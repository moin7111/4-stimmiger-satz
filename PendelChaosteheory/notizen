<body>

<a id="logo" href="../index-de.html">
  <img src="../common/myphysicslogo.png" width="162" height="32" alt="my physics lab logo">
</a>

<h1 lang="de">Doppel Pendel</h1>

<div id="header_nav">
<select id="language_menu" onchange="location = this.options[this.selectedIndex].value;">
    <option value="double-pendulum-en.html">Englisch</option>
    <option value="double-pendulum-de.html" selected="">Deutsch</option>
  </select>
<a class="nav_link" href="../pendulum/moveable-pendulum-de.html">vorherig</a>
<a class="nav_link" href="../pendulum/moveable-double-pendulum-de.html">nächste</a>
</div>

<ul id="header_bar" class="horiz_tabs">
  <li class="sim selected">Sim</li>
  <li class="graph ">Graph</li>
  <li class="time_graph">Zeit Graph</li>
  <li class="multi_graph">MehrGraphen</li>
</ul>



<div id="container" class="control_container" lang="de">
  <div id="div_graph" style="position: relative; float: left; display: none; width: 59%; height: auto;">
  <canvas contenteditable="false" width="800" height="800"></canvas><div style="position: absolute; left: 5%; top: 5%; width: 126px; display: none;"><div style="float: right; margin-top: 18px;"><button type="button" class="icon"><img src="../common/plus_gray.png" width="30" height="30"></button><br><button type="button" class="icon"><img src="../common/minus_gray.png" width="30" height="30"></button></div><div style="text-align: center;"><div style="width: 96px;"><button type="button" class="icon"><img src="../common/up_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/backward_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/target_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/forward_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/down_gray.png" width="30" height="30"></button></div></div></div></div>
  <div id="div_time_graph" style="position: relative; float: left; display: none;">
  <canvas contenteditable="false" width="800" height="800"></canvas><div style="position: absolute; left: 5%; top: 5%; width: 126px; display: none;"><div style="float: right; margin-top: 18px;"><button type="button" class="icon"><img src="../common/plus_gray.png" width="30" height="30"></button><br><button type="button" class="icon"><img src="../common/minus_gray.png" width="30" height="30"></button></div><div style="text-align: center;"><div style="width: 96px;"><button type="button" class="icon"><img src="../common/up_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/backward_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/target_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/forward_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/down_gray.png" width="30" height="30"></button></div></div></div></div>
  <div id="sim_applet" style="position: relative; float: left; width: 59%; height: auto; display: block;">
  <canvas tabindex="0" contenteditable="false" width="800" height="740"></canvas><div style="position: absolute; left: 5%; top: 5%; width: 126px; display: none;"><div style="float: right; margin-top: 18px;"><button type="button" class="icon"><img src="../common/plus_gray.png" width="30" height="30"></button><br><button type="button" class="icon"><img src="../common/minus_gray.png" width="30" height="30"></button></div><div style="text-align: center;"><div style="width: 96px;"><button type="button" class="icon"><img src="../common/up_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/backward_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/target_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/forward_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/down_gray.png" width="30" height="30"></button></div></div></div></div>
  <div id="sim_controls" class="control_group" style="margin-left: 10px; display: inline-block; column-count: 1; width: auto;">
  <div style="width: max-content; display: block;"><button type="button" class="icon"><img src="../common/restart.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/forward.png" width="30" height="30" style="display: none;"><img src="../common/pause.png" width="30" height="30" style="display: block;"></button><button type="button" class="icon"><img src="../common/next.png" width="30" height="30"></button></div><div class="slider" style="display: block;">Stange-1 Länge<input type="range" min="0" max="100" step="1"><input type="text" size="4" style="text-align: right;"></div><div class="slider" style="display: block;">Stange-2 Länge<input type="range" min="0" max="100" step="1"><input type="text" size="4" style="text-align: right;"></div><div class="slider" style="display: block;">Masse-1<input type="range" min="0" max="100" step="1"><input type="text" size="4" style="text-align: right;"></div><div class="slider" style="display: block;">Masse-2<input type="range" min="0" max="100" step="1"><input type="text" size="4" style="text-align: right;"></div><div class="slider" style="display: block;">Gravitation<input type="range" min="0" max="100" step="1"><input type="text" size="4" style="text-align: right;"></div><label style="display: block;"><input type="checkbox">Energie anzeigen</label><label style="display: block;"><input type="checkbox">Zeit anzeigen</label><label style="display: block;"><input type="checkbox">pan-zoom</label><label style="display: block;">Zeitschritt<input type="text" size="6" style="text-align: right;"></label><label style="display: block;">Zeitraffer<input type="text" size="4" style="text-align: right;"></label><label style="display: block;">Diff Eq Löser<select><option>Eulers Methode</option><option>Modifiziert Euler</option><option>Runge-Kutta</option><option>Adaptiert-Modifiziert Euler</option><option>Adaptiert-Runge-Kutta</option></select></label><label style="display: block;">Hintergrund<select><option>weiss</option><option>schwarz</option><option>weiss mit Pfade</option><option>schwarz mit Pfade</option><option>weiss mit lange Pfade</option><option>schwarz mit lange Pfade</option></select></label><button type="button" style="display: block;">mitteilen</button></div>
  <div id="graph_controls" class="control_group" style="display: none;">
  <label style="display: block;">Y:<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><label style="display: block;">X:<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><button type="button" style="display: block;">Graph erneuern</button><label style="display: block;">Graph Farbe<select><option>Aquamarin</option><option>Schwarz</option><option>Blau</option><option>Purpurrot</option><option>Grau</option><option>Grün</option><option>Hellgrün</option><option>Kastanienbraun</option><option>Marineblau</option><option>Olivgrün</option><option>Purpur</option><option>Rot</option><option>Silber</option><option>Blaugrün</option><option>Weiss</option><option>Gelb</option></select></label><label style="display: block;">Zeichenbreite<input type="text" size="4" style="text-align: right;"></label><label style="display: block;">Zeichnenart<select><option>Punkte</option><option>Linien</option></select></label><label style="display: block;"><input type="checkbox">pan-zoom</label></div>
  <div id="time_graph_controls" class="control_group" style="display: none;">
  <label style="display: block;">lime<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><label style="display: block;">red<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><label style="display: block;">blue<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><label style="display: block;">X:<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><label style="display: block;">Zeitfenster<input type="text" size="4" style="text-align: right;"></label><button type="button" style="display: block;">Graph erneuern</button><label style="display: block;"><input type="checkbox">pan-zoom</label></div>
  <p>
  <label id="label_show_sim" style="display: none;">
    <input type="checkbox" id="show_sim" checked="">show sim
  </label>
  <label id="label_terminal" style="display: inline;">
    <input type="checkbox" id="show_terminal">terminal
  </label>
  </p><div id="div_terminal" style="display: none;">
    <textarea id="term_output" cols="80" rows="20" wrap="soft" spellcheck="false"></textarea> <br>
    <label style="display:inline-block">command &gt;
      <input type="text" id="term_input" size="80" spellcheck="false">
    </label>
  </div>
</div>

<p class="introduction">
This is a simulation of a double pendulum. For large motions it is a chaotic system,
but for small motions it is a simple linear system. </p>

<p class="instructions">
You can change parameters in the simulation such as mass, gravity, and length of rods.
You can drag the pendulum with your mouse to change the starting position. </p>

<p>The math behind the simulation is shown below.  Also available:
<a href="https://github.com/myphysicslab/myphysicslab/blob/master/src/sims/pendulum/DoublePendulumApp.ts">source code</a>,
<a href="../develop/docs/classes/sims_pendulum_DoublePendulumApp.DoublePendulumApp.html">documentation</a> and
<a href="../develop/docs/Customizing.html">how to customize</a>.
</p>


<p>For small angles, a pendulum behaves like a
<a href="../explain/classify-diff-eq-de.html#linear">linear</a> system (see
<a href="../pendulum/pendulum-de.html">Simple Pendulum</a>).
When the angles are small in the Double Pendulum, the system behaves like the linear
<a href="../springs/double-spring-de.html">Double Spring</a>.
In the graph, you can see similar
<a href="http://mathworld.wolfram.com/LissajousCurve.html">Lissajous curves</a>
being generated.  This is because the motion is determined by simple sine and cosine
functions.
</p>

<p>For large angles, the pendulum is non-linear and the phase graph becomes much more
complex. You can see this by dragging one of the masses to a larger angle and letting
go.</p>

<p>We regard the pendulum rods as being massless and rigid. We regard the pendulum
masses as being point masses. The derivation of the equations of motion is shown below,
using the direct Newtonian method.</p>

<h2 id="kinematics">Kinematics of the Double Pendulum</h2>

<div class="image" style="width: 110px;">
<img src="dbl_pendulum.gif" width="104" height="176" alt="double pendulum variables">
</div>

<div style="margin-left:115px; max-width: 45em;">
<p>Kinematics means the relations of the parts of the device, without regard to forces.
In kinematics we are only trying to find expressions for the position, velocity, and
acceleration in terms of the variables that specify the state of the device.
</p>

<ul class="vars">
    <li><span class="html-math inline-math">
<i>x</i> =
</span> horizontal position of pendulum mass</li>
    <li><span class="html-math inline-math">
<i>y</i> =
</span> vertical position of pendulum mass</li>
    <li><span class="html-math inline-math">
<i>θ</i> =
</span> angle of pendulum (0 = vertical downwards,
         counter-clockwise is positive)</li>
    <li><span class="html-math inline-math">
<i>L</i> =
</span> length of rod (constant)</li>
</ul>
</div>

<div style="clear: both;">
<p>We place the origin at the pivot point of the upper pendulum. We regard
<span class="html-math inline-math">
<i>y</i>
</span> as increasing upwards. We indicate the upper pendulum by subscript 1,
and the lower by subscript 2. Begin by using simple trigonometry to write expressions
for the positions <span class="html-math inline-math">
<i>x</i><sub>1</sub>, <i>y</i><sub>1</sub>, <i>x</i><sub>2</sub>, <i>y</i><sub>2</sub>
</span> in terms of the angles <span class="html-math inline-math">
<i>θ</i><sub>1</sub>, <i>θ</i><sub>2</sub>
</span>.
</p>

<p class="html-math display-equation">
<i>x</i><sub>1</sub> = <i>L</i><sub>1</sub> sin <i>θ</i><sub>1</sub>
</p>
<p class="html-math display-equation">
<i>y</i><sub>1</sub> = −<i>L</i><sub>1</sub> cos <i>θ</i><sub>1</sub>
</p>
<p class="html-math display-equation">
<i>x</i><sub>2</sub> = <i>x</i><sub>1</sub> + <i>L</i><sub>2</sub> sin <i>θ</i><sub>2</sub>
</p>
<p class="html-math display-equation">
<i>y</i><sub>2</sub> = <i>y</i><sub>1</sub> − <i>L</i><sub>2</sub> cos <i>θ</i><sub>2</sub>
</p>

<p>The velocity is the derivative with respect to time of the position.</p>

<p class="html-math display-equation">
<i>x</i><sub>1</sub>' = <i>θ</i><sub>1</sub>' <i>L</i><sub>1</sub> cos <i>θ</i><sub>1</sub>
</p>
<p class="html-math display-equation">
<i>y</i><sub>1</sub>' = <i>θ</i><sub>1</sub>' <i>L</i><sub>1</sub> sin <i>θ</i><sub>1</sub>
</p>
<p class="html-math display-equation">
<i>x</i><sub>2</sub>' = <i>x</i><sub>1</sub>' + <i>θ</i><sub>2</sub>' <i>L</i><sub>2</sub> cos <i>θ</i><sub>2</sub>
</p>
<p class="html-math display-equation">
<i>y</i><sub>2</sub>' = <i>y</i><sub>1</sub>' + <i>θ</i><sub>2</sub>' <i>L</i><sub>2</sub> sin <i>θ</i><sub>2</sub>
</p>

<p>The acceleration is the second derivative.</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>x</i><sub>1</sub>'' = −<i>θ</i><sub>1</sub>'<sup>2</sup> <i>L</i><sub>1</sub> sin <i>θ</i><sub>1</sub> + <i>θ</i><sub>1</sub>'' <i>L</i><sub>1</sub> cos <i>θ</i><sub>1</sub>

</td><td class="equation-number">(1)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>y</i><sub>1</sub>'' = <i>θ</i><sub>1</sub>'<sup>2</sup> <i>L</i><sub>1</sub> cos <i>θ</i><sub>1</sub> + <i>θ</i><sub>1</sub>'' <i>L</i><sub>1</sub> sin <i>θ</i><sub>1</sub>

</td><td class="equation-number">(2)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>x</i><sub>2</sub>'' = <i>x</i><sub>1</sub>'' − <i>θ</i><sub>2</sub>'<sup>2</sup> <i>L</i><sub>2</sub> sin <i>θ</i><sub>2</sub> + <i>θ</i><sub>2</sub>'' <i>L</i><sub>2</sub> cos <i>θ</i><sub>2</sub>

</td><td class="equation-number">(3)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>y</i><sub>2</sub>'' = <i>y</i><sub>1</sub>'' + <i>θ</i><sub>2</sub>'<sup>2</sup> <i>L</i><sub>2</sub> cos <i>θ</i><sub>2</sub> + <i>θ</i><sub>2</sub>'' <i>L</i><sub>2</sub> sin <i>θ</i><sub>2</sub>

</td><td class="equation-number">(4)</td></tr></tbody></table>
</div>





<h2>Forces in the Double Pendulum</h2>

<div class="image" style="width: 100px;">
<img src="dbl_pendulum_m1.gif" width="96" height="211" alt="forces in upper mass of double pendulum">
<br>
upper mass
<br><br>
<img src="dbl_pendulum_m2.gif" width="81" height="199" alt="forces in lower mass of double pendulum">
<br>
lower mass
</div>

<div style="margin-left:110px; max-width: 45em;">

<p>We treat the two pendulum masses as point particles. Begin by drawing the free body
diagram for the upper mass and writing an expression for the net force acting on it.
Define these variables: </p>

<ul class="vars">
    <li><span class="html-math inline-math">
<i>T</i> =
</span> tension in the rod</li>
    <li><span class="html-math inline-math">
<i>m</i> =
</span> mass of pendulum</li>
    <li><span class="html-math inline-math">
<i>g</i> =
</span> gravitational constant</li>
</ul>

<p>The forces on the upper pendulum mass are the tension in the upper rod <span class="html-math inline-math">
<i>T</i><sub>1</sub>
</span>,
the tension in the lower rod <span class="html-math inline-math">
<i>T</i><sub>2</sub>
</span>, and gravity <span class="html-math inline-math">
−<i>m</i><sub>1</sub> <i>g</i>
</span>. We write
separate equations for the horizontal and vertical forces, since they can be treated
independently. The net force on the mass is the sum of these. Here we show the net
force and use Newton's law <span class="html-math inline-math">
<i>F</i> = <i>m a</i>
</span>. </p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>1</sub> <i>x</i><sub>1</sub>'' = −<i>T</i><sub>1</sub> sin <i>θ</i><sub>1</sub> + <i>T</i><sub>2</sub> sin <i>θ</i><sub>2</sub>

</td><td class="equation-number">(5)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>1</sub> <i>y</i><sub>1</sub>'' = <i>T</i><sub>1</sub> cos <i>θ</i><sub>1</sub> − <i>T</i><sub>2</sub> cos <i>θ</i><sub>2</sub> −
<span class="nobr"><i>m</i><sub>1</sub> <i>g</i></span>

</td><td class="equation-number">(6)</td></tr></tbody></table>


<p>For the lower pendulum, the forces are the tension in the lower rod <span class="html-math inline-math">
<i>T</i><sub>2</sub>
</span>, and
gravity <span class="html-math inline-math">
−<i>m</i><sub>2</sub> <i>g</i>
</span>. </p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>2</sub> <i>x</i><sub>2</sub>'' = −<i>T</i><sub>2</sub> sin <i>θ</i><sub>2</sub>

</td><td class="equation-number">(7)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' = <i>T</i><sub>2</sub> cos <i>θ</i><sub>2</sub> − <i>m</i><sub>2</sub> <i>g</i>

</td><td class="equation-number">(8)</td></tr></tbody></table>

<p>In relating these equations to the diagrams, keep in mind that in the example
diagram <span class="html-math inline-math">
<i>θ</i><sub>1</sub>
</span> is positive and <span class="html-math inline-math">
<i>θ</i><sub>2</sub>
</span> is negative, because of the convention
that a counter-clockwise angle is positive.</p>
</div>





<h2>Direct Method for Finding Equations of Motion</h2>

<p>Now we do some algebraic manipulations with the goal of finding expressions for
<span class="html-math inline-math">
<i>θ</i><sub>1</sub>'', <i>θ</i><sub>2</sub>''
</span> in terms of <span class="html-math inline-math">
<i>θ</i><sub>1</sub>, <i>θ</i><sub>1</sub>', <i>θ</i><sub>2</sub>, <i>θ</i><sub>2</sub>'
</span>. Begin by solving equations
(7), (8) for <span class="html-math inline-math">
<i>T</i><sub>2</sub> sin <i>θ</i><sub>2</sub>
</span> and <span class="html-math inline-math">
<i>T</i><sub>2</sub> cos <i>θ</i><sub>2</sub>
</span> and then substituting into
equations (5) and (6).
</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>1</sub> <i>x</i><sub>1</sub>'' = −<i>T</i><sub>1</sub> sin <i>θ</i><sub>1</sub> − <i>m</i><sub>2</sub> <i>x</i><sub>2</sub>''

</td><td class="equation-number">(9)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>1</sub> <i>y</i><sub>1</sub>'' = <i>T</i><sub>1</sub> cos <i>θ</i><sub>1</sub> − <i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' − <i>m</i><sub>2</sub> <i>g</i> −
<span class="nobr"><i>m</i><sub>1</sub> <i>g</i></span>

</td><td class="equation-number">(10)</td></tr></tbody></table>

<p>Multiply equation (9) by <span class="html-math inline-math">
cos <i>θ</i><sub>1</sub>
</span> and equation (10) by <span class="html-math inline-math">
sin <i>θ</i><sub>1</sub>
</span> and
rearrange to get
</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>T</i><sub>1</sub> sin <i>θ</i><sub>1</sub> cos <i>θ</i><sub>1</sub> = −cos <i>θ</i><sub>1</sub> (<i>m</i><sub>1</sub> <i>x</i><sub>1</sub>'' +
<span class="nobr"><i>m</i><sub>2</sub> <i>x</i><sub>2</sub>'')</span>

</td><td class="equation-number">(11)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>T</i><sub>1</sub> sin <i>θ</i><sub>1</sub> cos <i>θ</i><sub>1</sub> = sin <i>θ</i><sub>1</sub> (<i>m</i><sub>1</sub> <i>y</i><sub>1</sub>'' + <i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' +
<span class="nobr"><i>m</i><sub>2</sub> <i>g</i></span> +
<span class="nobr"><i>m</i><sub>1</sub> <i>g</i>)</span>

</td><td class="equation-number">(12)</td></tr></tbody></table>

<p>This leads to the equation
</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
sin <i>θ</i><sub>1</sub> (<i>m</i><sub>1</sub> <i>y</i><sub>1</sub>'' + <i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' + <i>m</i><sub>2</sub> <i>g</i> +
<span class="nobr"><i>m</i><sub>1</sub> <i>g</i>)</span> =
<span class="nobr">−cos <i>θ</i><sub>1</sub> (<i>m</i><sub>1</sub> <i>x</i><sub>1</sub>'' + <i>m</i><sub>2</sub> <i>x</i><sub>2</sub>'')</span>

</td><td class="equation-number">(13)</td></tr></tbody></table>

<p>Next, multiply equation (7) by <span class="html-math inline-math">
cos <i>θ</i><sub>2</sub>
</span> and equation (8) by <span class="html-math inline-math">
sin <i>θ</i><sub>2</sub>
</span> and
rearrange to get
</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>T</i><sub>2</sub> sin <i>θ</i><sub>2</sub> cos <i>θ</i><sub>2</sub> = −cos <i>θ</i><sub>2</sub> (<i>m</i><sub>2</sub> <i>x</i><sub>2</sub>'')

</td><td class="equation-number">(14)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>T</i><sub>2</sub> sin <i>θ</i><sub>2</sub> cos <i>θ</i><sub>2</sub> = sin <i>θ</i><sub>2</sub> (<i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' + <i>m</i><sub>2</sub> <i>g</i>)

</td><td class="equation-number">(15)</td></tr></tbody></table>

<p>which leads to</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
sin <i>θ</i><sub>2</sub> (<i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' + <i>m</i><sub>2</sub> <i>g</i>) = −cos <i>θ</i><sub>2</sub> (<i>m</i><sub>2</sub> <i>x</i><sub>2</sub>'')

</td><td class="equation-number">(16)</td></tr></tbody></table>

<p>Next we need to use a computer algebra program to solve equations (13) and (16) for
<span class="html-math inline-math">
<i>θ</i><sub>1</sub>'', <i>θ</i><sub>2</sub>''
</span> in terms of <span class="html-math inline-math">
<i>θ</i><sub>1</sub>, <i>θ</i><sub>1</sub>', <i>θ</i><sub>2</sub>, <i>θ</i><sub>2</sub>'
</span>. Note that we also include the
definitions given by equations (1-4), so that we have 2 equations (13, 16) and 2
unknowns (<span class="html-math inline-math">
<i>θ</i><sub>1</sub>'', <i>θ</i><sub>2</sub>''
</span>). The result is somewhat complicated, but is easy enough
to program into the computer.</p>

<div class="html-math table-equation">
<table class="fraction">
    <tbody><tr>
        <td rowspan="2">
            <i>θ</i><sub>1</sub>''&nbsp;=&nbsp;
        </td><td>
            −<i>g</i> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) sin <i>θ</i><sub>1</sub> − <i>m</i><sub>2</sub> <i>g</i> sin(<i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>) −
            2 sin(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>) <i>m</i><sub>2</sub> (<i>θ</i><sub>2</sub>'<sup>2</sup> <i>L</i><sub>2</sub> + <i>θ</i><sub>1</sub>'<sup>2</sup> <i>L</i><sub>1</sub> cos(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>))
        </td>
    </tr><tr>
        <td class="upper_line">
            <i>L</i><sub>1</sub> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub> − <i>m</i><sub>2</sub> cos(2 <i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>))
        </td>
    </tr>
</tbody></table>

<table class="fraction">
    <tbody><tr>
        <td rowspan="2">
            <i>θ</i><sub>2</sub>''&nbsp;=&nbsp;
        </td><td>
            2 sin(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>) (<i>θ</i><sub>1</sub>'<sup>2</sup> <i>L</i><sub>1</sub> (<i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) + <i>g</i>(<i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) cos <i>θ</i><sub>1</sub>
            + <i>θ</i><sub>2</sub>'<sup>2</sup> <i>L</i><sub>2</sub> <i>m</i><sub>2</sub> cos(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>))
        </td>
    </tr><tr>
        <td class="upper_line">
            <i>L</i><sub>2</sub> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub> − <i>m</i><sub>2</sub> cos(2 <i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>))
        </td>
    </tr>
</tbody></table>
</div>

<p>These are the equations of motion for the double pendulum.</p>





<h2>Numerical Solution</h2>

<p>The above equations are now close to the form needed for the
<a href="../explain/runge-kutta-de.html">Runge Kutta method</a>. The final
step is convert these two 2nd order equations into four 1st order equations. Define the
first derivatives as separate variables:</p>

<ul class="vars">
    <li><span class="html-math inline-math">
<i>ω</i><sub>1</sub> =
</span> angular velocity of top rod</li>
    <li><span class="html-math inline-math">
<i>ω</i><sub>2</sub> =
</span> angular velocity of bottom rod</li>
</ul>

<p>Then we can write the four 1st order equations:</p>

<p class="html-math display-equation">
<i>θ</i><sub>1</sub>' = <i>ω</i><sub>1</sub>
</p>
<p class="html-math display-equation">
<i>θ</i><sub>2</sub>' = <i>ω</i><sub>2</sub>
</p>

<div class="html-math table-equation">
<table class="fraction">
    <tbody><tr>
        <td rowspan="2">
            <i>ω</i><sub>1</sub>'&nbsp;=&nbsp;
        </td><td>
            −<i>g</i> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) sin <i>θ</i><sub>1</sub> − <i>m</i><sub>2</sub> <i>g</i> sin(<i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>) −
            2 sin(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>) <i>m</i><sub>2</sub> (<i>ω</i><sub>2</sub><sup>2</sup> <i>L</i><sub>2</sub> + <i>ω</i><sub>1</sub><sup>2</sup> <i>L</i><sub>1</sub> cos(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>))
        </td>
    </tr><tr>
        <td class="upper_line">
            <i>L</i><sub>1</sub> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub> − <i>m</i><sub>2</sub> cos(2 <i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>))
        </td>
    </tr>
</tbody></table>

<table class="fraction">
    <tbody><tr>
        <td rowspan="2">
            <i>ω</i><sub>2</sub>'&nbsp;=&nbsp;
        </td><td>
            2 sin(<i>θ</i><sub>1</sub>−<i>θ</i><sub>2</sub>) (<i>ω</i><sub>1</sub><sup>2</sup> <i>L</i><sub>1</sub> (<i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) + <i>g</i>(<i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) cos <i>θ</i><sub>1</sub>
            + <i>ω</i><sub>2</sub><sup>2</sup> <i>L</i><sub>2</sub> <i>m</i><sub>2</sub> cos(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>))
        </td>
    </tr><tr>
        <td class="upper_line">
            <i>L</i><sub>2</sub> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub> − <i>m</i><sub>2</sub> cos(2 <i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>))
        </td>
    </tr>
</tbody></table>
</div>

<p>This is now exactly the form needed to plug in to the Runge-Kutta method for
numerical solution of the system.</p>

<p id="page_history">
  This web page was first published February 2002.
</p>


<div id="footer2">
  <div id="copyright">
  © <a href="mailto:erikn@myPhysicsLab.com" title="send comments to Erik Neumann">
  Erik Neumann</a>,  2004-2021<br>
  <span id="revised_date">revised Dec 19 2023 9:56</span>
</div> 
  <a class="nav_link" href="../pendulum/moveable-pendulum-de.html">vorherig</a>
  <a class="nav_link" href="../pendulum/moveable-double-pendulum-de.html">nächste</a>
  <a id="valid_html" href="https://validator.w3.org/check?uri=referer;outline=1;" title="check if this page is valid HTML">
  <img src="../common/ValidHTML401.png" alt="Valid HTML 4.01" height="31" width="88">
  </a>
</div>

<!-- Call the app script after the body so that html entities are defined and 
* the script can find them.--> 
<script src="DoublePendulumApp-de.js"></script>
<script>
  (function build() {
    var elem_ids = {
      tab_list: 'header_bar',
      container: 'container',
      term_output: 'term_output',
      term_input: 'term_input',
      sim_applet: 'sim_applet',
      div_graph: 'div_graph',
      graph_controls: 'graph_controls',
      sim_controls: 'sim_controls',
      div_terminal: 'div_terminal',
      div_time_graph: 'div_time_graph',
      time_graph_controls: 'time_graph_controls',
      div_multi_graph: 'div_multi_graph',
      multi_graph_controls: 'multi_graph_controls',
      label_terminal: 'label_terminal',
      show_terminal: 'show_terminal',
      show_sim: 'show_sim',
      images_dir: '../common'
    };
    app = new sims$pendulum$DoublePendulumApp(elem_ids);
    app.defineNames('app');
    window.addEventListener('pageshow', function(event){
      // set language menu to correct language
      var menu = document.getElementById('language_menu');
      if (menu) { menu.selectedIndex = 1; }
    }, /*capturing=*/false);
    app.setup();
    window.addEventListener('blur', function(event){
      app.eval('FIRING=false;', /*output=*/false);
    }, /*capturing=*/false);
    window.addEventListener('focus', function(event){
      app.eval('FIRING=true;', /*output=*/false);
    }, /*capturing=*/false);
  }());
</script>
<script>
  // separate script tag, runs even if error occurs in earlier script tag
  app.start();
</script>
<!--script>
  app.eval('TAB_LAYOUT.LAYOUT="sim+graph";');
</script-->

<script>
  document.getElementsByTagName("html")[0].style.visibility = "visible";
</script>


</body>



"use strict";(()=>{var r=class h{constructor(){throw""}static assert(t,e){if(h.ASSERTS&&!t)throw e&&console.log(e),"assert failed "+(e||"")}static array2string(t,e,i){e=e??h.NF7E,i===void 0&&(i=", ");let s=t.length,n="";for(let a=0;a<s;a++)n+=(a>0?i:"")+e(t[a]);return n}static arrayBool2string(t,e,i){e=e||"true",i=i||"false";let s=t.length,n="";for(let a=0;a<s;a++)n+=t[a]?e:i,a<s-1&&(n+=", ");return n}static colorString3(t,e,i){let s="#",n=[t,e,i];for(let a=0;a<3;a++)s+=h.numToHexChar1(n[a]);return h.assert(s.length==4),s}static colorString6(t,e,i){let s="#",n=[t,e,i];for(let a=0;a<3;a++)s+=h.numToHexChar2(n[a]);return h.assert(s.length==7),s}static createImage(t,e,i){let s=document.createElement("img");return s.src=t,s.width=e,s.height=i!==void 0?i:e,s}static defineGlobal(t,e,i){Object.defineProperty(globalThis,t,{value:e,writable:!!i})}static drop(t,e){return e>=0?t.slice(e):t.slice(0,t.length+e)}static equals(t,e){return t.length!==e.length?!1:t.every((i,s)=>i===e[s])}static forEachRight(t,e,i){let s=t.length;for(let n=s-1;n>=0;n--)e.call(i,t[n],n,t)}static getElementById(t){let e=document.getElementById(t);if(e===null)throw"elementId not found: "+t;return e}static getViewportSize(){let t=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);return[t,e]}static hypot(t,e){return Math.sqrt(t*t+e*e)}static isChrome(){let t=navigator;return t!=null?t.userAgent.match(/.*Chrome.*/)!=null:!1}static isIPhone(){let t=navigator;return t!=null?t.platform=="iPhone":!1}static isObject(t){return typeof t=="object"&&t!=null}static limitAngle(t){if(t>Math.PI){let e=Math.floor((t- -Math.PI)/(2*Math.PI));return t-2*Math.PI*e}else if(t<-Math.PI){let e=Math.floor(-(t-Math.PI)/(2*Math.PI));return t+2*Math.PI*e}else return t}static maybeElementById(t){try{return document.getElementById(t)}catch{return null}}static methodsOf(t){let e=[],i=Object.getPrototypeOf(t);for(;i;){let s=Object.getOwnPropertyNames(i);for(let n=0;n<s.length;n++){let a=s[n];a!=="constructor"&&typeof t[a]=="function"&&e.push(a)}if(i=Object.getPrototypeOf(i),i===null||i.constructor===Object)break}return e.sort(),h.removeDuplicates(e),e}static nameOf(t,e){for(let i in t)if(t[i]===e)return i;return""}static newBooleanArray(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=!1;return e}static newNumberArray(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=0;return e}static NF0(t){return t!=null?t.toFixed(0):t===null?"null":"undefined"}static NF18(t){return t!=null?t.toFixed(18):t===null?"null":"undefined"}static NF1S(t){return t!=null?(t>0?"+":"")+t.toFixed(1):t===null?"null":"undefined"}static NF2(t){return t!=null?t.toFixed(2):t===null?"null":"undefined"}static NF3(t){return t!=null?t.toFixed(3):t===null?"null":"undefined"}static NF4(t){return t!=null?t.toFixed(4):t===null?"null":"undefined"}static NF5(t){return t!=null?t.toFixed(5):t===null?"null":"undefined"}static NF5E(t){return t!=null?Math.abs(t)>2e-4||t==0?t.toFixed(5):t.toExponential(5):t===null?"null":"undefined"}static nf5(t){return t!=null?t.toFixed(5).replace(/\.?0+$/,""):t===null?"null":"undefined"}static NF7(t){return t!=null?t.toFixed(7):t===null?"null":"undefined"}static NF7E(t){return t!=null?Math.abs(t)>2e-6?t.toFixed(7):t.toExponential(7):t===null?"null":"undefined"}static nf7(t){return t!=null?t.toFixed(7).replace(/\.?0+$/,""):t===null?"null":"undefined"}static NF9(t){return t!=null?t.toFixed(9):t===null?"null":"undefined"}static NFE(t){return t!=null?t.toExponential(7):t===null?"null":"undefined"}static NFSCI(t){return t!=null?t.toExponential(17):t===null?"null":"undefined"}static numToHexChar1(t){return t=Math.floor(.5+16*t),t>=15?"f":t<=0?"0":h.HEX_DIGITS.charAt(t)}static numToHexChar2(t){if(t=Math.floor(.5+256*t),t>=255)return"ff";if(t<=0)return"00";{let e=Math.floor(t/16),i=t%16;return h.HEX_DIGITS.charAt(e)+h.HEX_DIGITS.charAt(i)}}static prettyPrint(t,e,i){typeof e!="number"&&(e=2),typeof i!="string"&&(i="  ");let s=String(t),n="",a=0,o=s.length,l=!1,_=[],c="";t:for(let g=0;g<o;g++){let d=s.charAt(g);if(l){if(d==" ")continue;l=!1}if(d=="{"||d=="["){if(a++,a<=e){n+=d+`
`;for(let m=0;m<a;m++)n+=i;l=!0}else n+=d;_.push(c),c=d=="{"?"}":"]"}else if(d==c){if(a<=e){a--,n+=`
`;for(let f=0;f<a;f++)n+=i;n+=d}else a--,n+=d;let m=_.pop();if(m===void 0)throw"error in  prettyPrint";if(c=m,a<0)throw"unbalanced "+c+" at "+g+" in "+t}else if(d=='"'||d=="'"){let m=d,f=g;for(n+=d;++g<o;)if(d=s.charAt(g),n+=d,d==m)continue t;throw"unbalanced quote at "+f+" in "+t}else if((d==","||d==";")&&a<=e){n+=d+`
`;for(let m=0;m<a;m++)n+=i;l=!0}else n+=d}return n=n.replace(/^\s+\n/gm,""),n}static printArray(t,e,i){if(h.DEBUG){e=e||80,i=i||h.NF5E;let s="";for(let n=0,a=t.length;n<a;n++){let o=i(t[n]);s.length+o.length>e?(console.log(s),s="  "+o):s+=" "+o}s.length>0&&console.log(s)}}static printNums5(t,...e){for(let i=0;i<e.length;i++){let s=e[i];typeof s=="number"&&(t+=" "+h.NF5(s))}console.log(t)}static propertiesOf(t,e){if(t===null)return["null"];e=e||!1;let i=[];for(let s in t)typeof t[s]!="function"&&(e?i.push(s+": "+t[s]):i.push(s));return i.sort(),i}static range(t){let e=[],i=0;for(;i<t;)e.push(i++);return e}static remove(t,e){let i,s=n=>n===e;return(i=t.findIndex(s))>=0?(t.splice(i,1),!0):!1}static removeAll(t,e){let i=!1;return h.forEachRight(t,(s,n)=>{s===e&&(t.splice(n,1),i=!0)}),i}static removeDuplicates(t){let e=t.length;if(e<=1)return;let i=t[0],s=1,n=1;for(;s<e;){if(t[s]===i){s++;continue}i=t[s],t[n]=i,s++,n++}t.length=n}static repeat(t,e){let i=[],s=0;for(;s++<e;)i.push(t);return i}static setErrorHandler(){if(window.onerror=function(t,e,i,s,n){let a=t+`
`+e+":"+i+":"+s+`
`+n;h.showErrorAlert(a)},h.DEBUG){let t=1;try{h.assert(!1),t=2}catch{console.log("asserts are working")}if(t==2)throw"asserts are not working"}else h.DEBUG&&console.log("WARNING: asserts are NOT enabled!")}static setImagesDir(t){if(t!==void 0)h.IMAGES_DIR=t;else throw"images directory not found"}static showErrorAlert(t){h.DEBUG&&console.log(t),h.numErrors++<h.maxErrors&&alert(t)}static systemTime(){return h.MODERN_CLOCK?performance.now()*.001:Date.now()*.001}static take(t,e){return e==0?"":e>0?t.slice(0,e):t.slice(t.length+e,t.length)}static testFinite(t){if(!isFinite(t))throw"not a finite number "+t;return t}static testNumber(t){if(isNaN(t))throw"not a number "+t;return t}static toName(t){return t.toUpperCase().replace(/[ -]/g,"_")}static uniqueElements(t){let e=t.length;if(e>1){let i=t.slice();i.sort();let s=i[0];for(let n=1;n<e;n++){if(s==i[n])return!1;s=i[n]}}return!0}static validName(t){if(!t.match(/^[A-Z_][A-Z_0-9]*$/))throw"not a valid name: "+t;return t}static veryDifferent(t,e,i,s){if(i=i||1e-14,!(isFinite(t)&&isFinite(e)))throw"argument is NaN";if(i<=0)throw"epsilon must be positive "+i;if(s=s||1,s<=0)throw"magnitude must be positive "+s;let n=Math.max(Math.abs(t),Math.abs(e)),a=n>s?n:s;return Math.abs(t-e)>a*i}static zeroArray(t){let e=t.length;for(let i=0;i<e;i++)t[i]=0}};r.ASSERTS=!0;r.COMPILE_TIME="Mon Dec 18 16:59:57 PST 2023";r.DEBUG=!0;r.HEX_DIGITS="0123456789abcdef";r.IMAGES_DIR=".";r.LOCALE="de";r.maxErrors=3;r.MAX_INTEGER=Math.pow(2,53);r.MIN_INTEGER=-Math.pow(2,53);r.MODERN_CLOCK=r.isObject(performance)&&typeof performance.now=="function";r.NOT_IMPLEMENTED="not implemented";r.numErrors=0;r.VERSION="2.0.0";r.NF=r.nf5;r.defineGlobal("lab$util$Util",r);var Ot="CHOICES_MODIFIED",p=class{constructor(t,e,i){this.name_=r.validName(r.toName(e)),this.subject_=t,this.value_=i}toString(){return this.toStringShort()}toStringShort(){let t=this.value_,e;return typeof t=="object"&&t!==null&&t.toStringShort!==void 0?e=t.toStringShort():e=t,'GenericEvent{name_:"'+this.name_+'", subject_: '+this.subject_.toStringShort()+", value_: "+e+"}"}getName(t){return t?this.name_:this.name_}getSubject(){return this.subject_}getValue(){return this.value_}nameEquals(t){return this.name_==r.toName(t)}};r.defineGlobal("lab$util$GenericEvent",p);var Y=class{constructor(t,e,i){this.purpose_=i||"",this.subject_=t,t.addObserver(this),this.observeFn_=e}toString(){return this.toStringShort()}toStringShort(){return"GenericObserver{subject_: "+this.subject_.toStringShort()+(this.purpose_.length>0?', purpose_:"'+this.purpose_+'"':"")+"}"}disconnect(){this.subject_.removeObserver(this)}observe(t){this.observeFn_(t)}};r.defineGlobal("lab$util$GenericObserver",Y);var N=class{constructor(t,e,i,s,n,a,o){if(this.isComputed_=!1,this.choices_=[],this.values_=[],this.subject_=t,this.name_=r.validName(r.toName(e)),this.localName_=i,this.getter_=s,this.setter_=n,this.isComputed_=!1,a!==void 0)if(o!==void 0)this.setChoices(a,o,!1);else throw"values not defined"}toString(){return this.toStringShort().slice(0,-1)+", isComputed_: "+this.isComputed_+', localName_: "'+this.localName_+'", choices_: '+this.choices_+"}"}toStringShort(){return'ParameterBoolean{name_: "'+this.name_+'", subject_: '+this.subject_.toStringShort()+", value: "+this.getValue()+"}"}getAsString(){return this.getValue().toString()}getChoices(){return Array.from(this.choices_)}getName(t){return t?this.localName_:this.name_}getSubject(){return this.subject_}getValue(){return this.getter_()}getValues(){return this.values_.map(t=>t.toString())}isComputed(){return this.isComputed_}nameEquals(t){return this.name_==r.toName(t)}setChoices(t,e,i){if(e.length!==t.length)throw"choices and values not same length";if(this.choices_=t,this.values_=e,i===void 0||i){let s=new p(this.subject_,Ot,this);this.subject_.broadcast(s)}}setComputed(t){this.isComputed_=t}setFromString(t){this.setValue(t=="true"||t=="TRUE")}setValue(t){if(typeof t!="boolean")throw"non-boolean value: "+t;t!==this.getValue()&&this.setter_(t)}};r.defineGlobal("lab$util$ParameterBoolean",N);var y=class{constructor(t,e,i,s,n,a,o){if(this.units_="",this.isComputed_=!1,this.signifDigits_=3,this.decimalPlaces_=-1,this.lowerLimit_=0,this.upperLimit_=Number.POSITIVE_INFINITY,this.choices_=[],this.values_=[],this.subject_=t,this.name_=r.validName(r.toName(e)),this.localName_=i,this.getter_=s,this.setter_=n,a!==void 0)if(o!==void 0)this.setChoices(a,o,!1);else throw"values is not defined"}toString(){return this.toStringShort().slice(0,-1)+", isComputed_: "+this.isComputed_+', localName_: "'+this.localName_+'", units_: "'+this.units_+'", lowerLimit_: '+r.NF(this.lowerLimit_)+", upperLimit_: "+r.NF(this.upperLimit_)+", decimalPlaces_: "+this.decimalPlaces_+", signifDigits_: "+this.signifDigits_+", choices_: ["+this.choices_+"], values_: ["+this.values_+"]}"}toStringShort(){return'ParameterNumber{name_: "'+this.name_+'", subject_: '+this.subject_.toStringShort()+", value: "+r.NF(this.getValue())+"}"}getAsString(){return this.getValue().toString()}getChoices(){return Array.from(this.choices_)}getDecimalPlaces(){return this.decimalPlaces_}getLowerLimit(){return this.lowerLimit_}getName(t){return t?this.localName_:this.name_}getSignifDigits(){return this.signifDigits_}getSubject(){return this.subject_}getUnits(){return this.units_}getUpperLimit(){return this.upperLimit_}getValue(){return this.getter_()}getValues(){return this.values_.map(t=>t.toString())}isComputed(){return this.isComputed_}nameEquals(t){return this.name_==r.toName(t)}setChoices(t,e,i){if(e.length!==t.length)throw"choices and values not same length";if(this.choices_=t,this.values_=e,i===void 0||i){let s=new p(this.subject_,Ot,this);this.subject_.broadcast(s)}}setComputed(t){this.isComputed_=t}setDecimalPlaces(t){return this.decimalPlaces_=t,this}setFromString(t){let e=Number(t);if(isNaN(e))throw"not a number: "+t;this.setValue(e)}setLowerLimit(t){if(t>this.getValue()||t>this.upperLimit_)throw"out of range: "+t+" value="+this.getValue()+" upper="+this.upperLimit_;return this.lowerLimit_=t,this}setSignifDigits(t){return this.signifDigits_=t,this}setUnits(t){return this.units_=t,this}setUpperLimit(t){if(t<this.getValue()||t<this.lowerLimit_)throw"out of range: "+t+" value="+this.getValue()+" lower="+this.lowerLimit_;return this.upperLimit_=t,this}setValue(t){if(typeof t!="number")throw"not a number: "+t;if(t<this.lowerLimit_||t>this.upperLimit_)throw"out of range. "+t+" is not between "+this.lowerLimit_+" and "+this.upperLimit_;if(this.values_.length>0&&!this.values_.includes(t))throw t+" is not an allowed value among: ["+this.values_.join(",")+"]";t!==this.getValue()&&this.setter_(t)}};r.defineGlobal("lab$util$ParameterNumber",y);var I=class{constructor(t,e,i,s,n,a,o){if(this.isComputed_=!1,this.suggestedLength_=20,this.maxLength_=Number.POSITIVE_INFINITY,this.choices_=[],this.values_=[],this.inputFunction_=null,this.subject_=t,this.name_=r.validName(r.toName(e)),this.localName_=i,this.getter_=s,this.setter_=n,a!==void 0)if(o!==void 0)this.setChoices(a,o,!1);else throw"values is not defined"}toString(){return this.toStringShort().slice(0,-1)+", isComputed_: "+this.isComputed_+', localName_: "'+this.localName_+'", suggestedLength_: '+this.suggestedLength_+", maxLength_: "+this.maxLength_+", choices_: ["+this.choices_+"], values_: ["+this.values_+"]}"}toStringShort(){return'ParameterString{name_: "'+this.name_+'", subject_: '+this.subject_.toStringShort()+', value: "'+this.getValue()+'"}'}getAsString(){return this.getValue()}getChoices(){return Array.from(this.choices_)}getMaxLength(){return this.maxLength_}getName(t){return t?this.localName_:this.name_}getSubject(){return this.subject_}getSuggestedLength(){return this.suggestedLength_}getValue(){return this.getter_()}getValues(){return Array.from(this.values_)}isComputed(){return this.isComputed_}nameEquals(t){return this.name_==r.toName(t)}setChoices(t,e,i){if(e.length!==t.length)throw"choices and values not same length";if(this.choices_=t,this.values_=e,i===void 0||i){let s=new p(this.subject_,Ot,this);this.subject_.broadcast(s)}}setComputed(t){this.isComputed_=t}setFromString(t){this.setValue(t)}setInputFunction(t){return this.inputFunction_=t,this}setMaxLength(t){if(t<this.getValue().length)throw"too long";return this.maxLength_=t,this}setSuggestedLength(t){return this.suggestedLength_=t,this}setValue(t){if(this.inputFunction_!=null&&(t=this.inputFunction_(t)),typeof t!="string")throw"non-string value: "+t;if(t.length>this.maxLength_)throw"string too long: "+t+" maxLength="+this.maxLength_;if(this.values_.length>0&&!this.values_.includes(t))throw'"'+t+'" is not an allowed value among: ['+this.values_.join(",")+"]";t!==this.getValue()&&this.setter_(t)}};r.defineGlobal("lab$util$ParameterString",I);var T=class{constructor(t){if(this.observers_=[],this.paramList_=[],this.doBroadcast_=!0,this.isBroadcasting_=!1,this.commandList_=[],!t)throw"no name";this.name_=r.validName(r.toName(t))}toString(){return", parameters: ["+this.paramList_.map(t=>t.toStringShort())+"], observers: ["+this.observers_.map(t=>t.toStringShort())+"]}"}toStringShort(){return this.getClassName()+'{name_: "'+this.getName()+'"}'}addObserver(t){let e={action:!0,observer:t};this.commandList_.push(e),this.doCommands()}doCommands(){if(!this.isBroadcasting_){for(let t=0,e=this.commandList_.length;t<e;t++){let i=this.commandList_[t];i.action?this.observers_.includes(i.observer)||this.observers_.push(i.observer):r.remove(this.observers_,i.observer)}this.commandList_=[]}}addParameter(t){let e=t.getName(),i=this.getParam_(e);if(i!=null)throw"parameter "+e+" already exists: "+i;this.paramList_.push(t)}broadcast(t){if(this.doBroadcast_){this.isBroadcasting_=!0;try{this.observers_.forEach(e=>e.observe(t))}finally{this.isBroadcasting_=!1,this.doCommands()}}}broadcastParameter(t){let e=this.getParam_(t);if(e==null)throw"unknown Parameter "+t;this.broadcast(e)}getBroadcast(){return this.doBroadcast_}getName(){return this.name_}getObservers(){return Array.from(this.observers_)}getParam_(t){return t=r.toName(t),this.paramList_.find(e=>e.getName()==t)}getParameter(t){let e=this.getParam_(t);if(e!==void 0)return e;throw"Parameter not found "+t}getParameterBoolean(t){let e=this.getParam_(t);if(e instanceof N)return e;throw"ParameterBoolean not found "+t}getParameterNumber(t){let e=this.getParam_(t);if(e instanceof y)return e;throw"ParameterNumber not found "+t}getParameterString(t){let e=this.getParam_(t);if(e instanceof I)return e;throw"ParameterString not found "+t}getParameters(){return Array.from(this.paramList_)}removeObserver(t){let e={action:!1,observer:t};this.commandList_.push(e),this.doCommands()}removeParameter(t){r.remove(this.paramList_,t)}setBroadcast(t){let e=this.doBroadcast_;return this.doBroadcast_=t,e}};r.defineGlobal("lab$util$AbstractSubject",T);var Kt=class{constructor(t,e,i,s){this.label_=t,this.getter_=e,this.setter_=i,this.state_=e();let n=null;if(s!==void 0){let a=s.parentElement;a!=null&&a.tagName=="LABEL"&&(n=a)}else s=document.createElement("input"),s.type="checkbox",n=document.createElement("label"),n.appendChild(s),n.appendChild(document.createTextNode(this.label_));this.checkBox_=s,this.checkBox_.checked=this.state_,this.topElement_=n!==null?n:this.checkBox_,this.changeFn_=this.handleClick.bind(this),this.checkBox_.addEventListener("change",this.changeFn_,!0)}toString(){return this.toStringShort().slice(0,-1)+", state_: "+this.state_+"}"}toStringShort(){return this.getClassName()+'{label_: "'+this.label_+'"}'}disconnect(){this.checkBox_.removeEventListener("change",this.changeFn_,!0)}getClassName(){return"CheckBoxControlBase"}getElement(){return this.topElement_}getParameter(){return null}getState(){return this.getter_()}handleClick(t){this.setState(!this.getState())}observe(t){this.setState(this.getState())}setEnabled(t){this.checkBox_.disabled=!t}setState(t){this.getState()!=t&&this.setter_(t),this.state_!=this.getState()&&(this.state_=this.getState(),this.checkBox_.checked=this.state_)}};r.defineGlobal("lab$controls$CheckBoxControlBase",Kt);var j=class extends Kt{constructor(t,e){super(t.getName(!0),()=>t.getValue(),i=>t.setValue(i),e),this.parameter_=t,this.parameter_.getSubject().addObserver(this)}toString(){return super.toString().slice(0,-1)+", parameter_: "+this.parameter_.toStringShort()+"}"}disconnect(){super.disconnect(),this.parameter_.getSubject().removeObserver(this)}getClassName(){return"CheckBoxControl"}getParameter(){return this.parameter_}observe(t){t==this.parameter_&&super.observe(t)}};r.defineGlobal("lab$controls$CheckBoxControl",j);var At=class{constructor(t,e,i,s,n){this.getter_=i,this.setter_=s,this.choices=t,this.values_=e,this.currentIndex_=this.values_.indexOf(i()),this.selectMenu_=document.createElement("select"),r.assert(!this.selectMenu_.multiple),r.assert(this.selectMenu_.type=="select-one"),this.buildSelectMenu(),this.label_=n??"";let a=null;if(this.label_.length>0){let o=document.createElement("label");o.appendChild(document.createTextNode(this.label_)),o.appendChild(this.selectMenu_),a=o}this.selectMenu_.selectedIndex=this.currentIndex_,this.topElement_=a!==null?a:this.selectMenu_,this.changeFn_=this.itemStateChanged.bind(this),this.selectMenu_.addEventListener("change",this.changeFn_,!0)}toString(){return this.toStringShort().slice(0,-1)+", currentIndex_: "+this.currentIndex_+", choices.length: "+this.choices.length+', selected: "'+(this.currentIndex_>-1?this.choices[this.currentIndex_]:"(none)")+'"}'}toStringShort(){return this.getClassName()+'{label_: "'+this.label_+'"}'}buildSelectMenu(){this.selectMenu_.options.length=0;for(let t=0,e=this.choices.length;t<e;t++)this.selectMenu_.options[t]=new Option(this.choices[t])}disconnect(){this.selectMenu_.removeEventListener("change",this.changeFn_,!0)}getChoice(){return this.currentIndex_}getClassName(){return"ChoiceControlBase"}getElement(){return this.topElement_}getParameter(){return null}itemStateChanged(t){this.selectMenu_.selectedIndex!==this.currentIndex_&&this.setChoice(this.selectMenu_.selectedIndex)}observe(t){let e=this.values_.indexOf(this.getter_());this.setChoice(e)}setChoice(t){if(this.currentIndex_!==t){let e=this.selectMenu_.options.length;if(this.values_.length!=e)throw"ChoiceControl: values_.length="+this.values_.length+" but menu.options.length="+e;try{t<-1?t=-1:t>e-1&&(t=e-1),this.currentIndex_=t,t>-1&&this.setter_(this.values_[t])}catch(i){alert(i),this.currentIndex_=this.values_.indexOf(this.getter_())}this.selectMenu_.selectedIndex=this.currentIndex_}}setChoices(t,e){if(t.length!=e.length)throw"";this.choices=t,this.values_=e,this.currentIndex_=this.values_.indexOf(this.getter_()),this.buildSelectMenu(),this.selectMenu_.selectedIndex=this.currentIndex_}setEnabled(t){this.selectMenu_.disabled=!t}};r.defineGlobal("lab$controls$ChoiceControlBase",At);var H=class extends At{constructor(t,e,i,s){let n=i??t.getChoices(),a=s??t.getValues(),o=e??t.getName(!0);super(n,a,()=>t.getAsString(),l=>t.setFromString(l),o),this.parameter_=t,this.parameter_.getSubject().addObserver(this)}toString(){return super.toString().slice(0,-1)+", parameter_: "+this.parameter_.toStringShort()+"}"}disconnect(){super.disconnect(),this.parameter_.getSubject().removeObserver(this)}getClassName(){return"ChoiceControl"}getParameter(){return this.parameter_}observe(t){t.getValue()==this.parameter_&&t.nameEquals(Ot)?setTimeout(()=>this.rebuildMenu(),50):t==this.parameter_&&super.observe(t)}rebuildMenu(){let t=this.parameter_.getChoices();r.equals(this.choices,t)||this.setChoices(t,this.parameter_.getValues())}};r.defineGlobal("lab$controls$ChoiceControl",H);var Rt=class{constructor(){}systemTime(){return r.systemTime()}cancelCallback(t){clearTimeout(t)}scheduleCallback(t,e){return setTimeout(t,e)}requestAnimFrame(t){return requestAnimationFrame(t)}cancelAnimFrame(t){cancelAnimationFrame(t)}},A=class h extends T{constructor(t,e){super(t||"CLOCK"),this.timeRate_=1,this.saveTime_secs_=0,this.saveRealTime_secs_=0,this.isRunning_=!1,this.stepMode_=!1,this.tasks_=[],this.clockDebug_=!1,this.sysClock_=e||new Rt,this.clockStart_sys_secs_=this.sysClock_.systemTime(),this.realStart_sys_secs_=this.clockStart_sys_secs_,this.addParameter(new y(this,h.en.TIME_RATE,h.i18n.TIME_RATE,()=>this.getTimeRate(),i=>this.setTimeRate(i)))}toString(){return this.toStringShort().slice(0,-1)+", timeRate_: "+r.NF5(this.timeRate_)+", saveTime_secs_: "+r.NF5(this.saveTime_secs_)+", saveRealTime_secs_: "+r.NF5(this.saveRealTime_secs_)+", isRunning_: "+this.isRunning_+", stepMode_: "+this.stepMode_+", clockStart_sys_secs_: "+r.NF5(this.clockStart_sys_secs_)+", realStart_sys_secs_: "+r.NF5(this.realStart_sys_secs_)+", tasks_: ["+this.tasks_+"]"+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", time: "+r.NF5(this.getTime())+"}"}getClassName(){return"Clock"}addTask(t){this.tasks_.includes(t)||(this.tasks_.push(t),this.scheduleTask(t))}cancelAllTasks(){this.tasks_.forEach(t=>t.cancel())}clearStepMode(){this.stepMode_=!1}clockToSystem(t){return t/this.timeRate_+this.clockStart_sys_secs_}executeTasks(t,e){this.tasks_.forEach(i=>{i.getTime()>=t&&i.getTime()<=t+e&&i.schedule(0)})}getRealTime(){return this.isRunning_?(this.sysClock_.systemTime()-this.realStart_sys_secs_)*this.timeRate_:this.saveRealTime_secs_}getTasks(){return Array.from(this.tasks_)}getTime(){return this.isRunning_?(this.sysClock_.systemTime()-this.clockStart_sys_secs_)*this.timeRate_:this.saveTime_secs_}getTimeRate(){return this.timeRate_}isRunning(){return this.isRunning_}isStepping(){return this.stepMode_}pause(){this.clearStepMode(),this.isRunning_&&(this.saveTime_secs_=this.getTime(),this.saveRealTime_secs_=this.getRealTime(),this.cancelAllTasks(),this.isRunning_=!1,this.broadcast(new p(this,h.CLOCK_PAUSE)),r.DEBUG&&this.clockDebug_&&console.log("Clock.pause "+this.toString()))}removeTask(t){r.remove(this.tasks_,t),t.cancel()}resume(){this.clearStepMode(),this.isRunning_||(this.isRunning_=!0,this.setTimePrivate(this.saveTime_secs_),this.setRealTime(this.saveRealTime_secs_),r.DEBUG&&this.clockDebug_&&console.log("Clock.resume "+this.toString()),this.broadcast(new p(this,h.CLOCK_RESUME)))}scheduleTask(t){if(t.cancel(),this.isRunning_){let e=this.clockToSystem(this.getTime()),i=this.clockToSystem(t.getTime());r.veryDifferent(i,e)?i>e&&t.schedule(i-e):t.execute()}}setRealTime(t){r.DEBUG&&this.clockDebug_&&console.log("Clock.setRealTime "+r.NF5(t)),this.isRunning_?this.realStart_sys_secs_=this.sysClock_.systemTime()-t/this.timeRate_:this.saveRealTime_secs_=t}setTime(t){let e=this.getTime();r.veryDifferent(e,t,.001)&&(this.setTimePrivate(t),r.DEBUG&&this.clockDebug_&&console.log("Clock.setTime("+t+") getTime="+e+" realTime="+r.NF5(this.getRealTime())),this.broadcast(new p(this,h.CLOCK_SET_TIME)))}setTimePrivate(t){this.isRunning_?(this.clockStart_sys_secs_=this.sysClock_.systemTime()-t/this.timeRate_,this.tasks_.forEach(e=>this.scheduleTask(e))):this.saveTime_secs_=t}setTimeRate(t){if(r.veryDifferent(this.timeRate_,t)){let e=this.getTime(),i=this.getRealTime();this.timeRate_=t,this.setTimePrivate(e),this.setRealTime(i);let s=Math.abs(e-this.getTime());r.assert(s<.002,"time diff="+s),s=Math.abs(i-this.getRealTime()),r.assert(s<.002,"realTime diff="+s),this.broadcastParameter(h.en.TIME_RATE)}}step(t){this.pause(),this.stepMode_=!0,r.assert(typeof t=="number");let e=this.saveTime_secs_;this.saveTime_secs_+=t,this.saveRealTime_secs_+=t,this.broadcast(new p(this,h.CLOCK_STEP)),r.DEBUG&&this.clockDebug_&&console.log("Clock.step timeStep="+r.NFE(t)+" "+this.toString()),this.executeTasks(e,t)}systemToClock(t){return(t-this.clockStart_sys_secs_)*this.timeRate_}};A.CLOCK_PAUSE="CLOCK_PAUSE";A.CLOCK_RESUME="CLOCK_RESUME";A.CLOCK_SET_TIME="CLOCK_SET_TIME";A.CLOCK_STEP="CLOCK_STEP";A.en={TIME_RATE:"time rate"};A.de_strings={TIME_RATE:"Zeitraffer"};A.i18n=r.LOCALE==="de"?A.de_strings:A.en;r.defineGlobal("lab$util$Clock",A);var Tt=class{constructor(t,e,i){this.timeoutID_=NaN,this.sysClock_=i||new Rt,this.callBack_=e,this.time_=t}toString(){return"ClockTask{time_: "+r.NF(this.time_)+", timeoutID_: "+this.timeoutID_+", callBack_: "+this.callBack_+"}"}cancel(){isFinite(this.timeoutID_)&&(this.sysClock_.cancelCallback(this.timeoutID_),this.timeoutID_=NaN)}execute(){typeof this.callBack_=="function"&&this.callBack_()}getTime(){return this.time_}schedule(t){if(this.cancel(),typeof this.callBack_=="function"){let e=Math.round(t*1e3);this.timeoutID_=this.sysClock_.scheduleCallback(this.callBack_,e)}}setCallback(t){this.callBack_=t}};r.defineGlobal("lab$util$ClockTask",Tt);var P=class{constructor(t,e,i,s){this.repeatDelay=0,this.repeatFirst=2,this.label_=t,s===void 0&&(s=document.createElement("button"),s.type="button",i===void 0?s.appendChild(document.createTextNode(t)):(s.className="icon",s.appendChild(i))),this.button_=s,this.clickFunction_=e,this.mouseDownFn_=this.handleClick.bind(this),this.button_.addEventListener("mousedown",this.mouseDownFn_,!0),this.mouseUpFn_=this.handleMouseUp.bind(this),this.button_.addEventListener("mouseup",this.mouseUpFn_,!0),this.button_.addEventListener("dragleave",this.mouseUpFn_,!1)}toString(){return this.toStringShort().slice(0,-1)+", timeoutID_: "+this.timeoutID_+", repeatDelay: "+r.NF(this.repeatDelay)+", repeatFirst: "+this.repeatFirst+"}"}toStringShort(){return'ButtonControl{label_: "'+this.label_+'"}'}disconnect(){this.button_.removeEventListener("mousedown",this.mouseDownFn_,!0),this.button_.removeEventListener("mouseup",this.mouseUpFn_,!0),this.button_.removeEventListener("dragleave",this.mouseUpFn_,!1)}getElement(){return this.button_}getParameter(){return null}handleClick(t){this.holdClick()}handleMouseUp(t){this.timeoutID_!==void 0&&(clearTimeout(this.timeoutID_),this.timeoutID_=void 0)}holdClick(){if(this.clickFunction_(),this.repeatDelay>0){let t=this.timeoutID_!==void 0?this.repeatDelay:this.repeatFirst*this.repeatDelay;this.timeoutID_=setTimeout(()=>this.holdClick(),t)}}setClickFunction(t){this.clickFunction_=t}setEnabled(t){this.button_.disabled=!t}};r.defineGlobal("lab$controls$ButtonControl",P);var u=class h{constructor(t,e,i){let s=typeof i=="number"?i:0;this.x_=r.testNumber(t),this.y_=r.testNumber(e),this.z_=r.testNumber(s),this.length_=NaN,this.lengthSquared_=NaN}toString(){return"Vector{x: "+r.NF5(this.x_)+", y: "+r.NF5(this.y_)+(this.z_!=0?", z: "+r.NF5(this.z_):"")+"}"}static clone(t){return t instanceof h?t:new h(t.getX(),t.getY(),t.getZ())}add(t){return new h(this.x_+t.getX(),this.y_+t.getY(),this.z_+t.getZ())}angleTo(t){if(this.getZ()!=0||t.getZ()!=0)throw"";let e=Math.atan2(this.y_,this.x_),i=Math.atan2(t.getY(),t.getX());return r.limitAngle(i-e)}distanceSquaredTo(t){let e=this.x_-t.getX(),i=this.y_-t.getY(),s=this.z_-t.getZ();return e*e+i*i+s*s}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}divide(t){if(t===1)return this;if(t<h.TINY_POSITIVE)throw"Vector.divide by near zero factor "+r.NFE(t);return new h(this.x_/t,this.y_/t,this.z_/t)}dotProduct(t){let e=this.x_*t.getX()+this.y_*t.getY()+this.z_*t.getZ();if(isNaN(e))throw r.DEBUG?"dotproduct is not a number "+this+" "+t:"";return e}equals(t){return t===null?!1:t.getX()===this.x_&&t.getY()===this.y_&&t.getZ()===this.z_}getAngle(){return Math.atan2(this.y_,this.x_)}getX(){return this.x_}getY(){return this.y_}getZ(){return this.z_}length(){return isNaN(this.length_)&&(this.length_=Math.sqrt(this.lengthSquared())),this.length_}lengthCheap(){let t=Math.abs(this.x_)+Math.abs(this.y_);return this.z_==0?t:t+Math.abs(this.z_)}lengthSquared(){return isNaN(this.lengthSquared_)&&(this.z_===0?this.lengthSquared_=this.x_*this.x_+this.y_*this.y_:this.lengthSquared_=this.x_*this.x_+this.y_*this.y_+this.z_*this.z_),this.lengthSquared_}multiply(t){return t===1?this:new h(t*this.x_,t*this.y_,t*this.z_)}nearEqual(t,e){return!(r.veryDifferent(this.x_,t.getX(),e)||r.veryDifferent(this.y_,t.getY(),e)||r.veryDifferent(this.z_,t.getZ(),e))}normalize(){return this.divide(this.length())}rotate(t,e){let i;if(e!==void 0?i=t:(i=Math.cos(t),e=Math.sin(t)),Math.abs(i*i+e*e-1)>1e-12)throw"not cosine, sine: "+i+", "+e;return new h(this.x_*i-this.y_*e,this.x_*e+this.y_*i,this.z_)}subtract(t){return new h(this.x_-t.getX(),this.y_-t.getY(),this.z_-t.getZ())}};u.TINY_POSITIVE=1e-10;u.ORIGIN=new u(0,0);u.EAST=new u(1,0);u.NORTH=new u(0,1);u.SOUTH=new u(0,-1);u.WEST=new u(-1,0);r.defineGlobal("lab$util$Vector",u);var S=class h{constructor(t,e,i,s){if(t>i)throw"DoubleRect: left > right: "+t+" > "+i;if(e>s)throw"DoubleRect: bottom > top: "+e+" > "+s;this.left_=r.testNumber(t),this.right_=r.testNumber(i),this.bottom_=r.testNumber(e),this.top_=r.testNumber(s)}toString(){return"DoubleRect{left_: "+r.NF(this.left_)+", bottom_: "+r.NF(this.bottom_)+", right_: "+r.NF(this.right_)+", top_: "+r.NF(this.top_)+"}"}static clone(t){return new h(t.getLeft(),t.getBottom(),t.getRight(),t.getTop())}static make(t,e){let i=Math.min(t.getX(),e.getX()),s=Math.max(t.getX(),e.getX()),n=Math.min(t.getY(),e.getY()),a=Math.max(t.getY(),e.getY());return new h(i,n,s,a)}static makeCentered(t,e,i){let s=t.getX(),n=t.getY();return new h(s-e/2,n-i/2,s+e/2,n+i/2)}static makeCentered2(t,e){let i=t.getX(),s=t.getY(),n=e.getX(),a=e.getY();return new h(i-n/2,s-a/2,i+n/2,s+a/2)}contains(t){return t.getX()>=this.left_&&t.getX()<=this.right_&&t.getY()>=this.bottom_&&t.getY()<=this.top_}equals(t){return t===this?!0:t instanceof h?t.getLeft()==this.left_&&t.getRight()==this.right_&&t.getBottom()==this.bottom_&&t.getTop()==this.top_:!1}expand(t,e){return e=e===void 0?t:e,new h(this.getLeft()-t,this.getBottom()-e,this.getRight()+t,this.getTop()+t)}getBottom(){return this.bottom_}getCenter(){return new u(this.getCenterX(),this.getCenterY())}getCenterX(){return(this.left_+this.right_)/2}getCenterY(){return(this.bottom_+this.top_)/2}getHeight(){return this.top_-this.bottom_}getLeft(){return this.left_}getRight(){return this.right_}getTop(){return this.top_}getWidth(){return this.right_-this.left_}intersection(t){let e=Math.max(this.left_,t.getLeft()),i=Math.max(this.bottom_,t.getBottom()),s=Math.min(this.right_,t.getRight()),n=Math.min(this.top_,t.getTop());return e>s||i>n?h.EMPTY_RECT:new h(e,i,s,n)}isEmpty(t){let e=t||1e-16;return this.getWidth()<e||this.getHeight()<e}maybeVisible(t,e){if(this.contains(t)||this.contains(e))return!0;let i=t.getX(),s=t.getY(),n=e.getX(),a=e.getY(),o=this.left_;return!(i<o&&n<o||(o=this.right_,i>o&&n>o)||(o=this.bottom_,s<o&&a<o)||(o=this.top_,s>o&&a>o))}nearEqual(t,e){return!(r.veryDifferent(this.left_,t.getLeft(),e)||r.veryDifferent(this.bottom_,t.getBottom(),e)||r.veryDifferent(this.right_,t.getRight(),e)||r.veryDifferent(this.top_,t.getTop(),e))}scale(t,e){e=e===void 0?t:e;let i=this.getCenterX(),s=this.getCenterY(),n=this.getWidth(),a=this.getHeight();return new h(i-t*n/2,s-e*a/2,i+t*n/2,s+e*a/2)}translate(t,e){let i,s;if(typeof t=="number")i=t,s=e;else{let n=t;s=n.getY(),i=n.getX()}if(typeof i!="number"||typeof s!="number")throw"";return new h(this.left_+i,this.bottom_+s,this.right_+i,this.top_+s)}union(t){return new h(Math.min(this.left_,t.getLeft()),Math.min(this.bottom_,t.getBottom()),Math.max(this.right_,t.getRight()),Math.max(this.top_,t.getTop()))}unionPoint(t){return new h(Math.min(this.left_,t.getX()),Math.min(this.bottom_,t.getY()),Math.max(this.right_,t.getX()),Math.max(this.top_,t.getY()))}};S.EMPTY_RECT=new S(0,0,0,0);r.defineGlobal("lab$util$DoubleRect",S);var kt=class h{constructor(t,e,i){this.fontDescent=8,this.fontAscent=12,this.horizAlignValue_=0,this.horizAxisAlignment_="VALUE",this.vertAlignValue_=0,this.vertAxisAlignment_="VALUE",this.numDecimal_=0,this.changed_=!0,this.horizName_="x",this.verticalName_="y",this.zIndex=100,this.simRect_=t??S.EMPTY_RECT,this.numFont_=e??"14pt sans-serif",this.drawColor_=i??"gray"}toString(){return this.toStringShort().slice(0,-1)+", horizAxisAlignment_: "+this.horizAxisAlignment_+", vertAxisAlignment_: "+this.vertAxisAlignment_+", this.horizAlignValue_: "+r.NF(this.horizAlignValue_)+", this.vertAlignValue_: "+r.NF(this.vertAlignValue_)+', drawColor_: "'+this.drawColor_+'", numFont_: "'+this.numFont_+'", simRect_: '+this.simRect_+", zIndex: "+this.zIndex+"}"}toStringShort(){return'DisplayAxes{horizName_: "'+this.horizName_+'", verticalName_: "'+this.verticalName_+'"}'}contains(t){return!1}draw(t,e){t.save(),t.strokeStyle=this.drawColor_,t.fillStyle=this.drawColor_,t.font=this.numFont_,t.textAlign="start",t.textBaseline="alphabetic";let i,s,n=this.simRect_,a=n.getLeft(),o=n.getRight(),l=n.getBottom(),_=n.getTop(),c=o-.06*(o-a),g=a+.01*(o-a);switch(this.vertAxisAlignment_){case"VALUE":let b=this.vertAlignValue_;b<g?b=g:b>c&&(b=c),i=e.simToScreenX(b);break;case"RIGHT":i=e.simToScreenX(c);break;case"LEFT":i=e.simToScreenX(g);break;default:i=e.simToScreenX(n.getCenterX())}let d=e.simToScreenY(_),m=e.simToScreenY(l),f=10+this.fontDescent+this.fontAscent;switch(this.horizAxisAlignment_){case"VALUE":s=e.simToScreenY(this.horizAlignValue_),s<d+f?s=d+f:s>m-f&&(s=m-f);break;case"TOP":s=d+f;break;case"BOTTOM":s=m-f;break;default:s=e.simToScreenY(n.getCenterY())}t.beginPath(),t.moveTo(e.simToScreenX(a),s),t.lineTo(e.simToScreenX(o),s),t.stroke(),this.drawHorizTicks(s,t,e,this.simRect_),t.beginPath(),t.moveTo(i,e.simToScreenY(l)),t.lineTo(i,e.simToScreenY(_)),t.stroke(),this.drawVertTicks(i,t,e,this.simRect_),t.restore()}drawHorizTicks(t,e,i,s){let n=t-4,a=n+8,o=s.getLeft(),l=s.getRight(),_=this.getNiceIncrement(l-o),c=h.getNiceStart(o,_);for(;c<l;){let d=i.simToScreenX(c);e.beginPath(),e.moveTo(d,n),e.lineTo(d,a),e.stroke();let m=c+_;if(m>c){let f=c.toFixed(this.numDecimal_),b=e.measureText(f).width;e.fillText(f,d-b/2,a+this.fontAscent)}else{e.fillText("scale is too small",d,a+this.fontAscent);break}c=m}let g=e.measureText(this.horizName_).width;e.fillText(this.horizName_,i.simToScreenX(l)-g-5,t-8)}drawVertTicks(t,e,i,s){let n=t-4,a=n+8,o=s.getBottom(),l=s.getTop(),_=this.getNiceIncrement(l-o),c=h.getNiceStart(o,_);for(;c<l;){let d=i.simToScreenY(c);e.beginPath(),e.moveTo(n,d),e.lineTo(a,d),e.stroke();let m=c+_;if(m>c){let f=c.toFixed(this.numDecimal_),b=e.measureText(f).width;this.vertAxisAlignment_==="RIGHT"?e.fillText(f,a-(b+10),d+this.fontAscent/2):e.fillText(f,a+5,d+this.fontAscent/2)}else{e.fillText("scale is too small",a,d);break}c=m}let g=e.measureText(this.verticalName_).width;this.vertAxisAlignment_==="RIGHT"?e.fillText(this.verticalName_,t-(g+6),i.simToScreenY(l)+13):e.fillText(this.verticalName_,t+6,i.simToScreenY(l)+13)}getChanged(){return this.changed_?(this.changed_=!1,!0):!1}getColor(){return this.drawColor_}getFont(){return this.numFont_}getHorizName(){return this.horizName_}getMassObjects(){return[]}getNiceIncrement(t){let e=Math.pow(10,Math.floor(Math.log(t)/Math.LN10)),i=t/e,s;i>=8?s=2:i>=5?s=1:i>=3?s=.5:i>=2?s=.4:s=.2,s*=e;let n=Math.log(s)/Math.LN10;return this.numDecimal_=n<0?Math.ceil(-n):0,s}static getNiceStart(t,e){return Math.ceil(t/e)*e}getPosition(){return u.ORIGIN}getSimObjects(){return[]}getSimRect(){return this.simRect_}getVerticalName(){return this.verticalName_}getXAxisAlignment(){return this.horizAxisAlignment_}getYAxisAlignment(){return this.vertAxisAlignment_}getZIndex(){return this.zIndex}isDragable(){return!1}setColor(t){this.drawColor_=t,this.changed_=!0}setDragable(t){}setFont(t){this.numFont_=t,this.changed_=!0}setHorizName(t){this.horizName_=t,this.changed_=!0}setPosition(t){}setSimRect(t){this.simRect_=t,this.changed_=!0}setVerticalName(t){this.verticalName_=t,this.changed_=!0}setXAxisAlignment(t,e){return this.horizAxisAlignment_=t,typeof e=="number"&&(this.horizAlignValue_=e),this.changed_=!0,this}setYAxisAlignment(t,e){return this.vertAxisAlignment_=t,typeof e=="number"&&(this.vertAlignValue_=e),this.changed_=!0,this}setZIndex(t){t!==void 0&&(this.zIndex=t),this.changed_=!0}};r.defineGlobal("lab$graph$DisplayAxes",kt);var B=class{constructor(t,e,i,s,n){this.dragable_=!0,this.font_="14pt sans-serif",this.textColor_="blue",this.handColor_="blue",this.realColor_="red",this.handWidth_=1,this.outlineWidth_=1,this.outlineColor_="black",this.fillStyle_="rgba(255, 255, 255, 0.75)",this.zIndex_=0,this.changed_=!0,this.lastSimTime_=0,this.simTimeFn_=t,this.realTimeFn_=e,this.period_=i??2,this.radius_=s??1,this.location_=n??u.ORIGIN}toString(){return this.toStringShort().slice(0,-1)+", radius: "+r.NF(this.radius_)+", period: "+r.NF(this.period_)+", location_: "+this.location_+", zIndex: "+this.zIndex_+"}"}toStringShort(){return"DisplayClock{time: "+r.NF(this.simTimeFn_())+"}"}contains(t){return t.distanceTo(this.location_)<=this.radius_}draw(t,e){let i=e.simToScreen(this.location_),s=e.simToScreenScaleX(this.radius_);t.save(),t.beginPath(),t.arc(i.getX(),i.getY(),s,0,2*Math.PI,!1),t.closePath(),t.lineWidth=this.outlineWidth_,t.strokeStyle=this.outlineColor_,t.stroke(),t.fillStyle=this.fillStyle_,t.fill();let n=this.simTimeFn_();this.lastSimTime_=n;let a=this.realTimeFn_();this.drawHand(t,e,this.handColor_,n,i),this.drawHand(t,e,this.realColor_,a,i);let o=n.toFixed(3);t.fillStyle=this.textColor_,t.font=this.font_,t.textAlign="center",t.fillText(o,i.getX(),i.getY()),t.restore()}drawHand(t,e,i,s,n){s=s-this.period_*Math.floor(s/this.period_);let a=s/this.period_,o=e.simToScreenScaleX(this.radius_*Math.sin(2*Math.PI*a)),l=e.simToScreenScaleY(this.radius_*Math.cos(2*Math.PI*a));t.lineWidth=this.handWidth_,t.strokeStyle=i,t.beginPath(),t.moveTo(n.getX(),n.getY()),t.lineTo(n.getX()+o,n.getY()-l),t.stroke()}isDragable(){return this.dragable_}getChanged(){return this.simTimeFn_()!=this.lastSimTime_||this.changed_?(this.changed_=!1,!0):!1}getFillStyle(){return this.fillStyle_}getFont(){return this.font_}getHandColor(){return this.handColor_}getHandWidth(){return this.handWidth_}getMassObjects(){return[]}getOutlineColor(){return this.outlineColor_}getOutlineWidth(){return this.outlineWidth_}getPosition(){return this.location_}getRealColor(){return this.realColor_}getSimObjects(){return[]}getTextColor(){return this.textColor_}getZIndex(){return this.zIndex_}setDragable(t){this.dragable_=t}setFillStyle(t){return this.fillStyle_=t,this.changed_=!0,this}setFont(t){return this.font_=t,this.changed_=!0,this}setHandColor(t){return this.handColor_=t,this.changed_=!0,this}setHandWidth(t){return this.handWidth_=t,this.changed_=!0,this}setOutlineColor(t){return this.outlineColor_=t,this.changed_=!0,this}setOutlineWidth(t){return this.outlineWidth_=t,this.changed_=!0,this}setPosition(t){this.location_=u.clone(t),this.changed_=!0}setRealColor(t){return this.realColor_=t,this.changed_=!0,this}setTextColor(t){return this.textColor_=t,this.changed_=!0,this}setZIndex(t){this.zIndex_=t!==void 0?t:0,this.changed_=!0}};B.en={SHOW_CLOCK:"show clock"};B.de_strings={SHOW_CLOCK:"Zeit anzeigen"};B.i18n=r.LOCALE==="de"?B.de_strings:B.en;r.defineGlobal("lab$view$DisplayClock",B);var st=class h{constructor(t,e){this.afterEvalFn_=void 0,this.changeFn_=void 0,this.hasAlerted_=!1,this.history_=[],this.histIndex_=-1,this.verbose_=!1,this.regexs_=[],this.result=void 0,this.resultStack_=[],this.z={},this.parser=null,this.vars_="",this.evalCalls_=0,this.prompt_="> ",this.term_input_=t,t&&(t.spellcheck=!1,this.keyDownFn_=this.handleKey.bind(this),t.addEventListener("keydown",this.keyDownFn_,!1)),this.term_output_=e,e&&(e.spellcheck=!1),this.addRegex("eval","terminal.",!1),this.println(h.version())}toString(){return"Terminal{history.length: "+this.history_.length+", regexs_.length: "+this.regexs_.length+", verbose_: "+this.verbose_+", parser: "+(this.parser!=null?this.parser.toStringShort():"null")+"}"}addRegex(t,e,i,s){let n=i??!0;if(t.length==0)throw"";if(n){let l=t.split("|"),_=this.vars_.split("|");l.forEach(c=>{_.includes(c)||(this.vars_+=(this.vars_.length>0?"|":"")+c)})}let a=new RegExp("(^|[^\\w.$])("+t+")\\b","g"),o="$1"+e+"$2";return this.addRegex2(a,o,s)}addRegex2(t,e,i){let s={regex:t,replace:e};return this.hasRegex(s)?!1:(i?this.regexs_.unshift(s):this.regexs_.push(s),!0)}addToVars(t){this.vars_+=(this.vars_.length>0?"|":"")+t}alertOnce(t){this.hasAlerted_?console.log(t):(this.hasAlerted_=!0,alert(t))}clear(){this.term_output_&&(this.term_output_.value="")}commands(){if(this.term_output_){let t=this.term_output_.value.split(`
`);return t=t.map(e=>e.trim()),t=t.filter(e=>e.length>2&&e.substr(0,2)=="> "&&!e.match(/^> (terminal|this).(remember|commands)\(\s*\);?$/)),t=t.map(e=>e.substr(2)),t}else return[]}destroy(){this.keyDownFn_&&this.term_input_&&this.term_input_.removeEventListener("keydown",this.keyDownFn_,!1),this.changeFn_&&this.term_input_&&this.term_input_.removeEventListener("change",this.changeFn_,!0)}static encodeURIComponent(t){return encodeURIComponent(t).replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16))}eval(t,e=!0,i=!0){if(t=t.trim(),t.match(/^\s*$/))return;this.evalCalls_++,this.evalCalls_>1&&(e=!1),e?(r.assert(this.evalCalls_==1),r.assert(this.resultStack_.length==0),this.history_.unshift(t),this.histIndex_=-1):(this.resultStack_.push(this.result),this.result=void 0);let s=this.prompt_;try{let n=["",t];for(;n=this.splitAtSemicolon(n[1]),n[0];){let a=n[0].trim();if(a.length!=0)t:{if(e&&this.println(s+a),a.match(/^\s*\/\/.*/))continue;if(this.parser!=null){let l=this.parser.parse(a);if(l!==void 0){this.result=l;break t}}let o=this.expand(a);e&&this.verbose_&&this.println(s.trim()+s+o);try{this.result=(0,eval)('"use strict";'+o)}catch(l){throw`${l} in script "${o}"`}}}e&&this.result!==void 0&&t.slice(-1)!=";"&&this.println(String(this.result)),e&&this.afterEvalFn_!==void 0&&this.afterEvalFn_(),this.error=""}catch(n){this.error=String(n),e?(this.result=void 0,this.println(String(n))):this.result=this.resultStack_.pop(),i&&(r.showErrorAlert(String(n)),this.afterErrorFn!==void 0&&this.afterErrorFn())}if(this.evalCalls_--,e)return this.scrollDown(),this.result;{let n=this.result;return this.result=this.resultStack_.pop(),n}}expand(t){let e=this.replaceVar(t),i="",s=0;for(;e;){if(++s>1e4)throw"Terminal.expand";let n=e.match(/^[^'"/]+/);if(n!==null){let a=n[0];if(e=e.slice(a.length),a=this.regexs_.reduce((o,l)=>o.replace(l.regex,l.replace),a),i+=a,e.length==0)break}if(i.match(/.*[=(][ ]*$/)&&(n=e.match(/^\/[^*/](\\\/|[^\\/])*\//),n!==null)){let a=n[0];e=e.slice(a.length),i+=a;continue}if(e.length>0&&e[0]=="/"){i+="/",e=e.slice(1);continue}if(n=e.match(/^"(\\.|[^\\"])*"/),n!==null){let a=n[0];e=e.slice(a.length),i+=a;continue}if(e.length>0&&e[0]=='"'){i+='"',e=e.slice(1);continue}if(n=e.match(/^'(\\.|[^\\'])*'/),n!==null){let a=n[0];e=e.slice(a.length),i+=a;continue}if(e.length>0&&e[0]=="'"){i+="'",e=e.slice(1);continue}}return i}focus(){this.term_input_&&this.term_input_.focus()}getError(){return this.error}handleKey(t){if(t.type!=="keydown")return;let e=t;this.term_input_&&this.term_output_&&(e.metaKey&&e.key==="k"?(this.term_output_.value="",e.preventDefault()):e.key==="ArrowUp"||e.key==="ArrowDown"?(this.histIndex_==-1&&this.term_input_.value!=""&&(this.history_.unshift(this.term_input_.value),this.histIndex_=0),e.key==="ArrowUp"?this.histIndex_<this.history_.length-1&&(this.histIndex_++,this.term_input_.value=this.history_[this.histIndex_]):e.key==="ArrowDown"&&(this.histIndex_>0?(this.histIndex_--,this.term_input_.value=this.history_[this.histIndex_]):(this.histIndex_=-1,this.term_input_.value="")),e.preventDefault()):e.key==="Enter"&&this.eval(this.term_input_.value,!0,!1))}hasRegex(t){let e=t.regex.toString(),i=t.replace;return this.regexs_.some(s=>s.replace==i&&s.regex.toString()==e)}inputCallback(t){this.term_input_&&this.eval(this.term_input_.value,!0,!1)}parseURL(){this.parser!=null&&this.parser.saveStart();let t=window.location.href,e=t.indexOf("?");if(e>-1){let i=t.slice(e+1);return i=decodeURIComponent(i),this.eval(i,!0,!0),!0}return!1}println(t){this.term_output_&&(this.term_output_.value+=t+`
`,this.scrollDown())}replaceVar(t){let e=t.match(/^\s*(var|let|const)\s+(\w[\w_\d]*)(.*)/);if(e){r.assert(e.length>=4);let i=e[2];return this.addRegex(i,"z.",!0,!0),e[2]+e[3]}return t}scrollDown(){this.term_input_&&this.term_output_&&(this.term_output_.scrollTop=this.term_output_.scrollHeight-this.term_output_.offsetHeight,this.term_input_.value="")}setAfterEval(t){this.afterEvalFn_=t}setParser(t){this.parser=t,t.addCommand("vars",()=>String(this.vars()),"lists available variables")}setPrompt(t){this.prompt_=String(t)}setVerbose(t){this.verbose_=t}splitAtSemicolon(t){let e=0,i="",s="",n="",a="",o=!1,l=!1,_=!1,c="",g,d;for(g=0,d=t.length;g<d;g++)if(s=a,a!=" "&&a!="	"&&a!=`
`&&(i=a),a=t[g],n=g+1<d?t[g+1]:"\0",o){if(a==`
`&&(o=!1,e==0))break}else if(l)a=="/"&&s!="\\"&&(l=!1);else if(_)a==c&&s!="\\"&&(_=!1,c="");else if(a=="/")n=="/"?o=!0:n!="*"&&i&&(i=="="||i=="(")&&(l=!0);else if(a=='"'||a=="'")_=!0,c=a;else{if(a==";"&&e==0)break;a=="{"?e++:a=="}"&&e--}return[t.slice(0,g+1),t.slice(g+1)]}static stdRegex(t){t.addRegex("methodsOf|propertiesOf|prettyPrint","Util.",!1),t.addRegex("println","terminal.",!1),t.addRegex("getParameter|getSubject","terminal.parser.",!1),t.addRegex("result|z|parser","terminal.",!0),t.addRegex("AffineTransform|CircularList|Clock|ClockTask|DoubleRect|EasyScriptParser|GenericEvent|GenericMemo|GenericObserver|MutableVector|ParameterBoolean|ParameterNumber|ParameterString|RandomLCG|Terminal|Timer|Util|Vector","lab$$util$$",!1),t.addRegex("NF0|NF2|NF1S|NF3|NF5|NF5E|nf5|nf7|NF7|NF7E|NF9|NFE|NFSCI","Util.",!1),t.addRegex("CollisionAdvance|ConcreteVariable|ConcreteLine|ConstantForceLaw|CoordType|DampingLaw|EulersMethod|Force|FunctionVariable|GravityLaw|Gravity2Law|MassObject|ModifiedEuler|NumericalPath|ParametricPath|OvalPath|PointMass|RungeKutta|ShapeType|SimList|SimpleAdvance|Spring|VarsList","lab$$model$$",!1),t.addRegex("CoordMap|DisplayClock|DisplayConnector|DisplayLine|DisplayList|DisplayPath|DisplayShape|DisplayRope|DisplaySpring|DisplayText|DrawingMode|DrawingStyle|HorizAlign|LabCanvas|SimView|DisplayArc|ScreenRect|SimView|VerticalAlign","lab$$view$$",!1),t.addRegex("CircularEdge|CollisionHandling|ConcreteVertex|ContactSim|EdgeRange|ExtraAccel|ImpulseSim|Joint|JointUtil|PathJoint|Polygon|RigidBodyCollision|RigidBodySim|Rope|Scrim|Shapes|StraightEdge|ThrusterSet|Vertex|Walls","lab$$engine2D$$",!1),t.addRegex("AutoScale|DisplayGraph|GraphColor|GraphLine|EnergyBarGraph|GraphStyle|DisplayAxes|VarsHistory","lab$$graph$$",!1),t.addRegex("EventHandler|MouseTracker|RigidBodyEventHandler|SimController|SimRunner|ViewPanner","lab$$app$$",!1),t.addRegex("ButtonControl|CheckBoxControl|CheckBoxControlBase|ChoiceControl|ChoiceControlBase|LabelControl|NumericControl|NumericControlBase|SliderControl|TextControl|TextControlBase|ToggleControl","lab$$controls$$",!1)}vars(){let t=this.vars_.split("|");return t.sort(),t}static version(){return"myPhysicsLab version "+r.VERSION+", compiled on "+r.COMPILE_TIME+"."}};r.defineGlobal("lab$util$Terminal",st);var $=class h{constructor(t,e){this.initialNonDependent_=[],this.initialDependent_=[],this.allSubjParamNames_=[],this.allParamNames_=[],this.allSubjects_=[],this.unique_=[],this.commandNames_=[],this.commandFns_=[],this.commandHelp_=[],h.checkUniqueNames(t),this.subjects_=t,this.dependent_=Array.isArray(e)?e:[];let i=(s,n,a)=>{this.dependent_.includes(s)&&a.splice(n,1)};r.forEachRight(this.subjects_,i),this.subjects_=this.subjects_.concat(this.dependent_),this.addCommand("url",()=>this.scriptURL(),"prints URL with script to recreate current state"),this.addCommand("script",()=>this.script(),"prints script to recreate current state"),this.addCommand("values",()=>r.prettyPrint(this.values()),"shows available parameters and their current values"),this.addCommand("names",()=>r.prettyPrint(this.names().join(";")),"shows available parameter names (format is SUBJECT.PARAMETER)"),this.addCommand("help",()=>this.help(),"prints this help text"),this.update()}toString(){return this.toStringShort().slice(0,-1)+", subjects_: ["+this.subjects_.map(t=>t.toStringShort())+"]}"}toStringShort(){return"EasyScriptParser{subjects_.length: "+this.subjects_.length+"}"}addCommand(t,e,i){this.commandNames_.push(t),this.commandFns_.push(e),this.commandHelp_.push(i)}static checkUniqueNames(t){let e=[];t.forEach(i=>{let s=i.getName();if(e.includes(s))throw"duplicate Subject name: "+s;e.push(s)})}getParameter(t){t=r.toName(t);let e=t.split("."),i="",s="";if(e.length==1)i="",s=e[0];else if(e.length==2)i=e[0],s=e[1];else return null;let n;if(i==""){if(this.allParamNames_.reduce((o,l)=>o+(l==s?1:0),0)>1)throw"multiple Subjects have Parameter "+s;n=this.allParamNames_.indexOf(s)}else n=this.allSubjParamNames_.indexOf(t);return n>-1?this.allSubjects_[n].getParameter(s):null}getSubject(t){let e=r.toName(t),i=this.subjects_.find(s=>s.getName()==e);return i===void 0?null:i}getSubjects(){return Array.from(this.subjects_)}help(){let t=st.version()+`
`;t+=`Use the "values" command to see what can be set and the syntax.
 
`,t+=`command-K            clear Terminal window
`,t+=`arrow up/down        retrieve previous or next command
`,t+=`getParameter(name)   see "names" command, returns the named Parameter
`,t+=`getSubject(name)     see "names" command, returns the named Subject
`,t+=`propertiesOf(app)    shows properties of that object
`,t+=`methodsOf(app)       shows methods defined on that object
`,t+=`prettyPrint(app)     prints the object nicely
`,t+=`prettyPrint(app, 3)  prints the object, expanding 3 levels of sub-objects
`,t+=`println(1+2)         prints to the Terminal window
`,t+=`result               the result of the previous command
`;for(let e=0,i=this.commandNames_.length;e<i;e++){let s=this.commandNames_[e];for(;s.length<20;)s+=" ";t+=s+" "+this.commandHelp_[e]+`
`}return t}names(){return Array.from(this.allSubjParamNames_)}namesAndValues(t,e,i){t=t==!0;let s=this.allSubjects_.map((l,_)=>l.getParameter(this.allParamNames_[_])),n=s;e||(n=n.filter(l=>!l.isComputed())),n=n.filter(l=>this.dependent_.includes(l.getSubject())==t,this);let a=/^[a-zA-Z0-9_]+$/,o=n.map(l=>{let _=r.toName(l.getName()),c=s.indexOf(l);if(c<0)throw"EasyScript error "+l;let g=l.getValue();return typeof g=="string"&&!a.test(g)&&(g='"'+g+'"'),!i&&this.unique_[c]?_+"="+g:r.toName(l.getSubject().getName())+"."+_+"="+g});return o.length>0?o.join(";")+";":""}parse(t){t.slice(-1)==";"&&(t=t.slice(0,t.length-1));for(let n=0,a=this.commandNames_.length;n<a;n++)if(t.toLowerCase()==this.commandNames_[n])return this.commandFns_[n]();let e=t.split("="),i=r.toName(e[0].trim()),s=this.getParameter(i);if(!(s==null||e.length>2)){if(e.length==2){let n;try{n=h.unquote(e[1].trim()),s.setFromString(n)}catch(a){throw a+' while setting value "'+n+'" on parameter '+i}}return s.getValue()}}saveStart(){this.initialNonDependent_=this.namesAndValues(!1).split(";"),this.initialDependent_=this.namesAndValues(!0).split(";")}script(){let t=this.namesAndValues(!1).split(";");t=t.concat(this.namesAndValues(!0).split(";"));let e=this.initialNonDependent_.concat(this.initialDependent_),i=function(s,n,a){e.includes(s)&&a.splice(n,1)};return r.forEachRight(t,i),t.join(";")+(t.length>0?";":"")}scriptURL(){return window.location.href.replace(/\.html\?.*$/,".html")+"?"+st.encodeURIComponent(this.script())}static unquote(t){if(t.length<2)return t;let e=t.charAt(0),i=t.charAt(t.length-1);if(e==i&&(e=='"'||e=="'")){let s="";for(let n=1,a=t.length-1;n<a;n++){let o=t[n];if(o=="\\")if(n++,n<a)switch(o=t[n],o){case"0":s+="\0";break;case"b":s+="\b";break;case"t":s+="	";break;case"n":s+=`
`;break;case"v":s+="\v";break;case"f":s+="\f";break;case"r":s+="\r";break;case'"':s+='"';break;case"'":s+="'";break;case"\\":s+="\\";break;default:s+="\\"+o}else s+=o;else s+=o}return s}return t}update(){let t=this.subjects_.reduce(function(i,s){let n=s.getParameters().filter(a=>a.getName()!="DELETED");return i.concat(n)},[]);this.allSubjects_=t.map(i=>i.getSubject()),this.allParamNames_=t.map(i=>r.toName(i.getName())),this.allSubjParamNames_=t.map(i=>r.toName(i.getSubject().getName()+"."+i.getName()));let e=function(i,s){return i.reduce((n,a)=>n+(s(a)?1:0),0)};this.unique_=this.allParamNames_.map(i=>e(this.allParamNames_,s=>s==i)==1),this.initialDependent_=this.namesAndValues(!0).split(";")}values(){return this.namesAndValues(!1,!0,!0)+this.namesAndValues(!0,!0,!0)}};$.en={URL_SCRIPT:"share",PROMPT_URL:"Press command-C to copy this URL to the clipboard, it will replicate this simulation with current parameters.",WARN_URL_2048:"WARNING: URL is longer than 2048 characters."};$.de_strings={URL_SCRIPT:"mitteilen",PROMPT_URL:"Dr\xFCcken Sie command-C um diesen URL in die Zwischenablage zu kopieren, dies beinhaltet die eingegebenen Parameter.",WARN_URL_2048:"Achtung: URL is l\xE4nger als 2048 Zeichen."};$.i18n=r.LOCALE==="de"?$.de_strings:$.en;var O=class h{constructor(t){this.graphFont="10pt sans-serif",this.rect_=S.EMPTY_RECT,this.fontDescent_=8,this.fontAscent_=12,this.graphOrigin_=0,this.leftEdge_=0,this.rightEdge_=0,this.graphFactor_=10,this.graphDelta_=2,this.needRescale_=!0,this.drawBackground_=!0,this.potentialColor="#666",this.translationColor="#999",this.rotationColor="#ccc",this.lastTime_=r.systemTime(),this.lastTime2_=0,this.totalEnergyDisplay_=0,this.lastEnergyDisplay_=0,this.totalDigits_=1,this.totalEnergyPeriod_=.3,this.lastTotalEnergyTime_=Number.NEGATIVE_INFINITY,this.megaMinEnergy_=0,this.megaMaxEnergy_=0,this.minEnergy_=0,this.maxEnergy_=0,this.totalEnergy_=0,this.BUFFER_=12,this.history_=new Array(this.BUFFER_),this.bufptr_=0,this.dragable_=!0,this.visibleRect_=S.EMPTY_RECT,this.needResize_=!0,this.zIndex=0,this.changed_=!0,this.debug_=!1,this.system_=t}toString(){return this.toStringShort().slice(0,-1)+", visibleRect: "+this.visibleRect_+", rect: "+this.rect_+", needRescale: "+this.needRescale_+", leftEdge: "+r.NF(this.leftEdge_)+", rightEdge: "+r.NF(this.rightEdge_)+", graphOrigin: "+r.NF(this.graphOrigin_)+", graphFactor: "+r.NF(this.graphFactor_)+", minHistory: "+r.NF(this.minHistory())+", minEnergy: "+r.NF(this.minEnergy_)+", megaMinEnergy: "+r.NF(this.megaMinEnergy_)+", megaMinEnergyLoc: "+Math.floor(this.graphOrigin_+.5+this.graphFactor_*this.megaMinEnergy_)+", maxEnergy: "+r.NF(this.maxEnergy_)+", megaMaxEnergy: "+r.NF(this.megaMaxEnergy_)+", totalEnergy: "+r.NF(this.totalEnergy_)+", time: "+r.NF(r.systemTime()-this.lastTime_)+", zIndex: "+this.zIndex+"}"}toStringShort(){return"EnergyBarGraph{system: "+this.system_.toStringShort()+"}"}contains(t){return this.rect_.contains(t)}draw(t,e){if(this.visibleRect_.isEmpty())return;t.save(),t.font=this.graphFont,t.textAlign="start",t.textBaseline="alphabetic";let i=this.system_.getEnergyInfo(),s=i.getTranslational(),n=i.getPotential(),a=i.getRotational(),o=h.i18n.TRANSLATIONAL_ENERGY+",";isNaN(a)&&(o=h.i18n.KINETIC_ENERGY+",");let l=h.TOP_MARGIN+3*h.HEIGHT+this.fontAscent_+8+this.fontDescent_,_=e.screenToSimScaleY(l);if((this.needResize_||this.rect_.isEmpty()||r.veryDifferent(_,this.rect_.getHeight()))&&(this.debug_&&r.DEBUG&&console.log("h2 = "+_+" this.rect_.getHeight="+this.rect_.getHeight()),this.resizeRect(_)),this.debug_&&r.DEBUG){let gt=e.simToScreenRect(this.rect_);t.fillStyle="rgba(255,255,0,0.5)",t.fillRect(gt.getLeft(),gt.getTop(),gt.getWidth(),gt.getHeight())}this.leftEdge_=e.simToScreenX(this.rect_.getLeft())+h.LEFT_MARGIN,this.rightEdge_=e.simToScreenX(this.rect_.getRight())-h.RIGHT_MARGIN;let c=this.rightEdge_-this.leftEdge_,g=e.simToScreenY(this.rect_.getTop());this.drawBackground_&&(t.fillStyle="rgba(255,255,255,0.75)",t.fillRect(this.leftEdge_-h.LEFT_MARGIN,g+h.TOP_MARGIN,c+h.LEFT_MARGIN+h.RIGHT_MARGIN,l)),this.debug_&&r.DEBUG&&(t.strokeStyle="#90c",t.strokeRect(this.leftEdge_-h.LEFT_MARGIN,g+h.TOP_MARGIN,c+h.LEFT_MARGIN+h.RIGHT_MARGIN,l)),this.totalEnergy_=s+n+(isNaN(a)?0:a),r.assert(Math.abs(this.totalEnergy_-i.getTotalEnergy())<1e-12),this.minEnergy_=n<0?n:0,this.maxEnergy_=this.totalEnergy_>0?this.totalEnergy_:0,r.systemTime()-this.lastTotalEnergyTime_>this.totalEnergyPeriod_&&(this.lastTotalEnergyTime_=r.systemTime(),this.lastEnergyDisplay_=this.totalEnergyDisplay_,this.totalEnergyDisplay_=i.getTotalEnergy()),this.rescale(c);let d=this.graphOrigin_,m=0;t.fillStyle=this.potentialColor,n<0?(m=Math.floor(.5-n*this.graphFactor_),t.fillRect(d-m,g+h.TOP_MARGIN,m,h.HEIGHT),d=d-m):(m=Math.floor(.5+n*this.graphFactor_),t.fillRect(d,g+h.HEIGHT+h.TOP_MARGIN,m,h.HEIGHT),d+=m),isNaN(a)||(m=Math.floor(.5+a*this.graphFactor_),t.fillStyle=this.rotationColor,t.fillRect(d,g+h.HEIGHT+h.TOP_MARGIN,m,h.HEIGHT),d+=m),m=Math.floor(.5+s*this.graphFactor_);let f=this.graphOrigin_+Math.floor(.5+this.totalEnergy_*this.graphFactor_);r.assert(Math.abs(d+m-f)<=2),m=f-d,t.fillStyle=this.translationColor,t.fillRect(d,g+h.HEIGHT+h.TOP_MARGIN,m,h.HEIGHT);let b=(this.rightEdge_-this.graphOrigin_)/this.graphFactor_,C=this.drawScale(t,this.leftEdge_,g+h.HEIGHT+h.TOP_MARGIN,b),v=this.leftEdge_;v=this.drawLegend(t,h.i18n.POTENTIAL_ENERGY+",",this.potentialColor,!0,v,C),isNaN(a)||(v=this.drawLegend(t,h.i18n.ROTATIONAL_ENERGY+",",this.rotationColor,!0,v,C)),v=this.drawLegend(t,o,this.translationColor,!0,v,C),v=this.drawTotalEnergy(t,v,C),t.restore()}drawLegend(t,e,i,s,n,a){s?(t.fillStyle=i,t.fillRect(n,a,10,10)):(t.strokeStyle=i,t.strokeRect(n,a,10,10)),n+=13;let l=t.measureText(e).width;return t.fillStyle="#000",t.fillText(e,n,a+this.fontAscent_),n+=l+5,n}drawScale(t,e,i,s){let n=this.fontAscent_;if(Math.abs(s)>1e-18&&this.graphDelta_>1e-18){t.fillStyle="#000",t.strokeStyle="#000";let a=0,o=0;do{let l=this.graphOrigin_+Math.floor(a*this.graphFactor_);t.beginPath(),t.moveTo(l,i+h.HEIGHT/2),t.lineTo(l,i+h.HEIGHT+2),t.stroke();let _=h.numberFormat1(a),c=t.measureText(_).width;t.fillText(_,l-c/2,i+h.HEIGHT+n+3),a+=this.graphDelta_,this.debug_&&r.DEBUG&&++o>100&&console.log("loop 1 x="+l+" s="+_+" scale="+r.NFE(a)+" total="+r.NFE(s)+" graphDelta="+r.NFE(this.graphDelta_))}while(a<s+this.graphDelta_+1e-16);if(this.debug_&&r.DEBUG&&console.log("megaMinEnergy="+r.NFE(this.megaMinEnergy_)+" graphDelta="+r.NFE(this.graphDelta_)+" graphFactor="+r.NFE(this.graphFactor_)+" scale="+r.NFE(a)),this.megaMinEnergy_<-1e-12){a=-this.graphDelta_;let l;do{l=this.graphOrigin_+Math.floor(a*this.graphFactor_),t.beginPath(),t.moveTo(l,i+h.HEIGHT/2),t.lineTo(l,i+h.HEIGHT+2),t.stroke();let _=h.numberFormat1(a),c=t.measureText(_).width;t.fillText(_,l-c/2,i+h.HEIGHT+n+3),a-=this.graphDelta_,this.debug_&&r.DEBUG&&console.log("loop 2 x="+l+" s="+_+" scale="+r.NFE(a)+" megaMinEnergy="+r.NFE(this.megaMinEnergy_))}while(a>this.megaMinEnergy_&&l>=e)}}return i+h.HEIGHT+n+3+this.fontDescent_}drawTotalEnergy(t,e,i){let s=h.i18n.TOTAL+" "+this.formatTotalEnergy(this.totalEnergyDisplay_,this.lastEnergyDisplay_);return t.fillStyle="#000",t.fillText(s,e,i+this.fontAscent_),e+t.measureText(s).width+5}formatTotalEnergy(t,e){let i=Math.abs(t-e);if(i>1e-15){let a=-Math.floor(Math.log(i)/Math.log(10)),o=a>0?a:1;this.totalDigits_=o<20?o:20}let s=Math.abs(t),n=t<0?"-":"+";return s<1e-6?n+s.toExponential(5):s<1e3?n+s.toFixed(this.totalDigits_):n+s.toFixed(this.totalDigits_)}getChanged(){return this.changed_?(this.changed_=!1,!0):!1}getSimObjects(){return[]}getMassObjects(){return[]}getPosition(){return this.rect_.isEmpty()?new u(0,0):this.rect_.getCenter()}getVisibleArea(){return this.visibleRect_}getZIndex(){return this.zIndex}isDragable(){return this.dragable_}minHistory(){let t=0;for(let e=0,i=this.history_.length;e<i;e++)this.history_[e]<t&&(t=this.history_[e]);return t}static numberFormat1(t){let e=Math.abs(t),i;return e<1e-16?i="0":e<.001?(i=e.toExponential(3),i=i.replace(/\.0+([eE])/,"$1"),i=i.replace(/(\.\d*[1-9])0+([eE])/,"$1$2")):e<10?(i=e.toFixed(4),i=i.replace(/\.0+$/,""),i=i.replace(/(\.\d*[1-9])0+$/,"$1")):e<100?(i=e.toFixed(3),i=i.replace(/\.0+$/,""),i=i.replace(/(\.\d*[1-9])0+$/,"$1")):e<1e3?(i=e.toFixed(2),i=i.replace(/\.0+$/,""),i=i.replace(/(\.[1-9])0$/,"$1")):e<1e4?i=e.toFixed(0):(i=e.toExponential(3),i=i.replace(/\.0+([eE])/,"$1"),i=i.replace(/(\.\d*[1-9])0+([eE])/,"$1$2")),t<0?"-"+i:i}printEverything(t){r.DEBUG&&this.debug_&&console.log(t+this)}rescale(t){let e=this.timeCheck(this.minEnergy_);if(r.DEBUG&&this.printEverything("(status)"),this.megaMinEnergy_=this.minHistory(),r.assert(isFinite(this.megaMinEnergy_)),this.megaMinEnergy_<-1e-6?(this.graphOrigin_+Math.floor(.5+this.megaMinEnergy_*this.graphFactor_)<this.leftEdge_-h.LEFT_MARGIN&&(r.DEBUG&&this.printEverything("BIG MIN ENERGY"),this.needRescale_=!0),e&&-this.megaMinEnergy_*this.graphFactor_<.2*(this.graphOrigin_-this.leftEdge_)&&(r.DEBUG&&this.printEverything("SMALL MIN ENERGY"),this.needRescale_=!0)):this.megaMinEnergy_>1e-6?this.graphOrigin_>this.leftEdge_&&(r.DEBUG&&this.printEverything("POSITIVE MIN ENERGY"),this.needRescale_=!0):e&&this.graphOrigin_-this.leftEdge_>h.LEFT_MARGIN&&(this.needRescale_=!0),this.totalEnergy_>this.megaMaxEnergy_&&(this.megaMaxEnergy_=this.totalEnergy_),this.totalEnergy_>1e-12?(this.graphOrigin_+this.totalEnergy_*this.graphFactor_>this.rightEdge_&&(this.needRescale_=!0,r.DEBUG&&this.printEverything("BIG TOTAL ENERGY")),this.rightEdge_-this.graphOrigin_>.2*(this.graphOrigin_-this.leftEdge_)&&this.totalEnergy_*this.graphFactor_<.2*(this.rightEdge_-this.graphOrigin_)&&(this.needRescale_=!0,this.megaMaxEnergy_=this.totalEnergy_,r.DEBUG&&this.printEverything("SMALL TOTAL ENERGY"))):this.totalEnergy_<-1e-12&&e&&(this.megaMaxEnergy_<0&&this.graphOrigin_<this.rightEdge_&&(this.needRescale_=!0,r.DEBUG&&this.printEverything("NEGATIVE TOTAL ENERGY")),this.megaMaxEnergy_=this.totalEnergy_),this.needRescale_){this.lastTime_=r.systemTime(),this.needRescale_=!1;let i=this.totalEnergy_>0?this.totalEnergy_:0;i-=this.megaMinEnergy_,i<1e-16&&(i=1),i*this.graphFactor_>t?this.graphFactor_=.75*t/i:this.graphFactor_=.95*t/i,r.assert(isFinite(this.graphFactor_)),this.megaMinEnergy_<-1e-12?this.graphOrigin_=this.leftEdge_+Math.floor(.5+this.graphFactor_*-this.megaMinEnergy_):this.graphOrigin_=this.leftEdge_;let s=Math.pow(10,Math.floor(Math.log(i)/Math.log(10))),n=i/s;n>=8?this.graphDelta_=2:n>=5?this.graphDelta_=1:n>=3?this.graphDelta_=.5:n>=2?this.graphDelta_=.4:this.graphDelta_=.2,this.graphDelta_*=s}}resizeRect(t){r.assert(r.isObject(this.visibleRect_));let e=this.rect_.isEmpty()?this.visibleRect_.getTop():this.rect_.getTop(),i=e-t;e>this.visibleRect_.getTop()||t>this.visibleRect_.getHeight()?(e=this.visibleRect_.getTop(),i=e-t):i<this.visibleRect_.getBottom()&&(i=this.visibleRect_.getBottom(),e=i+t),this.debug_&&r.DEBUG&&console.log("resizeRect visibleRect="+this.visibleRect_+" rect="+this.rect_+" top="+e+" bottom="+i),this.rect_=new S(this.visibleRect_.getLeft(),i,this.visibleRect_.getRight(),e),this.debug_&&r.DEBUG&&console.log("resizeRect new rect="+this.rect_),this.needRescale_=!0,this.needResize_=!1}setDragable(t){this.dragable_=t}setPosition(t){if(this.rect_.isEmpty())this.rect_=new S(-5,t.getY()-.5,5,t.getY()+.5);else{let e=this.rect_.getHeight()/2;this.rect_=new S(this.rect_.getLeft(),t.getY()-e,this.rect_.getRight(),t.getY()+e),this.debug_&&r.DEBUG&&console.log("setPosition "+this.rect_)}this.changed_=!0}setVisibleArea(t){this.visibleRect_=t,this.needResize_=!0,this.changed_=!0}setZIndex(t){this.zIndex=t??0,this.changed_=!0}timeCheck(t){let e=r.systemTime();return e-this.lastTime2_>1?(this.lastTime2_=e,++this.bufptr_>=this.history_.length&&(this.bufptr_=0),this.history_[this.bufptr_]=t):this.minEnergy_<this.history_[this.bufptr_]&&(this.history_[this.bufptr_]=t),e-this.lastTime_>this.BUFFER_?(this.lastTime_=e,!0):!1}};O.HEIGHT=10;O.LEFT_MARGIN=10;O.RIGHT_MARGIN=0;O.TOP_MARGIN=0;O.en={SHOW_ENERGY:"show energy",POTENTIAL_ENERGY:"potential",TRANSLATIONAL_ENERGY:"translational",KINETIC_ENERGY:"kinetic",ROTATIONAL_ENERGY:"rotational",TOTAL:"total"};O.de_strings={SHOW_ENERGY:"Energie anzeigen",POTENTIAL_ENERGY:"potenzielle",TRANSLATIONAL_ENERGY:"translation",KINETIC_ENERGY:"kinetische",ROTATIONAL_ENERGY:"rotation",TOTAL:"gesamt"};O.i18n=r.LOCALE==="de"?O.de_strings:O.en;r.defineGlobal("lab$graph$EnergyBarGraph",O);var Vt=class{constructor(t,e,i){this.name_=t,this.topElement_=e,this.controls_=i}toString(){return this.toStringShort().slice(0,-1)+", controls_: ["+this.controls_.map(t=>t.toStringShort())+"]}"}toStringShort(){return'GroupControl{name_: "'+this.name_+'", controls_.length: '+this.controls_.length+"}"}disconnect(){this.controls_.forEach(t=>t.disconnect())}getControls(){return Array.from(this.controls_)}getElement(){return this.topElement_}getParameter(){return null}setEnabled(t){this.controls_.forEach(e=>e.setEnabled(t))}};r.defineGlobal("lab$controls$GroupControl",Vt);var rt=class{constructor(){this.memorizables_=[],this.isMemorizing_=!1}toString(){return"ConcreteMemoList{memorizables_: ["+this.memorizables_.map(t=>t.toStringShort())+"]}"}toStringShort(){return"ConcreteMemoList{memorizables_.length: "+this.memorizables_.length+"}"}addMemo(t){if(this.isMemorizing_)throw"addMemo during memorize";this.memorizables_.includes(t)||this.memorizables_.push(t)}getMemos(){return Array.from(this.memorizables_)}memorize(){try{this.isMemorizing_=!0,this.memorizables_.forEach(t=>t.memorize())}finally{this.isMemorizing_=!1}}removeMemo(t){if(this.isMemorizing_)throw"removeMemo during memorize";r.remove(this.memorizables_,t)}};r.defineGlobal("lab$util$ConcreteMemoList",rt);var Ft=class{constructor(t,e){this.timeoutID_=void 0,this.callBack_=null,this.timerCallback_=()=>this.timerCallback(),this.period_=0,this.firing_=!1,this.fired_sys_=NaN,this.delta_=0,this.sysClock_=e||new Rt,this.legacy_=t||typeof requestAnimationFrame!="function"}toString(){return"Timer{period_: "+this.period_+", firing_: "+this.firing_+", timeoutID_: "+this.timeoutID_+", fired_sys_: "+r.nf7(this.fired_sys_)+", delta_: "+r.nf7(this.delta_)+"}"}timerCallback(){if(this.callBack_===null)return;let t=this.sysClock_.systemTime(),e=t-(this.fired_sys_-this.delta_);if(e>=this.period_&&(this.callBack_(),this.fired_sys_=t,this.delta_=this.period_>0?e%this.period_:0),this.legacy_){let i=this.period_>0?Math.round(this.period_*1e3):17;this.timeoutID_=this.sysClock_.scheduleCallback(this.timerCallback_,i)}else this.timeoutID_=this.sysClock_.requestAnimFrame(this.timerCallback_)}getLegacy(){return this.legacy_}getPeriod(){return this.period_}isFiring(){return this.firing_}setCallBack(t){this.stopFiring(),this.callBack_=t}setLegacy(t){t!==this.legacy_&&(this.stopFiring(),this.legacy_=t)}setPeriod(t){if(t<0)throw"";this.period_=t}startFiring(){this.firing_||(this.firing_=!0,this.delta_=0,this.fired_sys_=this.sysClock_.systemTime()-this.period_-1e-7,this.timerCallback())}stopFiring(){this.firing_=!1,this.timeoutID_!==void 0&&(this.legacy_?this.sysClock_.cancelCallback(this.timeoutID_):this.sysClock_.cancelAnimFrame(this.timeoutID_),this.timeoutID_=void 0),this.fired_sys_=NaN,this.delta_=0}};r.defineGlobal("lab$util$Timer",Ft);var M=class h extends T{constructor(t,e){super(e||"SIM_RUNNER"),this.appName_="",this.displayPeriod_=0,this.nonStop_=!1,this.canvasList_=[],this.memoList_=new rt,this.errorObservers_=[],this.frames_=0,this.advanceList_=[t],this.timeStep_=t.getTimeStep(),this.timer_=new Ft,this.timer_.setPeriod(this.displayPeriod_),this.timer_.setCallBack(()=>this.callback());let i=(e?e+"_":"")+"CLOCK";this.clock_=new A(i);let s=t.getTime();this.clock_.setTime(s),this.clock_.setRealTime(s),this.clock_.addObserver(this),this.addParameter(new y(this,h.en.TIME_STEP,h.i18n.TIME_STEP,()=>this.getTimeStep(),n=>this.setTimeStep(n)).setSignifDigits(3)),this.addParameter(new y(this,h.en.DISPLAY_PERIOD,h.i18n.DISPLAY_PERIOD,()=>this.getDisplayPeriod(),n=>this.setDisplayPeriod(n)).setSignifDigits(3)),this.addParameter(new N(this,h.en.RUNNING,h.i18n.RUNNING,()=>this.getRunning(),n=>this.setRunning(n))),this.addParameter(new N(this,h.en.FIRING,h.i18n.FIRING,()=>this.getFiring(),n=>this.setFiring(n))),this.addParameter(new N(this,h.en.NON_STOP,h.i18n.NON_STOP,()=>this.getNonStop(),n=>this.setNonStop(n)))}toString(){return this.toStringShort().slice(0,-1)+", advanceList_: ["+this.advanceList_.map(t=>t.toStringShort())+"], clock_: "+this.clock_.toStringShort()+", timer_: "+this.timer_+", timeStep_: "+r.NF(this.timeStep_)+", displayPeriod_: "+r.NF(this.displayPeriod_)+", nonStop_: "+this.nonStop_+", canvasList_: ["+this.canvasList_.map(t=>t.toStringShort())+"], memoList_: "+this.memoList_+super.toString()}getClassName(){return"SimRunner"}addCanvas(t){this.canvasList_.includes(t)||(this.canvasList_.push(t),this.addMemo(t))}addErrorObserver(t){this.errorObservers_.includes(t)||this.errorObservers_.push(t)}addMemo(t){this.memoList_.addMemo(t)}addStrategy(t){this.advanceList_.push(t)}advanceSims(t,e){let i=t.getTime();for(;i<e&&(t.advance(this.timeStep_,this),!!this.getRunning());){let s=i;if(i=t.getTime(),i-s<=1e-15)throw"SimRunner: time did not advance";if(e-i<this.timeStep_)break}}callback(){try{if(this.clock_.isRunning()||this.clock_.isStepping()){let t=this.clock_.getTime(),e=this.advanceList_[0].getTime();if(t>e+1||t<e-1){let s=e+this.timeStep_;this.clock_.setTime(s),this.clock_.setRealTime(s),t=s}let i=t;for(let s=0,n=this.advanceList_.length;s<n;s++)this.advanceSims(this.advanceList_[s],i);this.clock_.isStepping()?this.clock_.clearStepMode():(t=this.clock_.getTime(),e=this.advanceList_[0].getTime(),t-e>20*this.timeStep_&&this.clock_.setTime(e))}this.paintAll(),this.frames_++}catch(t){this.handleException(t)}}destroy(){this.stopFiring()}getCanvasList(){return Array.from(this.canvasList_)}getClock(){return this.clock_}getDisplayPeriod(){return this.displayPeriod_}getFiring(){return this.timer_.isFiring()}getFrameRate(){return this.frames_/this.clock_.getTime()}getMemos(){return this.memoList_.getMemos()}getNonStop(){return this.nonStop_}getRunning(){return this.clock_.isRunning()}getTimeStep(){return this.timeStep_}handleException(t){this.pause(),this.timer_.stopFiring(),this.errorObservers_.forEach(i=>i.notifyError(t));let e=t!=null?" "+t:"";alert(h.i18n.STUCK+e)}memorize(){this.memoList_.memorize()}observe(t){if(t.getSubject()==this.clock_)if(t.nameEquals(A.CLOCK_RESUME)||t.nameEquals(A.CLOCK_PAUSE)){let e=this.advanceList_[0].getTime();this.clock_.setTime(e),this.clock_.setRealTime(e),this.broadcastParameter(h.en.RUNNING)}else t.nameEquals(A.CLOCK_SET_TIME)&&this.memorize()}paintAll(){this.canvasList_.forEach(t=>t.paint())}pause(){return this.clock_.pause(),this.clock_.getTime()}playUntil(t){let e=new Tt(t,null);return e.setCallback(()=>{this.clock_.pause(),this.clock_.removeTask(e)}),this.clock_.addTask(e),this.resume()}removeCanvas(t){r.remove(this.canvasList_,t),this.removeMemo(t)}removeErrorObserver(t){r.remove(this.errorObservers_,t)}removeMemo(t){this.memoList_.removeMemo(t)}reset(){this.frames_=0,this.timer_.startFiring(),this.clock_.pause(),this.advanceList_.forEach(e=>e.reset());let t=this.advanceList_[0].getTime();return this.clock_.setTime(t),this.clock_.setRealTime(t),this.paintAll(),this.broadcast(new p(this,h.RESET)),this.clock_.getTime()}resume(){return this.timer_.startFiring(),this.clock_.resume(),this.clock_.getTime()}save(){return this.advanceList_.forEach(t=>t.save()),this.clock_.getTime()}setAppName(t){this.appName_=t}setDisplayPeriod(t){this.displayPeriod_=t,this.timer_.setPeriod(t),this.broadcastParameter(h.en.DISPLAY_PERIOD)}setFiring(t){t?this.startFiring():(this.paintAll(),this.stopFiring()),this.broadcastParameter(h.en.FIRING)}setNonStop(t){this.nonStop_=t,this.broadcastParameter(h.en.NON_STOP)}setRunning(t){t?this.resume():this.pause()}setTimeStep(t){this.timeStep_=t,this.broadcastParameter(h.en.TIME_STEP)}startFiring(){this.timer_.startFiring()}step(){let t=this.advanceList_[0].getTime()+this.timeStep_-this.clock_.getTime();return this.clock_.step(t),this.timer_.startFiring(),this.clock_.getTime()}stopFiring(){this.nonStop_||this.timer_.stopFiring()}};M.RESET="RESET";M.en={TIME_STEP:"time step",DISPLAY_PERIOD:"display period",RESTART:"restart",RUNNING:"running",FIRING:"firing",PAUSE:"pause",RESUME:"resume",NON_STOP:"non-stop",STEP:"step",STUCK:"Simulation is stuck; click reset and play to continue."};M.de_strings={TIME_STEP:"Zeitschritt",DISPLAY_PERIOD:"Bilddauer",RESTART:"Neustart",RUNNING:"laufend",FIRING:"t\xE4tigend",PAUSE:"pausieren",RESUME:"weiter",NON_STOP:"durchgehend",STEP:"kleine Schritte",STUCK:"Simulation hat sich aufgeh\xE4ngt; dr\xFCcken Sie Neustart und Weiter um fort zu fahren."};M.i18n=r.LOCALE==="de"?M.de_strings:M.en;r.defineGlobal("lab$app$SimRunner",M);var q=class h{constructor(t,e,i,s,n,a){this.m11_=t,this.m12_=e,this.m21_=i,this.m22_=s,this.dx_=n,this.dy_=a}toString(){return"AffineTransform{m11_: "+r.NF(this.m11_)+", m12_: "+r.NF(this.m12_)+", m21_: "+r.NF(this.m21_)+", m22_: "+r.NF(this.m22_)+", dx_: "+r.NF(this.dx_)+", dy_: "+r.NF(this.dy_)+"}"}applyTransform(t){t.transform(this.m11_,this.m12_,this.m21_,this.m22_,this.dx_,this.dy_)}concatenate(t){let e=this.m11_*t.m11_+this.m21_*t.m12_,i=this.m12_*t.m11_+this.m22_*t.m12_,s=this.m11_*t.m21_+this.m21_*t.m22_,n=this.m12_*t.m21_+this.m22_*t.m22_,a=this.m11_*t.dx_+this.m21_*t.dy_+this.dx_,o=this.m12_*t.dx_+this.m22_*t.dy_+this.dy_;return new h(e,i,s,n,a,o)}lineTo(t,e,i){let s=this.transform(t,e);i.lineTo(s.getX(),s.getY())}moveTo(t,e,i){let s=this.transform(t,e);i.moveTo(s.getX(),s.getY())}rotate(t){let e=Math.cos(t),i=Math.sin(t),s=e*this.m11_+i*this.m21_,n=e*this.m12_+i*this.m22_,a=-i*this.m11_+e*this.m21_,o=-i*this.m12_+e*this.m22_;return new h(s,n,a,o,this.dx_,this.dy_)}scale(t,e){let i=this.m11_*t,s=this.m12_*t,n=this.m21_*e,a=this.m22_*e;return new h(i,s,n,a,this.dx_,this.dy_)}setTransform(t){t.setTransform(this.m11_,this.m12_,this.m21_,this.m22_,this.dx_,this.dy_)}transform(t,e){let i,s;if(typeof t=="number")i=t,s=e;else{let o=t;s=o.getY(),i=o.getX()}if(typeof i!="number"||typeof s!="number")throw"need a Vector or two numbers";let n=this.m11_*i+this.m21_*s+this.dx_,a=this.m12_*i+this.m22_*s+this.dy_;return new u(n,a)}translate(t,e){let i,s;if(typeof t=="number")i=t,s=e;else{let o=t;s=o.getY(),i=o.getX()}if(typeof i!="number"||typeof s!="number")throw"need a Vector or two numbers";let n=this.dx_+this.m11_*i+this.m21_*s,a=this.dy_+this.m12_*i+this.m22_*s;return new h(this.m11_,this.m12_,this.m21_,this.m22_,n,a)}};q.IDENTITY=new q(1,0,0,1,0,0);r.defineGlobal("lab$util$AffineTransform",q);var F=class h{constructor(t,e,i,s){if(typeof t!="number"||typeof e!="number"||typeof i!="number"||typeof s!="number"||i<0||s<0)throw"";this.left_=t,this.top_=e,this.width_=i,this.height_=s}toString(){return"ScreenRect{left_: "+r.NF(this.left_)+", top_: "+r.NF(this.top_)+", width_: "+r.NF(this.width_)+", height_: "+r.NF(this.height_)+"}"}static clone(t){return new h(t.left_,t.top_,t.width_,t.height_)}equals(t){return this.left_==t.left_&&this.top_==t.top_&&this.width_==t.width_&&this.height_==t.height_}getCenterX(){return this.left_+this.width_/2}getCenterY(){return this.top_+this.height_/2}getHeight(){return this.height_}getLeft(){return this.left_}getTop(){return this.top_}getWidth(){return this.width_}isEmpty(t){let e=t||1e-14;return this.width_<e||this.height_<e}makeOval(t){let e=this.width_/2,i=this.height_/2;if(typeof t.ellipse=="function")t.beginPath(),t.moveTo(this.left_+this.width_,this.top_+i),t.ellipse(this.left_+e,this.top_+i,e,i,0,0,2*Math.PI,!1);else{let s=Math.min(e,i);t.beginPath(),t.moveTo(this.left_+this.width_,this.top_),t.arc(this.left_+e,this.top_+i,s,0,2*Math.PI,!1),t.closePath()}}makeRect(t){t.rect(this.left_,this.top_,this.width_,this.height_)}nearEqual(t,e){return!(r.veryDifferent(this.left_,t.left_,e)||r.veryDifferent(this.top_,t.top_,e)||r.veryDifferent(this.width_,t.width_,e)||r.veryDifferent(this.height_,t.height_,e))}};F.EMPTY_RECT=new F(0,0,0,0);r.defineGlobal("lab$view$ScreenRect",F);var dt=class h{constructor(t,e,i,s,n,a){this.screen_left_=r.testFinite(t),this.screen_bottom_=r.testFinite(e),this.sim_left_=r.testFinite(i),this.sim_bottom_=r.testFinite(s),this.pixel_per_unit_x_=r.testFinite(n),this.pixel_per_unit_y_=r.testFinite(a);let o=q.IDENTITY;o=o.translate(this.screen_left_,this.screen_bottom_),o=o.scale(this.pixel_per_unit_x_,-this.pixel_per_unit_y_),o=o.translate(-this.sim_left_,-this.sim_bottom_),this.transform_=o}toString(){return"CoordMap{screen_left_: "+r.NF(this.screen_left_)+", screen_bottom_: "+r.NF(this.screen_bottom_)+", sim_left_: "+r.NF(this.sim_left_)+", sim_bottom_: "+r.NF(this.sim_bottom_)+", pixels_per_unit_x_: "+r.NF(this.pixel_per_unit_x_)+", pixels_per_unit_y_: "+r.NF(this.pixel_per_unit_y_)+(this.transform_!=null?", transform: "+this.transform_:"")+"}"}static make(t,e,i,s,n){if(i=i||"MIDDLE",s=s||"MIDDLE",n=n||1,n<h.MIN_SIZE||!isFinite(n))throw"bad aspectRatio "+n;let a=e.getLeft(),o=e.getBottom(),l=e.getRight()-a,_=e.getTop()-o;if(l<h.MIN_SIZE||_<h.MIN_SIZE)throw"simRect cannot be empty "+e;let c=t.getTop(),g=t.getLeft(),d=t.getWidth(),m=t.getHeight(),f=0,b=0,C=0,v=0;if(i=="FULL"&&(C=d/l,f=0),s=="FULL"&&(v=m/_,b=0),i!="FULL"||s!="FULL"){let it;if(i=="FULL")v=C*n,it=!0;else if(s=="FULL")C=v/n,it=!1;else{C=d/l,v=C*n,it=!0;let X=Math.floor(.5+v*_);m<X&&(v=m/_,C=v/n,it=!1)}if(it){r.assert(s!="FULL"),f=0;let X=Math.floor(.5+_*v);switch(s){case"BOTTOM":b=0;break;case"MIDDLE":b=(m-X)/2;break;case"TOP":b=m-X;break;default:throw"unsupported alignment "+s}}else{r.assert(i!="FULL"),b=0;let X=Math.floor(.5+l*C);switch(i){case"LEFT":f=0;break;case"MIDDLE":f=(d-X)/2;break;case"RIGHT":f=d-X;break;default:throw"unsupported alignment "+i}}}return new h(g,c+m,a-f/C,o-b/v,C,v)}getAffineTransform(){return this.transform_}getScaleX(){return this.pixel_per_unit_x_}getScaleY(){return this.pixel_per_unit_y_}screenToSim(t,e){let i,s;if(typeof t=="number")i=t,s=e;else{let n=t;s=n.getY(),i=n.getX()}if(typeof i!="number"||typeof s!="number")throw"";return new u(this.screenToSimX(i),this.screenToSimY(s))}screenToSimRect(t){return new S(this.screenToSimX(t.getLeft()),this.screenToSimY(t.getTop()+t.getHeight()),this.screenToSimX(t.getLeft()+t.getWidth()),this.screenToSimY(t.getTop()))}screenToSimScaleX(t){return t/this.pixel_per_unit_x_}screenToSimScaleY(t){return t/this.pixel_per_unit_y_}screenToSimX(t){return this.sim_left_+(t-this.screen_left_)/this.pixel_per_unit_x_}screenToSimY(t){return this.sim_bottom_+(this.screen_bottom_-t)/this.pixel_per_unit_y_}simToScreen(t){return new u(this.simToScreenX(t.getX()),this.simToScreenY(t.getY()))}simToScreenRect(t){return new F(this.simToScreenX(t.getLeft()),this.simToScreenY(t.getTop()),this.simToScreenScaleX(t.getWidth()),this.simToScreenScaleY(t.getHeight()))}simToScreenScaleX(t){return t*this.pixel_per_unit_x_}simToScreenScaleY(t){return t*this.pixel_per_unit_y_}simToScreenX(t){return this.screen_left_+(t-this.sim_left_)*this.pixel_per_unit_x_}simToScreenY(t){return this.screen_bottom_-(t-this.sim_bottom_)*this.pixel_per_unit_y_}};dt.MIN_SIZE=1e-15;r.defineGlobal("lab$view$CoordMap",dt);function re(){return["LEFT","MIDDLE","RIGHT","FULL","VALUE"]}function _e(){return[Gt.LEFT,Gt.MIDDLE,Gt.RIGHT,Gt.FULL,Gt.VALUE]}var Se={LEFT:"left",MIDDLE:"middle",RIGHT:"right",FULL:"full",VALUE:"value"},Ee={LEFT:"links",MIDDLE:"mitte",RIGHT:"rechts",FULL:"voll",VALUE:"Wert"},Gt=r.LOCALE==="de"?Ee:Se;function ne(){return["TOP","MIDDLE","BOTTOM","FULL","VALUE"]}function ce(){return[Ht.TOP,Ht.MIDDLE,Ht.BOTTOM,Ht.FULL,Ht.VALUE]}var be={TOP:"top",MIDDLE:"middle",BOTTOM:"bottom",FULL:"full",VALUE:"value"},ye={TOP:"oben",MIDDLE:"mitte",BOTTOM:"unten",FULL:"voll",VALUE:"Wert"},Ht=r.LOCALE==="de"?ye:be;var U=class h{constructor(t,e){this.expireTime_=1/0,this.changed_=!0;let i=t||"SIM_OBJ"+h.ID++;this.name_=r.validName(r.toName(i)),this.localName_=e||i}toString(){return this.getClassName()+'{name_: "'+this.getName()+'", expireTime_: '+r.NF(this.expireTime_)+"}"}toStringShort(){return this.getClassName()+'{name_: "'+this.getName()+'"}'}getChanged(){return this.changed_?(this.changed_=!1,!0):!1}getExpireTime(){return this.expireTime_}getName(t){return t?this.localName_:this.name_}isMassObject(){return!1}nameEquals(t){return this.name_==r.toName(t)}setChanged(){this.changed_=!0}setExpireTime(t){this.expireTime_=t}similar(t,e){return t==this}};U.ID=1;r.defineGlobal("lab$model$AbstractSimObject",U);var Bt=class extends U{constructor(t,e){super(t,e),this.mass_=1,this.loc_world_=u.ORIGIN,this.angle_=0,this.sinAngle_=0,this.cosAngle_=1,this.velocity_=u.ORIGIN,this.angular_velocity_=0,this.cm_body_=u.ORIGIN,this.zeroEnergyLevel_=null,this.dragPts_=[u.ORIGIN],this.moment_=0,this.minHeight_=NaN}toString(){return super.toString().slice(0,-1)+", mass_: "+r.NF(this.mass_)+", loc_world_: "+this.loc_world_+", angle_: "+this.angle_+", velocity_: "+this.velocity_+", angular_velocity_: "+r.NF(this.angular_velocity_)+", cm_body_: "+this.cm_body_+", zeroEnergyLevel_: "+r.NF(this.zeroEnergyLevel_)+", moment_: "+r.NF(this.moment_)+", dragPts_: ["+this.dragPts_.map(t=>t.toString())+"]}"}alignTo(t,e,i){let s=i===void 0?this.angle_:i,n=t.getX()-this.cm_body_.getX(),a=t.getY()-this.cm_body_.getY(),o=Math.sin(s),l=Math.cos(s);this.setPosition(new u(e.getX()-(n*l-a*o),e.getY()-(n*o+a*l)),s)}bodyToWorld(t){let e=t.getX()-this.cm_body_.getX(),i=t.getY()-this.cm_body_.getY(),s=this.loc_world_.getX()+(e*this.cosAngle_-i*this.sinAngle_),n=this.loc_world_.getY()+(e*this.sinAngle_+i*this.cosAngle_);return new u(s,n)}bodyToWorldTransform(){let t=new q(1,0,0,1,this.loc_world_.getX(),this.loc_world_.getY());return t=t.rotate(this.angle_),t.translate(-this.cm_body_.getX(),-this.cm_body_.getY())}getAngle(){return this.angle_}getAngularVelocity(){return this.angular_velocity_}getBottomWorld(){let t=1/0;return this.getVerticesBody().forEach(e=>{let i=this.bodyToWorld(e);i.getY()<t&&(t=i.getY())}),t}getBoundsBody(){return new S(this.getLeftBody(),this.getBottomBody(),this.getRightBody(),this.getTopBody())}getBoundsWorld(){return new S(this.getLeftWorld(),this.getBottomWorld(),this.getRightWorld(),this.getTopWorld())}getCenterOfMass(){return this.cm_body_}getCentroidWorld(){return this.bodyToWorld(this.getCentroidBody())}getDragPoints(){return Array.from(this.dragPts_)}getHeight(){return this.getTopBody()-this.getBottomBody()}getKineticEnergy(){return this.translationalEnergy()+this.rotationalEnergy()}getLeftWorld(){let t=1/0;return this.getVerticesBody().forEach(e=>{let i=this.bodyToWorld(e);i.getX()<t&&(t=i.getX())}),t}getMass(){return this.mass_}getPosition(){return this.loc_world_}getRightWorld(){let t=Number.NEGATIVE_INFINITY;return this.getVerticesBody().forEach(e=>{let i=this.bodyToWorld(e);i.getX()>t&&(t=i.getX())}),t}getTopWorld(){let t=Number.NEGATIVE_INFINITY;return this.getVerticesBody().forEach(e=>{let i=this.bodyToWorld(e);i.getY()>t&&(t=i.getY())}),t}getWidth(){return this.getRightBody()-this.getLeftBody()}getVelocity(t){if(t!==void 0){let e=this.rotateBodyToWorld(u.clone(t).subtract(this.cm_body_));return new u(this.velocity_.getX()-e.getY()*this.angular_velocity_,this.velocity_.getY()+e.getX()*this.angular_velocity_)}else return this.velocity_}getZeroEnergyLevel(){return this.zeroEnergyLevel_}isMassObject(){return!0}momentAboutCM(){return this.mass_*this.moment_}momentum(){let t=new Array(3);return t[0]=this.mass_*this.velocity_.getX(),t[1]=this.mass_*this.velocity_.getY(),t[2]=this.momentAboutCM()*this.angular_velocity_+this.mass_*(this.loc_world_.getX()*this.velocity_.getY()-this.loc_world_.getY()*this.velocity_.getX()),t}rotateBodyToWorld(t){return u.clone(t).rotate(this.cosAngle_,this.sinAngle_)}rotateWorldToBody(t){return u.clone(t).rotate(this.cosAngle_,-this.sinAngle_)}rotationalEnergy(){return .5*this.momentAboutCM()*this.angular_velocity_*this.angular_velocity_}setAngle(t){this.setPosition(this.loc_world_,t)}setAngularVelocity(t){if(!isFinite(t))throw"angular velocity must be finite "+t;this.angular_velocity_=t,this.setChanged()}setCenterOfMass(t){this.cm_body_=u.clone(t),this.minHeight_=NaN,this.setChanged()}setDragPoints(t){this.dragPts_=t.map(e=>u.clone(e)),this.setChanged()}setMass(t){if(t<=0||typeof t!="number")throw"mass must be positive "+t;this.mass_=t,this.setChanged()}setMinHeight(t){this.minHeight_=t}setMomentAboutCM(t){this.moment_=t,this.setChanged()}setPosition(t,e){this.loc_world_=u.clone(t),e!==void 0&&this.angle_!=e&&(this.angle_=e,this.sinAngle_=Math.sin(e),this.cosAngle_=Math.cos(e)),this.setChanged()}setPositionX(t){this.setPosition(new u(t,this.loc_world_.getY()))}setPositionY(t){this.setPosition(new u(this.loc_world_.getX(),t))}setVelocity(t,e){this.velocity_=u.clone(t),e!==void 0&&this.setAngularVelocity(e),this.setChanged()}setVelocityX(t){this.setVelocity(new u(t,this.velocity_.getY()))}setVelocityY(t){this.setVelocity(new u(this.velocity_.getX(),t))}setZeroEnergyLevel(t){this.zeroEnergyLevel_=t??this.loc_world_.getY(),this.setChanged()}translationalEnergy(){return .5*this.mass_*this.velocity_.lengthSquared()}worldToBody(t){let e=t.getX()-this.loc_world_.getX(),i=t.getY()-this.loc_world_.getY(),s=-this.sinAngle_,n=this.cosAngle_,a=this.cm_body_.getX()+(e*n-i*s),o=this.cm_body_.getY()+(e*s+i*n);return new u(a,o)}};r.defineGlobal("lab$model$AbstractMassObject",Bt);var wt;(function(h){h[h.RECTANGLE=0]="RECTANGLE",h[h.OVAL=1]="OVAL"})(wt||(wt={}));var x=class h extends Bt{constructor(t,e){let i,s;if(t===void 0||t==""){let n=h.ID++;i=h.en.POINT_MASS+n,s=h.i18n.POINT_MASS+n}else i=t,s=e||i;super(i,s),this.shape_=wt.OVAL,this.width_=1,this.height_=1,this.mass_=1}toString(){return super.toString().slice(0,-1)+", shape_: "+this.shape_+", width_: "+r.NF(this.width_)+", height_: "+r.NF(this.height_)+"}"}getClassName(){return"PointMass"}static makeCircle(t,e,i){let s=new h(e,i);return s.setWidth(t),s.setHeight(t),s}static makeOval(t,e,i,s){let n=new h(i,s);return n.setWidth(t),n.setHeight(e),n}static makeSquare(t,e,i){let s=new h(e,i);return s.setWidth(t),s.setHeight(t),s.setShape(wt.RECTANGLE),s}static makeRectangle(t,e,i,s){let n=new h(i,s);return n.setWidth(t),n.setHeight(e),n.setShape(wt.RECTANGLE),n}createCanvasPath(t){t.beginPath();let e=this.height_/2,i=this.width_/2;if(this.shape_==wt.RECTANGLE)t.rect(-i,-e,this.width_,this.height_);else if(this.shape_==wt.OVAL)if(typeof t.ellipse=="function")t.moveTo(i,0),t.ellipse(0,0,i,e,0,0,2*Math.PI,!1);else{let s=Math.min(i,e);t.arc(0,0,s,0,2*Math.PI,!1),t.closePath()}else throw""}getBottomBody(){return-this.height_/2}getCentroidBody(){return u.ORIGIN}getCentroidRadius(){let t=this.width_/2,e=this.height_/2;return Math.sqrt(t*t+e*e)}getLeftBody(){return-this.width_/2}getMinHeight(){if(isNaN(this.minHeight_)){let t=this.cm_body_.getX(),e=this.cm_body_.getY(),i=e-this.getBottomBody(),s=t-this.getLeftBody();s<i&&(i=s),s=this.getTopBody()-e,s<i&&(i=s),s=this.getRightBody()-t,s<i&&(i=s),this.minHeight_=i}return this.minHeight_}getRightBody(){return this.width_/2}getShape(){return this.shape_}getTopBody(){return this.height_/2}getVerticesBody(){let t=this.width_/2,e=this.height_/2;return[new u(-t,-e),new u(t,-e),new u(t,e),new u(-t,e)]}setHeight(t){this.height_=t,this.setChanged()}setShape(t){this.shape_=t,this.setChanged()}setWidth(t){this.width_=t,this.setChanged()}similar(t,e){if(!(t instanceof h))return!1;let i=t;return!(!i.loc_world_.nearEqual(this.loc_world_,e)||r.veryDifferent(i.width_,this.width_,e)||r.veryDifferent(i.height_,this.height_,e)||i.shape_!=this.shape_)}};x.en={POINT_MASS:"PointMass"};x.de_strings={POINT_MASS:"Punktmasse"};x.i18n=r.LOCALE==="de"?x.de_strings:x.en;r.defineGlobal("lab$model$PointMass",x);var nt=class{constructor(t,e){this.isDarkColor_=!1,this.changed_=!0,this.massObject_=t??new x("proto"),this.proto_=e??null,this.dragable_=isFinite(this.massObject_.getMass())&&this.massObject_.getDragPoints().length>0,this.lastColor_=this.getFillStyle()}toString(){return this.toStringShort().slice(0,-1)+", dragable_: "+this.dragable_+', fillStyle: "'+this.getFillStyle()+'", strokeStyle: "'+this.getStrokeStyle()+'", thickness: '+r.NF(this.getThickness())+", drawDragPoints: "+this.getDrawDragPoints()+", drawCenterOfMass: "+this.getDrawCenterOfMass()+', nameFont: "'+this.getNameFont()+'", nameColor: "'+this.getNameColor()+'", nameRotate: '+r.NF(this.getNameRotate())+", zIndex: "+this.getZIndex()+", proto: "+(this.proto_!=null?this.proto_.toStringShort():"null")+"}"}toStringShort(){return"DisplayShape{massObject_: "+this.massObject_.toStringShort()+"}"}contains(t){let e=this.massObject_.worldToBody(t);return this.massObject_.getBoundsBody().contains(e)}draw(t,e){t.save();let i=e.getAffineTransform(),s=1/e.getScaleX(),n=i.concatenate(this.massObject_.bodyToWorldTransform());n.setTransform(t),this.massObject_.createCanvasPath(t),this.getImageClip()&&t.clip();let a=this.getFillStyle();a&&(t.fillStyle=a,t.fill());let o=this.getStrokeStyle();if(o){t.lineWidth=e.screenToSimScaleX(this.getThickness());let c=this.getBorderDash();if(c.length>0&&typeof t.setLineDash=="function"){let g=c.map(d=>e.screenToSimScaleX(d));t.setLineDash(g)}t.strokeStyle=o,t.stroke(),t.setLineDash([])}let l=this.getImage(),_=this.getImageDraw();if((l!=null||_!=null)&&(t.translate(this.massObject_.getLeftBody(),this.massObject_.getTopBody()),t.scale(s,-s),this.getImageAT().applyTransform(t),l!=null&&t.drawImage(l,0,0),_?.(t)),this.massObject_.getMass()!=1/0){n.setTransform(t),this.lastColor_!==a&&(this.lastColor_=a);let c=e.screenToSimScaleX(1);if(t.lineWidth=c,this.getDrawCenterOfMass()){let g=this.massObject_.getCenterOfMass();this.isDarkColor_?t.strokeStyle="#ccc":t.strokeStyle="black";let d=.2*Math.min(this.massObject_.getWidth(),this.massObject_.getHeight()),m=8*c;d>m&&(d=m),t.beginPath(),t.moveTo(g.getX()-d,g.getY()),t.lineTo(g.getX()+d,g.getY()),t.stroke(),t.beginPath(),t.moveTo(g.getX(),g.getY()-d),t.lineTo(g.getX(),g.getY()+d),t.stroke()}if(this.getDrawDragPoints()){let g=4*c,d=.15*Math.min(this.massObject_.getWidth(),this.massObject_.getHeight());d<g&&(g=d),this.massObject_.getDragPoints().forEach(m=>{this.isDarkColor_?t.fillStyle="#ccc":t.fillStyle="gray",t.beginPath(),t.arc(m.getX(),m.getY(),g,0,2*Math.PI,!1),t.closePath(),t.fill()})}}if(this.getNameFont()){let c=this.massObject_.getCentroidBody(),g=n.translate(c),d=this.getNameRotate();d&&(g=g.rotate(d)),g=g.scale(s,-s),g.setTransform(t),t.fillStyle=this.getNameColor(),t.font=this.getNameFont(),t.textAlign="center";let m=this.massObject_.getName(!0),f=t.measureText("M").width;t.fillText(m,0,f/2)}t.restore()}getBorderDash(){return this.borderDash_!==void 0?this.borderDash_:this.proto_!=null?this.proto_.getBorderDash():[]}getChanged(){return this.massObject_.getChanged()||this.changed_?(this.changed_=!1,!0):!1}getDrawCenterOfMass(){return this.drawCenterOfMass_!==void 0?this.drawCenterOfMass_:this.proto_!=null?this.proto_.getDrawCenterOfMass():!1}getDrawDragPoints(){return this.drawDragPoints_!==void 0?this.drawDragPoints_:this.proto_!=null?this.proto_.getDrawDragPoints():!1}getFillStyle(){return this.fillStyle_!==void 0?this.fillStyle_:this.proto_!=null?this.proto_.getFillStyle():"lightGray"}getImage(){return this.image_!==void 0?this.image_:this.proto_!=null?this.proto_.getImage():null}getImageAT(){return this.imageAT_!==void 0?this.imageAT_:this.proto_!=null?this.proto_.getImageAT():q.IDENTITY}getImageClip(){return this.imageClip_!==void 0?this.imageClip_:this.proto_!=null?this.proto_.getImageClip():!1}getImageDraw(){return this.imageDraw_!==void 0?this.imageDraw_:this.proto_!=null?this.proto_.getImageDraw():null}getMassObjects(){return[this.massObject_]}getNameColor(){return this.nameColor_!==void 0?this.nameColor_:this.proto_!=null?this.proto_.getNameColor():"black"}getNameFont(){return this.nameFont_!==void 0?this.nameFont_:this.proto_!=null?this.proto_.getNameFont():""}getNameRotate(){return this.nameRotate_!==void 0?this.nameRotate_:this.proto_!=null?this.proto_.getNameRotate():0}getPosition(){return this.massObject_.getPosition()}getPrototype(){return this.proto_}getSimObjects(){return[this.massObject_]}getStrokeStyle(){return this.strokeStyle_!==void 0?this.strokeStyle_:this.proto_!=null?this.proto_.getStrokeStyle():""}getThickness(){return this.thickness_!==void 0?this.thickness_:this.proto_!=null?this.proto_.getThickness():1}getZIndex(){return this.zIndex_!==void 0?this.zIndex_:this.proto_!=null?this.proto_.getZIndex():0}isDragable(){return this.dragable_}setBorderDash(t){this.borderDash_=t,this.changed_=!0}setDragable(t){this.dragable_=t}setDrawCenterOfMass(t){this.drawCenterOfMass_=t,this.changed_=!0}setDrawDragPoints(t){this.drawDragPoints_=t,this.changed_=!0}setFillStyle(t){this.fillStyle_=t,this.changed_=!0}setImage(t){this.image_=t,this.changed_=!0}setImageAT(t){this.imageAT_=t,this.changed_=!0}setImageClip(t){this.imageClip_=t,this.changed_=!0}setImageDraw(t){this.imageDraw_=t,this.changed_=!0}setNameColor(t){this.nameColor_=t,this.changed_=!0}setNameFont(t){this.nameFont_=t,this.changed_=!0}setNameRotate(t){this.nameRotate_=t,this.changed_=!0}setPosition(t){this.massObject_.setPosition(t),this.changed_=!0}setPrototype(t){this.proto_=t}setStrokeStyle(t){this.strokeStyle_=t,this.changed_=!0}setThickness(t){this.thickness_=t,this.changed_=!0}setZIndex(t){this.zIndex_=t,this.changed_=!0}};r.defineGlobal("lab$view$DisplayShape",nt);var ht=class h{constructor(t,e){this.changed_=!0,this.spring_=t??null,this.proto_=e??null}toString(){return this.toStringShort().slice(0,-1)+", width: "+r.NF(this.getWidth())+', colorCompressed: "'+this.getColorCompressed()+'", colorExpanded: "'+this.getColorExpanded()+'", thickness: '+r.NF(this.getThickness())+", drawMode: "+this.getDrawMode()+", zIndex: "+this.getZIndex()+"}"}toStringShort(){return"DisplaySpring{spring_: "+(this.spring_!=null?this.spring_.toStringShort():"null")+"}"}contains(t){return!1}draw(t,e){if(this.spring_==null)return;let i=this.spring_.getLength();if(!(i<1e-6||this.spring_.getStiffness()==0)){if(t.save(),t.lineWidth=this.getThickness(),i<this.spring_.getRestLength()-1e-5?t.strokeStyle=this.getColorCompressed():t.strokeStyle=this.getColorExpanded(),this.getDrawMode()===h.JAGGED){let s=e.getAffineTransform(),n=this.spring_.getStartPoint(),a=this.spring_.getEndPoint();s=s.translate(n.getX(),n.getY());let o=Math.atan2(a.getY()-n.getY(),a.getX()-n.getX());s=s.rotate(o),s=s.scale(i/h.pathLength,this.getWidth()/.5),h.drawSpring(t,s)}else{let s=e.simToScreen(this.spring_.getStartPoint()),n=e.simToScreen(this.spring_.getEndPoint());t.beginPath(),t.moveTo(s.getX(),s.getY()),t.lineTo(n.getX(),n.getY()),t.stroke()}t.restore()}}static drawSpring(t,e){let i=h.pathLength,s=h.pathWidth/2,n=i/16;t.beginPath(),e.moveTo(0,0,t),e.lineTo(n,0,t),e.lineTo(2*n,s,t);for(let a=1;a<=3;a++)e.lineTo(4*a*n,-s,t),e.lineTo((4*a+2)*n,s,t);e.lineTo(15*n,0,t),e.lineTo(i,0,t),t.stroke()}getChanged(){return(this.spring_==null?!1:this.spring_.getChanged())||this.changed_?(this.changed_=!1,!0):!1}getColorCompressed(){return this.colorCompressed_!==void 0?this.colorCompressed_:this.proto_!=null?this.proto_.getColorCompressed():"red"}getColorExpanded(){return this.colorExpanded_!==void 0?this.colorExpanded_:this.proto_!=null?this.proto_.getColorExpanded():"green"}getDrawMode(){return this.drawMode_!==void 0?this.drawMode_:this.proto_!=null?this.proto_.getDrawMode():h.JAGGED}getMassObjects(){return[]}getPosition(){return this.spring_==null?u.ORIGIN:this.spring_.getStartPoint().add(this.spring_.getEndPoint()).multiply(.5)}getPrototype(){return this.proto_}getSimObjects(){return this.spring_==null?[]:[this.spring_]}getThickness(){return this.thickness_!==void 0?this.thickness_:this.proto_!=null?this.proto_.getThickness():4}getWidth(){return this.width_!==void 0?this.width_:this.proto_!=null?this.proto_.getWidth():.5}getZIndex(){return this.zIndex_!==void 0?this.zIndex_:this.proto_!=null?this.proto_.getZIndex():0}isDragable(){return!1}setColorCompressed(t){return this.colorCompressed_=t,this.changed_=!0,this}setColorExpanded(t){return this.colorExpanded_=t,this.changed_=!0,this}setDragable(t){}setDrawMode(t){return this.drawMode_=t,this.changed_=!0,this}setPosition(t){}setPrototype(t){return this.proto_=t,this}setThickness(t){return this.thickness_=t,this.changed_=!0,this}setWidth(t){return this.width_=t,this.changed_=!0,this}setZIndex(t){this.zIndex_=t,this.changed_=!0}};ht.JAGGED=1;ht.STRAIGHT=2;ht.pathLength=6;ht.pathWidth=.5;r.defineGlobal("lab$view$DisplaySpring",ht);var mt=class h extends T{constructor(t){super(t||"DISPLAY_LIST_"+h.NAME_ID++),this.drawables_=[],this.changed_=!0}toString(){return this.toStringShort().slice(0,-1)+", drawables_: ["+this.drawables_.map((t,e)=>e+": "+t.toStringShort())+"]"+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", drawables_.length: "+this.drawables_.length+"}"}getClassName(){return"DisplayList"}add(...t){t.forEach(e=>{if(!r.isObject(e))throw"non-object: "+e;let i=e.getZIndex();r.DEBUG&&this.preExist(e),this.sort();let s=this.drawables_.findIndex(n=>i<n.getZIndex());s=s<0?this.drawables_.length:s,this.drawables_.splice(s,0,e),this.changed_=!0,this.broadcast(new p(this,h.OBJECT_ADDED,e))})}contains(t){if(!r.isObject(t))throw"non-object passed to DisplayList.contains";return this.drawables_.includes(t)}draw(t,e){this.sort(),this.drawables_.forEach(i=>i.draw(t,e))}find(t){if(typeof t=="number"){let e=t,i=this.drawables_.length;return e<0||e>=i?void 0:(this.sort(),this.drawables_[e])}else if(typeof t=="string"){let e=r.toName(t);return this.drawables_.find(i=>{let s=i.getSimObjects();for(let n=0,a=s.length;n<a;n++)if(s[n].getName()==e)return!0;return!1})}else return r.isObject(t)?this.drawables_.find(e=>e.getSimObjects().some(s=>s===t)):void 0}findShape(t){let e=this.find(t);if(e instanceof nt)return e;throw"DisplayShape not found: "+t}findSpring(t){let e=this.find(t);if(e instanceof ht)return e;throw"DisplaySpring not found: "+t}get(t){let e=this.drawables_.length;if(t<0||t>=e)throw t+" is not in range 0 to "+(e-1);return this.sort(),this.drawables_[t]}getChanged(){let t=!1;for(let e=0,i=this.drawables_.length;e<i;e++){let s=this.drawables_[e].getChanged();t=t||s}return t||this.changed_?(this.changed_=!1,!0):!1}length(){return this.drawables_.length}preExist(t){if(r.DEBUG){let e=t.getSimObjects();for(let i=0,s=e.length;i<s;i++){let n=e[i],a=this.find(n);if(a!=null)throw console.log("*** WARNING PRE-EXISTING DISPLAYOBJECT "+a),console.log("*** FOR SIMOBJECT="+n),console.log("*** WHILE ADDING "+t),"pre-existing object "+a+" for "+n+" adding "+t}}}prepend(t){if(!r.isObject(t))throw"non-object passed to DisplayList.add";let e=t.getZIndex();r.DEBUG&&this.preExist(t),this.sort();let i=this.drawables_.length,s;for(s=i;s>0;s--){let n=this.drawables_[s-1].getZIndex();if(e>n)break}this.drawables_.splice(s,0,t),this.changed_=!0,this.broadcast(new p(this,h.OBJECT_ADDED,t))}remove(t){if(!r.isObject(t))throw"non-object passed to DisplayList.remove";let e=this.drawables_.indexOf(t);e>-1&&(this.drawables_.splice(e,1),this.changed_=!0,this.broadcast(new p(this,h.OBJECT_REMOVED,t)))}removeAll(){r.forEachRight(this.drawables_,t=>this.remove(t),this)}sort(){let t=!0,e=Number.NEGATIVE_INFINITY;for(let i=0,s=this.drawables_.length;i<s;i++){let n=this.drawables_[i].getZIndex();if(n<e){t=!1;break}e=n}t||(this.drawables_.sort(function(i,s){let n=i.getZIndex(),a=s.getZIndex();return n<a?-1:n>a?1:0}),this.changed_=!0)}toArray(){return this.sort(),Array.from(this.drawables_)}};mt.OBJECT_ADDED="OBJECT_ADDED";mt.OBJECT_REMOVED="OBJECT_REMOVED";mt.NAME_ID=1;r.defineGlobal("lab$view$DisplayList",mt);var w=class h extends T{constructor(t,e){if(super(t),this.panY=.05,this.panX=.05,this.zoom=1.1,this.screenRect_=new F(0,0,800,600),this.horizAlign_="MIDDLE",this.verticalAlign_="MIDDLE",this.aspectRatio_=1,this.displayList_=new mt,this.scaleTogether_=!0,this.opaqueness=1,this.changed_=!0,this.memoList_=new rt,!(e instanceof S))throw"not a DoubleRect "+e;if(e.isEmpty())throw"empty DoubleRect "+e;this.simRect_=e,this.coordMap_=dt.make(this.screenRect_,this.simRect_,this.horizAlign_,this.verticalAlign_,this.aspectRatio_),this.width_=e.getWidth(),this.height_=e.getHeight(),this.centerX_=e.getCenterX(),this.centerY_=e.getCenterY(),this.ratio_=this.height_/this.width_,this.addParameter(new y(this,h.en.WIDTH,h.i18n.WIDTH,()=>this.getWidth(),i=>this.setWidth(i))),this.addParameter(new y(this,h.en.HEIGHT,h.i18n.HEIGHT,()=>this.getHeight(),i=>this.setHeight(i))),this.addParameter(new y(this,h.en.CENTER_X,h.i18n.CENTER_X,()=>this.getCenterX(),i=>this.setCenterX(i)).setLowerLimit(Number.NEGATIVE_INFINITY)),this.addParameter(new y(this,h.en.CENTER_Y,h.i18n.CENTER_Y,()=>this.getCenterY(),i=>this.setCenterY(i)).setLowerLimit(Number.NEGATIVE_INFINITY)),this.addParameter(new N(this,h.en.SCALE_TOGETHER,h.i18n.SCALE_TOGETHER,()=>this.getScaleTogether(),i=>this.setScaleTogether(i))),this.addParameter(new I(this,h.en.VERTICAL_ALIGN,h.i18n.VERTICAL_ALIGN,()=>this.getVerticalAlign(),i=>this.setVerticalAlign(i),ce(),ne())),this.addParameter(new I(this,h.en.HORIZONTAL_ALIGN,h.i18n.HORIZONTAL_ALIGN,()=>this.getHorizAlign(),i=>this.setHorizAlign(i),_e(),re())),this.addParameter(new y(this,h.en.ASPECT_RATIO,h.i18n.ASPECT_RATIO,()=>this.getAspectRatio(),i=>this.setAspectRatio(i)))}toString(){return this.toStringShort().slice(0,-1)+", simRect_: "+this.simRect_+", screenRect_: "+this.screenRect_+", horizAlign_: "+this.horizAlign_+", verticalAlign_: "+this.verticalAlign_+", aspectRatio_: "+r.NF5(this.aspectRatio_)+", opaqueness: "+r.NF5(this.opaqueness)+", coordMap_: "+this.coordMap_+", memoList_: "+this.memoList_+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", displayList_: "+this.displayList_.toStringShort()+"}"}getClassName(){return"SimView"}addMemo(t){this.memoList_.addMemo(t)}gainFocus(){}getAspectRatio(){return this.aspectRatio_}getCenterX(){return this.centerX_}getCenterY(){return this.centerY_}getChanged(){return this.displayList_.getChanged()||this.changed_?(this.changed_=!1,!0):!1}getCoordMap(){return this.coordMap_}getDisplayList(){return this.displayList_}getHeight(){return this.height_}getHorizAlign(){return this.horizAlign_}getMemos(){return this.memoList_.getMemos()}getScaleTogether(){return this.scaleTogether_}getScreenRect(){return this.screenRect_}getSimRect(){return this.simRect_}getVerticalAlign(){return this.verticalAlign_}getWidth(){return this.width_}loseFocus(){}memorize(){this.memoList_.memorize()}modifySimRect(){let t=this.centerX_-this.width_/2,e=this.centerY_-this.height_/2,i=new S(t,e,t+this.width_,e+this.height_);this.changed_=!0,this.setSimRect(i)}paint(t){t.save(),t.globalAlpha=this.opaqueness,this.displayList_.draw(t,this.coordMap_),t.restore()}panDown(){this.setCenterY(this.centerY_-this.panY*this.height_)}panLeft(){this.setCenterX(this.centerX_-this.panX*this.width_)}panRight(){this.setCenterX(this.centerX_+this.panX*this.width_)}panUp(){this.setCenterY(this.centerY_+this.panY*this.height_)}realign(){this.setCoordMap(dt.make(this.screenRect_,this.simRect_,this.horizAlign_,this.verticalAlign_,this.aspectRatio_)),this.width_=this.simRect_.getWidth(),this.height_=this.simRect_.getHeight(),this.centerX_=this.simRect_.getCenterX(),this.centerY_=this.simRect_.getCenterY(),this.ratio_=this.height_/this.width_,this.changed_=!0}removeMemo(t){this.memoList_.removeMemo(t)}setAspectRatio(t){r.veryDifferent(this.aspectRatio_,t)&&(this.aspectRatio_=t,this.realign(),this.broadcastParameter(h.en.ASPECT_RATIO))}setCenterX(t){r.veryDifferent(this.centerX_,t)&&(this.centerX_=t,this.modifySimRect())}setCenterY(t){r.veryDifferent(this.centerY_,t)&&(this.centerY_=t,this.modifySimRect())}setCoordMap(t){if(!(t instanceof dt))throw"not a CoordMap: "+t;this.coordMap_=t,this.changed_=!0,this.broadcast(new p(this,h.COORD_MAP_CHANGED))}setHeight(t){r.veryDifferent(this.height_,t)&&(this.height_=t,this.scaleTogether_&&(this.width_=this.height_/this.ratio_),this.modifySimRect())}setHorizAlign(t){if(!re().includes(t))throw"invalid HorizAlign "+t;this.horizAlign_=t,this.realign(),this.broadcastParameter(h.en.HORIZONTAL_ALIGN)}setScaleTogether(t){this.scaleTogether_!=t&&(this.scaleTogether_=t,this.scaleTogether_&&(this.ratio_=this.height_/this.width_),this.changed_=!0,this.broadcastParameter(h.en.SCALE_TOGETHER))}setScreenRect(t){if(!(t instanceof F))throw"not a ScreenRect: "+t;if(t.isEmpty())throw"empty screenrect";this.screenRect_.equals(t)||(this.screenRect_=t,this.realign(),this.broadcast(new p(this,h.SCREEN_RECT_CHANGED)))}setSimRect(t){if(!(t instanceof S))throw"not a DoubleRect: "+t;this.simRect_.equals(t)||(this.simRect_=t,this.realign(),this.broadcastParameter(h.en.WIDTH),this.broadcastParameter(h.en.HEIGHT),this.broadcastParameter(h.en.CENTER_X),this.broadcastParameter(h.en.CENTER_Y),this.broadcast(new p(this,h.SIM_RECT_CHANGED)))}setVerticalAlign(t){if(!ne().includes(t))throw"invalid VerticalAlign "+t;this.verticalAlign_=t,this.realign(),this.broadcastParameter(h.en.VERTICAL_ALIGN)}setWidth(t){r.veryDifferent(this.width_,t)&&(this.width_=t,this.scaleTogether_&&(this.height_=this.width_*this.ratio_),this.modifySimRect())}zoomIn(){this.setHeight(this.height_/this.zoom)}zoomOut(){this.setHeight(this.height_*this.zoom)}};w.COORD_MAP_CHANGED="COORD_MAP_CHANGED";w.SCREEN_RECT_CHANGED="SCREEN_RECT_CHANGED";w.SIM_RECT_CHANGED="SIM_RECT_CHANGED";w.en={SCALE_TOGETHER:"scale X-Y together",WIDTH:"width",HEIGHT:"height",CENTER_X:"center-x",CENTER_Y:"center-y",VERTICAL_ALIGN:"vertical-align",HORIZONTAL_ALIGN:"horizontal-align",ASPECT_RATIO:"aspect-ratio"};w.de_strings={SCALE_TOGETHER:"X-Y zusammen skalieren",WIDTH:"Breite",HEIGHT:"H\xF6he",CENTER_X:"Mitte X",CENTER_Y:"Mitte Y",VERTICAL_ALIGN:"Vertikalejustierung",HORIZONTAL_ALIGN:"Horizontalejustierung",ASPECT_RATIO:"Querschnittsverh\xE4ltnis"};w.i18n=r.LOCALE==="de"?w.de_strings:w.en;r.defineGlobal("lab$view$SimView",w);var Wt=class{constructor(t,e,i){this.parameter_=t,this.name_=this.parameter_.getName(),this.state_=this.parameter_.getValue(),this.imageOn_=e,this.imageOff_=i,this.button_=document.createElement("button"),this.button_.type="button",this.button_.className="icon",i.style.display=this.state_?"block":"none",e.style.display=this.state_?"none":"block",this.button_.appendChild(e),this.button_.appendChild(i),this.clickFn_=this.handleClick.bind(this),this.button_.addEventListener("click",this.clickFn_,!0),this.parameter_.getSubject().addObserver(this)}toString(){return this.toStringShort().slice(0,-1)+", state_: "+this.state_+"}"}toStringShort(){return"ToggleControl{parameter_: "+this.parameter_.toStringShort()+"}"}disconnect(){this.parameter_.getSubject().removeObserver(this),this.button_.removeEventListener("click",this.clickFn_,!0)}getElement(){return this.button_}getParameter(){return this.parameter_}getState(){return this.state_}handleClick(t){this.setState(!this.state_)}observe(t){t==this.parameter_&&this.setState(this.parameter_.getValue())}setEnabled(t){this.button_.disabled=!t}setState(t){this.state_!=t&&(this.parameter_.setValue(t),this.state_=t,this.imageOff_.style.display=t?"block":"none",this.imageOn_.style.display=t?"none":"block")}};r.defineGlobal("lab$controls$ToggleControl",Wt);var L=class h{constructor(){throw""}static makeAxes(t,e){let i=new kt(t.getSimRect());return e&&(i.setXAxisAlignment("BOTTOM"),i.setYAxisAlignment("LEFT")),new Y(t,s=>{if(s.nameEquals(w.COORD_MAP_CHANGED)){let n=t.getCoordMap().screenToSimRect(t.getScreenRect());i.setSimRect(n)}},"resize axes"),t.getDisplayList().add(i),i}static makeBackgroundMenu(t){let e=[h.i18n.WHITE,h.i18n.BLACK,h.i18n.WHITE_WITH_TRAILS,h.i18n.BLACK_WITH_TRAILS,h.i18n.WHITE_WITH_LONG_TRAILS,h.i18n.BLACK_WITH_LONG_TRAILS],i=[h.en.WHITE,h.en.BLACK,h.en.WHITE_WITH_TRAILS,h.en.BLACK_WITH_TRAILS,h.en.WHITE_WITH_LONG_TRAILS,h.en.BLACK_WITH_LONG_TRAILS];i=i.map(_=>r.toName(_));let s=h.LONG_TRAILS,n=h.SHORT_TRAILS,a=()=>{let _=t.getBackground(),c=t.getAlpha();if(_=="")return i[0];if(_=="black")if(r.veryDifferent(c,1))if(r.veryDifferent(c,n)){if(!r.veryDifferent(c,s))return i[5]}else return i[3];else return i[1];else if(_=="white")if(r.veryDifferent(c,1))if(r.veryDifferent(c,n)){if(!r.veryDifferent(c,s))return i[4]}else return i[2];else return i[0];return""},o=_=>{switch(i.indexOf(_)){case 0:t.setBackground(""),t.setAlpha(1);break;case 1:t.setBackground("black"),t.setAlpha(1);break;case 2:t.setBackground("white"),t.setAlpha(n);break;case 3:t.setBackground("black"),t.setAlpha(n);break;case 4:t.setBackground("white"),t.setAlpha(s);break;case 5:t.setBackground("black"),t.setAlpha(s);break;default:throw""}},l=new At(e,i,a,o,h.i18n.BACKGROUND);return t.addObserver(l),l}static makePanZoomControls(t,e=!0,i){let s=r.IMAGES_DIR+"/",n=t.getSimRect();i===void 0&&(i=()=>t.setSimRect(n));let a=!1,o=30,l=document.createElement("div");a&&(l.style.border="dashed red thin"),l.style.width=o*3.2+"px";let _=r.createImage(s+"up_gray.png",o),c=new P("up",()=>t.panUp(),_);c.repeatDelay=100,l.appendChild(c.getElement());let g=document.createElement("div");a&&(g.style.border="dashed red thin"),g.style.width=l.style.width,_=r.createImage(s+"backward_gray.png",o),c=new P("left",()=>t.panLeft(),_),c.repeatDelay=100,g.appendChild(c.getElement()),_=r.createImage(s+"target_gray.png",o),c=new P("reset",i,_),g.appendChild(c.getElement()),_=r.createImage(s+"forward_gray.png",o),c=new P("right",()=>t.panRight(),_),c.repeatDelay=100,g.appendChild(c.getElement());let d=document.createElement("div");_=r.createImage(s+"down_gray.png",o),c=new P("down",()=>t.panDown(),_),c.repeatDelay=100,d.appendChild(c.getElement()),a&&(d.style.border="dashed red thin"),d.style.width=l.style.width;let m=document.createElement("div");m.appendChild(l),m.appendChild(g),m.appendChild(d),a&&(m.style.border="dashed green thin"),m.style.textAlign="center";let f=document.createElement("div");_=r.createImage(s+"plus_gray.png",o),c=new P("zoomIn",()=>t.zoomIn(),_),c.repeatDelay=100,f.appendChild(c.getElement()),f.appendChild(document.createElement("BR")),_=r.createImage(s+"minus_gray.png",o),c=new P("zoomOut",()=>t.zoomOut(),_),c.repeatDelay=100,f.appendChild(c.getElement()),f.style.cssFloat="right",f.style.marginTop=o*.6+"px",a&&(f.style.border="dashed blue thin");let b=document.createElement("div");return e&&(b.style.position="absolute",b.style.left="5%",b.style.top="5%",b.style.width=o*4.2+"px"),b.appendChild(f),b.appendChild(m),a&&(b.style.border="solid gray thin"),b.style.display="none",b}static makePlaybackControls(t,e){let i=r.IMAGES_DIR+"/",s=document.createElement("div");s.style.width="max-content",e&&(s.style.position="absolute",s.style.left="0",s.style.bottom="0",s.style.opacity="0.5");let n=30,a=r.createImage(i+"restart.png",n),o=new P(M.i18n.RESTART,()=>t.reset(),a);s.appendChild(o.getElement()),a=r.createImage(i+"forward.png",n);let l=r.createImage(i+"pause.png",n),_=new Wt(t.getParameterBoolean(M.en.RUNNING),a,l);s.appendChild(_.getElement()),a=r.createImage(i+"next.png",n);let c=new P(M.i18n.STEP,()=>t.step(),a);return c.repeatDelay=100,s.appendChild(c.getElement()),new Vt("playback",s,[o,_,c])}static makeEasyScript(t,e,i,s){let n=new $(t,e);return n.addCommand("reset",()=>i.reset(),"sets simulation to initial conditions"),n.addCommand("save",()=>i.save(),"saves simulation initial conditions"),n.addCommand("step",()=>i.step(),"advance simulation by a small time increment"),n.addCommand("pause",()=>i.pause(),"pause simulation"),n.addCommand("resume",()=>i.resume(),"resume simulation"),s.setParser(n),n}static makeShowClockParam(t,e,i){let s=e.getDisplayList(),n=new N(i,B.en.SHOW_CLOCK,B.i18n.SHOW_CLOCK,()=>s.contains(t),a=>{a?s.add(t):s.remove(t),i.broadcastParameter(B.en.SHOW_CLOCK)});return i.addParameter(n),new Y(s,a=>{a.getValue()==t&&i.broadcastParameter(B.en.SHOW_CLOCK)},"broadcast show clock parameter"),n}static makeShowEnergyParam(t,e,i,s,n){let a=s??O.en.SHOW_ENERGY,o=n??O.i18n.SHOW_ENERGY,l=e.getCoordMap().screenToSimRect(e.getScreenRect());t.setVisibleArea(l);let _=e.getDisplayList(),c=new N(i,a,o,()=>_.contains(t),g=>{g?_.add(t):_.remove(t),i.broadcastParameter(a)});return i.addParameter(c),new Y(_,g=>{g.getValue()==t&&i.broadcastParameter(a)},"broadcast show energy parameter"),c}static makeShowPanZoomParam(t,e){let i=new N(e,h.en.PAN_ZOOM,h.i18n.PAN_ZOOM,()=>t.style.display!="none",s=>{s?t.style.display="block":t.style.display="none",e.broadcastParameter(h.en.PAN_ZOOM)});return e.addParameter(i),i}static makeURLScriptButton(t,e){let i=()=>{let s=t.scriptURL(),n=$.i18n.PROMPT_URL;s.length>2048&&(n=n+"  "+$.i18n.WARN_URL_2048);let a=e.getFiring();a&&e.stopFiring(),window.prompt(n,s),a&&e.startFiring()};return new P($.i18n.URL_SCRIPT,i)}};L.SHORT_TRAILS=.1;L.LONG_TRAILS=.05;L.en={PAN_ZOOM:"pan-zoom",BACKGROUND:"background",WHITE:"white",BLACK:"black",WHITE_WITH_TRAILS:"white with trails",BLACK_WITH_TRAILS:"black with trails",WHITE_WITH_LONG_TRAILS:"white with long trails",BLACK_WITH_LONG_TRAILS:"black with long trails"};L.de_strings={PAN_ZOOM:"pan-zoom",BACKGROUND:"Hintergrund",WHITE:"weiss",BLACK:"schwarz",WHITE_WITH_TRAILS:"weiss mit Pfade",BLACK_WITH_TRAILS:"schwarz mit Pfade",WHITE_WITH_LONG_TRAILS:"weiss mit lange Pfade",BLACK_WITH_LONG_TRAILS:"schwarz mit lange Pfade"};L.i18n=r.LOCALE==="de"?L.de_strings:L.en;r.defineGlobal("sims$common$CommonControls",L);var Z=class h{constructor(t,e,i){this.totSteps_=0,this.secondDiff_=!0,this.specialTest_=!1,this.tolerance_=1e-6,this.diffEq_=t,this.energySystem_=e,this.odeSolver_=i}toString(){return this.toStringShort().slice(0,-1)+", odeSolver_: "+this.odeSolver_.toStringShort()+", energySystem_: "+this.energySystem_.toStringShort()+", secondDiff_: "+this.secondDiff_+", tolerance_: "+r.NFE(this.tolerance_)+"}"}toStringShort(){return"AdaptiveStepSolver{diffEq_: "+this.diffEq_.toStringShort()+"}"}getName(t){return t?h.i18n.NAME+"-"+this.odeSolver_.getName(!0):r.toName(h.en.NAME)+"_"+this.odeSolver_.getName(!1)}nameEquals(t){return this.getName()==r.toName(t)}getSecondDiff(){return this.secondDiff_}getTolerance(){return this.tolerance_}setSecondDiff(t){this.secondDiff_=t}setTolerance(t){this.tolerance_=t}step(t){this.diffEq_.saveState();let e=this.diffEq_.getTime(),i=t,s=0;this.diffEq_.modifyObjects();let n=this.energySystem_.getEnergyInfo().getTotalEnergy(),a=1/0,o=1/0,l=!0;if(t<1e-15)return null;do{let _=e;if(!l){this.diffEq_.restoreState(),this.diffEq_.modifyObjects(),r.assert(Math.abs(this.diffEq_.getTime()-e)<1e-12);let d=this.energySystem_.getEnergyInfo().getTotalEnergy();if(r.assert(Math.abs(d-n)<1e-10),i=i/5,i<1e-15)throw"time step too small "+i}for(s=0;_<e+t;){let d=i;_+d>e+t-1e-10&&(d=e+t-_),s++;let m=this.odeSolver_.step(d);if(this.diffEq_.modifyObjects(),m!=null)return m;_+=d}let c=this.energySystem_.getEnergyInfo().getTotalEnergy(),g=Math.abs(n-c);this.secondDiff_?l||(o=Math.abs(g-a)):o=g,a=g,l=!1}while(o>this.tolerance_);return this.totSteps_+=s,null}};Z.en={NAME:"Adaptive"};Z.de_strings={NAME:"Adaptiert"};Z.i18n=r.LOCALE==="de"?Z.de_strings:Z.en;r.defineGlobal("lab$model$AdaptiveStepSolver",Z);var Q=class h{constructor(t){this.inp_=[],this.k1_=[],this.ode_=t}toString(){return this.toStringShort()}toStringShort(){return"EulersMethod{ode_: "+this.ode_.toStringShort()+"}"}getName(t){return t?h.i18n.NAME:r.toName(h.en.NAME)}nameEquals(t){return this.getName()==r.toName(t)}step(t){let e=this.ode_.getVarsList(),i=e.getValues(),s=i.length;this.inp_.length!=s&&(this.inp_=new Array(s),this.k1_=new Array(s));let n=this.inp_,a=this.k1_;for(let l=0;l<s;l++)n[l]=i[l];r.zeroArray(a);let o=this.ode_.evaluate(n,a,0);if(o!=null)return o;for(let l=0;l<s;l++)i[l]+=a[l]*t;return e.setValues(i,!0),null}};Q.en={NAME:"Eulers Method"};Q.de_strings={NAME:"Eulers Methode"};Q.i18n=r.LOCALE==="de"?Q.de_strings:Q.en;r.defineGlobal("lab$model$EulersMethod",Q);var K=class h{constructor(t){this.inp_=[],this.k1_=[],this.k2_=[],this.ode_=t}toString(){return this.toStringShort()}toStringShort(){return"ModifiedEuler{ode_: "+this.ode_.toStringShort()+"}"}getName(t){return t?h.i18n.NAME:r.toName(h.en.NAME)}nameEquals(t){return this.getName()==r.toName(t)}step(t){let e=this.ode_.getVarsList(),i=e.getValues(),s=i.length;this.inp_.length!=s&&(this.inp_=new Array(s),this.k1_=new Array(s),this.k2_=new Array(s));let n=this.inp_,a=this.k1_,o=this.k2_;for(let _=0;_<s;_++)n[_]=i[_];r.zeroArray(a);let l=this.ode_.evaluate(n,a,0);if(l!=null)return l;for(let _=0;_<s;_++)n[_]=i[_]+a[_]*t;if(r.zeroArray(o),l=this.ode_.evaluate(n,o,t),l!=null)return l;for(let _=0;_<s;_++)i[_]+=(a[_]+o[_])*t/2;return e.setValues(i,!0),null}};K.en={NAME:"Modified Euler"};K.de_strings={NAME:"Modifiziert Euler"};K.i18n=r.LOCALE==="de"?K.de_strings:K.en;r.defineGlobal("lab$model$ModifiedEuler",K);var z=class h{constructor(t){this.inp_=[],this.k1_=[],this.k2_=[],this.k3_=[],this.k4_=[],this.ode_=t}toString(){return this.toStringShort()}toStringShort(){return"RungeKutta{ode_: "+this.ode_.toStringShort()+"}"}getName(t){return t?h.i18n.NAME:r.toName(h.en.NAME)}nameEquals(t){return this.getName()==r.toName(t)}step(t){let e=this.ode_.getVarsList(),i=e.getValues(),s=i.length;this.inp_.length<s&&(this.inp_=new Array(s),this.k1_=new Array(s),this.k2_=new Array(s),this.k3_=new Array(s),this.k4_=new Array(s));let n=this.inp_,a=this.k1_,o=this.k2_,l=this.k3_,_=this.k4_;for(let g=0;g<s;g++)n[g]=i[g];r.zeroArray(a);let c=this.ode_.evaluate(n,a,0);if(c!==null)return c;for(let g=0;g<s;g++)n[g]=i[g]+a[g]*t/2;if(r.zeroArray(o),c=this.ode_.evaluate(n,o,t/2),c!==null)return c;for(let g=0;g<s;g++)n[g]=i[g]+o[g]*t/2;if(r.zeroArray(l),c=this.ode_.evaluate(n,l,t/2),c!==null)return c;for(let g=0;g<s;g++)n[g]=i[g]+l[g]*t;if(r.zeroArray(_),c=this.ode_.evaluate(n,_,t),c!==null)return c;for(let g=0;g<s;g++)i[g]+=(a[g]+2*o[g]+2*l[g]+_[g])*t/6;return e.setValues(i,!0),null}};z.en={NAME:"Runge-Kutta"};z.de_strings={NAME:"Runge-Kutta"};z.i18n=r.LOCALE==="de"?z.de_strings:z.en;r.defineGlobal("lab$model$RungeKutta",z);var J=class h extends T{constructor(t,e,i,s){if(super(s||"DIFF_EQ_SUBJECT"),this.sim_=t,this.energySystem_=e,this.advanceStrategy_=i,this.solvers_=[],this.solvers_.push(new Q(this.sim_)),this.solvers_.push(new K(this.sim_)),this.solvers_.push(new z(this.sim_)),this.energySystem_!=null){let o=new Z(this.sim_,this.energySystem_,new K(this.sim_));this.solvers_.push(o),o=new Z(this.sim_,this.energySystem_,new z(this.sim_)),this.solvers_.push(o)}let n=this.solvers_.map(o=>o.getName(!0)),a=this.solvers_.map(o=>o.getName());this.addParameter(new I(this,h.en.DIFF_EQ_SOLVER,h.i18n.DIFF_EQ_SOLVER,()=>this.getDiffEqSolver(),o=>this.setDiffEqSolver(o),n,a))}toString(){return this.toStringShort().slice(0,-1)+", sim_: "+this.sim_.toStringShort()+", energySystem_: "+(this.energySystem_==null?"null":this.energySystem_.toStringShort())+", advanceStrategy_: "+this.advanceStrategy_+", solvers_: [ "+this.solvers_.map(t=>t.toStringShort())+"]"+super.toString()}getClassName(){return"DiffEqSolverSubject"}getDiffEqSolver(){return this.advanceStrategy_.getDiffEqSolver().getName()}setDiffEqSolver(t){if(!this.advanceStrategy_.getDiffEqSolver().nameEquals(t)){let e=this.solvers_.find(i=>i.nameEquals(t));if(e!==void 0)this.advanceStrategy_.setDiffEqSolver(e),this.broadcastParameter(h.en.DIFF_EQ_SOLVER);else throw"unknown solver: "+t}}};J.en={DIFF_EQ_SOLVER:"Diff Eq Solver"};J.de_strings={DIFF_EQ_SOLVER:"Diff Eq L\xF6ser"};J.i18n=r.LOCALE==="de"?J.de_strings:J.en;r.defineGlobal("lab$model$DiffEqSolverSubject",J);var he=class{constructor(t){this.text_=t,this.label_=document.createElement("label"),this.label_.appendChild(document.createTextNode(t))}toString(){return this.toStringShort().slice(0,-1)+"}"}toStringShort(){return'LabelControl{text_: "'+this.text_+'"}'}disconnect(){}getElement(){return this.label_}getParameter(){return null}setEnabled(t){throw"LabelControl cannot be disabled"}};r.defineGlobal("lab$controls$LabelControl",he);var Jt=class h{constructor(t,e,i,s){if(this.signifDigits_=3,this.decimalPlaces_=-1,this.columns_=Math.max(8,1+this.signifDigits_),this.lastValue_="",this.firstClick_=!1,this.label_=t,this.getter_=e,this.setter_=i,this.value_=e(),typeof this.value_!="number")throw"not a number "+this.value_;let n=null;if(s!==void 0){let a=s.parentElement;a!==null&&a.tagName=="LABEL"&&(n=a)}else s=document.createElement("input"),s.type="text",s.size=this.columns_,n=document.createElement("label"),n.appendChild(document.createTextNode(this.label_)),n.appendChild(s);this.textField_=s,this.topElement_=n!==null?n:this.textField_,this.textField_.style.textAlign="right",this.changeFn_=this.validate.bind(this),this.textField_.addEventListener("change",this.changeFn_,!0),this.focusFn_=this.gainFocus.bind(this),this.textField_.addEventListener("focus",this.focusFn_,!1),this.clickFn_=this.doClick.bind(this),this.textField_.addEventListener("click",this.clickFn_,!1),this.formatTextField()}toString(){return this.toStringShort().slice(0,-1)+", signifDigits_: "+this.signifDigits_+", decimalPlaces_: "+this.decimalPlaces_+", columns_: "+this.columns_+"}"}toStringShort(){return this.getClassName()+'{label_: "'+this.label_+'"}'}columnsNeeded(t,e){let i=h.magnitude(t);return 2+this.decimalPlacesNeeded(t,e)+(i>0?i:0)}decimalPlacesNeeded(t,e){if(this.decimalPlaces_>-1)return this.decimalPlaces_;{let i=e-1-h.magnitude(t);return i>16&&(i=16),i>0?i:0}}disconnect(){this.textField_.removeEventListener("change",this.changeFn_,!0),this.textField_.removeEventListener("focus",this.focusFn_,!1),this.textField_.removeEventListener("click",this.clickFn_,!1)}doClick(t){this.firstClick_&&(this.textField_.select(),this.firstClick_=!1)}formatTextField(){let t=this.decimalPlacesNeeded(this.value_,this.signifDigits_),e=this.columnsNeeded(this.value_,this.signifDigits_);this.lastValue_=this.value_.toFixed(t),this.textField_.value=this.lastValue_,e!=this.columns_&&(this.columns_=e,this.textField_.size=this.columns_)}gainFocus(t){this.firstClick_=!0}getClassName(){return"NumericControlBase"}getDecimalPlaces(){return this.decimalPlaces_}getElement(){return this.topElement_}getParameter(){return null}getSignifDigits(){return this.signifDigits_}getValue(){return this.value_}static magnitude(t){return Math.abs(t)<1e-15?0:Math.floor(Math.LOG10E*Math.log(Math.abs(t)))}observe(t){this.setValue(this.getter_())}setDecimalPlaces(t){return this.decimalPlaces_!=t&&(this.decimalPlaces_=t>-1?t:-1,this.formatTextField()),this}setEnabled(t){this.textField_.disabled=!t}setSignifDigits(t){return this.signifDigits_!=t&&(this.signifDigits_=t,this.formatTextField()),this}setValue(t){if(t!=this.value_){try{if(isNaN(t))throw"not a number "+t;this.value_=t,this.setter_(t)}catch(e){alert(e),this.value_=this.getter_()}this.formatTextField()}}validate(t){let e=this.textField_.value.replace(/^\s*|\s*$/g,"");if(e!=this.lastValue_){let i=parseFloat(e);isNaN(i)?(alert("not a number: "+e),this.formatTextField()):this.setValue(i)}}};r.defineGlobal("lab$controls$NumericControlBase",Jt);var tt=class extends Jt{constructor(t,e){super(t.getName(!0)+t.getUnits(),()=>t.getValue(),i=>t.setValue(i),e),this.parameter_=t,this.setSignifDigits(t.getSignifDigits()),this.setDecimalPlaces(t.getDecimalPlaces()),this.parameter_.getSubject().addObserver(this)}toString(){return super.toString().slice(0,-1)+", parameter_: "+this.parameter_.toStringShort()+"}"}disconnect(){super.disconnect(),this.parameter_.getSubject().removeObserver(this)}getClassName(){return"NumericControl"}getParameter(){return this.parameter_}observe(t){t===this.parameter_&&(super.observe(t),this.setSignifDigits(this.parameter_.getSignifDigits()),this.setDecimalPlaces(this.parameter_.getDecimalPlaces()))}};r.defineGlobal("lab$controls$NumericControl",tt);var Yt=class h{constructor(t,e,i,s,n){if(this.ehDrag_=!1,this.dragSimObj_=null,this.dragOffset_=u.ORIGIN,t==null&&n==null)throw"";if(this.dragDispObj_=t,this.view_=e,this.eventHandler_=n,t!=null){let a=t.getSimObjects();a.length>0&&(this.dragSimObj_=a[0])}this.loc_sim_=i,this.drag_body_=s,t!==null&&(this.dragOffset_=i.subtract(t.getPosition()),this.dragSimObj_===null&&(this.eventHandler_=null))}startDrag(t){this.eventHandler_!=null?this.ehDrag_=this.eventHandler_.startDrag(this.dragSimObj_,this.loc_sim_,this.dragOffset_,this.drag_body_,t):this.ehDrag_=!1}mouseDrag(t){let e=this.view_.getCoordMap();this.loc_sim_=e.screenToSim(t),this.dragDispObj_!=null&&(this.dragSimObj_==null||!this.ehDrag_)?this.dragDispObj_.setPosition(this.loc_sim_.subtract(this.dragOffset_)):this.eventHandler_!=null&&this.ehDrag_&&this.eventHandler_.mouseDrag(this.dragSimObj_,this.loc_sim_,this.dragOffset_)}finishDrag(){this.eventHandler_!=null&&this.eventHandler_.finishDrag(this.dragSimObj_,this.loc_sim_,this.dragOffset_)}static findNearestDragable(t,e,i){let s=null,n,a,o=null,l=1/0,_=t.getViews();t:for(let c=_.length-1;c>=0;c--){let g=_[c],d=g.getCoordMap(),m=d.screenToSim(e),f=g.getDisplayList().toArray();e:for(let b=f.length-1;b>=0;b--){let C=f[b];if(!C.isDragable())continue e;let v=C.getMassObjects();if(v.length>1)continue e;if(v.length==0)if(C.contains(m)){s=C,n=g,a=m,o=u.ORIGIN;break t}else continue e;else{let gt=v[0],it=gt.getDragPoints();for(let X=it.length-1;X>=0;X--){let pe=gt.bodyToWorld(it[X]),le=e.distanceTo(d.simToScreen(pe));le<=l&&(l=le,s=C,n=g,o=it[X],a=m)}}}}if(s==null){let c=t.getFocusView();if(c!=null)n=c,a=n.getCoordMap().screenToSim(e);else return null;if(i==null)return null}return n!==void 0&&a!==void 0?new h(s,n,a,o,i):null}};r.defineGlobal("lab$app$MouseTracker",Yt);var at=class h{constructor(t,e,i){this.enablePanning_=!1,this.panModifiers_={},this.mouseDrag_=!1,this.mouseTracker_=null,this.myViewPanner_=null,this.touchStartFn_=void 0,this.touchMoveFn_=void 0,this.touchEndFn_=void 0,this.debug_=!1,this.labCanvas_=t,this.eventHandler_=e||null,i===void 0&&(i={shift:!0}),i&&(this.enablePanning_=!0,this.panModifiers_=i),this.mouseDownFn_=this.mouseDown.bind(this),t.getCanvas().addEventListener("mousedown",this.mouseDownFn_),this.mouseMoveFn_=this.mouseMove.bind(this),document.addEventListener("mousemove",this.mouseMoveFn_),this.mouseUpFn_=this.mouseUp.bind(this),document.addEventListener("mouseup",this.mouseUpFn_),this.keyDownFn_=this.keyPressed.bind(this),document.addEventListener("keydown",this.keyDownFn_),this.keyUpFn_=this.keyReleased.bind(this),document.addEventListener("keyup",this.keyUpFn_),this.touchStartFn_=this.touchStart.bind(this),document.addEventListener("touchstart",this.touchStartFn_),this.touchMoveFn_=this.touchMove.bind(this),document.addEventListener("touchmove",this.touchMoveFn_),this.touchEndFn_=this.touchEnd.bind(this),document.addEventListener("touchend",this.touchEndFn_)}destroy(){this.mouseDownFn_&&this.labCanvas_.getCanvas().removeEventListener("mousedown",this.mouseDownFn_),this.mouseMoveFn_&&document.removeEventListener("mousemove",this.mouseMoveFn_),this.mouseUpFn_&&document.removeEventListener("mouseup",this.mouseUpFn_),this.keyDownFn_&&document.removeEventListener("keydown",this.keyDownFn_),this.keyUpFn_&&document.removeEventListener("keyup",this.keyUpFn_),this.touchStartFn_&&document.removeEventListener("touchstart",this.touchStartFn_),this.touchMoveFn_&&document.removeEventListener("touchmove",this.touchMoveFn_),this.touchEndFn_&&document.removeEventListener("touchend",this.touchEndFn_)}toString(){return this.toStringShort().slice(0,-1)+", labCanvas_: "+this.labCanvas_.toStringShort()+", enablePanning_: "+this.enablePanning_+", panModifiers_: "+h.modifiersToString(this.panModifiers_)+"}"}toStringShort(){return"SimController{eventHandler_: "+(this.eventHandler_!=null?this.eventHandler_.toStringShort():"null")+"}"}notifyError(t){this.mouseDrag_&&this.finishDrag()}mouseDown(t){let e={control:t.ctrlKey,meta:t.metaKey,shift:t.shiftKey,alt:t.altKey};this.doMouseDown(e,t.clientX,t.clientY)}doMouseDown(t,e,i){this.labCanvas_.focus(),this.mouseDrag_=!0;let s=this.eventToScreen(e,i);if(this.enablePanning_&&h.modifiersEqual(this.panModifiers_,t)){let n=this.labCanvas_.getFocusView();n!=null&&(this.myViewPanner_=new Qt(n,s),this.myViewPanner_.mouseDrag(s))}else this.mouseTracker_=Yt.findNearestDragable(this.labCanvas_,s,this.eventHandler_),this.mouseTracker_!=null&&this.mouseTracker_.startDrag(t)}eventToScreen(t,e){let i=this.labCanvas_.getCanvas(),s=i.getBoundingClientRect(),n=new u(t-s.left,e-s.top),a=i.offsetWidth/this.labCanvas_.getWidth();return n.divide(a)}mouseMove(t){this.doMouseMove(t.clientX,t.clientY)}doMouseMove(t,e){if(this.labCanvas_.getCanvas().offsetParent==null)return;let s=this.eventToScreen(t,e);this.myViewPanner_!=null?this.myViewPanner_.mouseDrag(s):this.mouseTracker_!=null&&this.mouseTracker_.mouseDrag(s)}mouseUp(t){this.labCanvas_.getCanvas().offsetParent!=null&&this.finishDrag()}finishDrag(){this.myViewPanner_!=null?this.myViewPanner_.finishDrag():this.mouseTracker_!=null&&this.mouseTracker_.finishDrag(),this.mouseTracker_=null,this.myViewPanner_=null,this.mouseDrag_=!1}getEventHandler(){return this.eventHandler_}getPanModifiers(){return this.enablePanning_?this.panModifiers_:null}keyPressed(t){let e=t;if((e.target==this.labCanvas_.getCanvas()||e.target==document.body)&&this.eventHandler_!=null){r.DEBUG&&this.debug_&&console.log("keyPressed "+r.propertiesOf(e,!0));let i={control:e.ctrlKey,meta:e.metaKey,shift:e.shiftKey,alt:e.altKey};this.eventHandler_.handleKeyEvent(e,!0,i)}}keyReleased(t){if((t.target==this.labCanvas_.getCanvas()||t.target==document.body)&&this.eventHandler_!=null){r.DEBUG&&this.debug_&&console.log("keyReleased "+r.propertiesOf(t,!0));let e={control:t.ctrlKey,meta:t.metaKey,shift:t.shiftKey,alt:t.altKey};this.eventHandler_.handleKeyEvent(t,!1,e)}}setEventHandler(t){this.eventHandler_=t}setPanModifiers(t){t==null?(this.enablePanning_=!1,this.panModifiers_={}):(this.enablePanning_=!0,this.panModifiers_=t)}touchStart(t){if(t.target==this.labCanvas_.getCanvas()){let e=t.touches;if(e&&e.length==1){let i={control:!1,meta:!1,shift:!1,alt:!1};this.doMouseDown(i,e[0].clientX,e[0].clientY)}else this.finishDrag()}}touchMove(t){let e=t!=null?t.touches:[];this.mouseDrag_&&e&&e.length==1?this.doMouseMove(e[0].clientX,e[0].clientY):this.finishDrag()}touchEnd(t){this.mouseDrag_&&this.finishDrag()}static modifiersToString(t){let e="";return t.control&&(e+="control"),t.alt&&(e+=(e.length>0?"+":"")+"alt"),t.meta&&(e+=(e.length>0?"+":"")+"meta"),t.shift&&(e+=(e.length>0?"+":"")+"shift"),e}static modifiersEqual(t,e){return!!t.control==!!e.control&&!!t.meta==!!e.meta&&!!t.shift==!!e.shift&&!!t.alt==!!e.alt}};r.defineGlobal("lab$app$SimController",at);var Qt=class{constructor(t,e){this.view_=t,this.panMap_=t.getCoordMap();let i=t.getSimRect();this.center_screen_=this.panMap_.simToScreen(i.getCenter()),this.start_screen_=e}mouseDrag(t){let e=this.start_screen_.subtract(t),i=this.panMap_.screenToSim(this.center_screen_.add(e)),s=this.view_.getSimRect(),n=S.makeCentered(i,s.getWidth(),s.getHeight());this.view_.setSimRect(n)}finishDrag(){}};r.defineGlobal("lab$app$ViewPanner",Qt);var ut=class h{constructor(t){this.capacity_=3e3,this.size_=0,this.cycles_=0,this.nextPtr_=0,this.lastPtr_=-1,this.values_=new Array(this.capacity_),this.lastValue_=null,t!==void 0&&t>1&&(this.capacity_=t,this.values_=new Array(t))}toString(){return"CircularList{capacity_: "+this.capacity_+", size_: "+this.size_+", cycles_: "+this.cycles_+", nextPtr_: "+this.nextPtr_+", lastPtr_: "+this.lastPtr_+"}"}causeMaxIntError(){this.size_=this.capacity_,this.cycles_=Math.floor(r.MAX_INTEGER/this.capacity_)-1}getEndIndex(){if(this.size_==0)return-1;let t;return this.nextPtr_==0?t=this.pointerToIndex(this.size_-1):t=this.pointerToIndex(this.nextPtr_-1),t}getEndValue(){let t=this.getEndIndex();return t==-1?null:this.values_[this.indexToPointer(t)]}getIterator(t){return new te(this,t)}getSize(){return this.size_}getStartIndex(){return this.size_<this.capacity_?0:this.pointerToIndex(this.nextPtr_)}getValue(t){let e=this.indexToPointer(t);return this.values_[e]}getValueAtPointer(t){return this.values_[t]}indexToPointer(t){if(this.size_<this.capacity_)return t;let e=t%this.capacity_;return t-(this.cycles_-(e<this.nextPtr_?0:1))*this.capacity_}pointerToIndex(t){if(this.size_<this.capacity_)return t;let e=t+(this.cycles_-(t<this.nextPtr_?0:1))*this.capacity_;if(e>=r.MAX_INTEGER)throw h.MAX_INDEX_ERROR;return e}reset(){this.nextPtr_=this.size_=0,this.cycles_=0,this.lastPtr_=-1}store(t){return this.lastPtr_=this.nextPtr_,this.values_[this.nextPtr_]=t,this.nextPtr_++,this.size_<this.capacity_&&this.size_++,this.nextPtr_>=this.capacity_&&(this.cycles_++,this.nextPtr_=0),this.pointerToIndex(this.lastPtr_)}};ut.MAX_INDEX_ERROR="exceeded max int";r.defineGlobal("lab$util$CircularList",ut);var te=class{constructor(t,e){if(this.first_=t.getSize()>0,this.cList_=t,(e===void 0||e<0)&&(e=t.getStartIndex()),t.getSize()>0&&(e<t.getStartIndex()||e>t.getEndIndex()))throw"out of range startIndex="+e;this.index_=e,this.pointer_=t.indexToPointer(e)}getIndex(){if(this.cList_.getSize()==0)throw"no data";return this.index_}getValue(){if(this.cList_.getSize()==0)throw"no data";return this.cList_.getValueAtPointer(this.pointer_)}hasNext(){return this.first_||this.index_<this.cList_.getEndIndex()}hasPrevious(){return this.first_||this.index_>this.cList_.getStartIndex()}nextValue(){if(this.cList_.getSize()===0)throw"no data";if(this.first_)this.first_=!1;else{if(this.index_+1>this.cList_.getEndIndex())throw"cannot iterate past end of list";this.index_++,this.pointer_=this.cList_.indexToPointer(this.index_)}return this.cList_.getValueAtPointer(this.pointer_)}previousValue(){if(this.cList_.getSize()===0)throw"no data";if(this.first_)this.first_=!1;else{if(this.index_-1<this.cList_.getStartIndex())throw"cannot iterate prior to start of list";this.index_--,this.pointer_=this.cList_.indexToPointer(this.index_)}return this.cList_.getValueAtPointer(this.pointer_)}};r.defineGlobal("lab$util$CircularListIterator",te);function de(){return[ge.DOTS,ge.LINES]}function me(){return["dots","lines"]}var Te={DOTS:"Dots",LINES:"Lines"},we={DOTS:"Punkte",LINES:"Linien"},ge=r.LOCALE==="de"?we:Te;var R=class h extends T{constructor(t,e,i){let s=i!==void 0?i:"VARIABLES";if(super(s),this.timeIdx_=-1,this.varList_=[],this.history_=r.DEBUG,this.histArray_=[],t.length!=e.length)throw"varNames and localNames are different lengths";for(let n=0,a=t.length;n<a;n++){let o=t[n];if(typeof o!="string")throw"variable name "+o+" is not a string i="+n;o=r.validName(r.toName(o)),t[n]=o,o==h.TIME&&(this.timeIdx_=n)}if(!r.uniqueElements(t))throw"duplicate variable names";for(let n=0,a=t.length;n<a;n++)this.varList_.push(new ot(this,t[n],e[n]))}toString(){return this.toStringShort().slice(0,-1)+", timeIdx_: "+this.timeIdx_+", history_: "+this.history_+", "+this.varList_.map((t,e)=>"("+e+") "+t.getName()+": "+r.NF5E(t.getValue()))+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", numVars: "+this.varList_.length+"}"}getClassName(){return"VarsList"}addParameter(t){throw"addParameter not allowed on VarsList"}addVariable(t){let e=t.getName();if(e==h.DELETED)throw'variable cannot be named "'+h.DELETED+'"';let i=this.findOpenSlot_(1);return this.varList_[i]=t,e==h.TIME&&(this.timeIdx_=i),this.broadcast(new p(this,h.VARS_MODIFIED)),i}addVariables(t,e){let i=t.length;if(i==0)throw"";if(t.length!=e.length)throw"names and localNames are different lengths";let s=this.findOpenSlot_(i);for(let n=0;n<i;n++){let a=r.validName(r.toName(t[n]));if(a==h.DELETED)throw"variable cannot be named ''+VarsList.DELETED+''";let o=s+n;this.varList_[o]=new ot(this,a,e[n]),a==h.TIME&&(this.timeIdx_=o)}return this.broadcast(new p(this,h.VARS_MODIFIED)),s}checkIndex_(t){if(t<0||t>=this.varList_.length)throw"bad variable index="+t+"; numVars="+this.varList_.length}deleteVariables(t,e){if(e!=0){if(e<0||t<0||t+e>this.varList_.length)throw"deleteVariables";for(let i=t;i<t+e;i++)this.varList_[i]=new ot(this,h.DELETED,h.DELETED);this.broadcast(new p(this,h.VARS_MODIFIED))}}findOpenSlot_(t){if(t<0)throw"";let e=0,i=-1;for(let n=0,a=this.varList_.length;n<a;n++)if(this.varList_[n].getName()==h.DELETED){if(i==-1&&(i=n),e++,e>=t)return i}else i=-1,e=0;let s;e>0?(s=t-e,r.assert(i>=0&&s>0)):(i=this.varList_.length,s=t);for(let n=0;n<s;n++)this.varList_.push(new ot(this,h.DELETED,h.DELETED));return i}getHistory(){return this.history_}getParameter(t){t=r.toName(t);let e=this.varList_.find(i=>i.getName()==t);if(e===void 0)throw"Parameter not found "+t;return e}getParameters(){return Array.from(this.varList_)}getTime(){if(this.timeIdx_<0)throw"no time variable";return this.getValue(this.timeIdx_)}getValue(t){return this.checkIndex_(t),this.varList_[t].getValue()}getValues(t){return this.varList_.map(e=>!t&&e.isComputed()?NaN:e.getValue())}getVariable(t){let e;if(typeof t=="number")e=t;else if(typeof t=="string"){if(t=r.toName(t),e=this.varList_.findIndex(i=>i.getName()==t),e<0)throw"unknown variable name "+t}else throw"";return this.checkIndex_(e),this.varList_[e]}incrSequence(...t){if(t.length==0)for(let e=0,i=this.varList_.length;e<i;e++)this.varList_[e].incrSequence();else for(let e=0,i=t.length;e<i;e++){let s=t[e];this.checkIndex_(s),this.varList_[s].incrSequence()}}indexOf(t){return typeof t=="string"?(t=r.toName(t),this.varList_.findIndex(e=>e.getName()==t)):this.varList_.findIndex(e=>e===t)}numVariables(){return this.varList_.length}printOneHistory(t){let e="";if(this.history_&&t<=this.histArray_.length){let i=this.histArray_[this.histArray_.length-t];e="//time = "+r.NF5(i[i.length-1]);for(let s=0,n=i.length-1;s<n;s++)e+=`
sim.getVarsList().setValue(`+s+", "+i[s]+");"}return e}printHistory(t){if(typeof t=="number")return this.printOneHistory(t);{let e=this.printOneHistory(10);return e+=`
`+this.printOneHistory(3),e+=`
`+this.printOneHistory(2),e+=`
`+this.printOneHistory(1),e}}saveHistory(){if(this.history_){let t=this.getValues();t.push(this.getTime()),this.histArray_.push(t),this.histArray_.length>20&&this.histArray_.shift()}}setComputed(...t){for(let e=0,i=t.length;e<i;e++){let s=t[e];this.checkIndex_(s),this.varList_[s].setComputed(!0)}}setHistory(t){this.history_=t}setTime(t){this.setValue(this.timeIdx_,t)}setValue(t,e,i){this.checkIndex_(t);let s=this.varList_[t];if(s.getName()!=h.DELETED){if(isNaN(e)&&!s.isComputed())throw"cannot set variable "+s.getName()+" to NaN";i?s.setValueSmooth(e):s.setValue(e)}}setValues(t,e){let i=this.varList_.length,s=t.length;if(s>i)throw"setValues bad length n="+s+" > N="+i;for(let n=0;n<i;n++)n<s&&this.setValue(n,t[n],e)}timeIndex(){return this.timeIdx_}toArray(){return Array.from(this.varList_)}};R.VARS_MODIFIED="VARS_MODIFIED";R.DELETED="DELETED";R.TIME="TIME";R.en={TIME:"time"};R.de_strings={TIME:"Zeit"};R.i18n=r.LOCALE==="de"?R.de_strings:R.en;r.defineGlobal("lab$model$VarsList",R);var ot=class{constructor(t,e,i){this.value_=0,this.isComputed_=!1,this.seq_=0,this.doesBroadcast_=!1,this.varsList_=t,this.name_=r.validName(r.toName(e)),this.localName_=i}toString(){return this.toStringShort().slice(0,-1)+", isComputed_: "+this.isComputed_+', localName_: "'+this.localName_+'", varsList_: '+this.varsList_.toStringShort()+"}"}toStringShort(){return this.getClassName()+'{name_: "'+this.name_+'", value_: '+r.NF(this.getValue())+"}"}getClassName(){return"ConcreteVariable"}getAsString(){return this.value_.toString()}getBroadcast(){return this.doesBroadcast_}getChoices(){return[]}getName(t){return t?this.localName_:this.name_}getSequence(){return this.seq_}getSubject(){return this.varsList_}getValue(){return this.value_}getValues(){return[]}incrSequence(){this.seq_++}indexOf(){return this.varsList_.indexOf(this)}isComputed(){return this.isComputed_}nameEquals(t){return this.name_==r.toName(t)}setBroadcast(t){this.doesBroadcast_=t}setComputed(t){this.isComputed_=t}setFromString(t){let e=Number(t);if(isNaN(e))throw"not a number: "+t+" (ConcreteVariable.setFromString)";this.setValue(e)}setValue(t){this.value_!=t&&(this.value_=t,this.seq_++,this.doesBroadcast_&&this.varsList_.broadcast(this))}setValueSmooth(t){this.value_=t}};r.defineGlobal("lab$model$ConcreteVariable",ot);var E=class h extends T{constructor(t,e,i){super(t),this.xVar_=-1,this.yVar_=-1,this.changed_=!0,this.drawColor_="lime",this.drawMode_="lines",this.lineWidth_=1,this.hotSpotColor_="red",this.styles_=[],this.xTransform=(s,n)=>s,this.yTransform=(s,n)=>n,this.varsList_=e,e.addObserver(this),this.yVarParam_=new y(this,h.en.Y_VARIABLE,h.i18n.Y_VARIABLE,()=>this.getYVariable(),s=>this.setYVariable(s)).setLowerLimit(-1),this.addParameter(this.yVarParam_),this.xVarParam_=new y(this,h.en.X_VARIABLE,h.i18n.X_VARIABLE,()=>this.getXVariable(),s=>this.setXVariable(s)).setLowerLimit(-1),this.addParameter(this.xVarParam_),this.buildMenu(),this.dataPoints_=new ut(i||1e5),this.addGraphStyle(),this.addParameter(new y(this,h.en.LINE_WIDTH,h.i18n.LINE_WIDTH,()=>this.getLineWidth(),s=>this.setLineWidth(s))),this.addParameter(new I(this,h.en.DRAWING_MODE,h.i18n.DRAWING_MODE,()=>this.getDrawingMode(),s=>this.setDrawingMode(s),de(),me())),this.addParameter(new I(this,h.en.GRAPH_COLOR,h.i18n.GRAPH_COLOR,()=>this.getColor(),s=>this.setColor(s)))}toString(){return this.toStringShort().slice(0,-1)+', drawColor_:"'+this.drawColor_+'", lineWidth_: '+r.NF(this.lineWidth_)+", drawMode_: "+this.drawMode_+', hotSpotColor_:"'+this.hotSpotColor_+'", styles_.length: '+r.NF(this.styles_.length)+", varsList: "+this.varsList_.toStringShort()+", dataPoints_: "+this.dataPoints_+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", xVar: "+r.NF(this.xVar_)+", yVar: "+r.NF(this.yVar_)+"}"}getClassName(){return"GraphLine"}addGraphStyle(){this.styles_.push(new ie(this.dataPoints_.getEndIndex()+1,this.drawMode_,this.drawColor_,this.lineWidth_)),this.changed_=!0}buildMenu(){let t=[h.i18n.NONE],e=[-1];for(let i=0,s=this.varsList_.numVariables();i<s;i++)t.push(this.varsList_.getVariable(i).getName(!0)),e.push(i);this.yVarParam_.setChoices(t,e),this.xVarParam_.setChoices(t,e)}getChanged(){return this.changed_?(this.changed_=!1,!0):!1}getColor(){return this.drawColor_}getDrawingMode(){return this.drawMode_}getGraphPoints(){return this.dataPoints_}getGraphStyle(t){let e=this.styles_;if(e.length==0)throw"graph styles list is empty";let i=e[0];for(let s=1,n=e.length;s<n;s++){let a=e[s];if(r.assert(i.index_<=a.index_),a.index_>t)break;i=a}return r.assert(r.isObject(i)),i}getHotSpotColor(){return this.hotSpotColor_}getLineWidth(){return this.lineWidth_}getVarsList(){return this.varsList_}getXVariable(){return this.xVar_}getXVarName(){return this.xVar_>-1?this.varsList_.getVariable(this.xVar_).getName(!0):""}getYVariable(){return this.yVar_}getYVarName(){return this.yVar_>-1?this.varsList_.getVariable(this.yVar_).getName(!0):""}memorize(){if(this.xVar_>-1&&this.yVar_>-1){let t=this.varsList_.getVariable(this.xVar_),e=this.varsList_.getVariable(this.yVar_),i=t.getValue(),s=e.getValue(),n=this.xTransform(i,s),a=this.yTransform(i,s),o=t.getSequence(),l=e.getSequence(),_=new ee(n,a,o,l),c=this.dataPoints_.getEndValue();(c==null||!c.equals(_))&&(this.dataPoints_.store(_),this.changed_=!0)}}observe(t){t.getSubject()==this.varsList_&&t.nameEquals(R.VARS_MODIFIED)&&this.buildMenu()}reset(){this.dataPoints_.reset(),this.resetStyle(),this.memorize(),this.broadcast(new p(this,h.RESET))}resetStyle(){this.styles_=[],this.addGraphStyle(),this.changed_=!0}setColor(t){this.drawColor_!=t&&(this.drawColor_=t,this.addGraphStyle(),this.changed_=!0,this.broadcastParameter(h.en.GRAPH_COLOR))}setDrawingMode(t){this.drawMode_!=t&&(this.drawMode_=t,this.addGraphStyle(),this.changed_=!0,this.broadcastParameter(h.en.DRAWING_MODE))}setHotSpotColor(t){this.hotSpotColor_=t,this.changed_=!0}setLineWidth(t){r.veryDifferent(t,this.lineWidth_)&&(this.lineWidth_=t,this.addGraphStyle(),this.changed_=!0,this.broadcastParameter(h.en.LINE_WIDTH))}setXVariable(t){if(typeof t=="string"){var e=this.varsList_.getVariable(t);t=this.varsList_.indexOf(e)}else if(t<-1||t>this.varsList_.numVariables()-1)throw"setXVariable bad index "+t;this.xVar_!=t&&(this.xVar_=t,this.reset(),this.broadcastParameter(h.en.X_VARIABLE))}setYVariable(t){if(typeof t=="string"){var e=this.varsList_.getVariable(t);t=this.varsList_.indexOf(e)}else if(t<-1||t>this.varsList_.numVariables()-1)throw"setYVariable bad index "+t;this.yVar_!=t&&(this.yVar_=t,this.reset(),this.broadcastParameter(h.en.Y_VARIABLE))}};E.RESET="RESET";E.en={DRAWING_MODE:"draw mode",GRAPH_COLOR:"graph color",GRAPH_DRAW_MODE:"graph draw mode",GRAPH_POINTS:"graph points",LINE_WIDTH:"draw width",X_VARIABLE:"X variable",Y_VARIABLE:"Y variable",CLEAR_GRAPH:"clear graph",NONE:"-none-"};E.de_strings={DRAWING_MODE:"Zeichnenart",GRAPH_COLOR:"Graph Farbe",GRAPH_DRAW_MODE:"Graph Zeichnenart",GRAPH_POINTS:"Punkteanzahl",LINE_WIDTH:"Zeichenbreite",X_VARIABLE:"X Variable",Y_VARIABLE:"Y Yariable",CLEAR_GRAPH:"Graph erneuern",NONE:"-keine-"};E.i18n=r.LOCALE==="de"?E.de_strings:E.en;r.defineGlobal("lab$graph$GraphLine",E);var ee=class{constructor(t,e,i,s){if(isNaN(t)||isNaN(e))throw"NaN in GraphPoint";this.x=t,this.y=e,this.seqX=i,this.seqY=s}toString(){return"GraphPoint{x: "+r.NF(this.x)+", y: "+r.NF(this.y)+", seqX: "+r.NF(this.seqX)+", seqY: "+r.NF(this.seqY)+"}"}equals(t){return this.x==t.x&&this.y==t.y&&this.seqX==t.seqX&&this.seqY==t.seqY}getX(){return this.x}getY(){return this.y}getZ(){return 0}};r.defineGlobal("lab$graph$GraphPoint",ee);var ie=class{constructor(t,e,i,s){this.index_=t,this.drawMode=e,this.color_=i,this.lineWidth=s}toString(){return"GraphStyle{index_: "+this.index_+", drawMode: "+this.drawMode+', color_:"'+this.color_+'", lineWidth: '+this.lineWidth+"}"}};r.defineGlobal("lab$graph$GraphStyle",ie);var k=class h extends T{constructor(t,e,i){if(super(t),this.enabled_=!0,this.isActive_=!0,this.ownEvent_=!1,this.axis_=h.BOTH_AXES,this.rangeSetX_=!1,this.rangeSetY_=!1,this.rangeXHi_=0,this.rangeXLo_=0,this.rangeYHi_=0,this.rangeYLo_=0,this.timeWindow_=10,this.extraMargin=.01,this.minSize=1e-14,!(e instanceof E))throw"not a GraphLine "+e;this.graphLines_=[],this.graphLines_.push(e),e.addObserver(this),this.simView_=i,i.addMemo(this),i.addObserver(this),this.lastIndex_=r.repeat(-1,this.graphLines_.length);let s=new y(this,h.en.TIME_WINDOW,h.i18n.TIME_WINDOW,()=>this.getTimeWindow(),a=>this.setTimeWindow(a));s.setSignifDigits(3),this.addParameter(s);let n=[h.VERTICAL,h.HORIZONTAL,h.BOTH_AXES];this.addParameter(new I(this,h.en.AXIS,h.i18n.AXIS,()=>this.getAxis(),a=>this.setAxis(a),n,n)),this.addParameter(new N(this,h.en.ACTIVE,h.i18n.ACTIVE,()=>this.getActive(),a=>this.setActive(a))),this.addParameter(new N(this,h.en.ENABLED,h.i18n.ENABLED,()=>this.getEnabled(),a=>this.setEnabled(a))),this.setComputed(this.isActive_)}toString(){return this.toStringShort().slice(0,-1)+", enabled_: "+this.enabled_+", isActive_: "+this.isActive_+", axis_: "+this.axis_+", extraMargin: "+r.NF(this.extraMargin)+", minSize: "+r.NF(this.minSize)+", timeWindow_: "+r.NF(this.timeWindow_)+", simView_: "+this.simView_.toStringShort()+", graphLines_: ["+this.graphLines_.map(t=>t.toStringShort())+"]"+super.toString()}getClassName(){return"AutoScale"}addGraphLine(t){if(!(t instanceof E))throw"not a GraphLine "+t;this.graphLines_.includes(t)||(this.graphLines_.push(t),this.lastIndex_.push(-1))}clearRange(){this.rangeXLo_=0,this.rangeXHi_=0,this.rangeSetX_=!1,this.rangeYLo_=0,this.rangeYHi_=0,this.rangeSetY_=!1}getActive(){return this.isActive_}getAxis(){return this.axis_}getEnabled(){return this.enabled_}getRangeRect(){return new S(this.rangeXLo_,this.rangeYLo_,this.rangeXHi_,this.rangeYHi_)}getTimeWindow(){return this.timeWindow_}memorize(){for(let t=0,e=this.graphLines_.length;t<e;t++){let i=this.graphLines_[t].getGraphPoints();this.lastIndex_[t]>i.getEndIndex()&&this.reset()}for(let t=0,e=this.graphLines_.length;t<e;t++){let s=this.graphLines_[t].getGraphPoints().getIterator(this.lastIndex_[t]);for(;s.hasNext();){let n=s.nextValue();this.updateRange_(this.graphLines_[t],n.x,n.y),this.lastIndex_[t]=s.getIndex()}}this.rangeCheck_()}observe(t){t.getSubject()==this.simView_?t.nameEquals(w.SIM_RECT_CHANGED)&&(this.ownEvent_||this.setActive(!1)):this.graphLines_.includes(t.getSubject())&&(t.nameEquals(E.en.X_VARIABLE)||t.nameEquals(E.en.Y_VARIABLE)?this.reset():t.nameEquals(E.RESET)&&this.setActive(!0))}rangeCheck_(){let t,e,i=this.minSize;this.rangeXHi_-this.rangeXLo_<i&&(t=(this.rangeXHi_+this.rangeXLo_)/2,e=Math.max(t*i,i),this.rangeXHi_=t+e,this.rangeXLo_=t-e),this.rangeYHi_-this.rangeYLo_<i&&(t=(this.rangeYHi_+this.rangeYLo_)/2,e=Math.max(t*i,i),this.rangeYHi_=t+e,this.rangeYLo_=t-e);let s=this.getRangeRect(),n=this.simView_.getSimRect();this.axis_==h.VERTICAL?s=new S(n.getLeft(),s.getBottom(),n.getRight(),s.getTop()):this.axis_==h.HORIZONTAL&&(s=new S(s.getLeft(),n.getBottom(),s.getRight(),n.getTop())),this.isActive_&&!s.nearEqual(n)&&(this.ownEvent_=!0,this.simView_.setSimRect(s),this.ownEvent_=!1,this.broadcast(new p(this,h.AUTO_SCALE,s)))}removeGraphLine(t){if(!(t instanceof E))throw"not a GraphLine "+t;let e=this.graphLines_.indexOf(t);if(e<0)throw"not found "+t;this.graphLines_.splice(e,1),this.lastIndex_.splice(e,1),r.assert(!this.graphLines_.includes(t)),this.reset()}reset(){this.clearRange();for(let t=0,e=this.lastIndex_.length;t<e;t++)this.lastIndex_[t]=-1}setActive(t){this.isActive_!=t&&(t?this.enabled_&&(this.reset(),this.simView_.addMemo(this),this.setComputed(!0),this.isActive_=!0,this.broadcastParameter(h.en.ACTIVE)):(this.simView_.removeMemo(this),this.setComputed(!1),this.isActive_=!1,this.broadcastParameter(h.en.ACTIVE))),r.assert(this.enabled_||!this.isActive_)}setAxis(t){if(t==h.VERTICAL||t==h.HORIZONTAL||t==h.BOTH_AXES)this.axis_=t,this.broadcastParameter(h.en.AXIS);else throw"unknown "+t}setComputed(t){[w.en.WIDTH,w.en.HEIGHT,w.en.CENTER_X,w.en.CENTER_Y].forEach(i=>this.simView_.getParameter(i).setComputed(t))}setEnabled(t){this.enabled_!=t&&(this.enabled_=t,this.setActive(t),this.broadcastParameter(h.en.ENABLED)),r.assert(this.enabled_||!this.isActive_)}setTimeWindow(t){r.veryDifferent(t,this.timeWindow_)&&(this.timeWindow_=t,this.reset(),this.memorize(),this.setActive(!0),this.broadcastParameter(h.en.TIME_WINDOW))}updateRange_(t,e,i){isFinite(e)||(e==Number.POSITIVE_INFINITY?e=1e308:e==Number.NEGATIVE_INFINITY&&(e=-1e308)),isFinite(i)||(i==Number.POSITIVE_INFINITY?i=1e308:i==Number.NEGATIVE_INFINITY&&(i=-1e308));let s=t.getVarsList().timeIndex(),n=t.getXVariable()==s,a=t.getYVariable()==s;this.rangeSetX_?(e<this.rangeXLo_&&(n?(this.rangeXLo_=e,this.rangeXHi_=e+this.timeWindow_):this.rangeXLo_=e-this.extraMargin*(this.rangeXHi_-this.rangeXLo_)),n?e>this.rangeXHi_-this.extraMargin*this.timeWindow_&&(this.rangeXHi_=e+this.extraMargin*this.timeWindow_,this.rangeXLo_=this.rangeXHi_-this.timeWindow_):e>this.rangeXHi_&&(this.rangeXHi_=e+this.extraMargin*(this.rangeXHi_-this.rangeXLo_))):(this.rangeXLo_=e,this.rangeXHi_=e+(n?this.timeWindow_:0),this.rangeSetX_=!0),this.rangeSetY_?(i<this.rangeYLo_&&(a?(this.rangeYLo_=i,this.rangeYHi_=i+this.timeWindow_):this.rangeYLo_=i-this.extraMargin*(this.rangeYHi_-this.rangeYLo_)),a?i>this.rangeYHi_-this.extraMargin*this.timeWindow_&&(this.rangeYHi_=i+this.extraMargin*this.timeWindow_,this.rangeYLo_=this.rangeYHi_-this.timeWindow_):i>this.rangeYHi_&&(this.rangeYHi_=i+this.extraMargin*(this.rangeYHi_-this.rangeYLo_))):(this.rangeYLo_=i,this.rangeYHi_=i+(a?this.timeWindow_:0),this.rangeSetY_=!0)}};k.AUTO_SCALE="AUTO_SCALE";k.BOTH_AXES="BOTH_AXES";k.HORIZONTAL="HORIZONTAL";k.VERTICAL="VERTICAL";k.en={AXIS:"axis",TIME_WINDOW:"time window",ACTIVE:"active",ENABLED:"enabled"};k.de_strings={AXIS:"Achse",TIME_WINDOW:"Zeitfenster",ACTIVE:"aktiviert",ENABLED:"erm\xF6glichte"};k.i18n=r.LOCALE==="de"?k.de_strings:k.en;r.defineGlobal("lab$graph$AutoScale",k);var Lt=class{constructor(t){if(this.offScreen_=null,this.lastMap_=null,this.screenRect_=F.EMPTY_RECT,this.needRedraw_=!1,this.useBuffer_=!0,this.zIndex=0,t!==void 0&&!(t instanceof E))throw"not a GraphLine "+t;this.graphLines_=t!==void 0?[t]:[],this.memDraw_=r.repeat(-1,this.graphLines_.length)}toString(){return this.toStringShort().slice(0,-1)+", screenRect_: "+this.screenRect_+", useBuffer_: "+this.useBuffer_+", zIndex: "+this.zIndex+", graphLines_: ["+this.graphLines_.map(t=>t.toStringShort())+"]}"}toStringShort(){return"DisplayGraph{graphLines_.length: "+this.graphLines_.length+"}"}addGraphLine(t){if(!(t instanceof E))throw"not a GraphLine "+t;this.graphLines_.includes(t)||(this.graphLines_.push(t),this.memDraw_.push(-1))}contains(t){return!1}draw(t,e){if(this.screenRect_.isEmpty()){r.DEBUG&&console.log("DisplayGraph: screenRect is empty");return}t.save(),(this.lastMap_==null||this.lastMap_!=e)&&(this.lastMap_=e,this.needRedraw_=!0);for(let i=0,s=this.graphLines_.length;i<s;i++)if(this.memDraw_[i]>this.graphLines_[i].getGraphPoints().getEndIndex()){this.reset();break}if(!this.useBuffer_)this.needRedraw_=!0,this.needRedraw_?(this.fullDraw(t,e),this.needRedraw_=!1):this.incrementalDraw(t,e);else{let i=this.screenRect_.getWidth(),s=this.screenRect_.getHeight();this.offScreen_==null&&(r.assert(i>0&&s>0),this.offScreen_=document.createElement("canvas"),this.offScreen_.width=i,this.offScreen_.height=s,this.needRedraw_=!0),r.assert(r.isObject(this.offScreen_));let n=this.offScreen_.getContext("2d");if(n===null)throw"DisplayGraph: getContext fail";this.needRedraw_?(n.clearRect(0,0,i,s),this.fullDraw(n,e),this.needRedraw_=!1):this.incrementalDraw(n,e),t.drawImage(this.offScreen_,0,0,i,s)}for(let i=0,s=this.graphLines_.length;i<s;i++)this.drawHotSpot(t,e,this.graphLines_[i]);t.restore()}drawHotSpot(t,e,i){let s=i.getGraphPoints().getEndValue();if(s!=null){let n=e.simToScreenX(s.getX()),a=e.simToScreenY(s.getY()),o=i.getHotSpotColor();o&&(t.fillStyle=o,t.fillRect(n-2,a-2,5,5))}}drawPoints(t,e,i,s){let n=e.screenToSimRect(this.screenRect_),a=s.getGraphPoints().getIterator(i);if(!a.hasNext())return i;let o=a.nextValue(),l=s.getGraphStyle(a.getIndex());if(l.drawMode=="dots"){let _=e.simToScreenX(o.x),c=e.simToScreenY(o.y),g=l.lineWidth;t.fillStyle=l.color_,t.fillRect(_,c,g,g)}for(;a.hasNext();){let _=o;if(o=a.nextValue(),o.x==_.x&&o.y==_.y)continue;l=s.getGraphStyle(a.getIndex());let c=o.seqX==_.seqX&&o.seqY==_.seqY;if(l.drawMode=="dots"||!c){if(!n.contains(o))continue;let g=e.simToScreenX(o.x),d=e.simToScreenY(o.y),m=l.lineWidth;t.fillStyle=l.color_,t.fillRect(g,d,m,m)}else{if(!n.maybeVisible(_,o))continue;let g=e.simToScreenX(_.x),d=e.simToScreenY(_.y),m=e.simToScreenX(o.x),f=e.simToScreenY(o.y);t.strokeStyle=l.color_,t.lineWidth=l.lineWidth,t.beginPath(),t.moveTo(g,d),t.lineTo(m,f),t.stroke()}}return a.getIndex()}fullDraw(t,e){this.memDraw_=r.repeat(-1,this.graphLines_.length),this.incrementalDraw(t,e)}getChanged(){let t=!1;for(let e=0,i=this.graphLines_.length;e<i;e++){let s=this.graphLines_[e].getChanged();t=t||s}return t||this.needRedraw_}getMassObjects(){return[]}getPosition(){return u.ORIGIN}getScreenRect(){return this.screenRect_}getSimObjects(){return[]}getUseBuffer(){return this.useBuffer_}getZIndex(){return this.zIndex}incrementalDraw(t,e){for(let i=0,s=this.graphLines_.length;i<s;i++)this.memDraw_[i]=this.drawPoints(t,e,this.memDraw_[i],this.graphLines_[i])}isDragable(){return!1}removeGraphLine(t){if(!(t instanceof E))throw"not a GraphLine "+t;let e=this.graphLines_.indexOf(t);if(e<0)throw"not found "+t;this.graphLines_.splice(e,1),this.memDraw_.splice(e,1),r.assert(!this.graphLines_.includes(t)),this.needRedraw_=!0}reset(){this.memDraw_=r.repeat(-1,this.graphLines_.length),this.needRedraw_=!0}setDragable(t){}setPosition(t){}setScreenRect(t){this.screenRect_=t,this.offScreen_=null,this.needRedraw_=!0}setUseBuffer(t){t!=this.useBuffer_&&(this.useBuffer_=t,this.useBuffer_||(this.offScreen_=null))}setZIndex(t){this.zIndex=t!==void 0?t:0,this.needRedraw_=!0}};r.defineGlobal("lab$graph$DisplayGraph",Lt);var lt=class{constructor(t,e){this.function_=t,this.purpose_=e||""}toString(){return this.toStringShort()}toStringShort(){return"GenericMemo{"+(this.purpose_.length>0?'purpose_:"'+this.purpose_+'"':"")+"}"}memorize(){this.function_()}};r.defineGlobal("lab$util$GenericMemo",lt);function ue(){return[G.AQUA,G.BLACK,G.BLUE,G.FUCHSIA,G.GRAY,G.GREEN,G.LIME,G.MAROON,G.NAVY,G.OLIVE,G.PURPLE,G.RED,G.SILVER,G.TEAL,G.WHITE,G.YELLOW]}function fe(){return["aqua","black","blue","fuchsia","gray","green","lime","maroon","navy","olive","purple","red","silver","teal","white","yellow"]}var Le={AQUA:"aqua",BLACK:"black",BLUE:"blue",FUCHSIA:"fuchsia",GRAY:"gray",GREEN:"green",LIME:"lime",MAROON:"maroon",NAVY:"navy",OLIVE:"olive",PURPLE:"purple",RED:"red",SILVER:"silver",TEAL:"teal",WHITE:"white",YELLOW:"yellow"},ve={AQUA:"Aquamarin",BLACK:"Schwarz",BLUE:"Blau",FUCHSIA:"Purpurrot",GRAY:"Grau",GREEN:"Gr\xFCn",LIME:"Hellgr\xFCn",MAROON:"Kastanienbraun",NAVY:"Marineblau",OLIVE:"Olivgr\xFCn",PURPLE:"Purpur",RED:"Rot",SILVER:"Silber",TEAL:"Blaugr\xFCn",WHITE:"Weiss",YELLOW:"Gelb"},G=r.LOCALE==="de"?ve:Le;var Ut=class extends T{constructor(t,e,i,s,n,a){super("GRAPH_LAYOUT"),this.displayStyle=a||"block",this.canvas=e,n.addCanvas(e),this.view=new w("X_Y_GRAPH_VIEW",new S(0,0,1,1)),this.view.setHorizAlign("FULL"),this.view.setVerticalAlign("FULL"),e.addView(this.view),this.displayList=this.view.getDisplayList(),this.line=new E("X_Y_GRAPH_LINE",t),this.line.setXVariable(0),this.line.setYVariable(1),this.line.setColor("lime"),this.view.addMemo(this.line),this.axes=L.makeAxes(this.view);let o=m=>{m.nameEquals(E.en.X_VARIABLE)&&this.axes.setHorizName(this.line.getXVarName()),m.nameEquals(E.en.Y_VARIABLE)&&this.axes.setVerticalName(this.line.getYVarName())};new Y(this.line,o,"update axes names"),o(new p(this.line,E.i18n.X_VARIABLE)),this.autoScale=new k("X_Y_AUTO_SCALE",this.line,this.view),this.autoScale.extraMargin=.05,this.displayGraph=new Lt(this.line),this.displayGraph.setScreenRect(this.view.getScreenRect()),this.displayGraph.setUseBuffer(!0),this.displayList.prepend(this.displayGraph),new Y(this.view,m=>{m.nameEquals(w.SCREEN_RECT_CHANGED)&&this.displayGraph.setScreenRect(this.view.getScreenRect())},"resize DisplayGraph"),this.controls_=[],this.div_controls=i;let l=this.line.getParameterNumber(E.en.Y_VARIABLE);this.addControl(new H(l,"Y:")),l=this.line.getParameterNumber(E.en.X_VARIABLE),this.addControl(new H(l,"X:")),this.addControl(new P(E.i18n.CLEAR_GRAPH,()=>this.line.reset()));let _=this.line.getParameterString(E.en.GRAPH_COLOR);this.addControl(new H(_,void 0,ue(),fe())),l=this.line.getParameterNumber(E.en.LINE_WIDTH),this.addControl(new tt(l)),_=this.line.getParameterString(E.en.DRAWING_MODE),this.addControl(new H(_)),this.graphCtrl=new at(e,null,{alt:!1,control:!1,meta:!1,shift:!1});let c=L.makePanZoomControls(this.view,!0,()=>{this.autoScale.setActive(!0)});s.appendChild(c);let g=L.makeShowPanZoomParam(c,this);this.addControl(new j(g));let d=this.line.getVarsList().timeIndex();n.addMemo(new lt(()=>{if(this.line.getXVariable()==d){let m=n.getClock().getTime(),f=this.autoScale.getTimeWindow();this.displayGraph.setUseBuffer(m<f)}else this.displayGraph.setUseBuffer(!0)},"graph: use off-screen buffer when not time-scrolling"))}toString(){return this.toStringShort().slice(0,-1)+", canvas: "+this.canvas.toStringShort()+", view: "+this.view.toStringShort()+", line: "+this.line.toStringShort()+", axes: "+this.axes.toStringShort()+", autoScale: "+this.autoScale.toStringShort()+", displayGraph: "+this.displayGraph.toStringShort()+", graphCtrl: "+this.graphCtrl.toStringShort()+super.toString()}getClassName(){return"StandardGraph1"}getSubjects(){return[this,this.line,this.view,this.autoScale]}addControl(t){let e=t.getElement();return e.style.display=this.displayStyle,this.div_controls.appendChild(e),this.controls_.push(t),t}};r.defineGlobal("sims$common$StandardGraph1",Ut);var V=class h extends T{constructor(t,e){super(e),this.simViews_=[],this.focusView_=null,this.alpha_=1,this.background_="",this.changed_=!0,this.counter_=0,this.debug_=!1,this.htmlCanvas_=t,this.memoList_=new rt,t.contentEditable="false",document.body.addEventListener("touchstart",function(i){i.target==t&&i.preventDefault()},{passive:!1}),document.body.addEventListener("touchend",function(i){i.target==t&&i.preventDefault()},{passive:!1}),document.body.addEventListener("touchmove",function(i){i.target==t&&i.preventDefault()},{passive:!1}),this.addParameter(new y(this,h.en.WIDTH,h.i18n.WIDTH,()=>this.getWidth(),i=>this.setWidth(i))),this.addParameter(new y(this,h.en.HEIGHT,h.i18n.HEIGHT,()=>this.getHeight(),i=>this.setHeight(i))),this.addParameter(new y(this,h.en.ALPHA,h.i18n.ALPHA,()=>this.getAlpha(),i=>this.setAlpha(i))),this.addParameter(new I(this,h.en.BACKGROUND,h.i18n.BACKGROUND,()=>this.getBackground(),i=>this.setBackground(i)))}toString(){return this.toStringShort().slice(0,-1)+", width: "+this.htmlCanvas_.width+", height: "+this.htmlCanvas_.height+', background_: "'+this.background_+'", alpha_: '+r.NF5(this.alpha_)+", focusView_: "+(this.focusView_==null?"null":this.focusView_.toStringShort())+", simViews_: ["+this.simViews_.map(t=>t.toStringShort())+"], memoList_: "+this.memoList_+super.toString()}getClassName(){return"LabCanvas"}addMemo(t){this.memoList_.addMemo(t)}addView(t){if(r.assert(r.isObject(t)),this.getWidth()>0&&this.getHeight()>0){let e=new F(0,0,this.getWidth(),this.getHeight());t.setScreenRect(e)}this.simViews_.push(t),this.addMemo(t),this.changed_=!0,this.broadcast(new p(this,h.VIEW_ADDED,t)),this.broadcast(new p(this,h.VIEW_LIST_MODIFIED)),this.focusView_==null&&this.setFocusView(t)}focus(){this.htmlCanvas_.focus()}getAlpha(){return this.alpha_}getBackground(){return this.background_}getCanvas(){return this.htmlCanvas_}getChanged(){let t=!1;for(let e=0,i=this.simViews_.length;e<i;e++){let s=this.simViews_[e].getChanged();t=t||s}return t||this.changed_?(this.changed_=!1,!0):!1}getContext(){let t=this.htmlCanvas_.getContext("2d");if(t===null)throw"unable to get CanvasRenderingContext2D";return t}getFocusView(){return this.focusView_}getHeight(){return this.htmlCanvas_.height}getMemos(){return this.memoList_.getMemos()}getScreenRect(){return new F(0,0,this.htmlCanvas_.width,this.htmlCanvas_.height)}getViews(){return Array.from(this.simViews_)}getWidth(){return this.htmlCanvas_.width}memorize(){this.memoList_.memorize()}notifySizeChanged(){let t=this.getScreenRect();this.simViews_.forEach(e=>e.setScreenRect(t)),this.changed_=!0,this.broadcast(new p(this,h.SIZE_CHANGED))}paint(){if(this.htmlCanvas_.offsetParent!=null){this.counter_>0&&this.counter_--;let t=this.getChanged();if(t||this.counter_>0){let e=this.htmlCanvas_.getContext("2d");if(e===null)throw"unable to get html context";e.save();try{this.background_!=""?(e.globalAlpha=this.alpha_,e.fillStyle=this.background_,e.fillRect(0,0,this.htmlCanvas_.width,this.htmlCanvas_.height),e.globalAlpha=1,this.alpha_==1?this.counter_=0:t&&(this.counter_=Math.floor(10/this.alpha_))):e.clearRect(0,0,this.htmlCanvas_.width,this.htmlCanvas_.height),this.simViews_.forEach(i=>i.paint(e))}finally{e.restore()}}}}removeMemo(t){this.memoList_.removeMemo(t)}removeView(t){if(!(t instanceof w))throw"not a SimView "+t;r.remove(this.simViews_,t),this.removeMemo(t),this.focusView_==t&&this.setFocusView(this.simViews_.length===0?null:this.simViews_[0]),this.changed_=!0,this.broadcast(new p(this,h.VIEW_REMOVED,t)),this.broadcast(new p(this,h.VIEW_LIST_MODIFIED))}setAlpha(t){if(r.veryDifferent(this.alpha_,t)){if(t<=0||t>1)throw"alpha must be between 0 and 1";this.alpha_=t,r.veryDifferent(t,1)&&this.background_==""&&this.setBackground("white"),this.changed_=!0,this.broadcastParameter(h.en.ALPHA)}}setBackground(t){this.background_!=t&&(this.background_=t,this.changed_=!0,this.broadcastParameter(h.en.BACKGROUND))}setFocusView(t){if(t!=null&&!this.simViews_.includes(t))throw"cannot set focus to unknown view "+t;this.focusView_!=t&&(this.focusView_!=null&&this.focusView_.loseFocus(),this.focusView_=t,t?.gainFocus(),this.changed_=!0,this.broadcast(new p(this,h.FOCUS_VIEW_CHANGED,t)))}setHeight(t){r.veryDifferent(t,this.htmlCanvas_.height)&&(this.htmlCanvas_.height=t),this.notifySizeChanged(),this.broadcastParameter(h.en.HEIGHT)}setScreenRect(t){if(!(t instanceof F))throw"not a ScreenRect: "+t;if(t.getTop()!=0||t.getLeft()!=0)throw"top left must be (0,0), was: "+t;this.changed_=!0,this.setSize(t.getWidth(),t.getHeight())}setSize(t,e){if(typeof t!="number"||t<=0||typeof e!="number"||e<=0)throw"bad size "+t+", "+e;this.htmlCanvas_.width=t,this.htmlCanvas_.height=e,this.notifySizeChanged(),this.broadcastParameter(h.en.WIDTH),this.broadcastParameter(h.en.HEIGHT)}setWidth(t){r.veryDifferent(t,this.htmlCanvas_.width)&&(this.htmlCanvas_.width=t),this.notifySizeChanged(),this.broadcastParameter(h.en.WIDTH)}};V.FOCUS_VIEW_CHANGED="FOCUS_VIEW_CHANGED";V.SIZE_CHANGED="SIZE_CHANGED";V.VIEW_LIST_MODIFIED="VIEW_LIST_MODIFIED";V.VIEW_ADDED="VIEW_ADDED";V.VIEW_REMOVED="VIEW_REMOVED";V.en={WIDTH:"width",HEIGHT:"height",ALPHA:"alpha",BACKGROUND:"background"};V.de_strings={WIDTH:"Breite",HEIGHT:"H\xF6he",ALPHA:"alpha",BACKGROUND:"Hintergrund"};V.i18n=r.LOCALE==="de"?V.de_strings:V.en;r.defineGlobal("lab$view$LabCanvas",V);var et=class h extends T{constructor(t,e=800,i=800,s=!0){super("TAB_LAYOUT"),this.limitSize_=!0,this.simWidth_=1,this.graphWidth_=1,this.timeGraphWidth_=1,this.debug_layout=!1,this.controls_=[],this.show_term_cb=null,r.setImagesDir(t.images_dir),this.tab_list=r.getElementById(t.tab_list),this.layout_=this.getSelectedTab(),this.terminalEnabled_=s,this.layout_==""&&(this.layout_="sim",this.setSelectedTab(this.layout_)),this.tab_list.addEventListener("click",d=>{let m=d.target;if(m===void 0)throw"event target is undefined";m==null||m.tagName!="LI"||m.className.indexOf("selected")>-1||this.setLayoutFromTab(m.className)}),window.addEventListener("resize",()=>this.redoLayout());let n=window.screen.orientation;n!==void 0?n.addEventListener("orientationchange",()=>this.redoLayout()):window.addEventListener("orientationchange",()=>this.redoLayout());let a=r.maybeElementById(t.term_output);this.term_input=r.maybeElementById(t.term_input),this.terminal=new st(this.term_input,a),st.stdRegex(this.terminal),this.div_contain=r.getElementById(t.container),this.debug_layout&&(this.div_contain.style.border="dashed 1px red"),this.div_sim=r.getElementById(t.sim_applet),this.div_sim.style.position="relative";let o=document.createElement("canvas");o.tabIndex=0,this.simCanvas=new V(o,"SIM_CANVAS"),this.simCanvas.setSize(e,i),this.div_sim.appendChild(this.simCanvas.getCanvas()),this.show_sim_cb=r.getElementById(t.show_sim);let l=this.show_sim_cb.parentElement;if(l==null||l.tagName!="LABEL")throw"";this.show_sim_label=l,this.show_sim_cb.addEventListener("click",d=>{this.showSim(this.show_sim_cb.checked)}),this.div_graph=r.getElementById(t.div_graph),this.div_graph.style.position="relative";let _=document.createElement("canvas");this.graphCanvas=new V(_,"GRAPH_CANVAS"),e=Math.max(e,i),this.graphCanvas.setSize(e,e),this.div_graph.appendChild(_),this.div_graph_controls=r.getElementById(t.graph_controls),this.debug_layout&&(this.div_graph_controls.style.border="dashed 1px green"),this.div_sim_controls=r.getElementById(t.sim_controls),this.div_sim_controls.style.marginLeft="10px",this.debug_layout&&(this.div_sim_controls.style.border="dashed 1px green"),this.div_term=r.getElementById(t.div_terminal),this.div_term.style.display="none",this.debug_layout&&(this.div_term.style.border="dashed 1px green");let c=r.getElementById(t.label_terminal);this.terminalEnabled_?(c.style.display="inline",this.show_term_cb=r.getElementById(t.show_terminal),this.show_term_cb.addEventListener("click",d=>{this.show_term_cb!==null&&this.showTerminal(this.show_term_cb.checked)})):c.style.display="none",this.div_time_graph=r.getElementById(t.div_time_graph),this.div_time_graph.style.position="relative";let g=document.createElement("canvas");this.timeGraphCanvas=new V(g,"TIME_GRAPH_CANVAS"),this.timeGraphCanvas.setSize(e,e),this.div_time_graph.appendChild(g),this.div_time_graph_controls=r.getElementById(t.time_graph_controls),this.debug_layout&&(this.div_time_graph_controls.style.border="dashed 1px green"),this.redoLayout(),this.addParameter(new y(this,h.en.SIM_WIDTH,h.i18n.SIM_WIDTH,()=>this.getSimWidth(),d=>this.setSimWidth(d))),this.addParameter(new y(this,h.en.GRAPH_WIDTH,h.i18n.GRAPH_WIDTH,()=>this.getGraphWidth(),d=>this.setGraphWidth(d))),this.addParameter(new y(this,h.en.TIME_GRAPH_WIDTH,h.i18n.TIME_GRAPH_WIDTH,()=>this.getTimeGraphWidth(),d=>this.setTimeGraphWidth(d))),this.addParameter(new I(this,h.en.LAYOUT,h.i18n.LAYOUT,()=>this.getLayout(),d=>this.setLayout(d),h.getLayoutValues(),h.getLayoutValues())),this.terminalEnabled_&&this.addParameter(new N(this,h.en.SHOW_TERMINAL,h.i18n.SHOW_TERMINAL,()=>this.show_term_cb!=null?this.show_term_cb.checked:!1,d=>this.showTerminal(d)))}toString(){return this.toStringShort().slice(0,-1)+', layout_: "'+this.layout_+'", simWidth_: '+r.NF(this.simWidth_)+", graphWidth_: "+r.NF(this.graphWidth_)+", timeGraphWidth_: "+r.NF(this.timeGraphWidth_)+", simCanvas: "+this.simCanvas.toStringShort()+", graphCanvas: "+this.graphCanvas.toStringShort()+", timeGraphCanvas: "+this.timeGraphCanvas.toStringShort()+", terminal: "+this.terminal+", controls_: ["+this.controls_.map(t=>t.toStringShort())+"]"+super.toString()}getClassName(){return"TabLayout"}static getLayoutValues(){return["sim","graph","sim+graph","time_graph","sim+time_graph","multi_graph","sim+multi_graph"]}addControl(t,e=!0){if(e){let i=t.getElement();i.style.display="block",this.div_sim_controls.appendChild(i)}return this.controls_.push(t),t}alignCanvasControls(t,e,i){t.style.display="block",e.style.display="inline-block",e.style.columnCount="1",e.style.width="auto";let s=e.getBoundingClientRect().width;s=s>150?s:300;let n=t.offsetWidth||t.getBoundingClientRect().width;i!=null&&(i.style.display="block",n+=i.offsetWidth||i.getBoundingClientRect().width);let a=this.div_contain.offsetWidth||this.div_contain.getBoundingClientRect().width;a-n-2<s&&a>2*s&&(e.style.width="100%",e.style.columnCount="2")}getGraphCanvas(){return this.graphCanvas}getGraphControls(){return this.div_graph_controls}getGraphDiv(){return this.div_graph}getGraphWidth(){return this.graphWidth_}getLayout(){return this.layout_}getSelectedTab(){let t;return this.tab_list.childNodes.forEach(i=>{if(i.nodeType==Node.ELEMENT_NODE){let s=i;s.tagName=="LI"&&s.className.match(/.*selected/)!=null&&(t=s)}}),t===void 0?"":t.className.replace(/[ ]*selected/,"")}getSimCanvas(){return this.simCanvas}getSimControls(){return this.div_sim_controls}getSimDiv(){return this.div_sim}getSimWidth(){return this.simWidth_}getSubjects(){return[this,this.simCanvas,this.graphCanvas,this.timeGraphCanvas]}getTerminal(){return this.terminal}getTimeGraphCanvas(){return this.timeGraphCanvas}getTimeGraphControls(){return this.div_time_graph_controls}getTimeGraphDiv(){return this.div_time_graph}getTimeGraphWidth(){return this.timeGraphWidth_}redoLayout(){let t=r.getViewportSize()[0];switch(this.div_sim.style.float="left",this.div_graph.style.float="left",this.div_time_graph.style.float="left",this.layout_){case"":case"sim":this.div_graph.style.display="none",this.div_graph_controls.style.display="none",this.div_time_graph.style.display="none",this.div_time_graph_controls.style.display="none",this.setDisplaySize(.95*this.simWidth_,this.div_graph),this.alignCanvasControls(this.div_sim,this.div_sim_controls),this.show_sim_label.style.display="none";break;case"graph":this.div_sim.style.display="none",this.div_sim_controls.style.display="none",this.div_time_graph.style.display="none",this.div_time_graph_controls.style.display="none",this.setDisplaySize(.95*this.graphWidth_,this.div_graph),this.alignCanvasControls(this.div_graph,this.div_graph_controls),this.show_sim_cb.checked=!1,this.show_sim_label.style.display="inline";break;case"sim+graph":this.div_time_graph.style.display="none",this.div_sim_controls.style.display="none",this.div_time_graph_controls.style.display="none",t>600?this.setDisplaySize(.49,this.div_graph):this.setDisplaySize(.95*this.graphWidth_,this.div_graph),this.alignCanvasControls(this.div_graph,this.div_graph_controls,this.div_sim),this.show_sim_cb.checked=!0,this.show_sim_label.style.display="inline";break;case"time_graph":this.div_graph.style.display="none",this.div_graph_controls.style.display="none",this.div_sim.style.display="none",this.div_sim_controls.style.display="none",this.setDisplaySize(.95*this.timeGraphWidth_,this.div_time_graph),this.alignCanvasControls(this.div_time_graph,this.div_time_graph_controls),this.show_sim_cb.checked=!1,this.show_sim_label.style.display="inline";break;case"sim+time_graph":this.div_graph.style.display="none",this.div_sim_controls.style.display="none",this.div_graph_controls.style.display="none",t>600?this.setDisplaySize(.49,this.div_time_graph):this.setDisplaySize(.95*this.timeGraphWidth_,this.div_time_graph),this.alignCanvasControls(this.div_time_graph,this.div_time_graph_controls,this.div_sim),this.show_sim_cb.checked=!0,this.show_sim_label.style.display="inline";break;case"multi_graph":this.div_graph.style.display="block",this.div_time_graph.style.display="block",this.div_sim.style.display="none",this.div_sim_controls.style.display="none",this.div_graph_controls.style.display="none",this.div_time_graph_controls.style.display="none",this.setDisplaySize(.49,this.div_graph),this.setDisplaySize(.49,this.div_time_graph),this.show_sim_cb.checked=!1,this.show_sim_label.style.display="inline";break;case"sim+multi_graph":this.div_graph.style.display="block",this.div_time_graph.style.display="block",this.div_sim.style.display="block",this.div_sim_controls.style.display="none",this.div_graph_controls.style.display="none",this.div_time_graph_controls.style.display="none",this.setDisplaySize(.49,this.div_graph),this.setDisplaySize(.49,this.div_time_graph),this.show_sim_cb.checked=!0,this.show_sim_label.style.display="inline";break;default:throw'redoLayout: no such layout "'+this.layout_+'"'}}setDisplaySize(t,e){if(this.limitSize_){let n=r.getViewportSize()[1]-80,a=this.div_contain.offsetWidth||this.div_contain.getBoundingClientRect().width,o=this.simCanvas.getScreenRect(),l=o.getWidth(),_=o.getHeight(),c=n/a*(l/_);t=Math.min(t,c)}let i=Math.floor(t*100)+"%";this.div_sim.style.width=i,this.div_sim.style.height="auto",e.style.width=i,e.style.height="auto"}setGraphWidth(t){r.veryDifferent(t,this.graphWidth_)&&(this.graphWidth_=t),this.redoLayout(),this.broadcastParameter(h.en.GRAPH_WIDTH)}setLayout(t){if(t=t.toLowerCase().trim(),this.layout_!=t){this.layout_=t;let e=this.layout_;switch(e){case"sim+graph":e="graph";break;case"sim+time_graph":e="time_graph";break;case"sim+multi_graph":e="multi_graph";break;default:}this.setSelectedTab(e),this.redoLayout()}}setLayoutFromTab(t){if(t=t.toLowerCase().trim(),this.show_sim_cb.checked)switch(t){case"graph":t="sim+graph";break;case"time_graph":t="sim+time_graph";break;case"multi_graph":t="sim+multi_graph";break;default:}this.setLayout(t)}setSelectedTab(t){this.getSelectedTab()!=t&&this.tab_list.childNodes.forEach(e=>{if(e.nodeType!=Node.ELEMENT_NODE)return;let i=e;i.tagName=="LI"&&(i.className.trim()==t?i.className+=" selected":i.className.indexOf("selected")>-1&&(i.className=i.className.replace(/[ ]*selected/,"")))})}setSimWidth(t){r.veryDifferent(t,this.simWidth_)&&(this.simWidth_=t),this.redoLayout(),this.broadcastParameter(h.en.SIM_WIDTH)}setTimeGraphWidth(t){r.veryDifferent(t,this.timeGraphWidth_)&&(this.timeGraphWidth_=t),this.redoLayout(),this.broadcastParameter(h.en.TIME_GRAPH_WIDTH)}showSim(t){switch(this.layout_){case"":case"sim":break;case"graph":t&&this.setLayout("sim+graph");break;case"sim+graph":t||this.setLayout("graph");break;case"time_graph":t&&this.setLayout("sim+time_graph");break;case"sim+time_graph":t||this.setLayout("time_graph");break;case"multi_graph":t&&this.setLayout("sim+multi_graph");break;case"sim+multi_graph":t||this.setLayout("multi_graph");break;default:throw'showSim: no such layout "'+this.layout_+'"'}}showTerminal(t){this.terminalEnabled_&&(this.div_term.style.display=t?"block":"none",this.show_term_cb!=null&&(this.show_term_cb.checked=t),t&&this.term_input&&this.term_input.focus())}};et.en={SIM_WIDTH:"sim-width",GRAPH_WIDTH:"graph-width",TIME_GRAPH_WIDTH:"time-graph-width",LAYOUT:"layout",SHOW_TERMINAL:"show terminal"};et.de_strings={SIM_WIDTH:"Sim Breite",GRAPH_WIDTH:"Graf Breite",TIME_GRAPH_WIDTH:"Zeit Graf Breite",LAYOUT:"layout",SHOW_TERMINAL:"zeige Terminal"};et.i18n=r.LOCALE==="de"?et.de_strings:et.en;r.defineGlobal("sims$common$TabLayout",et);var zt=class extends T{constructor(t,e,i,s,n,a,o,l){super("TIME_GRAPH_LAYOUT"),this.controls_=[],a=a??"lime",o=o??"red",l=l??"blue",this.canvas=e,n.addCanvas(e),this.view=new w("TIME_GRAPH_VIEW",new S(0,0,1,1)),this.view.setHorizAlign("FULL"),this.view.setVerticalAlign("FULL"),e.addView(this.view),this.axes=L.makeAxes(this.view),this.line1=new E("TIME_GRAPH_LINE_1",t),this.line1.setColor(a),this.view.addMemo(this.line1),this.autoScale=new k("TIME_GRAPH_AUTO_SCALE",this.line1,this.view),this.autoScale.extraMargin=.05,this.displayGraph=new Lt(this.line1),this.displayGraph.setScreenRect(this.view.getScreenRect()),this.view.getDisplayList().prepend(this.displayGraph),new Y(this.view,f=>{f.nameEquals(w.SCREEN_RECT_CHANGED)&&this.displayGraph.setScreenRect(this.view.getScreenRect())},"resize DisplayGraph");let _=this.line1.getVarsList().timeIndex();this.line1.setXVariable(_),this.line1.setYVariable(0),this.line2=new E("TIME_GRAPH_LINE_2",t),this.autoScale.addGraphLine(this.line2),this.view.addMemo(this.line2),this.line2.setXVariable(_),this.line2.setYVariable(1),this.line2.setColor(o),this.displayGraph.addGraphLine(this.line2),this.line3=new E("TIME_GRAPH_LINE_3",t),this.autoScale.addGraphLine(this.line3),this.view.addMemo(this.line3),this.line3.setXVariable(_),this.line3.setYVariable(-1),this.line3.setColor(l),this.displayGraph.addGraphLine(this.line3),this.div_controls=i;let c=this.line1.getParameterNumber(E.en.Y_VARIABLE);this.addControl(new H(c,a)),c=this.line2.getParameterNumber(E.en.Y_VARIABLE),this.addControl(new H(c,o)),c=this.line3.getParameterNumber(E.en.Y_VARIABLE),this.addControl(new H(c,l)),c=this.line1.getParameterNumber(E.en.X_VARIABLE),this.addControl(new H(c,"X:")),c=this.autoScale.getParameterNumber(k.en.TIME_WINDOW),this.addControl(new tt(c));let g=new P(E.i18n.CLEAR_GRAPH,()=>{this.line1.reset(),this.line2.reset(),this.line3.reset()});this.addControl(g),this.line1Obs=new Y(this.line1,f=>{this.line2.setXVariable(this.line1.getXVariable()),this.line3.setXVariable(this.line1.getXVariable())},"ensure line2, line3 have same X variable as line1"),this.graphCtrl=new at(e,null,{alt:!1,control:!1,meta:!1,shift:!1}),this.view.setScaleTogether(!1),new Y(n,f=>{if(f.nameEquals(M.RESET)){let b=this.view.getWidth();this.view.setCenterX(b/2),this.autoScale.setActive(!0)}},"TimeGraph1: go to time zero on reset"),n.addMemo(new lt(()=>{if(this.line1.getXVariable()==_){let f=n.getClock().getTime(),b=this.autoScale.getTimeWindow();this.displayGraph.setUseBuffer(f<b)}else this.displayGraph.setUseBuffer(!0)},"time graph: use off-screen buffer when not time-scrolling"));let d=L.makePanZoomControls(this.view,!0,()=>this.autoScale.setActive(!0));s.appendChild(d);let m=L.makeShowPanZoomParam(d,this);this.addControl(new j(m))}toString(){return this.toStringShort().slice(0,-1)+", canvas: "+this.canvas.toStringShort()+", view: "+this.view.toStringShort()+", line1: "+this.line1.toStringShort()+", line2: "+this.line2.toStringShort()+", line3: "+this.line3.toStringShort()+", axes: "+this.axes.toStringShort()+", autoScale: "+this.autoScale.toStringShort()+", displayGraph: "+this.displayGraph.toStringShort()+", graphCtrl: "+this.graphCtrl.toStringShort()+super.toString()}getClassName(){return"TimeGraph1"}addControl(t){let e=t.getElement();return e.style.display="block",this.div_controls.appendChild(e),this.controls_.push(t),t}getSubjects(){return[this,this.line1,this.line2,this.line3,this.view,this.autoScale]}};r.defineGlobal("sims$common$TimeGraph1",zt);var Xt=class{constructor(t,e){this.numberFormat=r.NF5E,this.separator="	",this.variablesList_=t,this.dataPoints_=new ut(e||1e5),this.varIndex_=r.range(this.variablesList_.numVariables())}toString(){return this.toStringShort().slice(0,-1)+", samples: "+this.dataPoints_.getSize()+", separator: "+this.separator+", varIndex_: ["+r.array2string(this.varIndex_,r.NF0)+"]}"}toStringShort(){return"VarsHistory{variablesList: "+this.variablesList_.toStringShort()+"}"}getDataPoints(){return this.dataPoints_}getVariables(){return Array.from(this.varIndex_)}memorize(){let t=this.variablesList_.getValues(!0),e=this.varIndex_.map(s=>t[s]),i=this.dataPoints_.getEndValue();(i==null||!r.equals(e,i))&&this.dataPoints_.store(e)}output(t){t===void 0&&(t=!0);let e="";this.varIndex_.forEach((s,n)=>{e+=n>0?this.separator:"",e+=this.variablesList_.getVariable(s).getName(t)}),e+=`
`;let i=this.dataPoints_.getIterator();for(;i.hasNext();){let s=i.nextValue();e+=r.array2string(s,this.numberFormat,this.separator)+`
`}return e}reset(){this.dataPoints_.reset()}setVariables(t){let e=this.variablesList_.numVariables();t.forEach(i=>{if(i<0||i>e-1)throw"variable index "+i+" not between 0 and "+(e-1)}),this.varIndex_=t,this.dataPoints_.reset()}setNumberFormat(t){this.numberFormat=t}setSeparator(t){this.separator=t}toArray(){let t=this.dataPoints_.getIterator(),e=[];for(;t.hasNext();)e.push(t.nextValue());return e}};r.defineGlobal("lab$graph$VarsHistory",Xt);var $t=class extends ot{constructor(t,e,i,s,n){super(t,e,i),this.getter_=s,this.setter_=n}toString(){return super.toString().slice(0,-1)+", getter_: "+this.getter_+", setter_: "+this.setter_+"}"}getBroadcast(){return!1}getClassName(){return"FunctionVariable"}getValue(){return this.getter_()}setValue(t){this.setter_!==void 0&&this.getValue()!=t&&(this.setter_(t),this.seq_++,this.doesBroadcast_&&this.varsList_.broadcast(this))}setValueSmooth(t){this.setter_!==void 0&&this.setter_(t)}};r.defineGlobal("lab$model$FunctionVariable",$t);var jt=class{constructor(t,e,i){this.zIndex_=0,this.dragable_=!1,this.changed_=!0,this.text_=t??"",this.location_=e??u.ORIGIN,this.proto_=i??null}toString(){return this.toStringShort().slice(0,-1)+", location: "+this.location_+", font: "+this.getFont()+', fillStyle: "'+this.getFillStyle()+'", textAlign: '+this.getTextAlign()+", textBaseline: "+this.getTextBaseline()+", zIndex: "+this.getZIndex()+"}"}toStringShort(){return"DisplayText{text_: "+this.text_+"}"}contains(t){return!1}draw(t,e){t.save(),t.fillStyle=this.getFillStyle(),t.font=this.getFont(),t.textAlign=this.getTextAlign(),t.textBaseline=this.getTextBaseline();let i=e.simToScreenX(this.location_.getX()),s=e.simToScreenY(this.location_.getY());t.fillText(this.text_,i,s),t.restore()}getChanged(){return this.changed_?(this.changed_=!1,!0):!1}getFillStyle(){return this.fillStyle_!==void 0?this.fillStyle_:this.proto_!=null?this.proto_.getFillStyle():"black"}getFont(){return this.font_!==void 0?this.font_:this.proto_!=null?this.proto_.getFont():"12pt sans-serif"}getMassObjects(){return[]}getPosition(){return this.location_}getSimObjects(){return[]}getTextAlign(){return this.textAlign_!==void 0?this.textAlign_:this.proto_!=null?this.proto_.getTextAlign():"left"}getTextBaseline(){return this.textBaseline_!==void 0?this.textBaseline_:this.proto_!=null?this.proto_.getTextBaseline():"alphabetic"}getText(){return this.text_}getZIndex(){return this.zIndex_!==void 0?this.zIndex_:this.proto_!=null?this.proto_.getZIndex():0}isDragable(){return this.dragable_}setDragable(t){this.dragable_=t}setFillStyle(t){return this.fillStyle_=t,this.changed_=!0,this}setFont(t){return this.font_=t,this.changed_=!0,this}setPosition(t){this.location_=u.clone(t),this.changed_=!0}setText(t){this.text_=t,this.changed_=!0}setTextAlign(t){return this.textAlign_=t,this.changed_=!0,this}setTextBaseline(t){return this.textBaseline_=t,this.changed_=!0,this}setZIndex(t){this.zIndex_=t,this.changed_=!0}};r.defineGlobal("lab$view$DisplayText",jt);var ae=class extends T{constructor(t,e,i,s,n,a,o){super(o||"APP"),this.energyGraph=null,this.showEnergyParam=null,this.simRect=e,this.layout=this.makeLayout(t),this.terminal=this.layout.getTerminal();let l=this.layout.getSimCanvas();this.sim=i,this.sim.setTerminal(this.terminal),this.advance=s,this.simList=i.getSimList(),this.varsList=i.getVarsList(),this.simCtrl=new at(l,n),this.simView=new w("SIM_VIEW",this.simRect),l.addView(this.simView),this.displayList=this.simView.getDisplayList(),this.statusView=new w("STATUS_VIEW",new S(-10,-10,10,10)),l.addView(this.statusView),this.axes=L.makeAxes(this.simView,!0),this.simRun=new M(this.advance),this.simRun.addCanvas(l),this.simRun.addErrorObserver(this.simCtrl),this.clock=this.simRun.getClock(),a!=null&&(this.energyGraph=new O(a),this.showEnergyParam=L.makeShowEnergyParam(this.energyGraph,this.statusView,this)),this.displayClock=new B(()=>i.getTime(),()=>this.clock.getRealTime(),2,2),this.displayClock.setPosition(new u(8,4)),this.showClockParam=L.makeShowClockParam(this.displayClock,this.statusView,this);let _=L.makePanZoomControls(this.simView,!0,()=>this.simView.setSimRect(this.simRect));this.layout.getSimDiv().appendChild(_),this.panZoomParam=L.makeShowPanZoomParam(_,this),this.panZoomParam.setValue(!1),this.diffEqSolver=new J(i,a,s),this.graph=new Ut(i.getVarsList(),this.layout.getGraphCanvas(),this.layout.getGraphControls(),this.layout.getGraphDiv(),this.simRun),this.graph.line.setDrawingMode("lines"),this.timeGraph=this.makeTimeGraph(),this.easyScript,this.terminal.setAfterEval(()=>this.sim.modifyObjects())}toString(){return", sim: "+this.sim.toStringShort()+", simList: "+this.simList.toStringShort()+", simCtrl: "+this.simCtrl.toStringShort()+", advance: "+this.advance+", simRect: "+this.simRect+", simView: "+this.simView.toStringShort()+", statusView: "+this.statusView.toStringShort()+", axes: "+this.axes.toStringShort()+", simRun: "+this.simRun.toStringShort()+", clock: "+this.clock.toStringShort()+", energyGraph: "+(this.energyGraph==null?"null":this.energyGraph.toStringShort())+", displayClock: "+this.displayClock.toStringShort()+", graph: "+this.graph.toStringShort()+", timeGraph: "+this.timeGraph.toStringShort()+", layout: "+this.layout.toStringShort()+", easyScript: "+this.easyScript.toStringShort()+", terminal: "+this.terminal+super.toString()}makeLayout(t){let i=Math.round(800*this.simRect.getHeight()/this.simRect.getWidth());return new et(t,800,i,!0)}addControl(t){return this.layout.addControl(t)}addPlaybackControls(){this.addControl(L.makePlaybackControls(this.simRun))}addStandardControls(){this.showEnergyParam!=null&&this.addControl(new j(this.showEnergyParam)),this.addControl(new j(this.showClockParam)),this.addControl(new j(this.panZoomParam));let t=this.simRun.getParameterNumber(M.en.TIME_STEP);this.addControl(new tt(t)),t=this.simRun.getClock().getParameterNumber(A.en.TIME_RATE),this.addControl(new tt(t));let e=this.diffEqSolver.getParameterString(J.en.DIFF_EQ_SOLVER);this.addControl(new H(e));let i=L.makeBackgroundMenu(this.layout.getSimCanvas());this.addControl(i)}defineNames(t){this.simRun.setAppName(t),this.terminal.addToVars(t),this.terminal.addRegex("advance|axes|clock|diffEqSolver|displayClock|energyGraph|graph|layout|sim|simCtrl|simList|simRect|simRun|simView|statusView|timeGraph|easyScript|terminal|varsList|displayList",t+"."),this.terminal.addRegex("simCanvas",t+".layout.")}makeEasyScript(t){let e=[this.varsList];t&&(e=e.concat(t)),this.easyScript=L.makeEasyScript(this.getSubjects(),e,this.simRun,this.terminal)}getSubjects(){return[this,this.sim,this.diffEqSolver,this.simRun,this.clock,this.simView,this.statusView,this.varsList].concat(this.layout.getSubjects(),this.graph.getSubjects(),this.timeGraph.getSubjects())}addURLScriptButton(){this.addControl(L.makeURLScriptButton(this.easyScript,this.simRun))}eval(t,e=!0){return this.terminal.eval(t,e)}static loadClass(){var t=$t.toString;t=Xt.toString,t=lt.toString,t=jt.toString,t=Tt.toString}setup(){this.clock.resume(),this.terminal.parseURL(),this.sim.saveInitialState(),this.sim.modifyObjects(),this.simRun.memorize()}start(){this.simRun.startFiring()}},qt=class extends ae{constructor(t,e,i,s,n,a,o){super(t,e,i,s,n,a,o)}makeTimeGraph(){return new zt(this.sim.getVarsList(),this.layout.getTimeGraphCanvas(),this.layout.getTimeGraphControls(),this.layout.getTimeGraphDiv(),this.simRun)}};r.defineGlobal("sims$common$AbstractApp",qt);var _t=class h extends U{constructor(t,e,i){super(t),this.startPt_=e||u.ORIGIN,this.endPt_=i||u.ORIGIN}toString(){return super.toString().slice(0,-1)+", startPoint: "+this.getStartPoint()+", endPoint: "+this.getEndPoint()+"}"}getClassName(){return"ConcreteLine"}getBoundsWorld(){return S.make(this.getStartPoint(),this.getEndPoint())}getEndPoint(){return this.endPt_}getStartPoint(){return this.startPt_}getVector(){return this.getEndPoint().subtract(this.getStartPoint())}setEndPoint(t){this.endPt_=t,this.setChanged()}setStartPoint(t){this.startPt_=t,this.setChanged()}similar(t,e){return!(t instanceof h)||!t.getStartPoint().nearEqual(this.getStartPoint(),e)?!1:t.getEndPoint().nearEqual(this.getEndPoint(),e)}};var Dt=class{constructor(t,e){this.changed_=!0,this.line_=t??new _t("proto"),this.scale_=1,this.proto_=e??null}toString(){return this.toStringShort().slice(0,-1)+", scale_: "+r.NF(this.scale_)+", thickness: "+r.NF(this.getThickness())+', color: "'+this.getColor()+'", lineDash: ['+this.getLineDash()+"], zIndex: "+this.getZIndex()+", proto: "+(this.proto_!=null?this.proto_.toStringShort():"null")+"}"}toStringShort(){return"DisplayLine{line_: "+this.line_.toStringShort()+"}"}contains(t){return!1}draw(t,e){if(this.getThickness()>0){let s=this.line_.getStartPoint(),n;if(this.scale_==1)n=this.line_.getEndPoint();else{let l=this.line_.getVector();n=s.add(l.multiply(this.scale_))}if(s=e.simToScreen(s),n=e.simToScreen(n),s.distanceTo(n)<1e-6)return;t.save();let o=this.getLineDash();o.length>0&&t.setLineDash&&t.setLineDash(o),t.lineWidth=this.getThickness(),t.strokeStyle=this.getColor(),t.beginPath(),t.moveTo(s.getX(),s.getY()),t.lineTo(n.getX(),n.getY()),t.stroke(),t.restore()}}getColor(){return this.color_!==void 0?this.color_:this.proto_!=null?this.proto_.getColor():"gray"}getChanged(){return this.line_.getChanged()||this.changed_?(this.changed_=!1,!0):!1}getLineDash(){return this.lineDash_!==void 0?this.lineDash_:this.proto_!=null?this.proto_.getLineDash():[]}getMassObjects(){return[]}getPosition(){return this.line_.getStartPoint().add(this.line_.getEndPoint()).multiply(.5)}getScale(){return this.scale_}getSimObjects(){return[this.line_]}getThickness(){return this.thickness_!==void 0?this.thickness_:this.proto_!=null?this.proto_.getThickness():4}getZIndex(){return this.zIndex_!==void 0?this.zIndex_:this.proto_!=null?this.proto_.getZIndex():0}isDragable(){return!1}setColor(t){return this.color_=t,this.changed_=!0,this}setDragable(t){}setLineDash(t){return this.lineDash_=t,this.changed_=!0,this}setPosition(t){}setScale(t){return this.scale_=t,this}setThickness(t){return this.thickness_=t,this.changed_=!0,this}setZIndex(t){this.zIndex_=t,this.changed_=!0}};r.defineGlobal("lab$view$DisplayLine",Dt);var se=class h extends U{constructor(t,e,i,s){super(t),this.angle_=0,this.startAngle_=e,this.radius_=i,this.center_=s}toString(){return super.toString().slice(0,-1)+", startAngle_: "+r.NF(this.startAngle_)+", angle_: "+r.NF(this.angle_)+", radius_: "+r.NF(this.radius_)+", center_: "+this.center_+"}"}getClassName(){return"Arc"}getAngle(){return this.angle_}getBoundsWorld(){return S.makeCentered(this.center_,this.radius_,this.radius_)}getCenter(){return this.center_}getRadius(){return this.radius_}getStartAngle(){return this.startAngle_}setAngle(t){this.angle_=t,this.setChanged()}setCenter(t){this.center_=t,this.setChanged()}setRadius(t){this.radius_=t,this.setChanged()}setStartAngle(t){this.startAngle_=t,this.setChanged()}similar(t,e){return!(t instanceof h)||r.veryDifferent(t.startAngle_,this.startAngle_,e)||r.veryDifferent(t.angle_,this.angle_,e)||r.veryDifferent(t.radius_,this.radius_,e)?!1:t.getCenter().nearEqual(this.center_,e)}};var Pt=class h extends U{constructor(t,e,i,s,n,a,o){super(t),this.contactDistance=0,this.contactTolerance=0,this.body_=e,this.location_=i,this.direction_=n,this.locationCoordType_=s,this.directionCoordType_=a,this.torque_=o===void 0?0:o}toString(){return super.toString().slice(0,-1)+', body: "'+this.body_.getName()+'", location: '+this.location_+", direction: "+this.direction_+", locationCoordType: "+this.locationCoordType_+", directionCoordType: "+this.directionCoordType_+", torque: "+r.NF5E(this.torque_)+"}"}getClassName(){return"Force"}getBody(){return this.body_}getBoundsWorld(){return S.make(this.getStartPoint(),this.getEndPoint())}getEndPoint(){return this.getStartPoint().add(this.getVector())}getStartPoint(){return this.locationCoordType_==0?this.body_.bodyToWorld(this.location_):this.location_}getTorque(){return this.torque_}getVector(){return this.directionCoordType_==0?this.body_.rotateBodyToWorld(this.direction_):this.direction_}similar(t,e){if(!(t instanceof h)||t.getName()!=this.getName())return!1;let i=t;return this.getStartPoint().nearEqual(i.getStartPoint(),e)?this.getVector().nearEqual(i.getVector(),e):!1}};r.defineGlobal("lab$model$Force",Pt);var Mt=class extends U{constructor(t,e,i,s,n,a,o,l){super(t),this.damping_=0,this.body1_=e,this.attach1_=u.clone(i),this.body2_=s,this.attach2_=u.clone(n),this.restLength_=a,this.stiffness_=o??0,this.compressOnly_=l??!1}toString(){return super.toString().slice(0,-1)+', body1_:"'+this.body1_.getName()+'", attach1_: '+this.attach1_+', body2_:"'+this.body2_.getName()+'", attach2_: '+this.attach2_+", restLength_: "+r.NF(this.restLength_)+", stiffness_: "+r.NF(this.stiffness_)+", damping_: "+r.NF(this.damping_)+", compressOnly_: "+this.compressOnly_+"}"}getClassName(){return"Spring"}calculateForces(){let t=this.getStartPoint(),e=this.getEndPoint(),i=e.subtract(t),s=i.length();if(s<u.TINY_POSITIVE)throw"zero spring length";let n=-this.stiffness_*(s-this.restLength_),a=-n*(i.getX()/s),o=-n*(i.getY()/s),l=new u(a,o,0);if(this.damping_!=0&&(!this.compressOnly_||s<this.restLength_-1e-10)){let _=this.body1_.getVelocity(this.attach1_),c=this.body2_.getVelocity(this.attach2_),g=_.subtract(c).multiply(-this.damping_);l=l.add(g)}return[new Pt("spring",this.body1_,t,1,l,1),new Pt("spring",this.body2_,e,1,l.multiply(-1),1)]}disconnect(){}getAttach1(){return this.attach1_}getAttach2(){return this.attach2_}getBodies(){return[this.body1_,this.body2_]}getBody1(){return this.body1_}getBody2(){return this.body2_}getBoundsWorld(){return S.make(this.getStartPoint(),this.getEndPoint())}getDamping(){return this.damping_}getEndPoint(){if(this.attach2_==null||this.body2_==null)throw"";let t=this.body2_.bodyToWorld(this.attach2_);if(this.compressOnly_){let e=this.getStartPoint(),i=e.distanceTo(t),s=this.restLength_;if(i<=s)return t;{let n=t.subtract(e).normalize();return e.add(n.multiply(s))}}else return t}getLength(){return this.getEndPoint().distanceTo(this.getStartPoint())}getPotentialEnergy(){let t=this.getStretch();return .5*this.stiffness_*t*t}getRestLength(){return this.restLength_}getStartPoint(){if(this.attach1_==null||this.body1_==null)throw"";return this.body1_.bodyToWorld(this.attach1_)}getStiffness(){return this.stiffness_}getStretch(){return this.getLength()-this.restLength_}getVector(){return this.getEndPoint().subtract(this.getStartPoint())}setDamping(t){return this.damping_=t,this.setChanged(),this}setRestLength(t){this.restLength_=t,this.setChanged()}setStiffness(t){this.stiffness_=t,this.setChanged()}};Mt.LOADME="loadme";r.defineGlobal("lab$model$Spring",Mt);var vt=class h extends T{constructor(){super("SIM_LIST"),this.elements_=[],this.tolerance_=.1}toString(){return this.toStringShort().slice(0,-1)+", tolerance_: "+r.NF(this.tolerance_)+", elements_: ["+this.elements_.map((t,e)=>e+": "+t.toStringShort())+"]"+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", length: "+this.elements_.length+"}"}getClassName(){return"SimList"}add(...t){for(let e=0;e<t.length;e++){let i=t[e];if(!i)throw"cannot add invalid SimObject";let s=i.getExpireTime();if(isFinite(s)){let n;for(;n=this.getSimilar(i);)this.remove(n)}this.elements_.includes(i)||(this.elements_.push(i),this.broadcast(new p(this,h.OBJECT_ADDED,i)))}}addAll(t){for(let e=0,i=t.length;e<i;e++)this.add(t[e])}clear(){this.removeAll(this.toArray())}contains(t){return this.elements_.includes(t)}get(t){if(typeof t=="number"){if(t>=0&&t<this.elements_.length)return this.elements_[t]}else if(typeof t=="string"){t=r.toName(t);let e=this.elements_.find(i=>i.getName()==t);if(e!==void 0)return e}throw"SimList did not find "+t}getArc(t){let e=this.get(t);if(e instanceof se)return e;throw"no Arc named "+t}getConcreteLine(t){let e=this.get(t);if(e instanceof _t)return e;throw"no ConcreteLine named "+t}getMassObject(t){let e=this.get(t);if(e instanceof x)return e;throw"no MassObject named "+t}getPointMass(t){let e=this.get(t);if(e instanceof x)return e;throw"no PointMass named "+t}getSimilar(t,e){let i=e===void 0?this.tolerance_:e,s=this.elements_.find(n=>n.similar(t,i));return s!==void 0?s:null}getSpring(t){let e=this.get(t);if(e instanceof Mt)return e;throw"no Spring named "+t}getTolerance(){return this.tolerance_}indexOf(t){return this.elements_.indexOf(t)}length(){return this.elements_.length}remove(t){r.remove(this.elements_,t)&&this.broadcast(new p(this,h.OBJECT_REMOVED,t))}removeAll(t){for(let e=0,i=t.length;e<i;e++)this.remove(t[e])}removeTemporary(t){for(let e=this.elements_.length-1;e>=0;e--){let i=this.elements_[e];i.getExpireTime()<t&&(this.elements_.splice(e,1),this.broadcast(new p(this,h.OBJECT_REMOVED,i)))}}setTolerance(t){this.tolerance_=t}toArray(){return Array.from(this.elements_)}};vt.OBJECT_ADDED="OBJECT_ADDED";vt.OBJECT_MODIFIED="OBJECT_MODIFIED";vt.OBJECT_REMOVED="OBJECT_REMOVED";var Ct=class h extends T{constructor(t,e,i){super(t||"SIM"),this.initialState_=null,this.recentState_=null,this.terminal_=null,this.simList_=e||new vt,this.varsList_=i||new R([],[],this.getName()+"_VARS")}toString(){return", varsList_: "+this.varsList_.toStringShort()+", simList_: "+this.simList_.toStringShort()+super.toString()}getTime(){return this.varsList_.getTime()}getVarsList(){return this.varsList_}reset(){this.initialState_!=null&&this.varsList_.setValues(this.initialState_),this.simList_.removeTemporary(1/0),this.modifyObjects(),this.broadcast(new p(this,h.RESET))}restoreState(){this.recentState_!=null&&this.varsList_.setValues(this.recentState_,!0)}saveInitialState(){this.initialState_=this.varsList_.getValues(),this.broadcast(new p(this,h.INITIAL_STATE_SAVED))}saveState(){this.recentState_=this.varsList_.getValues()}getSimList(){return this.simList_}setVarsList(t){this.varsList_=t}setTerminal(t){this.terminal_=t}};Ct.RESET="RESET";Ct.INITIAL_STATE_SAVED="INITIAL_STATE_SAVED";r.defineGlobal("lab$model$AbstractODESim",Ct);var D=class{constructor(t,e,i,s,n){this.potential_=t||0,this.translational_=e||0,this.rotational_=i===void 0?NaN:i,this.workDone_=s===void 0?NaN:s,this.initialEnergy_=n===void 0?NaN:n}toString(){return"EnergyInfo{potential_: "+r.NF(this.potential_)+", translational_: "+r.NF(this.translational_)+", rotational_: "+r.NF(this.rotational_)+", workDone_: "+r.NF(this.workDone_)+", initialEnergy_: "+r.NF(this.initialEnergy_)+"}"}getInitialEnergy(){return this.initialEnergy_}getPotential(){return this.potential_}getRotational(){return this.rotational_}getTotalEnergy(){let t=this.potential_+this.translational_;return isNaN(this.rotational_)||(t+=this.rotational_),t}getTranslational(){return this.translational_}getWorkDone(){return this.workDone_}setInitialEnergy(t){this.initialEnergy_=t}setPotential(t){this.potential_=t}setRotational(t){this.rotational_=t}setTranslational(t){this.translational_=t}setWorkDone(t){this.workDone_=t}};D.en={POTENTIAL_ENERGY:"potential energy",TRANSLATIONAL_ENERGY:"translational energy",KINETIC_ENERGY:"kinetic energy",ROTATIONAL_ENERGY:"rotational energy",TOTAL:"total",TOTAL_ENERGY:"total energy",PE_OFFSET:"potential energy offset"};D.de_strings={POTENTIAL_ENERGY:"potenzielle Energie",TRANSLATIONAL_ENERGY:"Translationsenergie",KINETIC_ENERGY:"kinetische Energie",ROTATIONAL_ENERGY:"Rotationsenergie",TOTAL:"gesamt",TOTAL_ENERGY:"gesamte Energie",PE_OFFSET:"Potenzielle Energie Ausgleich"};D.i18n=r.LOCALE==="de"?D.de_strings:D.en;r.defineGlobal("lab$model$EnergyInfo",D);var ft=0,pt=1,St=2,Et=3,Nt=4,It=5,xt=6,bt=7,yt=8,Ce=9,W=class h extends Ct{constructor(t){super(t),this.rod1Length_=1,this.rod2Length_=1,this.rod1_=new _t("rod1"),this.rod2_=new _t("rod2"),this.bob1_=x.makeCircle(.2,"bob1"),this.bob2_=x.makeCircle(.2,"bob2"),this.gravity_=9.8,this.potentialOffset_=0,this.isDragging_=!1;let e=[h.en.ANGLE_1,h.en.ANGLE_1_VELOCITY,h.en.ANGLE_2,h.en.ANGLE_2_VELOCITY,h.en.ACCELERATION_1,h.en.ACCELERATION_2,D.en.KINETIC_ENERGY,D.en.POTENTIAL_ENERGY,D.en.TOTAL_ENERGY,R.en.TIME],i=[h.i18n.ANGLE_1,h.i18n.ANGLE_1_VELOCITY,h.i18n.ANGLE_2,h.i18n.ANGLE_2_VELOCITY,h.i18n.ACCELERATION_1,h.i18n.ACCELERATION_2,D.i18n.KINETIC_ENERGY,D.i18n.POTENTIAL_ENERGY,D.i18n.TOTAL_ENERGY,R.i18n.TIME];this.setVarsList(new R(e,i,this.getName()+"_VARS")),this.getVarsList().setComputed(Nt,It,xt,bt,yt),this.bob1_.setMass(2),this.bob2_.setMass(2),this.getSimList().add(this.rod1_,this.rod2_,this.bob1_,this.bob2_),this.restState(),this.getVarsList().setValue(0,Math.PI/8),this.saveInitialState(),this.addParameter(new y(this,h.en.ROD_1_LENGTH,h.i18n.ROD_1_LENGTH,()=>this.getRod1Length(),n=>this.setRod1Length(n))),this.addParameter(new y(this,h.en.ROD_2_LENGTH,h.i18n.ROD_2_LENGTH,()=>this.getRod2Length(),n=>this.setRod2Length(n))),this.addParameter(new y(this,h.en.MASS_1,h.i18n.MASS_1,()=>this.getMass1(),n=>this.setMass1(n))),this.addParameter(new y(this,h.en.MASS_2,h.i18n.MASS_2,()=>this.getMass2(),n=>this.setMass2(n))),this.addParameter(new y(this,h.en.GRAVITY,h.i18n.GRAVITY,()=>this.getGravity(),n=>this.setGravity(n)));let s=new y(this,D.en.PE_OFFSET,D.i18n.PE_OFFSET,()=>this.getPEOffset(),n=>this.setPEOffset(n));s.setLowerLimit(Number.NEGATIVE_INFINITY),s.setSignifDigits(5),this.addParameter(s)}toString(){return this.toStringShort().slice(0,-1)+", rod1Length_: "+r.NF(this.rod1Length_)+", rod2Length_: "+r.NF(this.rod2Length_)+", rod1_: "+this.rod1_+", rod2_: "+this.rod2_+", bob1_: "+this.bob1_+", bob2_: "+this.bob2_+", gravity_: "+r.NF(this.gravity_)+", potentialOffset_: "+r.NF(this.potentialOffset_)+super.toString()}getClassName(){return"DoublePendulumSim"}restState(){let t=this.getVarsList(),e=t.getValues();e[ft]=0,e[pt]=0,e[St]=0,e[Et]=0,t.setValues(e),this.moveObjects(e)}getEnergyInfo(){let t=this.rod1Length_,e=this.rod2Length_,i=this.bob1_.getKineticEnergy()+this.bob2_.getKineticEnergy(),s=this.bob1_.getPosition().getY(),n=this.bob2_.getPosition().getY(),a=this.gravity_*this.bob1_.getMass()*(s- -t)+this.gravity_*this.bob2_.getMass()*(n-(-t-e));return new D(a+this.potentialOffset_,i)}getPEOffset(){return this.potentialOffset_}setPEOffset(t){this.potentialOffset_=t,this.getVarsList().incrSequence(bt,yt),this.broadcastParameter(D.en.PE_OFFSET)}modifyObjects(){let t=this.getVarsList(),e=t.getValues(),i=r.limitAngle(e[ft]);i!=e[ft]&&(this.getVarsList().setValue(0,i,!1),e[ft]=i);let s=r.limitAngle(e[St]);s!=e[St]&&(this.getVarsList().setValue(2,s,!1),e[St]=s),this.moveObjects(e);let n=new Array(e.length);this.evaluate(e,n,0),e[Nt]=n[pt],e[It]=n[Et];let a=this.getEnergyInfo();e[xt]=a.getTranslational(),e[bt]=a.getPotential(),e[yt]=a.getTotalEnergy(),t.setValues(e,!0)}moveObjects(t){let e=t[ft],i=Math.sin(e),s=Math.cos(e),n=t[St],a=Math.sin(n),o=Math.cos(n),l=this.rod1Length_,_=this.rod2Length_,c=l*i,g=-l*s,d=c+_*a,m=g-_*o;this.bob1_.setPosition(new u(c,g)),this.bob2_.setPosition(new u(d,m));let f=t[pt]*l*s,b=t[pt]*l*i,C=f+t[Et]*_*o,v=b+t[Et]*_*a;this.bob1_.setVelocity(new u(f,b)),this.bob2_.setVelocity(new u(C,v)),this.rod1_.setStartPoint(u.ORIGIN),this.rod1_.setEndPoint(this.bob1_.getPosition()),this.rod2_.setStartPoint(this.bob1_.getPosition()),this.rod2_.setEndPoint(this.bob2_.getPosition())}startDrag(t,e,i,s,n){return t==this.bob1_||t==this.bob2_?(this.isDragging_=!0,!0):!1}mouseDrag(t,e,i){let s=this.getVarsList(),n=s.getValues(),a=e.subtract(i);t==this.bob1_?(n[ft]=Math.atan2(a.getX(),-a.getY()),n[pt]=0,n[Et]=0):t==this.bob2_&&(n[St]=Math.atan2(a.getX()-this.bob1_.getPosition().getX(),-(a.getY()-this.bob1_.getPosition().getY())),n[pt]=0,n[Et]=0),s.setValues(n),this.moveObjects(n)}finishDrag(t,e,i){this.isDragging_=!1}handleKeyEvent(t,e,i){}evaluate(t,e,i){if(r.zeroArray(e),e[Ce]=1,!this.isDragging_){let s=t[ft],n=t[pt],a=t[St],o=t[Et],l=this.bob2_.getMass(),_=this.bob1_.getMass(),c=this.rod1Length_,g=this.rod2Length_,d=this.gravity_;e[ft]=n;let m=-d*(2*_+l)*Math.sin(s);m=m-d*l*Math.sin(s-2*a),m=m-2*l*o*o*g*Math.sin(s-a),m=m-l*n*n*c*Math.sin(2*(s-a)),m=m/(c*(2*_+l-l*Math.cos(2*(s-a)))),e[pt]=m,e[St]=o,m=(_+l)*n*n*c,m=m+d*(_+l)*Math.cos(s),m=m+l*o*o*g*Math.cos(s-a),m=m*2*Math.sin(s-a),m=m/(g*(2*_+l-l*Math.cos(2*(s-a)))),e[Et]=m}return null}getMass1(){return this.bob1_.getMass()}setMass1(t){this.bob1_.setMass(t),this.getVarsList().incrSequence(Nt,It,xt,bt,yt),this.broadcastParameter(h.en.MASS_1)}getMass2(){return this.bob2_.getMass()}setMass2(t){this.bob2_.setMass(t),this.getVarsList().incrSequence(Nt,It,xt,bt,yt),this.broadcastParameter(h.en.MASS_2)}getGravity(){return this.gravity_}setGravity(t){this.gravity_=t,this.getVarsList().incrSequence(Nt,It,bt,yt),this.broadcastParameter(h.en.GRAVITY)}getRod1Length(){return this.rod1Length_}setRod1Length(t){this.rod1Length_=t,this.getVarsList().incrSequence(Nt,It,xt,bt,yt),this.broadcastParameter(h.en.ROD_1_LENGTH)}getRod2Length(){return this.rod2Length_}setRod2Length(t){this.rod2Length_=t,this.getVarsList().incrSequence(Nt,It,xt,bt,yt),this.broadcastParameter(h.en.ROD_2_LENGTH)}};W.en={ACCELERATION_1:"acceleration-1",ACCELERATION_2:"acceleration-2",ANGLE_1:"angle-1",ANGLE_1_VELOCITY:"angle-1 velocity",ANGLE_2:"angle-2",ANGLE_2_VELOCITY:"angle-2 velocity",GRAVITY:"gravity",MASS_1:"mass-1",MASS_2:"mass-2",ROD_1_LENGTH:"rod-1 length",ROD_2_LENGTH:"rod-2 length"};W.de_strings={ACCELERATION_1:"Beschleunigung-1",ACCELERATION_2:"Beschleunigung-2",ANGLE_1:"Winkel-1",ANGLE_1_VELOCITY:"Winkel-1 Geschwindigkeit",ANGLE_2:"Winkel-2",ANGLE_2_VELOCITY:"Winkel-2 Geschwindigkeit",GRAVITY:"Gravitation",MASS_1:"Masse-1",MASS_2:"Masse-2",ROD_1_LENGTH:"Stange-1 L\xE4nge",ROD_2_LENGTH:"Stange-2 L\xE4nge"};W.i18n=r.LOCALE==="de"?W.de_strings:W.en;r.defineGlobal("sims$pendulum$DoublePendulumSim",W);var Zt=class{constructor(t,e){this.sim_=t,this.odeSolver_=e||new z(t),this.timeStep_=.025}toString(){return this.toStringShort().slice(0,-1)+", odeSolver_: "+this.odeSolver_.toStringShort()+"}"}toStringShort(){return"SimpleAdvance{sim_: "+this.sim_.toStringShort()+"}"}advance(t,e){this.sim_.getSimList().removeTemporary(this.sim_.getTime());let i=this.odeSolver_.step(t);if(i!=null)throw"error during advance "+i;this.sim_.modifyObjects(),e!==void 0&&e.memorize()}getDiffEqSolver(){return this.odeSolver_}getTime(){return this.sim_.getTime()}getTimeStep(){return this.timeStep_}reset(){this.sim_.reset()}save(){this.sim_.saveInitialState()}setDiffEqSolver(t){this.odeSolver_=t}setTimeStep(t){this.timeStep_=t}};r.defineGlobal("lab$model$SimpleAdvance",Zt);var ct=class h{constructor(t,e,i,s,n){this.textboxValue_="",this.firstClick_=!1,this.parameter_=t,this.min_=e;let a=t.getLowerLimit();if(a>e)throw"lower limit on slider ="+r.NF(e)+" is less than parameter lower limit ="+r.NF(a);if(this.max_=i,e>=i)throw"min >= max";let o=t.getUpperLimit();if(o<i)throw"upper limit on slider ="+r.NF(i)+" is greater than parameter upper limit ="+r.NF(o);if(this.increments_=n||100,this.increments_<2)throw"increments < 2";if(this.multiply_=s??!0,this.multiply_&&e<=0)throw"slider cannot have min <= 0 and also exponential scale";if(this.delta_=h.rangeToDelta(e,i,this.increments_,this.multiply_),this.signifDigits_=t.getSignifDigits(),this.decimalPlaces_=t.getDecimalPlaces(),this.columns_=Math.max(8,1+this.signifDigits_),this.paramValue_=t.getValue(),r.assert(typeof this.paramValue_=="number"),this.slider_=document.createElement("input"),this.slider_.type="range",this.slider_.type=="text")throw"cannot make slider";this.slider_.min="0",this.slider_.max=String(this.increments_),this.slider_.step="1",this.slider_.value=String(this.valueToIncrement(this.paramValue_)),this.sliderValue_=this.incrementToValue(Number(this.slider_.value)),this.textField_=document.createElement("input"),this.textField_.type="text",this.textField_.size=this.columns_,this.label_=document.createElement("div"),this.label_.className="slider",this.label_.appendChild(document.createTextNode(t.getName(!0)+t.getUnits())),this.label_.appendChild(this.slider_),this.label_.appendChild(this.textField_),this.textField_.style.textAlign="right",this.changeSliderFn_=this.changeSlider.bind(this),this.slider_.addEventListener("input",this.changeSliderFn_,!0),this.slider_.addEventListener("change",this.changeSliderFn_,!0),this.clickSliderFn_=this.clickSlider.bind(this),this.slider_.addEventListener("click",this.clickSliderFn_,!0),this.validateTextFn_=this.validateText.bind(this),this.textField_.addEventListener("change",this.validateTextFn_,!0),this.focusTextFn_=this.focusText.bind(this),this.textField_.addEventListener("focus",this.focusTextFn_,!1),this.clickTextFn_=this.clickText.bind(this),this.textField_.addEventListener("click",this.clickTextFn_,!0),this.formatTextField(),this.parameter_.getSubject().addObserver(this)}toString(){return this.toStringShort().slice(0,-1)+", paramValue_: "+r.NF(this.paramValue_)+", sliderValue_: "+r.NF(this.sliderValue_)+", slider_.value: "+this.slider_.value+", textboxValue_: "+this.textboxValue_+", min_: "+r.NF(this.min_)+", max_: "+r.NF(this.max_)+", increments_: "+this.increments_+", delta_: "+r.NF(this.delta_)+", multiply_: "+this.multiply_+", signifDigits_: "+this.signifDigits_+", decimalPlaces_: "+this.decimalPlaces_+", columns_: "+this.columns_+"}"}toStringShort(){return"SliderControl{parameter: "+this.parameter_.toStringShort()+"}"}columnsNeeded(t,e){let i=h.magnitude(t);return 2+this.decimalPlacesNeeded(t,e)+(i>0?i:0)}decimalPlacesNeeded(t,e){if(this.decimalPlaces_>-1)return this.decimalPlaces_;{let i=e-1-h.magnitude(t);return i>16&&(i=16),i>0?i:0}}disconnect(){this.parameter_.getSubject().removeObserver(this),this.slider_.removeEventListener("input",this.changeSliderFn_,!0),this.slider_.removeEventListener("change",this.changeSliderFn_,!0),this.slider_.removeEventListener("click",this.clickSliderFn_,!0),this.textField_.removeEventListener("change",this.validateTextFn_,!0),this.textField_.removeEventListener("focus",this.focusTextFn_,!1),this.textField_.removeEventListener("click",this.clickTextFn_,!0)}clickText(t){this.firstClick_&&(this.textField_.select(),this.firstClick_=!1)}clickSlider(t){this.slider_.focus()}formatTextField(){let t=this.decimalPlacesNeeded(this.paramValue_,this.signifDigits_),e=this.columnsNeeded(this.paramValue_,this.signifDigits_);this.textboxValue_=this.paramValue_.toFixed(t),this.textField_.value=this.textboxValue_,e!=this.columns_&&(this.columns_=e,this.textField_.size=this.columns_)}focusText(t){this.firstClick_=!0}getDecimalPlaces(){return this.decimalPlaces_}getElement(){return this.label_}getParameter(){return this.parameter_}getSignifDigits(){return this.signifDigits_}getValue(){return this.paramValue_}incrementToValue(t){return this.multiply_?this.min_*Math.pow(this.delta_,t):this.min_+t*this.delta_}static magnitude(t){return Math.abs(t)<1e-15?0:Math.floor(Math.LOG10E*Math.log(Math.abs(t)))}observe(t){t==this.parameter_&&this.setValue(this.parameter_.getValue())}static rangeToDelta(t,e,i,s){return s?Math.exp((Math.log(e)-Math.log(t))/i):(e-t)/i}setDecimalPlaces(t){return this.decimalPlaces_!=t&&(this.decimalPlaces_=t>-1?t:-1,this.formatTextField()),this}setEnabled(t){this.textField_.disabled=!t,this.slider_.disabled=!t}setSignifDigits(t){return this.signifDigits_!=t&&(this.signifDigits_=t,this.formatTextField()),this}setValue(t){if(t!=this.paramValue_){if(isNaN(t))throw"not a number: "+t;try{this.paramValue_=t,this.parameter_.setValue(t)}catch(i){alert(i),this.paramValue_=this.parameter_.getValue()}this.formatTextField();let e=this.valueToIncrement(this.paramValue_);this.sliderValue_=this.incrementToValue(e),this.slider_.value=String(e)}}changeSlider(t){let e=this.incrementToValue(Number(this.slider_.value));r.veryDifferent(e,this.sliderValue_)&&this.setValue(e)}validateText(t){let e=this.textField_.value.trim();if(e!=this.textboxValue_){let i=parseFloat(e);isNaN(i)?(alert("not a number: "+e),this.formatTextField()):this.setValue(i)}}valueToIncrement(t){return this.multiply_?Math.floor(.5+(Math.log(t)-Math.log(this.min_))/Math.log(this.delta_)):Math.floor(.5+(t-this.min_)/this.delta_)}};r.defineGlobal("lab$controls$SliderControl",ct);var oe=class extends qt{constructor(t){r.setErrorHandler();let e=new S(-2,-2.2,2,1.5),i=new W,s=new Zt(i);super(t,e,i,s,i,i),this.rod1=new Dt(this.simList.getConcreteLine("rod1")),this.displayList.add(this.rod1),this.rod2=new Dt(this.simList.getConcreteLine("rod2")),this.displayList.add(this.rod2),this.bob1=new nt(this.simList.getPointMass("bob1")),this.bob1.setFillStyle("blue"),this.displayList.add(this.bob1),this.bob2=new nt(this.simList.getPointMass("bob2")),this.bob2.setFillStyle("blue"),this.displayList.add(this.bob2),this.marker1=x.makeCircle(.2,"marker1"),this.marker1.setPosition(new u(-3,1)),this.marker1Shape=new nt(this.marker1),this.marker1Shape.setFillStyle(""),this.marker1Shape.setStrokeStyle("red"),this.marker1Shape.setDragable(!0),this.displayList.add(this.marker1Shape),this.graph.line.setXVariable(0),this.graph.line.setYVariable(2),this.addPlaybackControls();let n;n=i.getParameterNumber(W.en.ROD_1_LENGTH),this.addControl(new ct(n,.1,10.1,!0)),n=i.getParameterNumber(W.en.ROD_2_LENGTH),this.addControl(new ct(n,.1,10.1,!0)),n=i.getParameterNumber(W.en.MASS_1),this.addControl(new ct(n,.2,20.2,!0)),n=i.getParameterNumber(W.en.MASS_2),this.addControl(new ct(n,.2,20.2,!0)),n=i.getParameterNumber(W.en.GRAVITY),this.addControl(new ct(n,0,20,!1)),this.addStandardControls(),this.makeEasyScript(),this.addURLScriptButton()}toString(){return this.toStringShort().slice(0,-1)+", bob1: "+this.bob1.toStringShort()+", bob2: "+this.bob2.toStringShort()+", rod1: "+this.rod2.toStringShort()+", rod2: "+this.rod2.toStringShort()+super.toString()}getClassName(){return"DoublePendulumApp"}defineNames(t){super.defineNames(t),this.terminal.addRegex("rod1|rod2|bob1|bob2",t+"."),this.terminal.addRegex("DoublePendulumSim","sims$pendulum$",!1)}};r.defineGlobal("sims$pendulum$DoublePendulumApp",oe);})();
 

<body>

<a id="logo" href="../index-de.html">
  <img src="../common/myphysicslogo.png" width="162" height="32" alt="my physics lab logo">
</a>

<h1 lang="de">Doppel Pendel</h1>

<div id="header_nav">
<select id="language_menu" onchange="location = this.options[this.selectedIndex].value;">
    <option value="double-pendulum-en.html">Englisch</option>
    <option value="double-pendulum-de.html" selected="">Deutsch</option>
  </select>
<a class="nav_link" href="../pendulum/moveable-pendulum-de.html">vorherig</a>
<a class="nav_link" href="../pendulum/moveable-double-pendulum-de.html">nächste</a>
</div>

<ul id="header_bar" class="horiz_tabs">
  <li class="sim selected">Sim</li>
  <li class="graph ">Graph</li>
  <li class="time_graph">Zeit Graph</li>
  <li class="multi_graph">MehrGraphen</li>
</ul>



<div id="container" class="control_container" lang="de">
  <div id="div_graph" style="position: relative; float: left; display: none; width: 59%; height: auto;">
  <canvas contenteditable="false" width="800" height="800"></canvas><div style="position: absolute; left: 5%; top: 5%; width: 126px; display: none;"><div style="float: right; margin-top: 18px;"><button type="button" class="icon"><img src="../common/plus_gray.png" width="30" height="30"></button><br><button type="button" class="icon"><img src="../common/minus_gray.png" width="30" height="30"></button></div><div style="text-align: center;"><div style="width: 96px;"><button type="button" class="icon"><img src="../common/up_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/backward_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/target_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/forward_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/down_gray.png" width="30" height="30"></button></div></div></div></div>
  <div id="div_time_graph" style="position: relative; float: left; display: none;">
  <canvas contenteditable="false" width="800" height="800"></canvas><div style="position: absolute; left: 5%; top: 5%; width: 126px; display: none;"><div style="float: right; margin-top: 18px;"><button type="button" class="icon"><img src="../common/plus_gray.png" width="30" height="30"></button><br><button type="button" class="icon"><img src="../common/minus_gray.png" width="30" height="30"></button></div><div style="text-align: center;"><div style="width: 96px;"><button type="button" class="icon"><img src="../common/up_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/backward_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/target_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/forward_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/down_gray.png" width="30" height="30"></button></div></div></div></div>
  <div id="sim_applet" style="position: relative; float: left; width: 59%; height: auto; display: block;">
  <canvas tabindex="0" contenteditable="false" width="800" height="740"></canvas><div style="position: absolute; left: 5%; top: 5%; width: 126px; display: none;"><div style="float: right; margin-top: 18px;"><button type="button" class="icon"><img src="../common/plus_gray.png" width="30" height="30"></button><br><button type="button" class="icon"><img src="../common/minus_gray.png" width="30" height="30"></button></div><div style="text-align: center;"><div style="width: 96px;"><button type="button" class="icon"><img src="../common/up_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/backward_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/target_gray.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/forward_gray.png" width="30" height="30"></button></div><div style="width: 96px;"><button type="button" class="icon"><img src="../common/down_gray.png" width="30" height="30"></button></div></div></div></div>
  <div id="sim_controls" class="control_group" style="margin-left: 10px; display: inline-block; column-count: 1; width: auto;">
  <div style="width: max-content; display: block;"><button type="button" class="icon"><img src="../common/restart.png" width="30" height="30"></button><button type="button" class="icon"><img src="../common/forward.png" width="30" height="30" style="display: none;"><img src="../common/pause.png" width="30" height="30" style="display: block;"></button><button type="button" class="icon"><img src="../common/next.png" width="30" height="30"></button></div><div class="slider" style="display: block;">Stange-1 Länge<input type="range" min="0" max="100" step="1"><input type="text" size="4" style="text-align: right;"></div><div class="slider" style="display: block;">Stange-2 Länge<input type="range" min="0" max="100" step="1"><input type="text" size="4" style="text-align: right;"></div><div class="slider" style="display: block;">Masse-1<input type="range" min="0" max="100" step="1"><input type="text" size="4" style="text-align: right;"></div><div class="slider" style="display: block;">Masse-2<input type="range" min="0" max="100" step="1"><input type="text" size="4" style="text-align: right;"></div><div class="slider" style="display: block;">Gravitation<input type="range" min="0" max="100" step="1"><input type="text" size="4" style="text-align: right;"></div><label style="display: block;"><input type="checkbox">Energie anzeigen</label><label style="display: block;"><input type="checkbox">Zeit anzeigen</label><label style="display: block;"><input type="checkbox">pan-zoom</label><label style="display: block;">Zeitschritt<input type="text" size="6" style="text-align: right;"></label><label style="display: block;">Zeitraffer<input type="text" size="4" style="text-align: right;"></label><label style="display: block;">Diff Eq Löser<select><option>Eulers Methode</option><option>Modifiziert Euler</option><option>Runge-Kutta</option><option>Adaptiert-Modifiziert Euler</option><option>Adaptiert-Runge-Kutta</option></select></label><label style="display: block;">Hintergrund<select><option>weiss</option><option>schwarz</option><option>weiss mit Pfade</option><option>schwarz mit Pfade</option><option>weiss mit lange Pfade</option><option>schwarz mit lange Pfade</option></select></label><button type="button" style="display: block;">mitteilen</button></div>
  <div id="graph_controls" class="control_group" style="display: none;">
  <label style="display: block;">Y:<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><label style="display: block;">X:<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><button type="button" style="display: block;">Graph erneuern</button><label style="display: block;">Graph Farbe<select><option>Aquamarin</option><option>Schwarz</option><option>Blau</option><option>Purpurrot</option><option>Grau</option><option>Grün</option><option>Hellgrün</option><option>Kastanienbraun</option><option>Marineblau</option><option>Olivgrün</option><option>Purpur</option><option>Rot</option><option>Silber</option><option>Blaugrün</option><option>Weiss</option><option>Gelb</option></select></label><label style="display: block;">Zeichenbreite<input type="text" size="4" style="text-align: right;"></label><label style="display: block;">Zeichnenart<select><option>Punkte</option><option>Linien</option></select></label><label style="display: block;"><input type="checkbox">pan-zoom</label></div>
  <div id="time_graph_controls" class="control_group" style="display: none;">
  <label style="display: block;">lime<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><label style="display: block;">red<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><label style="display: block;">blue<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><label style="display: block;">X:<select><option>-keine-</option><option>Winkel-1</option><option>Winkel-1 Geschwindigkeit</option><option>Winkel-2</option><option>Winkel-2 Geschwindigkeit</option><option>Beschleunigung-1</option><option>Beschleunigung-2</option><option>kinetische Energie</option><option>potenzielle Energie</option><option>gesamte Energie</option><option>Zeit</option></select></label><label style="display: block;">Zeitfenster<input type="text" size="4" style="text-align: right;"></label><button type="button" style="display: block;">Graph erneuern</button><label style="display: block;"><input type="checkbox">pan-zoom</label></div>
  <p>
  <label id="label_show_sim" style="display: none;">
    <input type="checkbox" id="show_sim" checked="">show sim
  </label>
  <label id="label_terminal" style="display: inline;">
    <input type="checkbox" id="show_terminal">terminal
  </label>
  </p><div id="div_terminal" style="display: none;">
    <textarea id="term_output" cols="80" rows="20" wrap="soft" spellcheck="false"></textarea> <br>
    <label style="display:inline-block">command &gt;
      <input type="text" id="term_input" size="80" spellcheck="false">
    </label>
  </div>
</div>

<p class="introduction">
This is a simulation of a double pendulum. For large motions it is a chaotic system,
but for small motions it is a simple linear system. </p>

<p class="instructions">
You can change parameters in the simulation such as mass, gravity, and length of rods.
You can drag the pendulum with your mouse to change the starting position. </p>

<p>The math behind the simulation is shown below.  Also available:
<a href="https://github.com/myphysicslab/myphysicslab/blob/master/src/sims/pendulum/DoublePendulumApp.ts">source code</a>,
<a href="../develop/docs/classes/sims_pendulum_DoublePendulumApp.DoublePendulumApp.html">documentation</a> and
<a href="../develop/docs/Customizing.html">how to customize</a>.
</p>


<p>For small angles, a pendulum behaves like a
<a href="../explain/classify-diff-eq-de.html#linear">linear</a> system (see
<a href="../pendulum/pendulum-de.html">Simple Pendulum</a>).
When the angles are small in the Double Pendulum, the system behaves like the linear
<a href="../springs/double-spring-de.html">Double Spring</a>.
In the graph, you can see similar
<a href="http://mathworld.wolfram.com/LissajousCurve.html">Lissajous curves</a>
being generated.  This is because the motion is determined by simple sine and cosine
functions.
</p>

<p>For large angles, the pendulum is non-linear and the phase graph becomes much more
complex. You can see this by dragging one of the masses to a larger angle and letting
go.</p>

<p>We regard the pendulum rods as being massless and rigid. We regard the pendulum
masses as being point masses. The derivation of the equations of motion is shown below,
using the direct Newtonian method.</p>

<h2 id="kinematics">Kinematics of the Double Pendulum</h2>

<div class="image" style="width: 110px;">
<img src="dbl_pendulum.gif" width="104" height="176" alt="double pendulum variables">
</div>

<div style="margin-left:115px; max-width: 45em;">
<p>Kinematics means the relations of the parts of the device, without regard to forces.
In kinematics we are only trying to find expressions for the position, velocity, and
acceleration in terms of the variables that specify the state of the device.
</p>

<ul class="vars">
    <li><span class="html-math inline-math">
<i>x</i> =
</span> horizontal position of pendulum mass</li>
    <li><span class="html-math inline-math">
<i>y</i> =
</span> vertical position of pendulum mass</li>
    <li><span class="html-math inline-math">
<i>θ</i> =
</span> angle of pendulum (0 = vertical downwards,
         counter-clockwise is positive)</li>
    <li><span class="html-math inline-math">
<i>L</i> =
</span> length of rod (constant)</li>
</ul>
</div>

<div style="clear: both;">
<p>We place the origin at the pivot point of the upper pendulum. We regard
<span class="html-math inline-math">
<i>y</i>
</span> as increasing upwards. We indicate the upper pendulum by subscript 1,
and the lower by subscript 2. Begin by using simple trigonometry to write expressions
for the positions <span class="html-math inline-math">
<i>x</i><sub>1</sub>, <i>y</i><sub>1</sub>, <i>x</i><sub>2</sub>, <i>y</i><sub>2</sub>
</span> in terms of the angles <span class="html-math inline-math">
<i>θ</i><sub>1</sub>, <i>θ</i><sub>2</sub>
</span>.
</p>

<p class="html-math display-equation">
<i>x</i><sub>1</sub> = <i>L</i><sub>1</sub> sin <i>θ</i><sub>1</sub>
</p>
<p class="html-math display-equation">
<i>y</i><sub>1</sub> = −<i>L</i><sub>1</sub> cos <i>θ</i><sub>1</sub>
</p>
<p class="html-math display-equation">
<i>x</i><sub>2</sub> = <i>x</i><sub>1</sub> + <i>L</i><sub>2</sub> sin <i>θ</i><sub>2</sub>
</p>
<p class="html-math display-equation">
<i>y</i><sub>2</sub> = <i>y</i><sub>1</sub> − <i>L</i><sub>2</sub> cos <i>θ</i><sub>2</sub>
</p>

<p>The velocity is the derivative with respect to time of the position.</p>

<p class="html-math display-equation">
<i>x</i><sub>1</sub>' = <i>θ</i><sub>1</sub>' <i>L</i><sub>1</sub> cos <i>θ</i><sub>1</sub>
</p>
<p class="html-math display-equation">
<i>y</i><sub>1</sub>' = <i>θ</i><sub>1</sub>' <i>L</i><sub>1</sub> sin <i>θ</i><sub>1</sub>
</p>
<p class="html-math display-equation">
<i>x</i><sub>2</sub>' = <i>x</i><sub>1</sub>' + <i>θ</i><sub>2</sub>' <i>L</i><sub>2</sub> cos <i>θ</i><sub>2</sub>
</p>
<p class="html-math display-equation">
<i>y</i><sub>2</sub>' = <i>y</i><sub>1</sub>' + <i>θ</i><sub>2</sub>' <i>L</i><sub>2</sub> sin <i>θ</i><sub>2</sub>
</p>

<p>The acceleration is the second derivative.</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>x</i><sub>1</sub>'' = −<i>θ</i><sub>1</sub>'<sup>2</sup> <i>L</i><sub>1</sub> sin <i>θ</i><sub>1</sub> + <i>θ</i><sub>1</sub>'' <i>L</i><sub>1</sub> cos <i>θ</i><sub>1</sub>

</td><td class="equation-number">(1)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>y</i><sub>1</sub>'' = <i>θ</i><sub>1</sub>'<sup>2</sup> <i>L</i><sub>1</sub> cos <i>θ</i><sub>1</sub> + <i>θ</i><sub>1</sub>'' <i>L</i><sub>1</sub> sin <i>θ</i><sub>1</sub>

</td><td class="equation-number">(2)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>x</i><sub>2</sub>'' = <i>x</i><sub>1</sub>'' − <i>θ</i><sub>2</sub>'<sup>2</sup> <i>L</i><sub>2</sub> sin <i>θ</i><sub>2</sub> + <i>θ</i><sub>2</sub>'' <i>L</i><sub>2</sub> cos <i>θ</i><sub>2</sub>

</td><td class="equation-number">(3)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>y</i><sub>2</sub>'' = <i>y</i><sub>1</sub>'' + <i>θ</i><sub>2</sub>'<sup>2</sup> <i>L</i><sub>2</sub> cos <i>θ</i><sub>2</sub> + <i>θ</i><sub>2</sub>'' <i>L</i><sub>2</sub> sin <i>θ</i><sub>2</sub>

</td><td class="equation-number">(4)</td></tr></tbody></table>
</div>





<h2>Forces in the Double Pendulum</h2>

<div class="image" style="width: 100px;">
<img src="dbl_pendulum_m1.gif" width="96" height="211" alt="forces in upper mass of double pendulum">
<br>
upper mass
<br><br>
<img src="dbl_pendulum_m2.gif" width="81" height="199" alt="forces in lower mass of double pendulum">
<br>
lower mass
</div>

<div style="margin-left:110px; max-width: 45em;">

<p>We treat the two pendulum masses as point particles. Begin by drawing the free body
diagram for the upper mass and writing an expression for the net force acting on it.
Define these variables: </p>

<ul class="vars">
    <li><span class="html-math inline-math">
<i>T</i> =
</span> tension in the rod</li>
    <li><span class="html-math inline-math">
<i>m</i> =
</span> mass of pendulum</li>
    <li><span class="html-math inline-math">
<i>g</i> =
</span> gravitational constant</li>
</ul>

<p>The forces on the upper pendulum mass are the tension in the upper rod <span class="html-math inline-math">
<i>T</i><sub>1</sub>
</span>,
the tension in the lower rod <span class="html-math inline-math">
<i>T</i><sub>2</sub>
</span>, and gravity <span class="html-math inline-math">
−<i>m</i><sub>1</sub> <i>g</i>
</span>. We write
separate equations for the horizontal and vertical forces, since they can be treated
independently. The net force on the mass is the sum of these. Here we show the net
force and use Newton's law <span class="html-math inline-math">
<i>F</i> = <i>m a</i>
</span>. </p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>1</sub> <i>x</i><sub>1</sub>'' = −<i>T</i><sub>1</sub> sin <i>θ</i><sub>1</sub> + <i>T</i><sub>2</sub> sin <i>θ</i><sub>2</sub>

</td><td class="equation-number">(5)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>1</sub> <i>y</i><sub>1</sub>'' = <i>T</i><sub>1</sub> cos <i>θ</i><sub>1</sub> − <i>T</i><sub>2</sub> cos <i>θ</i><sub>2</sub> −
<span class="nobr"><i>m</i><sub>1</sub> <i>g</i></span>

</td><td class="equation-number">(6)</td></tr></tbody></table>


<p>For the lower pendulum, the forces are the tension in the lower rod <span class="html-math inline-math">
<i>T</i><sub>2</sub>
</span>, and
gravity <span class="html-math inline-math">
−<i>m</i><sub>2</sub> <i>g</i>
</span>. </p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>2</sub> <i>x</i><sub>2</sub>'' = −<i>T</i><sub>2</sub> sin <i>θ</i><sub>2</sub>

</td><td class="equation-number">(7)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' = <i>T</i><sub>2</sub> cos <i>θ</i><sub>2</sub> − <i>m</i><sub>2</sub> <i>g</i>

</td><td class="equation-number">(8)</td></tr></tbody></table>

<p>In relating these equations to the diagrams, keep in mind that in the example
diagram <span class="html-math inline-math">
<i>θ</i><sub>1</sub>
</span> is positive and <span class="html-math inline-math">
<i>θ</i><sub>2</sub>
</span> is negative, because of the convention
that a counter-clockwise angle is positive.</p>
</div>





<h2>Direct Method for Finding Equations of Motion</h2>

<p>Now we do some algebraic manipulations with the goal of finding expressions for
<span class="html-math inline-math">
<i>θ</i><sub>1</sub>'', <i>θ</i><sub>2</sub>''
</span> in terms of <span class="html-math inline-math">
<i>θ</i><sub>1</sub>, <i>θ</i><sub>1</sub>', <i>θ</i><sub>2</sub>, <i>θ</i><sub>2</sub>'
</span>. Begin by solving equations
(7), (8) for <span class="html-math inline-math">
<i>T</i><sub>2</sub> sin <i>θ</i><sub>2</sub>
</span> and <span class="html-math inline-math">
<i>T</i><sub>2</sub> cos <i>θ</i><sub>2</sub>
</span> and then substituting into
equations (5) and (6).
</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>1</sub> <i>x</i><sub>1</sub>'' = −<i>T</i><sub>1</sub> sin <i>θ</i><sub>1</sub> − <i>m</i><sub>2</sub> <i>x</i><sub>2</sub>''

</td><td class="equation-number">(9)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>m</i><sub>1</sub> <i>y</i><sub>1</sub>'' = <i>T</i><sub>1</sub> cos <i>θ</i><sub>1</sub> − <i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' − <i>m</i><sub>2</sub> <i>g</i> −
<span class="nobr"><i>m</i><sub>1</sub> <i>g</i></span>

</td><td class="equation-number">(10)</td></tr></tbody></table>

<p>Multiply equation (9) by <span class="html-math inline-math">
cos <i>θ</i><sub>1</sub>
</span> and equation (10) by <span class="html-math inline-math">
sin <i>θ</i><sub>1</sub>
</span> and
rearrange to get
</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>T</i><sub>1</sub> sin <i>θ</i><sub>1</sub> cos <i>θ</i><sub>1</sub> = −cos <i>θ</i><sub>1</sub> (<i>m</i><sub>1</sub> <i>x</i><sub>1</sub>'' +
<span class="nobr"><i>m</i><sub>2</sub> <i>x</i><sub>2</sub>'')</span>

</td><td class="equation-number">(11)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>T</i><sub>1</sub> sin <i>θ</i><sub>1</sub> cos <i>θ</i><sub>1</sub> = sin <i>θ</i><sub>1</sub> (<i>m</i><sub>1</sub> <i>y</i><sub>1</sub>'' + <i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' +
<span class="nobr"><i>m</i><sub>2</sub> <i>g</i></span> +
<span class="nobr"><i>m</i><sub>1</sub> <i>g</i>)</span>

</td><td class="equation-number">(12)</td></tr></tbody></table>

<p>This leads to the equation
</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
sin <i>θ</i><sub>1</sub> (<i>m</i><sub>1</sub> <i>y</i><sub>1</sub>'' + <i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' + <i>m</i><sub>2</sub> <i>g</i> +
<span class="nobr"><i>m</i><sub>1</sub> <i>g</i>)</span> =
<span class="nobr">−cos <i>θ</i><sub>1</sub> (<i>m</i><sub>1</sub> <i>x</i><sub>1</sub>'' + <i>m</i><sub>2</sub> <i>x</i><sub>2</sub>'')</span>

</td><td class="equation-number">(13)</td></tr></tbody></table>

<p>Next, multiply equation (7) by <span class="html-math inline-math">
cos <i>θ</i><sub>2</sub>
</span> and equation (8) by <span class="html-math inline-math">
sin <i>θ</i><sub>2</sub>
</span> and
rearrange to get
</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>T</i><sub>2</sub> sin <i>θ</i><sub>2</sub> cos <i>θ</i><sub>2</sub> = −cos <i>θ</i><sub>2</sub> (<i>m</i><sub>2</sub> <i>x</i><sub>2</sub>'')

</td><td class="equation-number">(14)</td></tr></tbody></table>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
<i>T</i><sub>2</sub> sin <i>θ</i><sub>2</sub> cos <i>θ</i><sub>2</sub> = sin <i>θ</i><sub>2</sub> (<i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' + <i>m</i><sub>2</sub> <i>g</i>)

</td><td class="equation-number">(15)</td></tr></tbody></table>

<p>which leads to</p>

<table class="html-math numbered-equation">
<tbody><tr><td class="equation-number">&nbsp;&nbsp;</td><td>
sin <i>θ</i><sub>2</sub> (<i>m</i><sub>2</sub> <i>y</i><sub>2</sub>'' + <i>m</i><sub>2</sub> <i>g</i>) = −cos <i>θ</i><sub>2</sub> (<i>m</i><sub>2</sub> <i>x</i><sub>2</sub>'')

</td><td class="equation-number">(16)</td></tr></tbody></table>

<p>Next we need to use a computer algebra program to solve equations (13) and (16) for
<span class="html-math inline-math">
<i>θ</i><sub>1</sub>'', <i>θ</i><sub>2</sub>''
</span> in terms of <span class="html-math inline-math">
<i>θ</i><sub>1</sub>, <i>θ</i><sub>1</sub>', <i>θ</i><sub>2</sub>, <i>θ</i><sub>2</sub>'
</span>. Note that we also include the
definitions given by equations (1-4), so that we have 2 equations (13, 16) and 2
unknowns (<span class="html-math inline-math">
<i>θ</i><sub>1</sub>'', <i>θ</i><sub>2</sub>''
</span>). The result is somewhat complicated, but is easy enough
to program into the computer.</p>

<div class="html-math table-equation">
<table class="fraction">
    <tbody><tr>
        <td rowspan="2">
            <i>θ</i><sub>1</sub>''&nbsp;=&nbsp;
        </td><td>
            −<i>g</i> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) sin <i>θ</i><sub>1</sub> − <i>m</i><sub>2</sub> <i>g</i> sin(<i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>) −
            2 sin(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>) <i>m</i><sub>2</sub> (<i>θ</i><sub>2</sub>'<sup>2</sup> <i>L</i><sub>2</sub> + <i>θ</i><sub>1</sub>'<sup>2</sup> <i>L</i><sub>1</sub> cos(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>))
        </td>
    </tr><tr>
        <td class="upper_line">
            <i>L</i><sub>1</sub> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub> − <i>m</i><sub>2</sub> cos(2 <i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>))
        </td>
    </tr>
</tbody></table>

<table class="fraction">
    <tbody><tr>
        <td rowspan="2">
            <i>θ</i><sub>2</sub>''&nbsp;=&nbsp;
        </td><td>
            2 sin(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>) (<i>θ</i><sub>1</sub>'<sup>2</sup> <i>L</i><sub>1</sub> (<i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) + <i>g</i>(<i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) cos <i>θ</i><sub>1</sub>
            + <i>θ</i><sub>2</sub>'<sup>2</sup> <i>L</i><sub>2</sub> <i>m</i><sub>2</sub> cos(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>))
        </td>
    </tr><tr>
        <td class="upper_line">
            <i>L</i><sub>2</sub> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub> − <i>m</i><sub>2</sub> cos(2 <i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>))
        </td>
    </tr>
</tbody></table>
</div>

<p>These are the equations of motion for the double pendulum.</p>





<h2>Numerical Solution</h2>

<p>The above equations are now close to the form needed for the
<a href="../explain/runge-kutta-de.html">Runge Kutta method</a>. The final
step is convert these two 2nd order equations into four 1st order equations. Define the
first derivatives as separate variables:</p>

<ul class="vars">
    <li><span class="html-math inline-math">
<i>ω</i><sub>1</sub> =
</span> angular velocity of top rod</li>
    <li><span class="html-math inline-math">
<i>ω</i><sub>2</sub> =
</span> angular velocity of bottom rod</li>
</ul>

<p>Then we can write the four 1st order equations:</p>

<p class="html-math display-equation">
<i>θ</i><sub>1</sub>' = <i>ω</i><sub>1</sub>
</p>
<p class="html-math display-equation">
<i>θ</i><sub>2</sub>' = <i>ω</i><sub>2</sub>
</p>

<div class="html-math table-equation">
<table class="fraction">
    <tbody><tr>
        <td rowspan="2">
            <i>ω</i><sub>1</sub>'&nbsp;=&nbsp;
        </td><td>
            −<i>g</i> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) sin <i>θ</i><sub>1</sub> − <i>m</i><sub>2</sub> <i>g</i> sin(<i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>) −
            2 sin(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>) <i>m</i><sub>2</sub> (<i>ω</i><sub>2</sub><sup>2</sup> <i>L</i><sub>2</sub> + <i>ω</i><sub>1</sub><sup>2</sup> <i>L</i><sub>1</sub> cos(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>))
        </td>
    </tr><tr>
        <td class="upper_line">
            <i>L</i><sub>1</sub> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub> − <i>m</i><sub>2</sub> cos(2 <i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>))
        </td>
    </tr>
</tbody></table>

<table class="fraction">
    <tbody><tr>
        <td rowspan="2">
            <i>ω</i><sub>2</sub>'&nbsp;=&nbsp;
        </td><td>
            2 sin(<i>θ</i><sub>1</sub>−<i>θ</i><sub>2</sub>) (<i>ω</i><sub>1</sub><sup>2</sup> <i>L</i><sub>1</sub> (<i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) + <i>g</i>(<i>m</i><sub>1</sub> + <i>m</i><sub>2</sub>) cos <i>θ</i><sub>1</sub>
            + <i>ω</i><sub>2</sub><sup>2</sup> <i>L</i><sub>2</sub> <i>m</i><sub>2</sub> cos(<i>θ</i><sub>1</sub> − <i>θ</i><sub>2</sub>))
        </td>
    </tr><tr>
        <td class="upper_line">
            <i>L</i><sub>2</sub> (2 <i>m</i><sub>1</sub> + <i>m</i><sub>2</sub> − <i>m</i><sub>2</sub> cos(2 <i>θ</i><sub>1</sub> − 2 <i>θ</i><sub>2</sub>))
        </td>
    </tr>
</tbody></table>
</div>

<p>This is now exactly the form needed to plug in to the Runge-Kutta method for
numerical solution of the system.</p>

<p id="page_history">
  This web page was first published February 2002.
</p>


<div id="footer2">
  <div id="copyright">
  © <a href="mailto:erikn@myPhysicsLab.com" title="send comments to Erik Neumann">
  Erik Neumann</a>,  2004-2021<br>
  <span id="revised_date">revised Dec 19 2023 9:56</span>
</div> 
  <a class="nav_link" href="../pendulum/moveable-pendulum-de.html">vorherig</a>
  <a class="nav_link" href="../pendulum/moveable-double-pendulum-de.html">nächste</a>
  <a id="valid_html" href="https://validator.w3.org/check?uri=referer;outline=1;" title="check if this page is valid HTML">
  <img src="../common/ValidHTML401.png" alt="Valid HTML 4.01" height="31" width="88">
  </a>
</div>

<!-- Call the app script after the body so that html entities are defined and 
* the script can find them.--> 
<script src="DoublePendulumApp-de.js"></script>
<script>
  (function build() {
    var elem_ids = {
      tab_list: 'header_bar',
      container: 'container',
      term_output: 'term_output',
      term_input: 'term_input',
      sim_applet: 'sim_applet',
      div_graph: 'div_graph',
      graph_controls: 'graph_controls',
      sim_controls: 'sim_controls',
      div_terminal: 'div_terminal',
      div_time_graph: 'div_time_graph',
      time_graph_controls: 'time_graph_controls',
      div_multi_graph: 'div_multi_graph',
      multi_graph_controls: 'multi_graph_controls',
      label_terminal: 'label_terminal',
      show_terminal: 'show_terminal',
      show_sim: 'show_sim',
      images_dir: '../common'
    };
    app = new sims$pendulum$DoublePendulumApp(elem_ids);
    app.defineNames('app');
    window.addEventListener('pageshow', function(event){
      // set language menu to correct language
      var menu = document.getElementById('language_menu');
      if (menu) { menu.selectedIndex = 1; }
    }, /*capturing=*/false);
    app.setup();
    window.addEventListener('blur', function(event){
      app.eval('FIRING=false;', /*output=*/false);
    }, /*capturing=*/false);
    window.addEventListener('focus', function(event){
      app.eval('FIRING=true;', /*output=*/false);
    }, /*capturing=*/false);
  }());
</script>
<script>
  // separate script tag, runs even if error occurs in earlier script tag
  app.start();
</script>
<!--script>
  app.eval('TAB_LAYOUT.LAYOUT="sim+graph";');
</script-->

<script>
  document.getElementsByTagName("html")[0].style.visibility = "visible";
</script>


</body>



"use strict";(()=>{var r=class h{constructor(){throw""}static assert(t,e){if(h.ASSERTS&&!t)throw e&&console.log(e),"assert failed "+(e||"")}static array2string(t,e,i){e=e??h.NF7E,i===void 0&&(i=", ");let s=t.length,n="";for(let a=0;a<s;a++)n+=(a>0?i:"")+e(t[a]);return n}static arrayBool2string(t,e,i){e=e||"true",i=i||"false";let s=t.length,n="";for(let a=0;a<s;a++)n+=t[a]?e:i,a<s-1&&(n+=", ");return n}static colorString3(t,e,i){let s="#",n=[t,e,i];for(let a=0;a<3;a++)s+=h.numToHexChar1(n[a]);return h.assert(s.length==4),s}static colorString6(t,e,i){let s="#",n=[t,e,i];for(let a=0;a<3;a++)s+=h.numToHexChar2(n[a]);return h.assert(s.length==7),s}static createImage(t,e,i){let s=document.createElement("img");return s.src=t,s.width=e,s.height=i!==void 0?i:e,s}static defineGlobal(t,e,i){Object.defineProperty(globalThis,t,{value:e,writable:!!i})}static drop(t,e){return e>=0?t.slice(e):t.slice(0,t.length+e)}static equals(t,e){return t.length!==e.length?!1:t.every((i,s)=>i===e[s])}static forEachRight(t,e,i){let s=t.length;for(let n=s-1;n>=0;n--)e.call(i,t[n],n,t)}static getElementById(t){let e=document.getElementById(t);if(e===null)throw"elementId not found: "+t;return e}static getViewportSize(){let t=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);return[t,e]}static hypot(t,e){return Math.sqrt(t*t+e*e)}static isChrome(){let t=navigator;return t!=null?t.userAgent.match(/.*Chrome.*/)!=null:!1}static isIPhone(){let t=navigator;return t!=null?t.platform=="iPhone":!1}static isObject(t){return typeof t=="object"&&t!=null}static limitAngle(t){if(t>Math.PI){let e=Math.floor((t- -Math.PI)/(2*Math.PI));return t-2*Math.PI*e}else if(t<-Math.PI){let e=Math.floor(-(t-Math.PI)/(2*Math.PI));return t+2*Math.PI*e}else return t}static maybeElementById(t){try{return document.getElementById(t)}catch{return null}}static methodsOf(t){let e=[],i=Object.getPrototypeOf(t);for(;i;){let s=Object.getOwnPropertyNames(i);for(let n=0;n<s.length;n++){let a=s[n];a!=="constructor"&&typeof t[a]=="function"&&e.push(a)}if(i=Object.getPrototypeOf(i),i===null||i.constructor===Object)break}return e.sort(),h.removeDuplicates(e),e}static nameOf(t,e){for(let i in t)if(t[i]===e)return i;return""}static newBooleanArray(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=!1;return e}static newNumberArray(t){let e=new Array(t);for(let i=0;i<t;i++)e[i]=0;return e}static NF0(t){return t!=null?t.toFixed(0):t===null?"null":"undefined"}static NF18(t){return t!=null?t.toFixed(18):t===null?"null":"undefined"}static NF1S(t){return t!=null?(t>0?"+":"")+t.toFixed(1):t===null?"null":"undefined"}static NF2(t){return t!=null?t.toFixed(2):t===null?"null":"undefined"}static NF3(t){return t!=null?t.toFixed(3):t===null?"null":"undefined"}static NF4(t){return t!=null?t.toFixed(4):t===null?"null":"undefined"}static NF5(t){return t!=null?t.toFixed(5):t===null?"null":"undefined"}static NF5E(t){return t!=null?Math.abs(t)>2e-4||t==0?t.toFixed(5):t.toExponential(5):t===null?"null":"undefined"}static nf5(t){return t!=null?t.toFixed(5).replace(/\.?0+$/,""):t===null?"null":"undefined"}static NF7(t){return t!=null?t.toFixed(7):t===null?"null":"undefined"}static NF7E(t){return t!=null?Math.abs(t)>2e-6?t.toFixed(7):t.toExponential(7):t===null?"null":"undefined"}static nf7(t){return t!=null?t.toFixed(7).replace(/\.?0+$/,""):t===null?"null":"undefined"}static NF9(t){return t!=null?t.toFixed(9):t===null?"null":"undefined"}static NFE(t){return t!=null?t.toExponential(7):t===null?"null":"undefined"}static NFSCI(t){return t!=null?t.toExponential(17):t===null?"null":"undefined"}static numToHexChar1(t){return t=Math.floor(.5+16*t),t>=15?"f":t<=0?"0":h.HEX_DIGITS.charAt(t)}static numToHexChar2(t){if(t=Math.floor(.5+256*t),t>=255)return"ff";if(t<=0)return"00";{let e=Math.floor(t/16),i=t%16;return h.HEX_DIGITS.charAt(e)+h.HEX_DIGITS.charAt(i)}}static prettyPrint(t,e,i){typeof e!="number"&&(e=2),typeof i!="string"&&(i="  ");let s=String(t),n="",a=0,o=s.length,l=!1,_=[],c="";t:for(let g=0;g<o;g++){let d=s.charAt(g);if(l){if(d==" ")continue;l=!1}if(d=="{"||d=="["){if(a++,a<=e){n+=d+`
`;for(let m=0;m<a;m++)n+=i;l=!0}else n+=d;_.push(c),c=d=="{"?"}":"]"}else if(d==c){if(a<=e){a--,n+=`
`;for(let f=0;f<a;f++)n+=i;n+=d}else a--,n+=d;let m=_.pop();if(m===void 0)throw"error in  prettyPrint";if(c=m,a<0)throw"unbalanced "+c+" at "+g+" in "+t}else if(d=='"'||d=="'"){let m=d,f=g;for(n+=d;++g<o;)if(d=s.charAt(g),n+=d,d==m)continue t;throw"unbalanced quote at "+f+" in "+t}else if((d==","||d==";")&&a<=e){n+=d+`
`;for(let m=0;m<a;m++)n+=i;l=!0}else n+=d}return n=n.replace(/^\s+\n/gm,""),n}static printArray(t,e,i){if(h.DEBUG){e=e||80,i=i||h.NF5E;let s="";for(let n=0,a=t.length;n<a;n++){let o=i(t[n]);s.length+o.length>e?(console.log(s),s="  "+o):s+=" "+o}s.length>0&&console.log(s)}}static printNums5(t,...e){for(let i=0;i<e.length;i++){let s=e[i];typeof s=="number"&&(t+=" "+h.NF5(s))}console.log(t)}static propertiesOf(t,e){if(t===null)return["null"];e=e||!1;let i=[];for(let s in t)typeof t[s]!="function"&&(e?i.push(s+": "+t[s]):i.push(s));return i.sort(),i}static range(t){let e=[],i=0;for(;i<t;)e.push(i++);return e}static remove(t,e){let i,s=n=>n===e;return(i=t.findIndex(s))>=0?(t.splice(i,1),!0):!1}static removeAll(t,e){let i=!1;return h.forEachRight(t,(s,n)=>{s===e&&(t.splice(n,1),i=!0)}),i}static removeDuplicates(t){let e=t.length;if(e<=1)return;let i=t[0],s=1,n=1;for(;s<e;){if(t[s]===i){s++;continue}i=t[s],t[n]=i,s++,n++}t.length=n}static repeat(t,e){let i=[],s=0;for(;s++<e;)i.push(t);return i}static setErrorHandler(){if(window.onerror=function(t,e,i,s,n){let a=t+`
`+e+":"+i+":"+s+`
`+n;h.showErrorAlert(a)},h.DEBUG){let t=1;try{h.assert(!1),t=2}catch{console.log("asserts are working")}if(t==2)throw"asserts are not working"}else h.DEBUG&&console.log("WARNING: asserts are NOT enabled!")}static setImagesDir(t){if(t!==void 0)h.IMAGES_DIR=t;else throw"images directory not found"}static showErrorAlert(t){h.DEBUG&&console.log(t),h.numErrors++<h.maxErrors&&alert(t)}static systemTime(){return h.MODERN_CLOCK?performance.now()*.001:Date.now()*.001}static take(t,e){return e==0?"":e>0?t.slice(0,e):t.slice(t.length+e,t.length)}static testFinite(t){if(!isFinite(t))throw"not a finite number "+t;return t}static testNumber(t){if(isNaN(t))throw"not a number "+t;return t}static toName(t){return t.toUpperCase().replace(/[ -]/g,"_")}static uniqueElements(t){let e=t.length;if(e>1){let i=t.slice();i.sort();let s=i[0];for(let n=1;n<e;n++){if(s==i[n])return!1;s=i[n]}}return!0}static validName(t){if(!t.match(/^[A-Z_][A-Z_0-9]*$/))throw"not a valid name: "+t;return t}static veryDifferent(t,e,i,s){if(i=i||1e-14,!(isFinite(t)&&isFinite(e)))throw"argument is NaN";if(i<=0)throw"epsilon must be positive "+i;if(s=s||1,s<=0)throw"magnitude must be positive "+s;let n=Math.max(Math.abs(t),Math.abs(e)),a=n>s?n:s;return Math.abs(t-e)>a*i}static zeroArray(t){let e=t.length;for(let i=0;i<e;i++)t[i]=0}};r.ASSERTS=!0;r.COMPILE_TIME="Mon Dec 18 16:59:57 PST 2023";r.DEBUG=!0;r.HEX_DIGITS="0123456789abcdef";r.IMAGES_DIR=".";r.LOCALE="de";r.maxErrors=3;r.MAX_INTEGER=Math.pow(2,53);r.MIN_INTEGER=-Math.pow(2,53);r.MODERN_CLOCK=r.isObject(performance)&&typeof performance.now=="function";r.NOT_IMPLEMENTED="not implemented";r.numErrors=0;r.VERSION="2.0.0";r.NF=r.nf5;r.defineGlobal("lab$util$Util",r);var Ot="CHOICES_MODIFIED",p=class{constructor(t,e,i){this.name_=r.validName(r.toName(e)),this.subject_=t,this.value_=i}toString(){return this.toStringShort()}toStringShort(){let t=this.value_,e;return typeof t=="object"&&t!==null&&t.toStringShort!==void 0?e=t.toStringShort():e=t,'GenericEvent{name_:"'+this.name_+'", subject_: '+this.subject_.toStringShort()+", value_: "+e+"}"}getName(t){return t?this.name_:this.name_}getSubject(){return this.subject_}getValue(){return this.value_}nameEquals(t){return this.name_==r.toName(t)}};r.defineGlobal("lab$util$GenericEvent",p);var Y=class{constructor(t,e,i){this.purpose_=i||"",this.subject_=t,t.addObserver(this),this.observeFn_=e}toString(){return this.toStringShort()}toStringShort(){return"GenericObserver{subject_: "+this.subject_.toStringShort()+(this.purpose_.length>0?', purpose_:"'+this.purpose_+'"':"")+"}"}disconnect(){this.subject_.removeObserver(this)}observe(t){this.observeFn_(t)}};r.defineGlobal("lab$util$GenericObserver",Y);var N=class{constructor(t,e,i,s,n,a,o){if(this.isComputed_=!1,this.choices_=[],this.values_=[],this.subject_=t,this.name_=r.validName(r.toName(e)),this.localName_=i,this.getter_=s,this.setter_=n,this.isComputed_=!1,a!==void 0)if(o!==void 0)this.setChoices(a,o,!1);else throw"values not defined"}toString(){return this.toStringShort().slice(0,-1)+", isComputed_: "+this.isComputed_+', localName_: "'+this.localName_+'", choices_: '+this.choices_+"}"}toStringShort(){return'ParameterBoolean{name_: "'+this.name_+'", subject_: '+this.subject_.toStringShort()+", value: "+this.getValue()+"}"}getAsString(){return this.getValue().toString()}getChoices(){return Array.from(this.choices_)}getName(t){return t?this.localName_:this.name_}getSubject(){return this.subject_}getValue(){return this.getter_()}getValues(){return this.values_.map(t=>t.toString())}isComputed(){return this.isComputed_}nameEquals(t){return this.name_==r.toName(t)}setChoices(t,e,i){if(e.length!==t.length)throw"choices and values not same length";if(this.choices_=t,this.values_=e,i===void 0||i){let s=new p(this.subject_,Ot,this);this.subject_.broadcast(s)}}setComputed(t){this.isComputed_=t}setFromString(t){this.setValue(t=="true"||t=="TRUE")}setValue(t){if(typeof t!="boolean")throw"non-boolean value: "+t;t!==this.getValue()&&this.setter_(t)}};r.defineGlobal("lab$util$ParameterBoolean",N);var y=class{constructor(t,e,i,s,n,a,o){if(this.units_="",this.isComputed_=!1,this.signifDigits_=3,this.decimalPlaces_=-1,this.lowerLimit_=0,this.upperLimit_=Number.POSITIVE_INFINITY,this.choices_=[],this.values_=[],this.subject_=t,this.name_=r.validName(r.toName(e)),this.localName_=i,this.getter_=s,this.setter_=n,a!==void 0)if(o!==void 0)this.setChoices(a,o,!1);else throw"values is not defined"}toString(){return this.toStringShort().slice(0,-1)+", isComputed_: "+this.isComputed_+', localName_: "'+this.localName_+'", units_: "'+this.units_+'", lowerLimit_: '+r.NF(this.lowerLimit_)+", upperLimit_: "+r.NF(this.upperLimit_)+", decimalPlaces_: "+this.decimalPlaces_+", signifDigits_: "+this.signifDigits_+", choices_: ["+this.choices_+"], values_: ["+this.values_+"]}"}toStringShort(){return'ParameterNumber{name_: "'+this.name_+'", subject_: '+this.subject_.toStringShort()+", value: "+r.NF(this.getValue())+"}"}getAsString(){return this.getValue().toString()}getChoices(){return Array.from(this.choices_)}getDecimalPlaces(){return this.decimalPlaces_}getLowerLimit(){return this.lowerLimit_}getName(t){return t?this.localName_:this.name_}getSignifDigits(){return this.signifDigits_}getSubject(){return this.subject_}getUnits(){return this.units_}getUpperLimit(){return this.upperLimit_}getValue(){return this.getter_()}getValues(){return this.values_.map(t=>t.toString())}isComputed(){return this.isComputed_}nameEquals(t){return this.name_==r.toName(t)}setChoices(t,e,i){if(e.length!==t.length)throw"choices and values not same length";if(this.choices_=t,this.values_=e,i===void 0||i){let s=new p(this.subject_,Ot,this);this.subject_.broadcast(s)}}setComputed(t){this.isComputed_=t}setDecimalPlaces(t){return this.decimalPlaces_=t,this}setFromString(t){let e=Number(t);if(isNaN(e))throw"not a number: "+t;this.setValue(e)}setLowerLimit(t){if(t>this.getValue()||t>this.upperLimit_)throw"out of range: "+t+" value="+this.getValue()+" upper="+this.upperLimit_;return this.lowerLimit_=t,this}setSignifDigits(t){return this.signifDigits_=t,this}setUnits(t){return this.units_=t,this}setUpperLimit(t){if(t<this.getValue()||t<this.lowerLimit_)throw"out of range: "+t+" value="+this.getValue()+" lower="+this.lowerLimit_;return this.upperLimit_=t,this}setValue(t){if(typeof t!="number")throw"not a number: "+t;if(t<this.lowerLimit_||t>this.upperLimit_)throw"out of range. "+t+" is not between "+this.lowerLimit_+" and "+this.upperLimit_;if(this.values_.length>0&&!this.values_.includes(t))throw t+" is not an allowed value among: ["+this.values_.join(",")+"]";t!==this.getValue()&&this.setter_(t)}};r.defineGlobal("lab$util$ParameterNumber",y);var I=class{constructor(t,e,i,s,n,a,o){if(this.isComputed_=!1,this.suggestedLength_=20,this.maxLength_=Number.POSITIVE_INFINITY,this.choices_=[],this.values_=[],this.inputFunction_=null,this.subject_=t,this.name_=r.validName(r.toName(e)),this.localName_=i,this.getter_=s,this.setter_=n,a!==void 0)if(o!==void 0)this.setChoices(a,o,!1);else throw"values is not defined"}toString(){return this.toStringShort().slice(0,-1)+", isComputed_: "+this.isComputed_+', localName_: "'+this.localName_+'", suggestedLength_: '+this.suggestedLength_+", maxLength_: "+this.maxLength_+", choices_: ["+this.choices_+"], values_: ["+this.values_+"]}"}toStringShort(){return'ParameterString{name_: "'+this.name_+'", subject_: '+this.subject_.toStringShort()+', value: "'+this.getValue()+'"}'}getAsString(){return this.getValue()}getChoices(){return Array.from(this.choices_)}getMaxLength(){return this.maxLength_}getName(t){return t?this.localName_:this.name_}getSubject(){return this.subject_}getSuggestedLength(){return this.suggestedLength_}getValue(){return this.getter_()}getValues(){return Array.from(this.values_)}isComputed(){return this.isComputed_}nameEquals(t){return this.name_==r.toName(t)}setChoices(t,e,i){if(e.length!==t.length)throw"choices and values not same length";if(this.choices_=t,this.values_=e,i===void 0||i){let s=new p(this.subject_,Ot,this);this.subject_.broadcast(s)}}setComputed(t){this.isComputed_=t}setFromString(t){this.setValue(t)}setInputFunction(t){return this.inputFunction_=t,this}setMaxLength(t){if(t<this.getValue().length)throw"too long";return this.maxLength_=t,this}setSuggestedLength(t){return this.suggestedLength_=t,this}setValue(t){if(this.inputFunction_!=null&&(t=this.inputFunction_(t)),typeof t!="string")throw"non-string value: "+t;if(t.length>this.maxLength_)throw"string too long: "+t+" maxLength="+this.maxLength_;if(this.values_.length>0&&!this.values_.includes(t))throw'"'+t+'" is not an allowed value among: ['+this.values_.join(",")+"]";t!==this.getValue()&&this.setter_(t)}};r.defineGlobal("lab$util$ParameterString",I);var T=class{constructor(t){if(this.observers_=[],this.paramList_=[],this.doBroadcast_=!0,this.isBroadcasting_=!1,this.commandList_=[],!t)throw"no name";this.name_=r.validName(r.toName(t))}toString(){return", parameters: ["+this.paramList_.map(t=>t.toStringShort())+"], observers: ["+this.observers_.map(t=>t.toStringShort())+"]}"}toStringShort(){return this.getClassName()+'{name_: "'+this.getName()+'"}'}addObserver(t){let e={action:!0,observer:t};this.commandList_.push(e),this.doCommands()}doCommands(){if(!this.isBroadcasting_){for(let t=0,e=this.commandList_.length;t<e;t++){let i=this.commandList_[t];i.action?this.observers_.includes(i.observer)||this.observers_.push(i.observer):r.remove(this.observers_,i.observer)}this.commandList_=[]}}addParameter(t){let e=t.getName(),i=this.getParam_(e);if(i!=null)throw"parameter "+e+" already exists: "+i;this.paramList_.push(t)}broadcast(t){if(this.doBroadcast_){this.isBroadcasting_=!0;try{this.observers_.forEach(e=>e.observe(t))}finally{this.isBroadcasting_=!1,this.doCommands()}}}broadcastParameter(t){let e=this.getParam_(t);if(e==null)throw"unknown Parameter "+t;this.broadcast(e)}getBroadcast(){return this.doBroadcast_}getName(){return this.name_}getObservers(){return Array.from(this.observers_)}getParam_(t){return t=r.toName(t),this.paramList_.find(e=>e.getName()==t)}getParameter(t){let e=this.getParam_(t);if(e!==void 0)return e;throw"Parameter not found "+t}getParameterBoolean(t){let e=this.getParam_(t);if(e instanceof N)return e;throw"ParameterBoolean not found "+t}getParameterNumber(t){let e=this.getParam_(t);if(e instanceof y)return e;throw"ParameterNumber not found "+t}getParameterString(t){let e=this.getParam_(t);if(e instanceof I)return e;throw"ParameterString not found "+t}getParameters(){return Array.from(this.paramList_)}removeObserver(t){let e={action:!1,observer:t};this.commandList_.push(e),this.doCommands()}removeParameter(t){r.remove(this.paramList_,t)}setBroadcast(t){let e=this.doBroadcast_;return this.doBroadcast_=t,e}};r.defineGlobal("lab$util$AbstractSubject",T);var Kt=class{constructor(t,e,i,s){this.label_=t,this.getter_=e,this.setter_=i,this.state_=e();let n=null;if(s!==void 0){let a=s.parentElement;a!=null&&a.tagName=="LABEL"&&(n=a)}else s=document.createElement("input"),s.type="checkbox",n=document.createElement("label"),n.appendChild(s),n.appendChild(document.createTextNode(this.label_));this.checkBox_=s,this.checkBox_.checked=this.state_,this.topElement_=n!==null?n:this.checkBox_,this.changeFn_=this.handleClick.bind(this),this.checkBox_.addEventListener("change",this.changeFn_,!0)}toString(){return this.toStringShort().slice(0,-1)+", state_: "+this.state_+"}"}toStringShort(){return this.getClassName()+'{label_: "'+this.label_+'"}'}disconnect(){this.checkBox_.removeEventListener("change",this.changeFn_,!0)}getClassName(){return"CheckBoxControlBase"}getElement(){return this.topElement_}getParameter(){return null}getState(){return this.getter_()}handleClick(t){this.setState(!this.getState())}observe(t){this.setState(this.getState())}setEnabled(t){this.checkBox_.disabled=!t}setState(t){this.getState()!=t&&this.setter_(t),this.state_!=this.getState()&&(this.state_=this.getState(),this.checkBox_.checked=this.state_)}};r.defineGlobal("lab$controls$CheckBoxControlBase",Kt);var j=class extends Kt{constructor(t,e){super(t.getName(!0),()=>t.getValue(),i=>t.setValue(i),e),this.parameter_=t,this.parameter_.getSubject().addObserver(this)}toString(){return super.toString().slice(0,-1)+", parameter_: "+this.parameter_.toStringShort()+"}"}disconnect(){super.disconnect(),this.parameter_.getSubject().removeObserver(this)}getClassName(){return"CheckBoxControl"}getParameter(){return this.parameter_}observe(t){t==this.parameter_&&super.observe(t)}};r.defineGlobal("lab$controls$CheckBoxControl",j);var At=class{constructor(t,e,i,s,n){this.getter_=i,this.setter_=s,this.choices=t,this.values_=e,this.currentIndex_=this.values_.indexOf(i()),this.selectMenu_=document.createElement("select"),r.assert(!this.selectMenu_.multiple),r.assert(this.selectMenu_.type=="select-one"),this.buildSelectMenu(),this.label_=n??"";let a=null;if(this.label_.length>0){let o=document.createElement("label");o.appendChild(document.createTextNode(this.label_)),o.appendChild(this.selectMenu_),a=o}this.selectMenu_.selectedIndex=this.currentIndex_,this.topElement_=a!==null?a:this.selectMenu_,this.changeFn_=this.itemStateChanged.bind(this),this.selectMenu_.addEventListener("change",this.changeFn_,!0)}toString(){return this.toStringShort().slice(0,-1)+", currentIndex_: "+this.currentIndex_+", choices.length: "+this.choices.length+', selected: "'+(this.currentIndex_>-1?this.choices[this.currentIndex_]:"(none)")+'"}'}toStringShort(){return this.getClassName()+'{label_: "'+this.label_+'"}'}buildSelectMenu(){this.selectMenu_.options.length=0;for(let t=0,e=this.choices.length;t<e;t++)this.selectMenu_.options[t]=new Option(this.choices[t])}disconnect(){this.selectMenu_.removeEventListener("change",this.changeFn_,!0)}getChoice(){return this.currentIndex_}getClassName(){return"ChoiceControlBase"}getElement(){return this.topElement_}getParameter(){return null}itemStateChanged(t){this.selectMenu_.selectedIndex!==this.currentIndex_&&this.setChoice(this.selectMenu_.selectedIndex)}observe(t){let e=this.values_.indexOf(this.getter_());this.setChoice(e)}setChoice(t){if(this.currentIndex_!==t){let e=this.selectMenu_.options.length;if(this.values_.length!=e)throw"ChoiceControl: values_.length="+this.values_.length+" but menu.options.length="+e;try{t<-1?t=-1:t>e-1&&(t=e-1),this.currentIndex_=t,t>-1&&this.setter_(this.values_[t])}catch(i){alert(i),this.currentIndex_=this.values_.indexOf(this.getter_())}this.selectMenu_.selectedIndex=this.currentIndex_}}setChoices(t,e){if(t.length!=e.length)throw"";this.choices=t,this.values_=e,this.currentIndex_=this.values_.indexOf(this.getter_()),this.buildSelectMenu(),this.selectMenu_.selectedIndex=this.currentIndex_}setEnabled(t){this.selectMenu_.disabled=!t}};r.defineGlobal("lab$controls$ChoiceControlBase",At);var H=class extends At{constructor(t,e,i,s){let n=i??t.getChoices(),a=s??t.getValues(),o=e??t.getName(!0);super(n,a,()=>t.getAsString(),l=>t.setFromString(l),o),this.parameter_=t,this.parameter_.getSubject().addObserver(this)}toString(){return super.toString().slice(0,-1)+", parameter_: "+this.parameter_.toStringShort()+"}"}disconnect(){super.disconnect(),this.parameter_.getSubject().removeObserver(this)}getClassName(){return"ChoiceControl"}getParameter(){return this.parameter_}observe(t){t.getValue()==this.parameter_&&t.nameEquals(Ot)?setTimeout(()=>this.rebuildMenu(),50):t==this.parameter_&&super.observe(t)}rebuildMenu(){let t=this.parameter_.getChoices();r.equals(this.choices,t)||this.setChoices(t,this.parameter_.getValues())}};r.defineGlobal("lab$controls$ChoiceControl",H);var Rt=class{constructor(){}systemTime(){return r.systemTime()}cancelCallback(t){clearTimeout(t)}scheduleCallback(t,e){return setTimeout(t,e)}requestAnimFrame(t){return requestAnimationFrame(t)}cancelAnimFrame(t){cancelAnimationFrame(t)}},A=class h extends T{constructor(t,e){super(t||"CLOCK"),this.timeRate_=1,this.saveTime_secs_=0,this.saveRealTime_secs_=0,this.isRunning_=!1,this.stepMode_=!1,this.tasks_=[],this.clockDebug_=!1,this.sysClock_=e||new Rt,this.clockStart_sys_secs_=this.sysClock_.systemTime(),this.realStart_sys_secs_=this.clockStart_sys_secs_,this.addParameter(new y(this,h.en.TIME_RATE,h.i18n.TIME_RATE,()=>this.getTimeRate(),i=>this.setTimeRate(i)))}toString(){return this.toStringShort().slice(0,-1)+", timeRate_: "+r.NF5(this.timeRate_)+", saveTime_secs_: "+r.NF5(this.saveTime_secs_)+", saveRealTime_secs_: "+r.NF5(this.saveRealTime_secs_)+", isRunning_: "+this.isRunning_+", stepMode_: "+this.stepMode_+", clockStart_sys_secs_: "+r.NF5(this.clockStart_sys_secs_)+", realStart_sys_secs_: "+r.NF5(this.realStart_sys_secs_)+", tasks_: ["+this.tasks_+"]"+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", time: "+r.NF5(this.getTime())+"}"}getClassName(){return"Clock"}addTask(t){this.tasks_.includes(t)||(this.tasks_.push(t),this.scheduleTask(t))}cancelAllTasks(){this.tasks_.forEach(t=>t.cancel())}clearStepMode(){this.stepMode_=!1}clockToSystem(t){return t/this.timeRate_+this.clockStart_sys_secs_}executeTasks(t,e){this.tasks_.forEach(i=>{i.getTime()>=t&&i.getTime()<=t+e&&i.schedule(0)})}getRealTime(){return this.isRunning_?(this.sysClock_.systemTime()-this.realStart_sys_secs_)*this.timeRate_:this.saveRealTime_secs_}getTasks(){return Array.from(this.tasks_)}getTime(){return this.isRunning_?(this.sysClock_.systemTime()-this.clockStart_sys_secs_)*this.timeRate_:this.saveTime_secs_}getTimeRate(){return this.timeRate_}isRunning(){return this.isRunning_}isStepping(){return this.stepMode_}pause(){this.clearStepMode(),this.isRunning_&&(this.saveTime_secs_=this.getTime(),this.saveRealTime_secs_=this.getRealTime(),this.cancelAllTasks(),this.isRunning_=!1,this.broadcast(new p(this,h.CLOCK_PAUSE)),r.DEBUG&&this.clockDebug_&&console.log("Clock.pause "+this.toString()))}removeTask(t){r.remove(this.tasks_,t),t.cancel()}resume(){this.clearStepMode(),this.isRunning_||(this.isRunning_=!0,this.setTimePrivate(this.saveTime_secs_),this.setRealTime(this.saveRealTime_secs_),r.DEBUG&&this.clockDebug_&&console.log("Clock.resume "+this.toString()),this.broadcast(new p(this,h.CLOCK_RESUME)))}scheduleTask(t){if(t.cancel(),this.isRunning_){let e=this.clockToSystem(this.getTime()),i=this.clockToSystem(t.getTime());r.veryDifferent(i,e)?i>e&&t.schedule(i-e):t.execute()}}setRealTime(t){r.DEBUG&&this.clockDebug_&&console.log("Clock.setRealTime "+r.NF5(t)),this.isRunning_?this.realStart_sys_secs_=this.sysClock_.systemTime()-t/this.timeRate_:this.saveRealTime_secs_=t}setTime(t){let e=this.getTime();r.veryDifferent(e,t,.001)&&(this.setTimePrivate(t),r.DEBUG&&this.clockDebug_&&console.log("Clock.setTime("+t+") getTime="+e+" realTime="+r.NF5(this.getRealTime())),this.broadcast(new p(this,h.CLOCK_SET_TIME)))}setTimePrivate(t){this.isRunning_?(this.clockStart_sys_secs_=this.sysClock_.systemTime()-t/this.timeRate_,this.tasks_.forEach(e=>this.scheduleTask(e))):this.saveTime_secs_=t}setTimeRate(t){if(r.veryDifferent(this.timeRate_,t)){let e=this.getTime(),i=this.getRealTime();this.timeRate_=t,this.setTimePrivate(e),this.setRealTime(i);let s=Math.abs(e-this.getTime());r.assert(s<.002,"time diff="+s),s=Math.abs(i-this.getRealTime()),r.assert(s<.002,"realTime diff="+s),this.broadcastParameter(h.en.TIME_RATE)}}step(t){this.pause(),this.stepMode_=!0,r.assert(typeof t=="number");let e=this.saveTime_secs_;this.saveTime_secs_+=t,this.saveRealTime_secs_+=t,this.broadcast(new p(this,h.CLOCK_STEP)),r.DEBUG&&this.clockDebug_&&console.log("Clock.step timeStep="+r.NFE(t)+" "+this.toString()),this.executeTasks(e,t)}systemToClock(t){return(t-this.clockStart_sys_secs_)*this.timeRate_}};A.CLOCK_PAUSE="CLOCK_PAUSE";A.CLOCK_RESUME="CLOCK_RESUME";A.CLOCK_SET_TIME="CLOCK_SET_TIME";A.CLOCK_STEP="CLOCK_STEP";A.en={TIME_RATE:"time rate"};A.de_strings={TIME_RATE:"Zeitraffer"};A.i18n=r.LOCALE==="de"?A.de_strings:A.en;r.defineGlobal("lab$util$Clock",A);var Tt=class{constructor(t,e,i){this.timeoutID_=NaN,this.sysClock_=i||new Rt,this.callBack_=e,this.time_=t}toString(){return"ClockTask{time_: "+r.NF(this.time_)+", timeoutID_: "+this.timeoutID_+", callBack_: "+this.callBack_+"}"}cancel(){isFinite(this.timeoutID_)&&(this.sysClock_.cancelCallback(this.timeoutID_),this.timeoutID_=NaN)}execute(){typeof this.callBack_=="function"&&this.callBack_()}getTime(){return this.time_}schedule(t){if(this.cancel(),typeof this.callBack_=="function"){let e=Math.round(t*1e3);this.timeoutID_=this.sysClock_.scheduleCallback(this.callBack_,e)}}setCallback(t){this.callBack_=t}};r.defineGlobal("lab$util$ClockTask",Tt);var P=class{constructor(t,e,i,s){this.repeatDelay=0,this.repeatFirst=2,this.label_=t,s===void 0&&(s=document.createElement("button"),s.type="button",i===void 0?s.appendChild(document.createTextNode(t)):(s.className="icon",s.appendChild(i))),this.button_=s,this.clickFunction_=e,this.mouseDownFn_=this.handleClick.bind(this),this.button_.addEventListener("mousedown",this.mouseDownFn_,!0),this.mouseUpFn_=this.handleMouseUp.bind(this),this.button_.addEventListener("mouseup",this.mouseUpFn_,!0),this.button_.addEventListener("dragleave",this.mouseUpFn_,!1)}toString(){return this.toStringShort().slice(0,-1)+", timeoutID_: "+this.timeoutID_+", repeatDelay: "+r.NF(this.repeatDelay)+", repeatFirst: "+this.repeatFirst+"}"}toStringShort(){return'ButtonControl{label_: "'+this.label_+'"}'}disconnect(){this.button_.removeEventListener("mousedown",this.mouseDownFn_,!0),this.button_.removeEventListener("mouseup",this.mouseUpFn_,!0),this.button_.removeEventListener("dragleave",this.mouseUpFn_,!1)}getElement(){return this.button_}getParameter(){return null}handleClick(t){this.holdClick()}handleMouseUp(t){this.timeoutID_!==void 0&&(clearTimeout(this.timeoutID_),this.timeoutID_=void 0)}holdClick(){if(this.clickFunction_(),this.repeatDelay>0){let t=this.timeoutID_!==void 0?this.repeatDelay:this.repeatFirst*this.repeatDelay;this.timeoutID_=setTimeout(()=>this.holdClick(),t)}}setClickFunction(t){this.clickFunction_=t}setEnabled(t){this.button_.disabled=!t}};r.defineGlobal("lab$controls$ButtonControl",P);var u=class h{constructor(t,e,i){let s=typeof i=="number"?i:0;this.x_=r.testNumber(t),this.y_=r.testNumber(e),this.z_=r.testNumber(s),this.length_=NaN,this.lengthSquared_=NaN}toString(){return"Vector{x: "+r.NF5(this.x_)+", y: "+r.NF5(this.y_)+(this.z_!=0?", z: "+r.NF5(this.z_):"")+"}"}static clone(t){return t instanceof h?t:new h(t.getX(),t.getY(),t.getZ())}add(t){return new h(this.x_+t.getX(),this.y_+t.getY(),this.z_+t.getZ())}angleTo(t){if(this.getZ()!=0||t.getZ()!=0)throw"";let e=Math.atan2(this.y_,this.x_),i=Math.atan2(t.getY(),t.getX());return r.limitAngle(i-e)}distanceSquaredTo(t){let e=this.x_-t.getX(),i=this.y_-t.getY(),s=this.z_-t.getZ();return e*e+i*i+s*s}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}divide(t){if(t===1)return this;if(t<h.TINY_POSITIVE)throw"Vector.divide by near zero factor "+r.NFE(t);return new h(this.x_/t,this.y_/t,this.z_/t)}dotProduct(t){let e=this.x_*t.getX()+this.y_*t.getY()+this.z_*t.getZ();if(isNaN(e))throw r.DEBUG?"dotproduct is not a number "+this+" "+t:"";return e}equals(t){return t===null?!1:t.getX()===this.x_&&t.getY()===this.y_&&t.getZ()===this.z_}getAngle(){return Math.atan2(this.y_,this.x_)}getX(){return this.x_}getY(){return this.y_}getZ(){return this.z_}length(){return isNaN(this.length_)&&(this.length_=Math.sqrt(this.lengthSquared())),this.length_}lengthCheap(){let t=Math.abs(this.x_)+Math.abs(this.y_);return this.z_==0?t:t+Math.abs(this.z_)}lengthSquared(){return isNaN(this.lengthSquared_)&&(this.z_===0?this.lengthSquared_=this.x_*this.x_+this.y_*this.y_:this.lengthSquared_=this.x_*this.x_+this.y_*this.y_+this.z_*this.z_),this.lengthSquared_}multiply(t){return t===1?this:new h(t*this.x_,t*this.y_,t*this.z_)}nearEqual(t,e){return!(r.veryDifferent(this.x_,t.getX(),e)||r.veryDifferent(this.y_,t.getY(),e)||r.veryDifferent(this.z_,t.getZ(),e))}normalize(){return this.divide(this.length())}rotate(t,e){let i;if(e!==void 0?i=t:(i=Math.cos(t),e=Math.sin(t)),Math.abs(i*i+e*e-1)>1e-12)throw"not cosine, sine: "+i+", "+e;return new h(this.x_*i-this.y_*e,this.x_*e+this.y_*i,this.z_)}subtract(t){return new h(this.x_-t.getX(),this.y_-t.getY(),this.z_-t.getZ())}};u.TINY_POSITIVE=1e-10;u.ORIGIN=new u(0,0);u.EAST=new u(1,0);u.NORTH=new u(0,1);u.SOUTH=new u(0,-1);u.WEST=new u(-1,0);r.defineGlobal("lab$util$Vector",u);var S=class h{constructor(t,e,i,s){if(t>i)throw"DoubleRect: left > right: "+t+" > "+i;if(e>s)throw"DoubleRect: bottom > top: "+e+" > "+s;this.left_=r.testNumber(t),this.right_=r.testNumber(i),this.bottom_=r.testNumber(e),this.top_=r.testNumber(s)}toString(){return"DoubleRect{left_: "+r.NF(this.left_)+", bottom_: "+r.NF(this.bottom_)+", right_: "+r.NF(this.right_)+", top_: "+r.NF(this.top_)+"}"}static clone(t){return new h(t.getLeft(),t.getBottom(),t.getRight(),t.getTop())}static make(t,e){let i=Math.min(t.getX(),e.getX()),s=Math.max(t.getX(),e.getX()),n=Math.min(t.getY(),e.getY()),a=Math.max(t.getY(),e.getY());return new h(i,n,s,a)}static makeCentered(t,e,i){let s=t.getX(),n=t.getY();return new h(s-e/2,n-i/2,s+e/2,n+i/2)}static makeCentered2(t,e){let i=t.getX(),s=t.getY(),n=e.getX(),a=e.getY();return new h(i-n/2,s-a/2,i+n/2,s+a/2)}contains(t){return t.getX()>=this.left_&&t.getX()<=this.right_&&t.getY()>=this.bottom_&&t.getY()<=this.top_}equals(t){return t===this?!0:t instanceof h?t.getLeft()==this.left_&&t.getRight()==this.right_&&t.getBottom()==this.bottom_&&t.getTop()==this.top_:!1}expand(t,e){return e=e===void 0?t:e,new h(this.getLeft()-t,this.getBottom()-e,this.getRight()+t,this.getTop()+t)}getBottom(){return this.bottom_}getCenter(){return new u(this.getCenterX(),this.getCenterY())}getCenterX(){return(this.left_+this.right_)/2}getCenterY(){return(this.bottom_+this.top_)/2}getHeight(){return this.top_-this.bottom_}getLeft(){return this.left_}getRight(){return this.right_}getTop(){return this.top_}getWidth(){return this.right_-this.left_}intersection(t){let e=Math.max(this.left_,t.getLeft()),i=Math.max(this.bottom_,t.getBottom()),s=Math.min(this.right_,t.getRight()),n=Math.min(this.top_,t.getTop());return e>s||i>n?h.EMPTY_RECT:new h(e,i,s,n)}isEmpty(t){let e=t||1e-16;return this.getWidth()<e||this.getHeight()<e}maybeVisible(t,e){if(this.contains(t)||this.contains(e))return!0;let i=t.getX(),s=t.getY(),n=e.getX(),a=e.getY(),o=this.left_;return!(i<o&&n<o||(o=this.right_,i>o&&n>o)||(o=this.bottom_,s<o&&a<o)||(o=this.top_,s>o&&a>o))}nearEqual(t,e){return!(r.veryDifferent(this.left_,t.getLeft(),e)||r.veryDifferent(this.bottom_,t.getBottom(),e)||r.veryDifferent(this.right_,t.getRight(),e)||r.veryDifferent(this.top_,t.getTop(),e))}scale(t,e){e=e===void 0?t:e;let i=this.getCenterX(),s=this.getCenterY(),n=this.getWidth(),a=this.getHeight();return new h(i-t*n/2,s-e*a/2,i+t*n/2,s+e*a/2)}translate(t,e){let i,s;if(typeof t=="number")i=t,s=e;else{let n=t;s=n.getY(),i=n.getX()}if(typeof i!="number"||typeof s!="number")throw"";return new h(this.left_+i,this.bottom_+s,this.right_+i,this.top_+s)}union(t){return new h(Math.min(this.left_,t.getLeft()),Math.min(this.bottom_,t.getBottom()),Math.max(this.right_,t.getRight()),Math.max(this.top_,t.getTop()))}unionPoint(t){return new h(Math.min(this.left_,t.getX()),Math.min(this.bottom_,t.getY()),Math.max(this.right_,t.getX()),Math.max(this.top_,t.getY()))}};S.EMPTY_RECT=new S(0,0,0,0);r.defineGlobal("lab$util$DoubleRect",S);var kt=class h{constructor(t,e,i){this.fontDescent=8,this.fontAscent=12,this.horizAlignValue_=0,this.horizAxisAlignment_="VALUE",this.vertAlignValue_=0,this.vertAxisAlignment_="VALUE",this.numDecimal_=0,this.changed_=!0,this.horizName_="x",this.verticalName_="y",this.zIndex=100,this.simRect_=t??S.EMPTY_RECT,this.numFont_=e??"14pt sans-serif",this.drawColor_=i??"gray"}toString(){return this.toStringShort().slice(0,-1)+", horizAxisAlignment_: "+this.horizAxisAlignment_+", vertAxisAlignment_: "+this.vertAxisAlignment_+", this.horizAlignValue_: "+r.NF(this.horizAlignValue_)+", this.vertAlignValue_: "+r.NF(this.vertAlignValue_)+', drawColor_: "'+this.drawColor_+'", numFont_: "'+this.numFont_+'", simRect_: '+this.simRect_+", zIndex: "+this.zIndex+"}"}toStringShort(){return'DisplayAxes{horizName_: "'+this.horizName_+'", verticalName_: "'+this.verticalName_+'"}'}contains(t){return!1}draw(t,e){t.save(),t.strokeStyle=this.drawColor_,t.fillStyle=this.drawColor_,t.font=this.numFont_,t.textAlign="start",t.textBaseline="alphabetic";let i,s,n=this.simRect_,a=n.getLeft(),o=n.getRight(),l=n.getBottom(),_=n.getTop(),c=o-.06*(o-a),g=a+.01*(o-a);switch(this.vertAxisAlignment_){case"VALUE":let b=this.vertAlignValue_;b<g?b=g:b>c&&(b=c),i=e.simToScreenX(b);break;case"RIGHT":i=e.simToScreenX(c);break;case"LEFT":i=e.simToScreenX(g);break;default:i=e.simToScreenX(n.getCenterX())}let d=e.simToScreenY(_),m=e.simToScreenY(l),f=10+this.fontDescent+this.fontAscent;switch(this.horizAxisAlignment_){case"VALUE":s=e.simToScreenY(this.horizAlignValue_),s<d+f?s=d+f:s>m-f&&(s=m-f);break;case"TOP":s=d+f;break;case"BOTTOM":s=m-f;break;default:s=e.simToScreenY(n.getCenterY())}t.beginPath(),t.moveTo(e.simToScreenX(a),s),t.lineTo(e.simToScreenX(o),s),t.stroke(),this.drawHorizTicks(s,t,e,this.simRect_),t.beginPath(),t.moveTo(i,e.simToScreenY(l)),t.lineTo(i,e.simToScreenY(_)),t.stroke(),this.drawVertTicks(i,t,e,this.simRect_),t.restore()}drawHorizTicks(t,e,i,s){let n=t-4,a=n+8,o=s.getLeft(),l=s.getRight(),_=this.getNiceIncrement(l-o),c=h.getNiceStart(o,_);for(;c<l;){let d=i.simToScreenX(c);e.beginPath(),e.moveTo(d,n),e.lineTo(d,a),e.stroke();let m=c+_;if(m>c){let f=c.toFixed(this.numDecimal_),b=e.measureText(f).width;e.fillText(f,d-b/2,a+this.fontAscent)}else{e.fillText("scale is too small",d,a+this.fontAscent);break}c=m}let g=e.measureText(this.horizName_).width;e.fillText(this.horizName_,i.simToScreenX(l)-g-5,t-8)}drawVertTicks(t,e,i,s){let n=t-4,a=n+8,o=s.getBottom(),l=s.getTop(),_=this.getNiceIncrement(l-o),c=h.getNiceStart(o,_);for(;c<l;){let d=i.simToScreenY(c);e.beginPath(),e.moveTo(n,d),e.lineTo(a,d),e.stroke();let m=c+_;if(m>c){let f=c.toFixed(this.numDecimal_),b=e.measureText(f).width;this.vertAxisAlignment_==="RIGHT"?e.fillText(f,a-(b+10),d+this.fontAscent/2):e.fillText(f,a+5,d+this.fontAscent/2)}else{e.fillText("scale is too small",a,d);break}c=m}let g=e.measureText(this.verticalName_).width;this.vertAxisAlignment_==="RIGHT"?e.fillText(this.verticalName_,t-(g+6),i.simToScreenY(l)+13):e.fillText(this.verticalName_,t+6,i.simToScreenY(l)+13)}getChanged(){return this.changed_?(this.changed_=!1,!0):!1}getColor(){return this.drawColor_}getFont(){return this.numFont_}getHorizName(){return this.horizName_}getMassObjects(){return[]}getNiceIncrement(t){let e=Math.pow(10,Math.floor(Math.log(t)/Math.LN10)),i=t/e,s;i>=8?s=2:i>=5?s=1:i>=3?s=.5:i>=2?s=.4:s=.2,s*=e;let n=Math.log(s)/Math.LN10;return this.numDecimal_=n<0?Math.ceil(-n):0,s}static getNiceStart(t,e){return Math.ceil(t/e)*e}getPosition(){return u.ORIGIN}getSimObjects(){return[]}getSimRect(){return this.simRect_}getVerticalName(){return this.verticalName_}getXAxisAlignment(){return this.horizAxisAlignment_}getYAxisAlignment(){return this.vertAxisAlignment_}getZIndex(){return this.zIndex}isDragable(){return!1}setColor(t){this.drawColor_=t,this.changed_=!0}setDragable(t){}setFont(t){this.numFont_=t,this.changed_=!0}setHorizName(t){this.horizName_=t,this.changed_=!0}setPosition(t){}setSimRect(t){this.simRect_=t,this.changed_=!0}setVerticalName(t){this.verticalName_=t,this.changed_=!0}setXAxisAlignment(t,e){return this.horizAxisAlignment_=t,typeof e=="number"&&(this.horizAlignValue_=e),this.changed_=!0,this}setYAxisAlignment(t,e){return this.vertAxisAlignment_=t,typeof e=="number"&&(this.vertAlignValue_=e),this.changed_=!0,this}setZIndex(t){t!==void 0&&(this.zIndex=t),this.changed_=!0}};r.defineGlobal("lab$graph$DisplayAxes",kt);var B=class{constructor(t,e,i,s,n){this.dragable_=!0,this.font_="14pt sans-serif",this.textColor_="blue",this.handColor_="blue",this.realColor_="red",this.handWidth_=1,this.outlineWidth_=1,this.outlineColor_="black",this.fillStyle_="rgba(255, 255, 255, 0.75)",this.zIndex_=0,this.changed_=!0,this.lastSimTime_=0,this.simTimeFn_=t,this.realTimeFn_=e,this.period_=i??2,this.radius_=s??1,this.location_=n??u.ORIGIN}toString(){return this.toStringShort().slice(0,-1)+", radius: "+r.NF(this.radius_)+", period: "+r.NF(this.period_)+", location_: "+this.location_+", zIndex: "+this.zIndex_+"}"}toStringShort(){return"DisplayClock{time: "+r.NF(this.simTimeFn_())+"}"}contains(t){return t.distanceTo(this.location_)<=this.radius_}draw(t,e){let i=e.simToScreen(this.location_),s=e.simToScreenScaleX(this.radius_);t.save(),t.beginPath(),t.arc(i.getX(),i.getY(),s,0,2*Math.PI,!1),t.closePath(),t.lineWidth=this.outlineWidth_,t.strokeStyle=this.outlineColor_,t.stroke(),t.fillStyle=this.fillStyle_,t.fill();let n=this.simTimeFn_();this.lastSimTime_=n;let a=this.realTimeFn_();this.drawHand(t,e,this.handColor_,n,i),this.drawHand(t,e,this.realColor_,a,i);let o=n.toFixed(3);t.fillStyle=this.textColor_,t.font=this.font_,t.textAlign="center",t.fillText(o,i.getX(),i.getY()),t.restore()}drawHand(t,e,i,s,n){s=s-this.period_*Math.floor(s/this.period_);let a=s/this.period_,o=e.simToScreenScaleX(this.radius_*Math.sin(2*Math.PI*a)),l=e.simToScreenScaleY(this.radius_*Math.cos(2*Math.PI*a));t.lineWidth=this.handWidth_,t.strokeStyle=i,t.beginPath(),t.moveTo(n.getX(),n.getY()),t.lineTo(n.getX()+o,n.getY()-l),t.stroke()}isDragable(){return this.dragable_}getChanged(){return this.simTimeFn_()!=this.lastSimTime_||this.changed_?(this.changed_=!1,!0):!1}getFillStyle(){return this.fillStyle_}getFont(){return this.font_}getHandColor(){return this.handColor_}getHandWidth(){return this.handWidth_}getMassObjects(){return[]}getOutlineColor(){return this.outlineColor_}getOutlineWidth(){return this.outlineWidth_}getPosition(){return this.location_}getRealColor(){return this.realColor_}getSimObjects(){return[]}getTextColor(){return this.textColor_}getZIndex(){return this.zIndex_}setDragable(t){this.dragable_=t}setFillStyle(t){return this.fillStyle_=t,this.changed_=!0,this}setFont(t){return this.font_=t,this.changed_=!0,this}setHandColor(t){return this.handColor_=t,this.changed_=!0,this}setHandWidth(t){return this.handWidth_=t,this.changed_=!0,this}setOutlineColor(t){return this.outlineColor_=t,this.changed_=!0,this}setOutlineWidth(t){return this.outlineWidth_=t,this.changed_=!0,this}setPosition(t){this.location_=u.clone(t),this.changed_=!0}setRealColor(t){return this.realColor_=t,this.changed_=!0,this}setTextColor(t){return this.textColor_=t,this.changed_=!0,this}setZIndex(t){this.zIndex_=t!==void 0?t:0,this.changed_=!0}};B.en={SHOW_CLOCK:"show clock"};B.de_strings={SHOW_CLOCK:"Zeit anzeigen"};B.i18n=r.LOCALE==="de"?B.de_strings:B.en;r.defineGlobal("lab$view$DisplayClock",B);var st=class h{constructor(t,e){this.afterEvalFn_=void 0,this.changeFn_=void 0,this.hasAlerted_=!1,this.history_=[],this.histIndex_=-1,this.verbose_=!1,this.regexs_=[],this.result=void 0,this.resultStack_=[],this.z={},this.parser=null,this.vars_="",this.evalCalls_=0,this.prompt_="> ",this.term_input_=t,t&&(t.spellcheck=!1,this.keyDownFn_=this.handleKey.bind(this),t.addEventListener("keydown",this.keyDownFn_,!1)),this.term_output_=e,e&&(e.spellcheck=!1),this.addRegex("eval","terminal.",!1),this.println(h.version())}toString(){return"Terminal{history.length: "+this.history_.length+", regexs_.length: "+this.regexs_.length+", verbose_: "+this.verbose_+", parser: "+(this.parser!=null?this.parser.toStringShort():"null")+"}"}addRegex(t,e,i,s){let n=i??!0;if(t.length==0)throw"";if(n){let l=t.split("|"),_=this.vars_.split("|");l.forEach(c=>{_.includes(c)||(this.vars_+=(this.vars_.length>0?"|":"")+c)})}let a=new RegExp("(^|[^\\w.$])("+t+")\\b","g"),o="$1"+e+"$2";return this.addRegex2(a,o,s)}addRegex2(t,e,i){let s={regex:t,replace:e};return this.hasRegex(s)?!1:(i?this.regexs_.unshift(s):this.regexs_.push(s),!0)}addToVars(t){this.vars_+=(this.vars_.length>0?"|":"")+t}alertOnce(t){this.hasAlerted_?console.log(t):(this.hasAlerted_=!0,alert(t))}clear(){this.term_output_&&(this.term_output_.value="")}commands(){if(this.term_output_){let t=this.term_output_.value.split(`
`);return t=t.map(e=>e.trim()),t=t.filter(e=>e.length>2&&e.substr(0,2)=="> "&&!e.match(/^> (terminal|this).(remember|commands)\(\s*\);?$/)),t=t.map(e=>e.substr(2)),t}else return[]}destroy(){this.keyDownFn_&&this.term_input_&&this.term_input_.removeEventListener("keydown",this.keyDownFn_,!1),this.changeFn_&&this.term_input_&&this.term_input_.removeEventListener("change",this.changeFn_,!0)}static encodeURIComponent(t){return encodeURIComponent(t).replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16))}eval(t,e=!0,i=!0){if(t=t.trim(),t.match(/^\s*$/))return;this.evalCalls_++,this.evalCalls_>1&&(e=!1),e?(r.assert(this.evalCalls_==1),r.assert(this.resultStack_.length==0),this.history_.unshift(t),this.histIndex_=-1):(this.resultStack_.push(this.result),this.result=void 0);let s=this.prompt_;try{let n=["",t];for(;n=this.splitAtSemicolon(n[1]),n[0];){let a=n[0].trim();if(a.length!=0)t:{if(e&&this.println(s+a),a.match(/^\s*\/\/.*/))continue;if(this.parser!=null){let l=this.parser.parse(a);if(l!==void 0){this.result=l;break t}}let o=this.expand(a);e&&this.verbose_&&this.println(s.trim()+s+o);try{this.result=(0,eval)('"use strict";'+o)}catch(l){throw`${l} in script "${o}"`}}}e&&this.result!==void 0&&t.slice(-1)!=";"&&this.println(String(this.result)),e&&this.afterEvalFn_!==void 0&&this.afterEvalFn_(),this.error=""}catch(n){this.error=String(n),e?(this.result=void 0,this.println(String(n))):this.result=this.resultStack_.pop(),i&&(r.showErrorAlert(String(n)),this.afterErrorFn!==void 0&&this.afterErrorFn())}if(this.evalCalls_--,e)return this.scrollDown(),this.result;{let n=this.result;return this.result=this.resultStack_.pop(),n}}expand(t){let e=this.replaceVar(t),i="",s=0;for(;e;){if(++s>1e4)throw"Terminal.expand";let n=e.match(/^[^'"/]+/);if(n!==null){let a=n[0];if(e=e.slice(a.length),a=this.regexs_.reduce((o,l)=>o.replace(l.regex,l.replace),a),i+=a,e.length==0)break}if(i.match(/.*[=(][ ]*$/)&&(n=e.match(/^\/[^*/](\\\/|[^\\/])*\//),n!==null)){let a=n[0];e=e.slice(a.length),i+=a;continue}if(e.length>0&&e[0]=="/"){i+="/",e=e.slice(1);continue}if(n=e.match(/^"(\\.|[^\\"])*"/),n!==null){let a=n[0];e=e.slice(a.length),i+=a;continue}if(e.length>0&&e[0]=='"'){i+='"',e=e.slice(1);continue}if(n=e.match(/^'(\\.|[^\\'])*'/),n!==null){let a=n[0];e=e.slice(a.length),i+=a;continue}if(e.length>0&&e[0]=="'"){i+="'",e=e.slice(1);continue}}return i}focus(){this.term_input_&&this.term_input_.focus()}getError(){return this.error}handleKey(t){if(t.type!=="keydown")return;let e=t;this.term_input_&&this.term_output_&&(e.metaKey&&e.key==="k"?(this.term_output_.value="",e.preventDefault()):e.key==="ArrowUp"||e.key==="ArrowDown"?(this.histIndex_==-1&&this.term_input_.value!=""&&(this.history_.unshift(this.term_input_.value),this.histIndex_=0),e.key==="ArrowUp"?this.histIndex_<this.history_.length-1&&(this.histIndex_++,this.term_input_.value=this.history_[this.histIndex_]):e.key==="ArrowDown"&&(this.histIndex_>0?(this.histIndex_--,this.term_input_.value=this.history_[this.histIndex_]):(this.histIndex_=-1,this.term_input_.value="")),e.preventDefault()):e.key==="Enter"&&this.eval(this.term_input_.value,!0,!1))}hasRegex(t){let e=t.regex.toString(),i=t.replace;return this.regexs_.some(s=>s.replace==i&&s.regex.toString()==e)}inputCallback(t){this.term_input_&&this.eval(this.term_input_.value,!0,!1)}parseURL(){this.parser!=null&&this.parser.saveStart();let t=window.location.href,e=t.indexOf("?");if(e>-1){let i=t.slice(e+1);return i=decodeURIComponent(i),this.eval(i,!0,!0),!0}return!1}println(t){this.term_output_&&(this.term_output_.value+=t+`
`,this.scrollDown())}replaceVar(t){let e=t.match(/^\s*(var|let|const)\s+(\w[\w_\d]*)(.*)/);if(e){r.assert(e.length>=4);let i=e[2];return this.addRegex(i,"z.",!0,!0),e[2]+e[3]}return t}scrollDown(){this.term_input_&&this.term_output_&&(this.term_output_.scrollTop=this.term_output_.scrollHeight-this.term_output_.offsetHeight,this.term_input_.value="")}setAfterEval(t){this.afterEvalFn_=t}setParser(t){this.parser=t,t.addCommand("vars",()=>String(this.vars()),"lists available variables")}setPrompt(t){this.prompt_=String(t)}setVerbose(t){this.verbose_=t}splitAtSemicolon(t){let e=0,i="",s="",n="",a="",o=!1,l=!1,_=!1,c="",g,d;for(g=0,d=t.length;g<d;g++)if(s=a,a!=" "&&a!="	"&&a!=`
`&&(i=a),a=t[g],n=g+1<d?t[g+1]:"\0",o){if(a==`
`&&(o=!1,e==0))break}else if(l)a=="/"&&s!="\\"&&(l=!1);else if(_)a==c&&s!="\\"&&(_=!1,c="");else if(a=="/")n=="/"?o=!0:n!="*"&&i&&(i=="="||i=="(")&&(l=!0);else if(a=='"'||a=="'")_=!0,c=a;else{if(a==";"&&e==0)break;a=="{"?e++:a=="}"&&e--}return[t.slice(0,g+1),t.slice(g+1)]}static stdRegex(t){t.addRegex("methodsOf|propertiesOf|prettyPrint","Util.",!1),t.addRegex("println","terminal.",!1),t.addRegex("getParameter|getSubject","terminal.parser.",!1),t.addRegex("result|z|parser","terminal.",!0),t.addRegex("AffineTransform|CircularList|Clock|ClockTask|DoubleRect|EasyScriptParser|GenericEvent|GenericMemo|GenericObserver|MutableVector|ParameterBoolean|ParameterNumber|ParameterString|RandomLCG|Terminal|Timer|Util|Vector","lab$$util$$",!1),t.addRegex("NF0|NF2|NF1S|NF3|NF5|NF5E|nf5|nf7|NF7|NF7E|NF9|NFE|NFSCI","Util.",!1),t.addRegex("CollisionAdvance|ConcreteVariable|ConcreteLine|ConstantForceLaw|CoordType|DampingLaw|EulersMethod|Force|FunctionVariable|GravityLaw|Gravity2Law|MassObject|ModifiedEuler|NumericalPath|ParametricPath|OvalPath|PointMass|RungeKutta|ShapeType|SimList|SimpleAdvance|Spring|VarsList","lab$$model$$",!1),t.addRegex("CoordMap|DisplayClock|DisplayConnector|DisplayLine|DisplayList|DisplayPath|DisplayShape|DisplayRope|DisplaySpring|DisplayText|DrawingMode|DrawingStyle|HorizAlign|LabCanvas|SimView|DisplayArc|ScreenRect|SimView|VerticalAlign","lab$$view$$",!1),t.addRegex("CircularEdge|CollisionHandling|ConcreteVertex|ContactSim|EdgeRange|ExtraAccel|ImpulseSim|Joint|JointUtil|PathJoint|Polygon|RigidBodyCollision|RigidBodySim|Rope|Scrim|Shapes|StraightEdge|ThrusterSet|Vertex|Walls","lab$$engine2D$$",!1),t.addRegex("AutoScale|DisplayGraph|GraphColor|GraphLine|EnergyBarGraph|GraphStyle|DisplayAxes|VarsHistory","lab$$graph$$",!1),t.addRegex("EventHandler|MouseTracker|RigidBodyEventHandler|SimController|SimRunner|ViewPanner","lab$$app$$",!1),t.addRegex("ButtonControl|CheckBoxControl|CheckBoxControlBase|ChoiceControl|ChoiceControlBase|LabelControl|NumericControl|NumericControlBase|SliderControl|TextControl|TextControlBase|ToggleControl","lab$$controls$$",!1)}vars(){let t=this.vars_.split("|");return t.sort(),t}static version(){return"myPhysicsLab version "+r.VERSION+", compiled on "+r.COMPILE_TIME+"."}};r.defineGlobal("lab$util$Terminal",st);var $=class h{constructor(t,e){this.initialNonDependent_=[],this.initialDependent_=[],this.allSubjParamNames_=[],this.allParamNames_=[],this.allSubjects_=[],this.unique_=[],this.commandNames_=[],this.commandFns_=[],this.commandHelp_=[],h.checkUniqueNames(t),this.subjects_=t,this.dependent_=Array.isArray(e)?e:[];let i=(s,n,a)=>{this.dependent_.includes(s)&&a.splice(n,1)};r.forEachRight(this.subjects_,i),this.subjects_=this.subjects_.concat(this.dependent_),this.addCommand("url",()=>this.scriptURL(),"prints URL with script to recreate current state"),this.addCommand("script",()=>this.script(),"prints script to recreate current state"),this.addCommand("values",()=>r.prettyPrint(this.values()),"shows available parameters and their current values"),this.addCommand("names",()=>r.prettyPrint(this.names().join(";")),"shows available parameter names (format is SUBJECT.PARAMETER)"),this.addCommand("help",()=>this.help(),"prints this help text"),this.update()}toString(){return this.toStringShort().slice(0,-1)+", subjects_: ["+this.subjects_.map(t=>t.toStringShort())+"]}"}toStringShort(){return"EasyScriptParser{subjects_.length: "+this.subjects_.length+"}"}addCommand(t,e,i){this.commandNames_.push(t),this.commandFns_.push(e),this.commandHelp_.push(i)}static checkUniqueNames(t){let e=[];t.forEach(i=>{let s=i.getName();if(e.includes(s))throw"duplicate Subject name: "+s;e.push(s)})}getParameter(t){t=r.toName(t);let e=t.split("."),i="",s="";if(e.length==1)i="",s=e[0];else if(e.length==2)i=e[0],s=e[1];else return null;let n;if(i==""){if(this.allParamNames_.reduce((o,l)=>o+(l==s?1:0),0)>1)throw"multiple Subjects have Parameter "+s;n=this.allParamNames_.indexOf(s)}else n=this.allSubjParamNames_.indexOf(t);return n>-1?this.allSubjects_[n].getParameter(s):null}getSubject(t){let e=r.toName(t),i=this.subjects_.find(s=>s.getName()==e);return i===void 0?null:i}getSubjects(){return Array.from(this.subjects_)}help(){let t=st.version()+`
`;t+=`Use the "values" command to see what can be set and the syntax.
 
`,t+=`command-K            clear Terminal window
`,t+=`arrow up/down        retrieve previous or next command
`,t+=`getParameter(name)   see "names" command, returns the named Parameter
`,t+=`getSubject(name)     see "names" command, returns the named Subject
`,t+=`propertiesOf(app)    shows properties of that object
`,t+=`methodsOf(app)       shows methods defined on that object
`,t+=`prettyPrint(app)     prints the object nicely
`,t+=`prettyPrint(app, 3)  prints the object, expanding 3 levels of sub-objects
`,t+=`println(1+2)         prints to the Terminal window
`,t+=`result               the result of the previous command
`;for(let e=0,i=this.commandNames_.length;e<i;e++){let s=this.commandNames_[e];for(;s.length<20;)s+=" ";t+=s+" "+this.commandHelp_[e]+`
`}return t}names(){return Array.from(this.allSubjParamNames_)}namesAndValues(t,e,i){t=t==!0;let s=this.allSubjects_.map((l,_)=>l.getParameter(this.allParamNames_[_])),n=s;e||(n=n.filter(l=>!l.isComputed())),n=n.filter(l=>this.dependent_.includes(l.getSubject())==t,this);let a=/^[a-zA-Z0-9_]+$/,o=n.map(l=>{let _=r.toName(l.getName()),c=s.indexOf(l);if(c<0)throw"EasyScript error "+l;let g=l.getValue();return typeof g=="string"&&!a.test(g)&&(g='"'+g+'"'),!i&&this.unique_[c]?_+"="+g:r.toName(l.getSubject().getName())+"."+_+"="+g});return o.length>0?o.join(";")+";":""}parse(t){t.slice(-1)==";"&&(t=t.slice(0,t.length-1));for(let n=0,a=this.commandNames_.length;n<a;n++)if(t.toLowerCase()==this.commandNames_[n])return this.commandFns_[n]();let e=t.split("="),i=r.toName(e[0].trim()),s=this.getParameter(i);if(!(s==null||e.length>2)){if(e.length==2){let n;try{n=h.unquote(e[1].trim()),s.setFromString(n)}catch(a){throw a+' while setting value "'+n+'" on parameter '+i}}return s.getValue()}}saveStart(){this.initialNonDependent_=this.namesAndValues(!1).split(";"),this.initialDependent_=this.namesAndValues(!0).split(";")}script(){let t=this.namesAndValues(!1).split(";");t=t.concat(this.namesAndValues(!0).split(";"));let e=this.initialNonDependent_.concat(this.initialDependent_),i=function(s,n,a){e.includes(s)&&a.splice(n,1)};return r.forEachRight(t,i),t.join(";")+(t.length>0?";":"")}scriptURL(){return window.location.href.replace(/\.html\?.*$/,".html")+"?"+st.encodeURIComponent(this.script())}static unquote(t){if(t.length<2)return t;let e=t.charAt(0),i=t.charAt(t.length-1);if(e==i&&(e=='"'||e=="'")){let s="";for(let n=1,a=t.length-1;n<a;n++){let o=t[n];if(o=="\\")if(n++,n<a)switch(o=t[n],o){case"0":s+="\0";break;case"b":s+="\b";break;case"t":s+="	";break;case"n":s+=`
`;break;case"v":s+="\v";break;case"f":s+="\f";break;case"r":s+="\r";break;case'"':s+='"';break;case"'":s+="'";break;case"\\":s+="\\";break;default:s+="\\"+o}else s+=o;else s+=o}return s}return t}update(){let t=this.subjects_.reduce(function(i,s){let n=s.getParameters().filter(a=>a.getName()!="DELETED");return i.concat(n)},[]);this.allSubjects_=t.map(i=>i.getSubject()),this.allParamNames_=t.map(i=>r.toName(i.getName())),this.allSubjParamNames_=t.map(i=>r.toName(i.getSubject().getName()+"."+i.getName()));let e=function(i,s){return i.reduce((n,a)=>n+(s(a)?1:0),0)};this.unique_=this.allParamNames_.map(i=>e(this.allParamNames_,s=>s==i)==1),this.initialDependent_=this.namesAndValues(!0).split(";")}values(){return this.namesAndValues(!1,!0,!0)+this.namesAndValues(!0,!0,!0)}};$.en={URL_SCRIPT:"share",PROMPT_URL:"Press command-C to copy this URL to the clipboard, it will replicate this simulation with current parameters.",WARN_URL_2048:"WARNING: URL is longer than 2048 characters."};$.de_strings={URL_SCRIPT:"mitteilen",PROMPT_URL:"Dr\xFCcken Sie command-C um diesen URL in die Zwischenablage zu kopieren, dies beinhaltet die eingegebenen Parameter.",WARN_URL_2048:"Achtung: URL is l\xE4nger als 2048 Zeichen."};$.i18n=r.LOCALE==="de"?$.de_strings:$.en;var O=class h{constructor(t){this.graphFont="10pt sans-serif",this.rect_=S.EMPTY_RECT,this.fontDescent_=8,this.fontAscent_=12,this.graphOrigin_=0,this.leftEdge_=0,this.rightEdge_=0,this.graphFactor_=10,this.graphDelta_=2,this.needRescale_=!0,this.drawBackground_=!0,this.potentialColor="#666",this.translationColor="#999",this.rotationColor="#ccc",this.lastTime_=r.systemTime(),this.lastTime2_=0,this.totalEnergyDisplay_=0,this.lastEnergyDisplay_=0,this.totalDigits_=1,this.totalEnergyPeriod_=.3,this.lastTotalEnergyTime_=Number.NEGATIVE_INFINITY,this.megaMinEnergy_=0,this.megaMaxEnergy_=0,this.minEnergy_=0,this.maxEnergy_=0,this.totalEnergy_=0,this.BUFFER_=12,this.history_=new Array(this.BUFFER_),this.bufptr_=0,this.dragable_=!0,this.visibleRect_=S.EMPTY_RECT,this.needResize_=!0,this.zIndex=0,this.changed_=!0,this.debug_=!1,this.system_=t}toString(){return this.toStringShort().slice(0,-1)+", visibleRect: "+this.visibleRect_+", rect: "+this.rect_+", needRescale: "+this.needRescale_+", leftEdge: "+r.NF(this.leftEdge_)+", rightEdge: "+r.NF(this.rightEdge_)+", graphOrigin: "+r.NF(this.graphOrigin_)+", graphFactor: "+r.NF(this.graphFactor_)+", minHistory: "+r.NF(this.minHistory())+", minEnergy: "+r.NF(this.minEnergy_)+", megaMinEnergy: "+r.NF(this.megaMinEnergy_)+", megaMinEnergyLoc: "+Math.floor(this.graphOrigin_+.5+this.graphFactor_*this.megaMinEnergy_)+", maxEnergy: "+r.NF(this.maxEnergy_)+", megaMaxEnergy: "+r.NF(this.megaMaxEnergy_)+", totalEnergy: "+r.NF(this.totalEnergy_)+", time: "+r.NF(r.systemTime()-this.lastTime_)+", zIndex: "+this.zIndex+"}"}toStringShort(){return"EnergyBarGraph{system: "+this.system_.toStringShort()+"}"}contains(t){return this.rect_.contains(t)}draw(t,e){if(this.visibleRect_.isEmpty())return;t.save(),t.font=this.graphFont,t.textAlign="start",t.textBaseline="alphabetic";let i=this.system_.getEnergyInfo(),s=i.getTranslational(),n=i.getPotential(),a=i.getRotational(),o=h.i18n.TRANSLATIONAL_ENERGY+",";isNaN(a)&&(o=h.i18n.KINETIC_ENERGY+",");let l=h.TOP_MARGIN+3*h.HEIGHT+this.fontAscent_+8+this.fontDescent_,_=e.screenToSimScaleY(l);if((this.needResize_||this.rect_.isEmpty()||r.veryDifferent(_,this.rect_.getHeight()))&&(this.debug_&&r.DEBUG&&console.log("h2 = "+_+" this.rect_.getHeight="+this.rect_.getHeight()),this.resizeRect(_)),this.debug_&&r.DEBUG){let gt=e.simToScreenRect(this.rect_);t.fillStyle="rgba(255,255,0,0.5)",t.fillRect(gt.getLeft(),gt.getTop(),gt.getWidth(),gt.getHeight())}this.leftEdge_=e.simToScreenX(this.rect_.getLeft())+h.LEFT_MARGIN,this.rightEdge_=e.simToScreenX(this.rect_.getRight())-h.RIGHT_MARGIN;let c=this.rightEdge_-this.leftEdge_,g=e.simToScreenY(this.rect_.getTop());this.drawBackground_&&(t.fillStyle="rgba(255,255,255,0.75)",t.fillRect(this.leftEdge_-h.LEFT_MARGIN,g+h.TOP_MARGIN,c+h.LEFT_MARGIN+h.RIGHT_MARGIN,l)),this.debug_&&r.DEBUG&&(t.strokeStyle="#90c",t.strokeRect(this.leftEdge_-h.LEFT_MARGIN,g+h.TOP_MARGIN,c+h.LEFT_MARGIN+h.RIGHT_MARGIN,l)),this.totalEnergy_=s+n+(isNaN(a)?0:a),r.assert(Math.abs(this.totalEnergy_-i.getTotalEnergy())<1e-12),this.minEnergy_=n<0?n:0,this.maxEnergy_=this.totalEnergy_>0?this.totalEnergy_:0,r.systemTime()-this.lastTotalEnergyTime_>this.totalEnergyPeriod_&&(this.lastTotalEnergyTime_=r.systemTime(),this.lastEnergyDisplay_=this.totalEnergyDisplay_,this.totalEnergyDisplay_=i.getTotalEnergy()),this.rescale(c);let d=this.graphOrigin_,m=0;t.fillStyle=this.potentialColor,n<0?(m=Math.floor(.5-n*this.graphFactor_),t.fillRect(d-m,g+h.TOP_MARGIN,m,h.HEIGHT),d=d-m):(m=Math.floor(.5+n*this.graphFactor_),t.fillRect(d,g+h.HEIGHT+h.TOP_MARGIN,m,h.HEIGHT),d+=m),isNaN(a)||(m=Math.floor(.5+a*this.graphFactor_),t.fillStyle=this.rotationColor,t.fillRect(d,g+h.HEIGHT+h.TOP_MARGIN,m,h.HEIGHT),d+=m),m=Math.floor(.5+s*this.graphFactor_);let f=this.graphOrigin_+Math.floor(.5+this.totalEnergy_*this.graphFactor_);r.assert(Math.abs(d+m-f)<=2),m=f-d,t.fillStyle=this.translationColor,t.fillRect(d,g+h.HEIGHT+h.TOP_MARGIN,m,h.HEIGHT);let b=(this.rightEdge_-this.graphOrigin_)/this.graphFactor_,C=this.drawScale(t,this.leftEdge_,g+h.HEIGHT+h.TOP_MARGIN,b),v=this.leftEdge_;v=this.drawLegend(t,h.i18n.POTENTIAL_ENERGY+",",this.potentialColor,!0,v,C),isNaN(a)||(v=this.drawLegend(t,h.i18n.ROTATIONAL_ENERGY+",",this.rotationColor,!0,v,C)),v=this.drawLegend(t,o,this.translationColor,!0,v,C),v=this.drawTotalEnergy(t,v,C),t.restore()}drawLegend(t,e,i,s,n,a){s?(t.fillStyle=i,t.fillRect(n,a,10,10)):(t.strokeStyle=i,t.strokeRect(n,a,10,10)),n+=13;let l=t.measureText(e).width;return t.fillStyle="#000",t.fillText(e,n,a+this.fontAscent_),n+=l+5,n}drawScale(t,e,i,s){let n=this.fontAscent_;if(Math.abs(s)>1e-18&&this.graphDelta_>1e-18){t.fillStyle="#000",t.strokeStyle="#000";let a=0,o=0;do{let l=this.graphOrigin_+Math.floor(a*this.graphFactor_);t.beginPath(),t.moveTo(l,i+h.HEIGHT/2),t.lineTo(l,i+h.HEIGHT+2),t.stroke();let _=h.numberFormat1(a),c=t.measureText(_).width;t.fillText(_,l-c/2,i+h.HEIGHT+n+3),a+=this.graphDelta_,this.debug_&&r.DEBUG&&++o>100&&console.log("loop 1 x="+l+" s="+_+" scale="+r.NFE(a)+" total="+r.NFE(s)+" graphDelta="+r.NFE(this.graphDelta_))}while(a<s+this.graphDelta_+1e-16);if(this.debug_&&r.DEBUG&&console.log("megaMinEnergy="+r.NFE(this.megaMinEnergy_)+" graphDelta="+r.NFE(this.graphDelta_)+" graphFactor="+r.NFE(this.graphFactor_)+" scale="+r.NFE(a)),this.megaMinEnergy_<-1e-12){a=-this.graphDelta_;let l;do{l=this.graphOrigin_+Math.floor(a*this.graphFactor_),t.beginPath(),t.moveTo(l,i+h.HEIGHT/2),t.lineTo(l,i+h.HEIGHT+2),t.stroke();let _=h.numberFormat1(a),c=t.measureText(_).width;t.fillText(_,l-c/2,i+h.HEIGHT+n+3),a-=this.graphDelta_,this.debug_&&r.DEBUG&&console.log("loop 2 x="+l+" s="+_+" scale="+r.NFE(a)+" megaMinEnergy="+r.NFE(this.megaMinEnergy_))}while(a>this.megaMinEnergy_&&l>=e)}}return i+h.HEIGHT+n+3+this.fontDescent_}drawTotalEnergy(t,e,i){let s=h.i18n.TOTAL+" "+this.formatTotalEnergy(this.totalEnergyDisplay_,this.lastEnergyDisplay_);return t.fillStyle="#000",t.fillText(s,e,i+this.fontAscent_),e+t.measureText(s).width+5}formatTotalEnergy(t,e){let i=Math.abs(t-e);if(i>1e-15){let a=-Math.floor(Math.log(i)/Math.log(10)),o=a>0?a:1;this.totalDigits_=o<20?o:20}let s=Math.abs(t),n=t<0?"-":"+";return s<1e-6?n+s.toExponential(5):s<1e3?n+s.toFixed(this.totalDigits_):n+s.toFixed(this.totalDigits_)}getChanged(){return this.changed_?(this.changed_=!1,!0):!1}getSimObjects(){return[]}getMassObjects(){return[]}getPosition(){return this.rect_.isEmpty()?new u(0,0):this.rect_.getCenter()}getVisibleArea(){return this.visibleRect_}getZIndex(){return this.zIndex}isDragable(){return this.dragable_}minHistory(){let t=0;for(let e=0,i=this.history_.length;e<i;e++)this.history_[e]<t&&(t=this.history_[e]);return t}static numberFormat1(t){let e=Math.abs(t),i;return e<1e-16?i="0":e<.001?(i=e.toExponential(3),i=i.replace(/\.0+([eE])/,"$1"),i=i.replace(/(\.\d*[1-9])0+([eE])/,"$1$2")):e<10?(i=e.toFixed(4),i=i.replace(/\.0+$/,""),i=i.replace(/(\.\d*[1-9])0+$/,"$1")):e<100?(i=e.toFixed(3),i=i.replace(/\.0+$/,""),i=i.replace(/(\.\d*[1-9])0+$/,"$1")):e<1e3?(i=e.toFixed(2),i=i.replace(/\.0+$/,""),i=i.replace(/(\.[1-9])0$/,"$1")):e<1e4?i=e.toFixed(0):(i=e.toExponential(3),i=i.replace(/\.0+([eE])/,"$1"),i=i.replace(/(\.\d*[1-9])0+([eE])/,"$1$2")),t<0?"-"+i:i}printEverything(t){r.DEBUG&&this.debug_&&console.log(t+this)}rescale(t){let e=this.timeCheck(this.minEnergy_);if(r.DEBUG&&this.printEverything("(status)"),this.megaMinEnergy_=this.minHistory(),r.assert(isFinite(this.megaMinEnergy_)),this.megaMinEnergy_<-1e-6?(this.graphOrigin_+Math.floor(.5+this.megaMinEnergy_*this.graphFactor_)<this.leftEdge_-h.LEFT_MARGIN&&(r.DEBUG&&this.printEverything("BIG MIN ENERGY"),this.needRescale_=!0),e&&-this.megaMinEnergy_*this.graphFactor_<.2*(this.graphOrigin_-this.leftEdge_)&&(r.DEBUG&&this.printEverything("SMALL MIN ENERGY"),this.needRescale_=!0)):this.megaMinEnergy_>1e-6?this.graphOrigin_>this.leftEdge_&&(r.DEBUG&&this.printEverything("POSITIVE MIN ENERGY"),this.needRescale_=!0):e&&this.graphOrigin_-this.leftEdge_>h.LEFT_MARGIN&&(this.needRescale_=!0),this.totalEnergy_>this.megaMaxEnergy_&&(this.megaMaxEnergy_=this.totalEnergy_),this.totalEnergy_>1e-12?(this.graphOrigin_+this.totalEnergy_*this.graphFactor_>this.rightEdge_&&(this.needRescale_=!0,r.DEBUG&&this.printEverything("BIG TOTAL ENERGY")),this.rightEdge_-this.graphOrigin_>.2*(this.graphOrigin_-this.leftEdge_)&&this.totalEnergy_*this.graphFactor_<.2*(this.rightEdge_-this.graphOrigin_)&&(this.needRescale_=!0,this.megaMaxEnergy_=this.totalEnergy_,r.DEBUG&&this.printEverything("SMALL TOTAL ENERGY"))):this.totalEnergy_<-1e-12&&e&&(this.megaMaxEnergy_<0&&this.graphOrigin_<this.rightEdge_&&(this.needRescale_=!0,r.DEBUG&&this.printEverything("NEGATIVE TOTAL ENERGY")),this.megaMaxEnergy_=this.totalEnergy_),this.needRescale_){this.lastTime_=r.systemTime(),this.needRescale_=!1;let i=this.totalEnergy_>0?this.totalEnergy_:0;i-=this.megaMinEnergy_,i<1e-16&&(i=1),i*this.graphFactor_>t?this.graphFactor_=.75*t/i:this.graphFactor_=.95*t/i,r.assert(isFinite(this.graphFactor_)),this.megaMinEnergy_<-1e-12?this.graphOrigin_=this.leftEdge_+Math.floor(.5+this.graphFactor_*-this.megaMinEnergy_):this.graphOrigin_=this.leftEdge_;let s=Math.pow(10,Math.floor(Math.log(i)/Math.log(10))),n=i/s;n>=8?this.graphDelta_=2:n>=5?this.graphDelta_=1:n>=3?this.graphDelta_=.5:n>=2?this.graphDelta_=.4:this.graphDelta_=.2,this.graphDelta_*=s}}resizeRect(t){r.assert(r.isObject(this.visibleRect_));let e=this.rect_.isEmpty()?this.visibleRect_.getTop():this.rect_.getTop(),i=e-t;e>this.visibleRect_.getTop()||t>this.visibleRect_.getHeight()?(e=this.visibleRect_.getTop(),i=e-t):i<this.visibleRect_.getBottom()&&(i=this.visibleRect_.getBottom(),e=i+t),this.debug_&&r.DEBUG&&console.log("resizeRect visibleRect="+this.visibleRect_+" rect="+this.rect_+" top="+e+" bottom="+i),this.rect_=new S(this.visibleRect_.getLeft(),i,this.visibleRect_.getRight(),e),this.debug_&&r.DEBUG&&console.log("resizeRect new rect="+this.rect_),this.needRescale_=!0,this.needResize_=!1}setDragable(t){this.dragable_=t}setPosition(t){if(this.rect_.isEmpty())this.rect_=new S(-5,t.getY()-.5,5,t.getY()+.5);else{let e=this.rect_.getHeight()/2;this.rect_=new S(this.rect_.getLeft(),t.getY()-e,this.rect_.getRight(),t.getY()+e),this.debug_&&r.DEBUG&&console.log("setPosition "+this.rect_)}this.changed_=!0}setVisibleArea(t){this.visibleRect_=t,this.needResize_=!0,this.changed_=!0}setZIndex(t){this.zIndex=t??0,this.changed_=!0}timeCheck(t){let e=r.systemTime();return e-this.lastTime2_>1?(this.lastTime2_=e,++this.bufptr_>=this.history_.length&&(this.bufptr_=0),this.history_[this.bufptr_]=t):this.minEnergy_<this.history_[this.bufptr_]&&(this.history_[this.bufptr_]=t),e-this.lastTime_>this.BUFFER_?(this.lastTime_=e,!0):!1}};O.HEIGHT=10;O.LEFT_MARGIN=10;O.RIGHT_MARGIN=0;O.TOP_MARGIN=0;O.en={SHOW_ENERGY:"show energy",POTENTIAL_ENERGY:"potential",TRANSLATIONAL_ENERGY:"translational",KINETIC_ENERGY:"kinetic",ROTATIONAL_ENERGY:"rotational",TOTAL:"total"};O.de_strings={SHOW_ENERGY:"Energie anzeigen",POTENTIAL_ENERGY:"potenzielle",TRANSLATIONAL_ENERGY:"translation",KINETIC_ENERGY:"kinetische",ROTATIONAL_ENERGY:"rotation",TOTAL:"gesamt"};O.i18n=r.LOCALE==="de"?O.de_strings:O.en;r.defineGlobal("lab$graph$EnergyBarGraph",O);var Vt=class{constructor(t,e,i){this.name_=t,this.topElement_=e,this.controls_=i}toString(){return this.toStringShort().slice(0,-1)+", controls_: ["+this.controls_.map(t=>t.toStringShort())+"]}"}toStringShort(){return'GroupControl{name_: "'+this.name_+'", controls_.length: '+this.controls_.length+"}"}disconnect(){this.controls_.forEach(t=>t.disconnect())}getControls(){return Array.from(this.controls_)}getElement(){return this.topElement_}getParameter(){return null}setEnabled(t){this.controls_.forEach(e=>e.setEnabled(t))}};r.defineGlobal("lab$controls$GroupControl",Vt);var rt=class{constructor(){this.memorizables_=[],this.isMemorizing_=!1}toString(){return"ConcreteMemoList{memorizables_: ["+this.memorizables_.map(t=>t.toStringShort())+"]}"}toStringShort(){return"ConcreteMemoList{memorizables_.length: "+this.memorizables_.length+"}"}addMemo(t){if(this.isMemorizing_)throw"addMemo during memorize";this.memorizables_.includes(t)||this.memorizables_.push(t)}getMemos(){return Array.from(this.memorizables_)}memorize(){try{this.isMemorizing_=!0,this.memorizables_.forEach(t=>t.memorize())}finally{this.isMemorizing_=!1}}removeMemo(t){if(this.isMemorizing_)throw"removeMemo during memorize";r.remove(this.memorizables_,t)}};r.defineGlobal("lab$util$ConcreteMemoList",rt);var Ft=class{constructor(t,e){this.timeoutID_=void 0,this.callBack_=null,this.timerCallback_=()=>this.timerCallback(),this.period_=0,this.firing_=!1,this.fired_sys_=NaN,this.delta_=0,this.sysClock_=e||new Rt,this.legacy_=t||typeof requestAnimationFrame!="function"}toString(){return"Timer{period_: "+this.period_+", firing_: "+this.firing_+", timeoutID_: "+this.timeoutID_+", fired_sys_: "+r.nf7(this.fired_sys_)+", delta_: "+r.nf7(this.delta_)+"}"}timerCallback(){if(this.callBack_===null)return;let t=this.sysClock_.systemTime(),e=t-(this.fired_sys_-this.delta_);if(e>=this.period_&&(this.callBack_(),this.fired_sys_=t,this.delta_=this.period_>0?e%this.period_:0),this.legacy_){let i=this.period_>0?Math.round(this.period_*1e3):17;this.timeoutID_=this.sysClock_.scheduleCallback(this.timerCallback_,i)}else this.timeoutID_=this.sysClock_.requestAnimFrame(this.timerCallback_)}getLegacy(){return this.legacy_}getPeriod(){return this.period_}isFiring(){return this.firing_}setCallBack(t){this.stopFiring(),this.callBack_=t}setLegacy(t){t!==this.legacy_&&(this.stopFiring(),this.legacy_=t)}setPeriod(t){if(t<0)throw"";this.period_=t}startFiring(){this.firing_||(this.firing_=!0,this.delta_=0,this.fired_sys_=this.sysClock_.systemTime()-this.period_-1e-7,this.timerCallback())}stopFiring(){this.firing_=!1,this.timeoutID_!==void 0&&(this.legacy_?this.sysClock_.cancelCallback(this.timeoutID_):this.sysClock_.cancelAnimFrame(this.timeoutID_),this.timeoutID_=void 0),this.fired_sys_=NaN,this.delta_=0}};r.defineGlobal("lab$util$Timer",Ft);var M=class h extends T{constructor(t,e){super(e||"SIM_RUNNER"),this.appName_="",this.displayPeriod_=0,this.nonStop_=!1,this.canvasList_=[],this.memoList_=new rt,this.errorObservers_=[],this.frames_=0,this.advanceList_=[t],this.timeStep_=t.getTimeStep(),this.timer_=new Ft,this.timer_.setPeriod(this.displayPeriod_),this.timer_.setCallBack(()=>this.callback());let i=(e?e+"_":"")+"CLOCK";this.clock_=new A(i);let s=t.getTime();this.clock_.setTime(s),this.clock_.setRealTime(s),this.clock_.addObserver(this),this.addParameter(new y(this,h.en.TIME_STEP,h.i18n.TIME_STEP,()=>this.getTimeStep(),n=>this.setTimeStep(n)).setSignifDigits(3)),this.addParameter(new y(this,h.en.DISPLAY_PERIOD,h.i18n.DISPLAY_PERIOD,()=>this.getDisplayPeriod(),n=>this.setDisplayPeriod(n)).setSignifDigits(3)),this.addParameter(new N(this,h.en.RUNNING,h.i18n.RUNNING,()=>this.getRunning(),n=>this.setRunning(n))),this.addParameter(new N(this,h.en.FIRING,h.i18n.FIRING,()=>this.getFiring(),n=>this.setFiring(n))),this.addParameter(new N(this,h.en.NON_STOP,h.i18n.NON_STOP,()=>this.getNonStop(),n=>this.setNonStop(n)))}toString(){return this.toStringShort().slice(0,-1)+", advanceList_: ["+this.advanceList_.map(t=>t.toStringShort())+"], clock_: "+this.clock_.toStringShort()+", timer_: "+this.timer_+", timeStep_: "+r.NF(this.timeStep_)+", displayPeriod_: "+r.NF(this.displayPeriod_)+", nonStop_: "+this.nonStop_+", canvasList_: ["+this.canvasList_.map(t=>t.toStringShort())+"], memoList_: "+this.memoList_+super.toString()}getClassName(){return"SimRunner"}addCanvas(t){this.canvasList_.includes(t)||(this.canvasList_.push(t),this.addMemo(t))}addErrorObserver(t){this.errorObservers_.includes(t)||this.errorObservers_.push(t)}addMemo(t){this.memoList_.addMemo(t)}addStrategy(t){this.advanceList_.push(t)}advanceSims(t,e){let i=t.getTime();for(;i<e&&(t.advance(this.timeStep_,this),!!this.getRunning());){let s=i;if(i=t.getTime(),i-s<=1e-15)throw"SimRunner: time did not advance";if(e-i<this.timeStep_)break}}callback(){try{if(this.clock_.isRunning()||this.clock_.isStepping()){let t=this.clock_.getTime(),e=this.advanceList_[0].getTime();if(t>e+1||t<e-1){let s=e+this.timeStep_;this.clock_.setTime(s),this.clock_.setRealTime(s),t=s}let i=t;for(let s=0,n=this.advanceList_.length;s<n;s++)this.advanceSims(this.advanceList_[s],i);this.clock_.isStepping()?this.clock_.clearStepMode():(t=this.clock_.getTime(),e=this.advanceList_[0].getTime(),t-e>20*this.timeStep_&&this.clock_.setTime(e))}this.paintAll(),this.frames_++}catch(t){this.handleException(t)}}destroy(){this.stopFiring()}getCanvasList(){return Array.from(this.canvasList_)}getClock(){return this.clock_}getDisplayPeriod(){return this.displayPeriod_}getFiring(){return this.timer_.isFiring()}getFrameRate(){return this.frames_/this.clock_.getTime()}getMemos(){return this.memoList_.getMemos()}getNonStop(){return this.nonStop_}getRunning(){return this.clock_.isRunning()}getTimeStep(){return this.timeStep_}handleException(t){this.pause(),this.timer_.stopFiring(),this.errorObservers_.forEach(i=>i.notifyError(t));let e=t!=null?" "+t:"";alert(h.i18n.STUCK+e)}memorize(){this.memoList_.memorize()}observe(t){if(t.getSubject()==this.clock_)if(t.nameEquals(A.CLOCK_RESUME)||t.nameEquals(A.CLOCK_PAUSE)){let e=this.advanceList_[0].getTime();this.clock_.setTime(e),this.clock_.setRealTime(e),this.broadcastParameter(h.en.RUNNING)}else t.nameEquals(A.CLOCK_SET_TIME)&&this.memorize()}paintAll(){this.canvasList_.forEach(t=>t.paint())}pause(){return this.clock_.pause(),this.clock_.getTime()}playUntil(t){let e=new Tt(t,null);return e.setCallback(()=>{this.clock_.pause(),this.clock_.removeTask(e)}),this.clock_.addTask(e),this.resume()}removeCanvas(t){r.remove(this.canvasList_,t),this.removeMemo(t)}removeErrorObserver(t){r.remove(this.errorObservers_,t)}removeMemo(t){this.memoList_.removeMemo(t)}reset(){this.frames_=0,this.timer_.startFiring(),this.clock_.pause(),this.advanceList_.forEach(e=>e.reset());let t=this.advanceList_[0].getTime();return this.clock_.setTime(t),this.clock_.setRealTime(t),this.paintAll(),this.broadcast(new p(this,h.RESET)),this.clock_.getTime()}resume(){return this.timer_.startFiring(),this.clock_.resume(),this.clock_.getTime()}save(){return this.advanceList_.forEach(t=>t.save()),this.clock_.getTime()}setAppName(t){this.appName_=t}setDisplayPeriod(t){this.displayPeriod_=t,this.timer_.setPeriod(t),this.broadcastParameter(h.en.DISPLAY_PERIOD)}setFiring(t){t?this.startFiring():(this.paintAll(),this.stopFiring()),this.broadcastParameter(h.en.FIRING)}setNonStop(t){this.nonStop_=t,this.broadcastParameter(h.en.NON_STOP)}setRunning(t){t?this.resume():this.pause()}setTimeStep(t){this.timeStep_=t,this.broadcastParameter(h.en.TIME_STEP)}startFiring(){this.timer_.startFiring()}step(){let t=this.advanceList_[0].getTime()+this.timeStep_-this.clock_.getTime();return this.clock_.step(t),this.timer_.startFiring(),this.clock_.getTime()}stopFiring(){this.nonStop_||this.timer_.stopFiring()}};M.RESET="RESET";M.en={TIME_STEP:"time step",DISPLAY_PERIOD:"display period",RESTART:"restart",RUNNING:"running",FIRING:"firing",PAUSE:"pause",RESUME:"resume",NON_STOP:"non-stop",STEP:"step",STUCK:"Simulation is stuck; click reset and play to continue."};M.de_strings={TIME_STEP:"Zeitschritt",DISPLAY_PERIOD:"Bilddauer",RESTART:"Neustart",RUNNING:"laufend",FIRING:"t\xE4tigend",PAUSE:"pausieren",RESUME:"weiter",NON_STOP:"durchgehend",STEP:"kleine Schritte",STUCK:"Simulation hat sich aufgeh\xE4ngt; dr\xFCcken Sie Neustart und Weiter um fort zu fahren."};M.i18n=r.LOCALE==="de"?M.de_strings:M.en;r.defineGlobal("lab$app$SimRunner",M);var q=class h{constructor(t,e,i,s,n,a){this.m11_=t,this.m12_=e,this.m21_=i,this.m22_=s,this.dx_=n,this.dy_=a}toString(){return"AffineTransform{m11_: "+r.NF(this.m11_)+", m12_: "+r.NF(this.m12_)+", m21_: "+r.NF(this.m21_)+", m22_: "+r.NF(this.m22_)+", dx_: "+r.NF(this.dx_)+", dy_: "+r.NF(this.dy_)+"}"}applyTransform(t){t.transform(this.m11_,this.m12_,this.m21_,this.m22_,this.dx_,this.dy_)}concatenate(t){let e=this.m11_*t.m11_+this.m21_*t.m12_,i=this.m12_*t.m11_+this.m22_*t.m12_,s=this.m11_*t.m21_+this.m21_*t.m22_,n=this.m12_*t.m21_+this.m22_*t.m22_,a=this.m11_*t.dx_+this.m21_*t.dy_+this.dx_,o=this.m12_*t.dx_+this.m22_*t.dy_+this.dy_;return new h(e,i,s,n,a,o)}lineTo(t,e,i){let s=this.transform(t,e);i.lineTo(s.getX(),s.getY())}moveTo(t,e,i){let s=this.transform(t,e);i.moveTo(s.getX(),s.getY())}rotate(t){let e=Math.cos(t),i=Math.sin(t),s=e*this.m11_+i*this.m21_,n=e*this.m12_+i*this.m22_,a=-i*this.m11_+e*this.m21_,o=-i*this.m12_+e*this.m22_;return new h(s,n,a,o,this.dx_,this.dy_)}scale(t,e){let i=this.m11_*t,s=this.m12_*t,n=this.m21_*e,a=this.m22_*e;return new h(i,s,n,a,this.dx_,this.dy_)}setTransform(t){t.setTransform(this.m11_,this.m12_,this.m21_,this.m22_,this.dx_,this.dy_)}transform(t,e){let i,s;if(typeof t=="number")i=t,s=e;else{let o=t;s=o.getY(),i=o.getX()}if(typeof i!="number"||typeof s!="number")throw"need a Vector or two numbers";let n=this.m11_*i+this.m21_*s+this.dx_,a=this.m12_*i+this.m22_*s+this.dy_;return new u(n,a)}translate(t,e){let i,s;if(typeof t=="number")i=t,s=e;else{let o=t;s=o.getY(),i=o.getX()}if(typeof i!="number"||typeof s!="number")throw"need a Vector or two numbers";let n=this.dx_+this.m11_*i+this.m21_*s,a=this.dy_+this.m12_*i+this.m22_*s;return new h(this.m11_,this.m12_,this.m21_,this.m22_,n,a)}};q.IDENTITY=new q(1,0,0,1,0,0);r.defineGlobal("lab$util$AffineTransform",q);var F=class h{constructor(t,e,i,s){if(typeof t!="number"||typeof e!="number"||typeof i!="number"||typeof s!="number"||i<0||s<0)throw"";this.left_=t,this.top_=e,this.width_=i,this.height_=s}toString(){return"ScreenRect{left_: "+r.NF(this.left_)+", top_: "+r.NF(this.top_)+", width_: "+r.NF(this.width_)+", height_: "+r.NF(this.height_)+"}"}static clone(t){return new h(t.left_,t.top_,t.width_,t.height_)}equals(t){return this.left_==t.left_&&this.top_==t.top_&&this.width_==t.width_&&this.height_==t.height_}getCenterX(){return this.left_+this.width_/2}getCenterY(){return this.top_+this.height_/2}getHeight(){return this.height_}getLeft(){return this.left_}getTop(){return this.top_}getWidth(){return this.width_}isEmpty(t){let e=t||1e-14;return this.width_<e||this.height_<e}makeOval(t){let e=this.width_/2,i=this.height_/2;if(typeof t.ellipse=="function")t.beginPath(),t.moveTo(this.left_+this.width_,this.top_+i),t.ellipse(this.left_+e,this.top_+i,e,i,0,0,2*Math.PI,!1);else{let s=Math.min(e,i);t.beginPath(),t.moveTo(this.left_+this.width_,this.top_),t.arc(this.left_+e,this.top_+i,s,0,2*Math.PI,!1),t.closePath()}}makeRect(t){t.rect(this.left_,this.top_,this.width_,this.height_)}nearEqual(t,e){return!(r.veryDifferent(this.left_,t.left_,e)||r.veryDifferent(this.top_,t.top_,e)||r.veryDifferent(this.width_,t.width_,e)||r.veryDifferent(this.height_,t.height_,e))}};F.EMPTY_RECT=new F(0,0,0,0);r.defineGlobal("lab$view$ScreenRect",F);var dt=class h{constructor(t,e,i,s,n,a){this.screen_left_=r.testFinite(t),this.screen_bottom_=r.testFinite(e),this.sim_left_=r.testFinite(i),this.sim_bottom_=r.testFinite(s),this.pixel_per_unit_x_=r.testFinite(n),this.pixel_per_unit_y_=r.testFinite(a);let o=q.IDENTITY;o=o.translate(this.screen_left_,this.screen_bottom_),o=o.scale(this.pixel_per_unit_x_,-this.pixel_per_unit_y_),o=o.translate(-this.sim_left_,-this.sim_bottom_),this.transform_=o}toString(){return"CoordMap{screen_left_: "+r.NF(this.screen_left_)+", screen_bottom_: "+r.NF(this.screen_bottom_)+", sim_left_: "+r.NF(this.sim_left_)+", sim_bottom_: "+r.NF(this.sim_bottom_)+", pixels_per_unit_x_: "+r.NF(this.pixel_per_unit_x_)+", pixels_per_unit_y_: "+r.NF(this.pixel_per_unit_y_)+(this.transform_!=null?", transform: "+this.transform_:"")+"}"}static make(t,e,i,s,n){if(i=i||"MIDDLE",s=s||"MIDDLE",n=n||1,n<h.MIN_SIZE||!isFinite(n))throw"bad aspectRatio "+n;let a=e.getLeft(),o=e.getBottom(),l=e.getRight()-a,_=e.getTop()-o;if(l<h.MIN_SIZE||_<h.MIN_SIZE)throw"simRect cannot be empty "+e;let c=t.getTop(),g=t.getLeft(),d=t.getWidth(),m=t.getHeight(),f=0,b=0,C=0,v=0;if(i=="FULL"&&(C=d/l,f=0),s=="FULL"&&(v=m/_,b=0),i!="FULL"||s!="FULL"){let it;if(i=="FULL")v=C*n,it=!0;else if(s=="FULL")C=v/n,it=!1;else{C=d/l,v=C*n,it=!0;let X=Math.floor(.5+v*_);m<X&&(v=m/_,C=v/n,it=!1)}if(it){r.assert(s!="FULL"),f=0;let X=Math.floor(.5+_*v);switch(s){case"BOTTOM":b=0;break;case"MIDDLE":b=(m-X)/2;break;case"TOP":b=m-X;break;default:throw"unsupported alignment "+s}}else{r.assert(i!="FULL"),b=0;let X=Math.floor(.5+l*C);switch(i){case"LEFT":f=0;break;case"MIDDLE":f=(d-X)/2;break;case"RIGHT":f=d-X;break;default:throw"unsupported alignment "+i}}}return new h(g,c+m,a-f/C,o-b/v,C,v)}getAffineTransform(){return this.transform_}getScaleX(){return this.pixel_per_unit_x_}getScaleY(){return this.pixel_per_unit_y_}screenToSim(t,e){let i,s;if(typeof t=="number")i=t,s=e;else{let n=t;s=n.getY(),i=n.getX()}if(typeof i!="number"||typeof s!="number")throw"";return new u(this.screenToSimX(i),this.screenToSimY(s))}screenToSimRect(t){return new S(this.screenToSimX(t.getLeft()),this.screenToSimY(t.getTop()+t.getHeight()),this.screenToSimX(t.getLeft()+t.getWidth()),this.screenToSimY(t.getTop()))}screenToSimScaleX(t){return t/this.pixel_per_unit_x_}screenToSimScaleY(t){return t/this.pixel_per_unit_y_}screenToSimX(t){return this.sim_left_+(t-this.screen_left_)/this.pixel_per_unit_x_}screenToSimY(t){return this.sim_bottom_+(this.screen_bottom_-t)/this.pixel_per_unit_y_}simToScreen(t){return new u(this.simToScreenX(t.getX()),this.simToScreenY(t.getY()))}simToScreenRect(t){return new F(this.simToScreenX(t.getLeft()),this.simToScreenY(t.getTop()),this.simToScreenScaleX(t.getWidth()),this.simToScreenScaleY(t.getHeight()))}simToScreenScaleX(t){return t*this.pixel_per_unit_x_}simToScreenScaleY(t){return t*this.pixel_per_unit_y_}simToScreenX(t){return this.screen_left_+(t-this.sim_left_)*this.pixel_per_unit_x_}simToScreenY(t){return this.screen_bottom_-(t-this.sim_bottom_)*this.pixel_per_unit_y_}};dt.MIN_SIZE=1e-15;r.defineGlobal("lab$view$CoordMap",dt);function re(){return["LEFT","MIDDLE","RIGHT","FULL","VALUE"]}function _e(){return[Gt.LEFT,Gt.MIDDLE,Gt.RIGHT,Gt.FULL,Gt.VALUE]}var Se={LEFT:"left",MIDDLE:"middle",RIGHT:"right",FULL:"full",VALUE:"value"},Ee={LEFT:"links",MIDDLE:"mitte",RIGHT:"rechts",FULL:"voll",VALUE:"Wert"},Gt=r.LOCALE==="de"?Ee:Se;function ne(){return["TOP","MIDDLE","BOTTOM","FULL","VALUE"]}function ce(){return[Ht.TOP,Ht.MIDDLE,Ht.BOTTOM,Ht.FULL,Ht.VALUE]}var be={TOP:"top",MIDDLE:"middle",BOTTOM:"bottom",FULL:"full",VALUE:"value"},ye={TOP:"oben",MIDDLE:"mitte",BOTTOM:"unten",FULL:"voll",VALUE:"Wert"},Ht=r.LOCALE==="de"?ye:be;var U=class h{constructor(t,e){this.expireTime_=1/0,this.changed_=!0;let i=t||"SIM_OBJ"+h.ID++;this.name_=r.validName(r.toName(i)),this.localName_=e||i}toString(){return this.getClassName()+'{name_: "'+this.getName()+'", expireTime_: '+r.NF(this.expireTime_)+"}"}toStringShort(){return this.getClassName()+'{name_: "'+this.getName()+'"}'}getChanged(){return this.changed_?(this.changed_=!1,!0):!1}getExpireTime(){return this.expireTime_}getName(t){return t?this.localName_:this.name_}isMassObject(){return!1}nameEquals(t){return this.name_==r.toName(t)}setChanged(){this.changed_=!0}setExpireTime(t){this.expireTime_=t}similar(t,e){return t==this}};U.ID=1;r.defineGlobal("lab$model$AbstractSimObject",U);var Bt=class extends U{constructor(t,e){super(t,e),this.mass_=1,this.loc_world_=u.ORIGIN,this.angle_=0,this.sinAngle_=0,this.cosAngle_=1,this.velocity_=u.ORIGIN,this.angular_velocity_=0,this.cm_body_=u.ORIGIN,this.zeroEnergyLevel_=null,this.dragPts_=[u.ORIGIN],this.moment_=0,this.minHeight_=NaN}toString(){return super.toString().slice(0,-1)+", mass_: "+r.NF(this.mass_)+", loc_world_: "+this.loc_world_+", angle_: "+this.angle_+", velocity_: "+this.velocity_+", angular_velocity_: "+r.NF(this.angular_velocity_)+", cm_body_: "+this.cm_body_+", zeroEnergyLevel_: "+r.NF(this.zeroEnergyLevel_)+", moment_: "+r.NF(this.moment_)+", dragPts_: ["+this.dragPts_.map(t=>t.toString())+"]}"}alignTo(t,e,i){let s=i===void 0?this.angle_:i,n=t.getX()-this.cm_body_.getX(),a=t.getY()-this.cm_body_.getY(),o=Math.sin(s),l=Math.cos(s);this.setPosition(new u(e.getX()-(n*l-a*o),e.getY()-(n*o+a*l)),s)}bodyToWorld(t){let e=t.getX()-this.cm_body_.getX(),i=t.getY()-this.cm_body_.getY(),s=this.loc_world_.getX()+(e*this.cosAngle_-i*this.sinAngle_),n=this.loc_world_.getY()+(e*this.sinAngle_+i*this.cosAngle_);return new u(s,n)}bodyToWorldTransform(){let t=new q(1,0,0,1,this.loc_world_.getX(),this.loc_world_.getY());return t=t.rotate(this.angle_),t.translate(-this.cm_body_.getX(),-this.cm_body_.getY())}getAngle(){return this.angle_}getAngularVelocity(){return this.angular_velocity_}getBottomWorld(){let t=1/0;return this.getVerticesBody().forEach(e=>{let i=this.bodyToWorld(e);i.getY()<t&&(t=i.getY())}),t}getBoundsBody(){return new S(this.getLeftBody(),this.getBottomBody(),this.getRightBody(),this.getTopBody())}getBoundsWorld(){return new S(this.getLeftWorld(),this.getBottomWorld(),this.getRightWorld(),this.getTopWorld())}getCenterOfMass(){return this.cm_body_}getCentroidWorld(){return this.bodyToWorld(this.getCentroidBody())}getDragPoints(){return Array.from(this.dragPts_)}getHeight(){return this.getTopBody()-this.getBottomBody()}getKineticEnergy(){return this.translationalEnergy()+this.rotationalEnergy()}getLeftWorld(){let t=1/0;return this.getVerticesBody().forEach(e=>{let i=this.bodyToWorld(e);i.getX()<t&&(t=i.getX())}),t}getMass(){return this.mass_}getPosition(){return this.loc_world_}getRightWorld(){let t=Number.NEGATIVE_INFINITY;return this.getVerticesBody().forEach(e=>{let i=this.bodyToWorld(e);i.getX()>t&&(t=i.getX())}),t}getTopWorld(){let t=Number.NEGATIVE_INFINITY;return this.getVerticesBody().forEach(e=>{let i=this.bodyToWorld(e);i.getY()>t&&(t=i.getY())}),t}getWidth(){return this.getRightBody()-this.getLeftBody()}getVelocity(t){if(t!==void 0){let e=this.rotateBodyToWorld(u.clone(t).subtract(this.cm_body_));return new u(this.velocity_.getX()-e.getY()*this.angular_velocity_,this.velocity_.getY()+e.getX()*this.angular_velocity_)}else return this.velocity_}getZeroEnergyLevel(){return this.zeroEnergyLevel_}isMassObject(){return!0}momentAboutCM(){return this.mass_*this.moment_}momentum(){let t=new Array(3);return t[0]=this.mass_*this.velocity_.getX(),t[1]=this.mass_*this.velocity_.getY(),t[2]=this.momentAboutCM()*this.angular_velocity_+this.mass_*(this.loc_world_.getX()*this.velocity_.getY()-this.loc_world_.getY()*this.velocity_.getX()),t}rotateBodyToWorld(t){return u.clone(t).rotate(this.cosAngle_,this.sinAngle_)}rotateWorldToBody(t){return u.clone(t).rotate(this.cosAngle_,-this.sinAngle_)}rotationalEnergy(){return .5*this.momentAboutCM()*this.angular_velocity_*this.angular_velocity_}setAngle(t){this.setPosition(this.loc_world_,t)}setAngularVelocity(t){if(!isFinite(t))throw"angular velocity must be finite "+t;this.angular_velocity_=t,this.setChanged()}setCenterOfMass(t){this.cm_body_=u.clone(t),this.minHeight_=NaN,this.setChanged()}setDragPoints(t){this.dragPts_=t.map(e=>u.clone(e)),this.setChanged()}setMass(t){if(t<=0||typeof t!="number")throw"mass must be positive "+t;this.mass_=t,this.setChanged()}setMinHeight(t){this.minHeight_=t}setMomentAboutCM(t){this.moment_=t,this.setChanged()}setPosition(t,e){this.loc_world_=u.clone(t),e!==void 0&&this.angle_!=e&&(this.angle_=e,this.sinAngle_=Math.sin(e),this.cosAngle_=Math.cos(e)),this.setChanged()}setPositionX(t){this.setPosition(new u(t,this.loc_world_.getY()))}setPositionY(t){this.setPosition(new u(this.loc_world_.getX(),t))}setVelocity(t,e){this.velocity_=u.clone(t),e!==void 0&&this.setAngularVelocity(e),this.setChanged()}setVelocityX(t){this.setVelocity(new u(t,this.velocity_.getY()))}setVelocityY(t){this.setVelocity(new u(this.velocity_.getX(),t))}setZeroEnergyLevel(t){this.zeroEnergyLevel_=t??this.loc_world_.getY(),this.setChanged()}translationalEnergy(){return .5*this.mass_*this.velocity_.lengthSquared()}worldToBody(t){let e=t.getX()-this.loc_world_.getX(),i=t.getY()-this.loc_world_.getY(),s=-this.sinAngle_,n=this.cosAngle_,a=this.cm_body_.getX()+(e*n-i*s),o=this.cm_body_.getY()+(e*s+i*n);return new u(a,o)}};r.defineGlobal("lab$model$AbstractMassObject",Bt);var wt;(function(h){h[h.RECTANGLE=0]="RECTANGLE",h[h.OVAL=1]="OVAL"})(wt||(wt={}));var x=class h extends Bt{constructor(t,e){let i,s;if(t===void 0||t==""){let n=h.ID++;i=h.en.POINT_MASS+n,s=h.i18n.POINT_MASS+n}else i=t,s=e||i;super(i,s),this.shape_=wt.OVAL,this.width_=1,this.height_=1,this.mass_=1}toString(){return super.toString().slice(0,-1)+", shape_: "+this.shape_+", width_: "+r.NF(this.width_)+", height_: "+r.NF(this.height_)+"}"}getClassName(){return"PointMass"}static makeCircle(t,e,i){let s=new h(e,i);return s.setWidth(t),s.setHeight(t),s}static makeOval(t,e,i,s){let n=new h(i,s);return n.setWidth(t),n.setHeight(e),n}static makeSquare(t,e,i){let s=new h(e,i);return s.setWidth(t),s.setHeight(t),s.setShape(wt.RECTANGLE),s}static makeRectangle(t,e,i,s){let n=new h(i,s);return n.setWidth(t),n.setHeight(e),n.setShape(wt.RECTANGLE),n}createCanvasPath(t){t.beginPath();let e=this.height_/2,i=this.width_/2;if(this.shape_==wt.RECTANGLE)t.rect(-i,-e,this.width_,this.height_);else if(this.shape_==wt.OVAL)if(typeof t.ellipse=="function")t.moveTo(i,0),t.ellipse(0,0,i,e,0,0,2*Math.PI,!1);else{let s=Math.min(i,e);t.arc(0,0,s,0,2*Math.PI,!1),t.closePath()}else throw""}getBottomBody(){return-this.height_/2}getCentroidBody(){return u.ORIGIN}getCentroidRadius(){let t=this.width_/2,e=this.height_/2;return Math.sqrt(t*t+e*e)}getLeftBody(){return-this.width_/2}getMinHeight(){if(isNaN(this.minHeight_)){let t=this.cm_body_.getX(),e=this.cm_body_.getY(),i=e-this.getBottomBody(),s=t-this.getLeftBody();s<i&&(i=s),s=this.getTopBody()-e,s<i&&(i=s),s=this.getRightBody()-t,s<i&&(i=s),this.minHeight_=i}return this.minHeight_}getRightBody(){return this.width_/2}getShape(){return this.shape_}getTopBody(){return this.height_/2}getVerticesBody(){let t=this.width_/2,e=this.height_/2;return[new u(-t,-e),new u(t,-e),new u(t,e),new u(-t,e)]}setHeight(t){this.height_=t,this.setChanged()}setShape(t){this.shape_=t,this.setChanged()}setWidth(t){this.width_=t,this.setChanged()}similar(t,e){if(!(t instanceof h))return!1;let i=t;return!(!i.loc_world_.nearEqual(this.loc_world_,e)||r.veryDifferent(i.width_,this.width_,e)||r.veryDifferent(i.height_,this.height_,e)||i.shape_!=this.shape_)}};x.en={POINT_MASS:"PointMass"};x.de_strings={POINT_MASS:"Punktmasse"};x.i18n=r.LOCALE==="de"?x.de_strings:x.en;r.defineGlobal("lab$model$PointMass",x);var nt=class{constructor(t,e){this.isDarkColor_=!1,this.changed_=!0,this.massObject_=t??new x("proto"),this.proto_=e??null,this.dragable_=isFinite(this.massObject_.getMass())&&this.massObject_.getDragPoints().length>0,this.lastColor_=this.getFillStyle()}toString(){return this.toStringShort().slice(0,-1)+", dragable_: "+this.dragable_+', fillStyle: "'+this.getFillStyle()+'", strokeStyle: "'+this.getStrokeStyle()+'", thickness: '+r.NF(this.getThickness())+", drawDragPoints: "+this.getDrawDragPoints()+", drawCenterOfMass: "+this.getDrawCenterOfMass()+', nameFont: "'+this.getNameFont()+'", nameColor: "'+this.getNameColor()+'", nameRotate: '+r.NF(this.getNameRotate())+", zIndex: "+this.getZIndex()+", proto: "+(this.proto_!=null?this.proto_.toStringShort():"null")+"}"}toStringShort(){return"DisplayShape{massObject_: "+this.massObject_.toStringShort()+"}"}contains(t){let e=this.massObject_.worldToBody(t);return this.massObject_.getBoundsBody().contains(e)}draw(t,e){t.save();let i=e.getAffineTransform(),s=1/e.getScaleX(),n=i.concatenate(this.massObject_.bodyToWorldTransform());n.setTransform(t),this.massObject_.createCanvasPath(t),this.getImageClip()&&t.clip();let a=this.getFillStyle();a&&(t.fillStyle=a,t.fill());let o=this.getStrokeStyle();if(o){t.lineWidth=e.screenToSimScaleX(this.getThickness());let c=this.getBorderDash();if(c.length>0&&typeof t.setLineDash=="function"){let g=c.map(d=>e.screenToSimScaleX(d));t.setLineDash(g)}t.strokeStyle=o,t.stroke(),t.setLineDash([])}let l=this.getImage(),_=this.getImageDraw();if((l!=null||_!=null)&&(t.translate(this.massObject_.getLeftBody(),this.massObject_.getTopBody()),t.scale(s,-s),this.getImageAT().applyTransform(t),l!=null&&t.drawImage(l,0,0),_?.(t)),this.massObject_.getMass()!=1/0){n.setTransform(t),this.lastColor_!==a&&(this.lastColor_=a);let c=e.screenToSimScaleX(1);if(t.lineWidth=c,this.getDrawCenterOfMass()){let g=this.massObject_.getCenterOfMass();this.isDarkColor_?t.strokeStyle="#ccc":t.strokeStyle="black";let d=.2*Math.min(this.massObject_.getWidth(),this.massObject_.getHeight()),m=8*c;d>m&&(d=m),t.beginPath(),t.moveTo(g.getX()-d,g.getY()),t.lineTo(g.getX()+d,g.getY()),t.stroke(),t.beginPath(),t.moveTo(g.getX(),g.getY()-d),t.lineTo(g.getX(),g.getY()+d),t.stroke()}if(this.getDrawDragPoints()){let g=4*c,d=.15*Math.min(this.massObject_.getWidth(),this.massObject_.getHeight());d<g&&(g=d),this.massObject_.getDragPoints().forEach(m=>{this.isDarkColor_?t.fillStyle="#ccc":t.fillStyle="gray",t.beginPath(),t.arc(m.getX(),m.getY(),g,0,2*Math.PI,!1),t.closePath(),t.fill()})}}if(this.getNameFont()){let c=this.massObject_.getCentroidBody(),g=n.translate(c),d=this.getNameRotate();d&&(g=g.rotate(d)),g=g.scale(s,-s),g.setTransform(t),t.fillStyle=this.getNameColor(),t.font=this.getNameFont(),t.textAlign="center";let m=this.massObject_.getName(!0),f=t.measureText("M").width;t.fillText(m,0,f/2)}t.restore()}getBorderDash(){return this.borderDash_!==void 0?this.borderDash_:this.proto_!=null?this.proto_.getBorderDash():[]}getChanged(){return this.massObject_.getChanged()||this.changed_?(this.changed_=!1,!0):!1}getDrawCenterOfMass(){return this.drawCenterOfMass_!==void 0?this.drawCenterOfMass_:this.proto_!=null?this.proto_.getDrawCenterOfMass():!1}getDrawDragPoints(){return this.drawDragPoints_!==void 0?this.drawDragPoints_:this.proto_!=null?this.proto_.getDrawDragPoints():!1}getFillStyle(){return this.fillStyle_!==void 0?this.fillStyle_:this.proto_!=null?this.proto_.getFillStyle():"lightGray"}getImage(){return this.image_!==void 0?this.image_:this.proto_!=null?this.proto_.getImage():null}getImageAT(){return this.imageAT_!==void 0?this.imageAT_:this.proto_!=null?this.proto_.getImageAT():q.IDENTITY}getImageClip(){return this.imageClip_!==void 0?this.imageClip_:this.proto_!=null?this.proto_.getImageClip():!1}getImageDraw(){return this.imageDraw_!==void 0?this.imageDraw_:this.proto_!=null?this.proto_.getImageDraw():null}getMassObjects(){return[this.massObject_]}getNameColor(){return this.nameColor_!==void 0?this.nameColor_:this.proto_!=null?this.proto_.getNameColor():"black"}getNameFont(){return this.nameFont_!==void 0?this.nameFont_:this.proto_!=null?this.proto_.getNameFont():""}getNameRotate(){return this.nameRotate_!==void 0?this.nameRotate_:this.proto_!=null?this.proto_.getNameRotate():0}getPosition(){return this.massObject_.getPosition()}getPrototype(){return this.proto_}getSimObjects(){return[this.massObject_]}getStrokeStyle(){return this.strokeStyle_!==void 0?this.strokeStyle_:this.proto_!=null?this.proto_.getStrokeStyle():""}getThickness(){return this.thickness_!==void 0?this.thickness_:this.proto_!=null?this.proto_.getThickness():1}getZIndex(){return this.zIndex_!==void 0?this.zIndex_:this.proto_!=null?this.proto_.getZIndex():0}isDragable(){return this.dragable_}setBorderDash(t){this.borderDash_=t,this.changed_=!0}setDragable(t){this.dragable_=t}setDrawCenterOfMass(t){this.drawCenterOfMass_=t,this.changed_=!0}setDrawDragPoints(t){this.drawDragPoints_=t,this.changed_=!0}setFillStyle(t){this.fillStyle_=t,this.changed_=!0}setImage(t){this.image_=t,this.changed_=!0}setImageAT(t){this.imageAT_=t,this.changed_=!0}setImageClip(t){this.imageClip_=t,this.changed_=!0}setImageDraw(t){this.imageDraw_=t,this.changed_=!0}setNameColor(t){this.nameColor_=t,this.changed_=!0}setNameFont(t){this.nameFont_=t,this.changed_=!0}setNameRotate(t){this.nameRotate_=t,this.changed_=!0}setPosition(t){this.massObject_.setPosition(t),this.changed_=!0}setPrototype(t){this.proto_=t}setStrokeStyle(t){this.strokeStyle_=t,this.changed_=!0}setThickness(t){this.thickness_=t,this.changed_=!0}setZIndex(t){this.zIndex_=t,this.changed_=!0}};r.defineGlobal("lab$view$DisplayShape",nt);var ht=class h{constructor(t,e){this.changed_=!0,this.spring_=t??null,this.proto_=e??null}toString(){return this.toStringShort().slice(0,-1)+", width: "+r.NF(this.getWidth())+', colorCompressed: "'+this.getColorCompressed()+'", colorExpanded: "'+this.getColorExpanded()+'", thickness: '+r.NF(this.getThickness())+", drawMode: "+this.getDrawMode()+", zIndex: "+this.getZIndex()+"}"}toStringShort(){return"DisplaySpring{spring_: "+(this.spring_!=null?this.spring_.toStringShort():"null")+"}"}contains(t){return!1}draw(t,e){if(this.spring_==null)return;let i=this.spring_.getLength();if(!(i<1e-6||this.spring_.getStiffness()==0)){if(t.save(),t.lineWidth=this.getThickness(),i<this.spring_.getRestLength()-1e-5?t.strokeStyle=this.getColorCompressed():t.strokeStyle=this.getColorExpanded(),this.getDrawMode()===h.JAGGED){let s=e.getAffineTransform(),n=this.spring_.getStartPoint(),a=this.spring_.getEndPoint();s=s.translate(n.getX(),n.getY());let o=Math.atan2(a.getY()-n.getY(),a.getX()-n.getX());s=s.rotate(o),s=s.scale(i/h.pathLength,this.getWidth()/.5),h.drawSpring(t,s)}else{let s=e.simToScreen(this.spring_.getStartPoint()),n=e.simToScreen(this.spring_.getEndPoint());t.beginPath(),t.moveTo(s.getX(),s.getY()),t.lineTo(n.getX(),n.getY()),t.stroke()}t.restore()}}static drawSpring(t,e){let i=h.pathLength,s=h.pathWidth/2,n=i/16;t.beginPath(),e.moveTo(0,0,t),e.lineTo(n,0,t),e.lineTo(2*n,s,t);for(let a=1;a<=3;a++)e.lineTo(4*a*n,-s,t),e.lineTo((4*a+2)*n,s,t);e.lineTo(15*n,0,t),e.lineTo(i,0,t),t.stroke()}getChanged(){return(this.spring_==null?!1:this.spring_.getChanged())||this.changed_?(this.changed_=!1,!0):!1}getColorCompressed(){return this.colorCompressed_!==void 0?this.colorCompressed_:this.proto_!=null?this.proto_.getColorCompressed():"red"}getColorExpanded(){return this.colorExpanded_!==void 0?this.colorExpanded_:this.proto_!=null?this.proto_.getColorExpanded():"green"}getDrawMode(){return this.drawMode_!==void 0?this.drawMode_:this.proto_!=null?this.proto_.getDrawMode():h.JAGGED}getMassObjects(){return[]}getPosition(){return this.spring_==null?u.ORIGIN:this.spring_.getStartPoint().add(this.spring_.getEndPoint()).multiply(.5)}getPrototype(){return this.proto_}getSimObjects(){return this.spring_==null?[]:[this.spring_]}getThickness(){return this.thickness_!==void 0?this.thickness_:this.proto_!=null?this.proto_.getThickness():4}getWidth(){return this.width_!==void 0?this.width_:this.proto_!=null?this.proto_.getWidth():.5}getZIndex(){return this.zIndex_!==void 0?this.zIndex_:this.proto_!=null?this.proto_.getZIndex():0}isDragable(){return!1}setColorCompressed(t){return this.colorCompressed_=t,this.changed_=!0,this}setColorExpanded(t){return this.colorExpanded_=t,this.changed_=!0,this}setDragable(t){}setDrawMode(t){return this.drawMode_=t,this.changed_=!0,this}setPosition(t){}setPrototype(t){return this.proto_=t,this}setThickness(t){return this.thickness_=t,this.changed_=!0,this}setWidth(t){return this.width_=t,this.changed_=!0,this}setZIndex(t){this.zIndex_=t,this.changed_=!0}};ht.JAGGED=1;ht.STRAIGHT=2;ht.pathLength=6;ht.pathWidth=.5;r.defineGlobal("lab$view$DisplaySpring",ht);var mt=class h extends T{constructor(t){super(t||"DISPLAY_LIST_"+h.NAME_ID++),this.drawables_=[],this.changed_=!0}toString(){return this.toStringShort().slice(0,-1)+", drawables_: ["+this.drawables_.map((t,e)=>e+": "+t.toStringShort())+"]"+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", drawables_.length: "+this.drawables_.length+"}"}getClassName(){return"DisplayList"}add(...t){t.forEach(e=>{if(!r.isObject(e))throw"non-object: "+e;let i=e.getZIndex();r.DEBUG&&this.preExist(e),this.sort();let s=this.drawables_.findIndex(n=>i<n.getZIndex());s=s<0?this.drawables_.length:s,this.drawables_.splice(s,0,e),this.changed_=!0,this.broadcast(new p(this,h.OBJECT_ADDED,e))})}contains(t){if(!r.isObject(t))throw"non-object passed to DisplayList.contains";return this.drawables_.includes(t)}draw(t,e){this.sort(),this.drawables_.forEach(i=>i.draw(t,e))}find(t){if(typeof t=="number"){let e=t,i=this.drawables_.length;return e<0||e>=i?void 0:(this.sort(),this.drawables_[e])}else if(typeof t=="string"){let e=r.toName(t);return this.drawables_.find(i=>{let s=i.getSimObjects();for(let n=0,a=s.length;n<a;n++)if(s[n].getName()==e)return!0;return!1})}else return r.isObject(t)?this.drawables_.find(e=>e.getSimObjects().some(s=>s===t)):void 0}findShape(t){let e=this.find(t);if(e instanceof nt)return e;throw"DisplayShape not found: "+t}findSpring(t){let e=this.find(t);if(e instanceof ht)return e;throw"DisplaySpring not found: "+t}get(t){let e=this.drawables_.length;if(t<0||t>=e)throw t+" is not in range 0 to "+(e-1);return this.sort(),this.drawables_[t]}getChanged(){let t=!1;for(let e=0,i=this.drawables_.length;e<i;e++){let s=this.drawables_[e].getChanged();t=t||s}return t||this.changed_?(this.changed_=!1,!0):!1}length(){return this.drawables_.length}preExist(t){if(r.DEBUG){let e=t.getSimObjects();for(let i=0,s=e.length;i<s;i++){let n=e[i],a=this.find(n);if(a!=null)throw console.log("*** WARNING PRE-EXISTING DISPLAYOBJECT "+a),console.log("*** FOR SIMOBJECT="+n),console.log("*** WHILE ADDING "+t),"pre-existing object "+a+" for "+n+" adding "+t}}}prepend(t){if(!r.isObject(t))throw"non-object passed to DisplayList.add";let e=t.getZIndex();r.DEBUG&&this.preExist(t),this.sort();let i=this.drawables_.length,s;for(s=i;s>0;s--){let n=this.drawables_[s-1].getZIndex();if(e>n)break}this.drawables_.splice(s,0,t),this.changed_=!0,this.broadcast(new p(this,h.OBJECT_ADDED,t))}remove(t){if(!r.isObject(t))throw"non-object passed to DisplayList.remove";let e=this.drawables_.indexOf(t);e>-1&&(this.drawables_.splice(e,1),this.changed_=!0,this.broadcast(new p(this,h.OBJECT_REMOVED,t)))}removeAll(){r.forEachRight(this.drawables_,t=>this.remove(t),this)}sort(){let t=!0,e=Number.NEGATIVE_INFINITY;for(let i=0,s=this.drawables_.length;i<s;i++){let n=this.drawables_[i].getZIndex();if(n<e){t=!1;break}e=n}t||(this.drawables_.sort(function(i,s){let n=i.getZIndex(),a=s.getZIndex();return n<a?-1:n>a?1:0}),this.changed_=!0)}toArray(){return this.sort(),Array.from(this.drawables_)}};mt.OBJECT_ADDED="OBJECT_ADDED";mt.OBJECT_REMOVED="OBJECT_REMOVED";mt.NAME_ID=1;r.defineGlobal("lab$view$DisplayList",mt);var w=class h extends T{constructor(t,e){if(super(t),this.panY=.05,this.panX=.05,this.zoom=1.1,this.screenRect_=new F(0,0,800,600),this.horizAlign_="MIDDLE",this.verticalAlign_="MIDDLE",this.aspectRatio_=1,this.displayList_=new mt,this.scaleTogether_=!0,this.opaqueness=1,this.changed_=!0,this.memoList_=new rt,!(e instanceof S))throw"not a DoubleRect "+e;if(e.isEmpty())throw"empty DoubleRect "+e;this.simRect_=e,this.coordMap_=dt.make(this.screenRect_,this.simRect_,this.horizAlign_,this.verticalAlign_,this.aspectRatio_),this.width_=e.getWidth(),this.height_=e.getHeight(),this.centerX_=e.getCenterX(),this.centerY_=e.getCenterY(),this.ratio_=this.height_/this.width_,this.addParameter(new y(this,h.en.WIDTH,h.i18n.WIDTH,()=>this.getWidth(),i=>this.setWidth(i))),this.addParameter(new y(this,h.en.HEIGHT,h.i18n.HEIGHT,()=>this.getHeight(),i=>this.setHeight(i))),this.addParameter(new y(this,h.en.CENTER_X,h.i18n.CENTER_X,()=>this.getCenterX(),i=>this.setCenterX(i)).setLowerLimit(Number.NEGATIVE_INFINITY)),this.addParameter(new y(this,h.en.CENTER_Y,h.i18n.CENTER_Y,()=>this.getCenterY(),i=>this.setCenterY(i)).setLowerLimit(Number.NEGATIVE_INFINITY)),this.addParameter(new N(this,h.en.SCALE_TOGETHER,h.i18n.SCALE_TOGETHER,()=>this.getScaleTogether(),i=>this.setScaleTogether(i))),this.addParameter(new I(this,h.en.VERTICAL_ALIGN,h.i18n.VERTICAL_ALIGN,()=>this.getVerticalAlign(),i=>this.setVerticalAlign(i),ce(),ne())),this.addParameter(new I(this,h.en.HORIZONTAL_ALIGN,h.i18n.HORIZONTAL_ALIGN,()=>this.getHorizAlign(),i=>this.setHorizAlign(i),_e(),re())),this.addParameter(new y(this,h.en.ASPECT_RATIO,h.i18n.ASPECT_RATIO,()=>this.getAspectRatio(),i=>this.setAspectRatio(i)))}toString(){return this.toStringShort().slice(0,-1)+", simRect_: "+this.simRect_+", screenRect_: "+this.screenRect_+", horizAlign_: "+this.horizAlign_+", verticalAlign_: "+this.verticalAlign_+", aspectRatio_: "+r.NF5(this.aspectRatio_)+", opaqueness: "+r.NF5(this.opaqueness)+", coordMap_: "+this.coordMap_+", memoList_: "+this.memoList_+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", displayList_: "+this.displayList_.toStringShort()+"}"}getClassName(){return"SimView"}addMemo(t){this.memoList_.addMemo(t)}gainFocus(){}getAspectRatio(){return this.aspectRatio_}getCenterX(){return this.centerX_}getCenterY(){return this.centerY_}getChanged(){return this.displayList_.getChanged()||this.changed_?(this.changed_=!1,!0):!1}getCoordMap(){return this.coordMap_}getDisplayList(){return this.displayList_}getHeight(){return this.height_}getHorizAlign(){return this.horizAlign_}getMemos(){return this.memoList_.getMemos()}getScaleTogether(){return this.scaleTogether_}getScreenRect(){return this.screenRect_}getSimRect(){return this.simRect_}getVerticalAlign(){return this.verticalAlign_}getWidth(){return this.width_}loseFocus(){}memorize(){this.memoList_.memorize()}modifySimRect(){let t=this.centerX_-this.width_/2,e=this.centerY_-this.height_/2,i=new S(t,e,t+this.width_,e+this.height_);this.changed_=!0,this.setSimRect(i)}paint(t){t.save(),t.globalAlpha=this.opaqueness,this.displayList_.draw(t,this.coordMap_),t.restore()}panDown(){this.setCenterY(this.centerY_-this.panY*this.height_)}panLeft(){this.setCenterX(this.centerX_-this.panX*this.width_)}panRight(){this.setCenterX(this.centerX_+this.panX*this.width_)}panUp(){this.setCenterY(this.centerY_+this.panY*this.height_)}realign(){this.setCoordMap(dt.make(this.screenRect_,this.simRect_,this.horizAlign_,this.verticalAlign_,this.aspectRatio_)),this.width_=this.simRect_.getWidth(),this.height_=this.simRect_.getHeight(),this.centerX_=this.simRect_.getCenterX(),this.centerY_=this.simRect_.getCenterY(),this.ratio_=this.height_/this.width_,this.changed_=!0}removeMemo(t){this.memoList_.removeMemo(t)}setAspectRatio(t){r.veryDifferent(this.aspectRatio_,t)&&(this.aspectRatio_=t,this.realign(),this.broadcastParameter(h.en.ASPECT_RATIO))}setCenterX(t){r.veryDifferent(this.centerX_,t)&&(this.centerX_=t,this.modifySimRect())}setCenterY(t){r.veryDifferent(this.centerY_,t)&&(this.centerY_=t,this.modifySimRect())}setCoordMap(t){if(!(t instanceof dt))throw"not a CoordMap: "+t;this.coordMap_=t,this.changed_=!0,this.broadcast(new p(this,h.COORD_MAP_CHANGED))}setHeight(t){r.veryDifferent(this.height_,t)&&(this.height_=t,this.scaleTogether_&&(this.width_=this.height_/this.ratio_),this.modifySimRect())}setHorizAlign(t){if(!re().includes(t))throw"invalid HorizAlign "+t;this.horizAlign_=t,this.realign(),this.broadcastParameter(h.en.HORIZONTAL_ALIGN)}setScaleTogether(t){this.scaleTogether_!=t&&(this.scaleTogether_=t,this.scaleTogether_&&(this.ratio_=this.height_/this.width_),this.changed_=!0,this.broadcastParameter(h.en.SCALE_TOGETHER))}setScreenRect(t){if(!(t instanceof F))throw"not a ScreenRect: "+t;if(t.isEmpty())throw"empty screenrect";this.screenRect_.equals(t)||(this.screenRect_=t,this.realign(),this.broadcast(new p(this,h.SCREEN_RECT_CHANGED)))}setSimRect(t){if(!(t instanceof S))throw"not a DoubleRect: "+t;this.simRect_.equals(t)||(this.simRect_=t,this.realign(),this.broadcastParameter(h.en.WIDTH),this.broadcastParameter(h.en.HEIGHT),this.broadcastParameter(h.en.CENTER_X),this.broadcastParameter(h.en.CENTER_Y),this.broadcast(new p(this,h.SIM_RECT_CHANGED)))}setVerticalAlign(t){if(!ne().includes(t))throw"invalid VerticalAlign "+t;this.verticalAlign_=t,this.realign(),this.broadcastParameter(h.en.VERTICAL_ALIGN)}setWidth(t){r.veryDifferent(this.width_,t)&&(this.width_=t,this.scaleTogether_&&(this.height_=this.width_*this.ratio_),this.modifySimRect())}zoomIn(){this.setHeight(this.height_/this.zoom)}zoomOut(){this.setHeight(this.height_*this.zoom)}};w.COORD_MAP_CHANGED="COORD_MAP_CHANGED";w.SCREEN_RECT_CHANGED="SCREEN_RECT_CHANGED";w.SIM_RECT_CHANGED="SIM_RECT_CHANGED";w.en={SCALE_TOGETHER:"scale X-Y together",WIDTH:"width",HEIGHT:"height",CENTER_X:"center-x",CENTER_Y:"center-y",VERTICAL_ALIGN:"vertical-align",HORIZONTAL_ALIGN:"horizontal-align",ASPECT_RATIO:"aspect-ratio"};w.de_strings={SCALE_TOGETHER:"X-Y zusammen skalieren",WIDTH:"Breite",HEIGHT:"H\xF6he",CENTER_X:"Mitte X",CENTER_Y:"Mitte Y",VERTICAL_ALIGN:"Vertikalejustierung",HORIZONTAL_ALIGN:"Horizontalejustierung",ASPECT_RATIO:"Querschnittsverh\xE4ltnis"};w.i18n=r.LOCALE==="de"?w.de_strings:w.en;r.defineGlobal("lab$view$SimView",w);var Wt=class{constructor(t,e,i){this.parameter_=t,this.name_=this.parameter_.getName(),this.state_=this.parameter_.getValue(),this.imageOn_=e,this.imageOff_=i,this.button_=document.createElement("button"),this.button_.type="button",this.button_.className="icon",i.style.display=this.state_?"block":"none",e.style.display=this.state_?"none":"block",this.button_.appendChild(e),this.button_.appendChild(i),this.clickFn_=this.handleClick.bind(this),this.button_.addEventListener("click",this.clickFn_,!0),this.parameter_.getSubject().addObserver(this)}toString(){return this.toStringShort().slice(0,-1)+", state_: "+this.state_+"}"}toStringShort(){return"ToggleControl{parameter_: "+this.parameter_.toStringShort()+"}"}disconnect(){this.parameter_.getSubject().removeObserver(this),this.button_.removeEventListener("click",this.clickFn_,!0)}getElement(){return this.button_}getParameter(){return this.parameter_}getState(){return this.state_}handleClick(t){this.setState(!this.state_)}observe(t){t==this.parameter_&&this.setState(this.parameter_.getValue())}setEnabled(t){this.button_.disabled=!t}setState(t){this.state_!=t&&(this.parameter_.setValue(t),this.state_=t,this.imageOff_.style.display=t?"block":"none",this.imageOn_.style.display=t?"none":"block")}};r.defineGlobal("lab$controls$ToggleControl",Wt);var L=class h{constructor(){throw""}static makeAxes(t,e){let i=new kt(t.getSimRect());return e&&(i.setXAxisAlignment("BOTTOM"),i.setYAxisAlignment("LEFT")),new Y(t,s=>{if(s.nameEquals(w.COORD_MAP_CHANGED)){let n=t.getCoordMap().screenToSimRect(t.getScreenRect());i.setSimRect(n)}},"resize axes"),t.getDisplayList().add(i),i}static makeBackgroundMenu(t){let e=[h.i18n.WHITE,h.i18n.BLACK,h.i18n.WHITE_WITH_TRAILS,h.i18n.BLACK_WITH_TRAILS,h.i18n.WHITE_WITH_LONG_TRAILS,h.i18n.BLACK_WITH_LONG_TRAILS],i=[h.en.WHITE,h.en.BLACK,h.en.WHITE_WITH_TRAILS,h.en.BLACK_WITH_TRAILS,h.en.WHITE_WITH_LONG_TRAILS,h.en.BLACK_WITH_LONG_TRAILS];i=i.map(_=>r.toName(_));let s=h.LONG_TRAILS,n=h.SHORT_TRAILS,a=()=>{let _=t.getBackground(),c=t.getAlpha();if(_=="")return i[0];if(_=="black")if(r.veryDifferent(c,1))if(r.veryDifferent(c,n)){if(!r.veryDifferent(c,s))return i[5]}else return i[3];else return i[1];else if(_=="white")if(r.veryDifferent(c,1))if(r.veryDifferent(c,n)){if(!r.veryDifferent(c,s))return i[4]}else return i[2];else return i[0];return""},o=_=>{switch(i.indexOf(_)){case 0:t.setBackground(""),t.setAlpha(1);break;case 1:t.setBackground("black"),t.setAlpha(1);break;case 2:t.setBackground("white"),t.setAlpha(n);break;case 3:t.setBackground("black"),t.setAlpha(n);break;case 4:t.setBackground("white"),t.setAlpha(s);break;case 5:t.setBackground("black"),t.setAlpha(s);break;default:throw""}},l=new At(e,i,a,o,h.i18n.BACKGROUND);return t.addObserver(l),l}static makePanZoomControls(t,e=!0,i){let s=r.IMAGES_DIR+"/",n=t.getSimRect();i===void 0&&(i=()=>t.setSimRect(n));let a=!1,o=30,l=document.createElement("div");a&&(l.style.border="dashed red thin"),l.style.width=o*3.2+"px";let _=r.createImage(s+"up_gray.png",o),c=new P("up",()=>t.panUp(),_);c.repeatDelay=100,l.appendChild(c.getElement());let g=document.createElement("div");a&&(g.style.border="dashed red thin"),g.style.width=l.style.width,_=r.createImage(s+"backward_gray.png",o),c=new P("left",()=>t.panLeft(),_),c.repeatDelay=100,g.appendChild(c.getElement()),_=r.createImage(s+"target_gray.png",o),c=new P("reset",i,_),g.appendChild(c.getElement()),_=r.createImage(s+"forward_gray.png",o),c=new P("right",()=>t.panRight(),_),c.repeatDelay=100,g.appendChild(c.getElement());let d=document.createElement("div");_=r.createImage(s+"down_gray.png",o),c=new P("down",()=>t.panDown(),_),c.repeatDelay=100,d.appendChild(c.getElement()),a&&(d.style.border="dashed red thin"),d.style.width=l.style.width;let m=document.createElement("div");m.appendChild(l),m.appendChild(g),m.appendChild(d),a&&(m.style.border="dashed green thin"),m.style.textAlign="center";let f=document.createElement("div");_=r.createImage(s+"plus_gray.png",o),c=new P("zoomIn",()=>t.zoomIn(),_),c.repeatDelay=100,f.appendChild(c.getElement()),f.appendChild(document.createElement("BR")),_=r.createImage(s+"minus_gray.png",o),c=new P("zoomOut",()=>t.zoomOut(),_),c.repeatDelay=100,f.appendChild(c.getElement()),f.style.cssFloat="right",f.style.marginTop=o*.6+"px",a&&(f.style.border="dashed blue thin");let b=document.createElement("div");return e&&(b.style.position="absolute",b.style.left="5%",b.style.top="5%",b.style.width=o*4.2+"px"),b.appendChild(f),b.appendChild(m),a&&(b.style.border="solid gray thin"),b.style.display="none",b}static makePlaybackControls(t,e){let i=r.IMAGES_DIR+"/",s=document.createElement("div");s.style.width="max-content",e&&(s.style.position="absolute",s.style.left="0",s.style.bottom="0",s.style.opacity="0.5");let n=30,a=r.createImage(i+"restart.png",n),o=new P(M.i18n.RESTART,()=>t.reset(),a);s.appendChild(o.getElement()),a=r.createImage(i+"forward.png",n);let l=r.createImage(i+"pause.png",n),_=new Wt(t.getParameterBoolean(M.en.RUNNING),a,l);s.appendChild(_.getElement()),a=r.createImage(i+"next.png",n);let c=new P(M.i18n.STEP,()=>t.step(),a);return c.repeatDelay=100,s.appendChild(c.getElement()),new Vt("playback",s,[o,_,c])}static makeEasyScript(t,e,i,s){let n=new $(t,e);return n.addCommand("reset",()=>i.reset(),"sets simulation to initial conditions"),n.addCommand("save",()=>i.save(),"saves simulation initial conditions"),n.addCommand("step",()=>i.step(),"advance simulation by a small time increment"),n.addCommand("pause",()=>i.pause(),"pause simulation"),n.addCommand("resume",()=>i.resume(),"resume simulation"),s.setParser(n),n}static makeShowClockParam(t,e,i){let s=e.getDisplayList(),n=new N(i,B.en.SHOW_CLOCK,B.i18n.SHOW_CLOCK,()=>s.contains(t),a=>{a?s.add(t):s.remove(t),i.broadcastParameter(B.en.SHOW_CLOCK)});return i.addParameter(n),new Y(s,a=>{a.getValue()==t&&i.broadcastParameter(B.en.SHOW_CLOCK)},"broadcast show clock parameter"),n}static makeShowEnergyParam(t,e,i,s,n){let a=s??O.en.SHOW_ENERGY,o=n??O.i18n.SHOW_ENERGY,l=e.getCoordMap().screenToSimRect(e.getScreenRect());t.setVisibleArea(l);let _=e.getDisplayList(),c=new N(i,a,o,()=>_.contains(t),g=>{g?_.add(t):_.remove(t),i.broadcastParameter(a)});return i.addParameter(c),new Y(_,g=>{g.getValue()==t&&i.broadcastParameter(a)},"broadcast show energy parameter"),c}static makeShowPanZoomParam(t,e){let i=new N(e,h.en.PAN_ZOOM,h.i18n.PAN_ZOOM,()=>t.style.display!="none",s=>{s?t.style.display="block":t.style.display="none",e.broadcastParameter(h.en.PAN_ZOOM)});return e.addParameter(i),i}static makeURLScriptButton(t,e){let i=()=>{let s=t.scriptURL(),n=$.i18n.PROMPT_URL;s.length>2048&&(n=n+"  "+$.i18n.WARN_URL_2048);let a=e.getFiring();a&&e.stopFiring(),window.prompt(n,s),a&&e.startFiring()};return new P($.i18n.URL_SCRIPT,i)}};L.SHORT_TRAILS=.1;L.LONG_TRAILS=.05;L.en={PAN_ZOOM:"pan-zoom",BACKGROUND:"background",WHITE:"white",BLACK:"black",WHITE_WITH_TRAILS:"white with trails",BLACK_WITH_TRAILS:"black with trails",WHITE_WITH_LONG_TRAILS:"white with long trails",BLACK_WITH_LONG_TRAILS:"black with long trails"};L.de_strings={PAN_ZOOM:"pan-zoom",BACKGROUND:"Hintergrund",WHITE:"weiss",BLACK:"schwarz",WHITE_WITH_TRAILS:"weiss mit Pfade",BLACK_WITH_TRAILS:"schwarz mit Pfade",WHITE_WITH_LONG_TRAILS:"weiss mit lange Pfade",BLACK_WITH_LONG_TRAILS:"schwarz mit lange Pfade"};L.i18n=r.LOCALE==="de"?L.de_strings:L.en;r.defineGlobal("sims$common$CommonControls",L);var Z=class h{constructor(t,e,i){this.totSteps_=0,this.secondDiff_=!0,this.specialTest_=!1,this.tolerance_=1e-6,this.diffEq_=t,this.energySystem_=e,this.odeSolver_=i}toString(){return this.toStringShort().slice(0,-1)+", odeSolver_: "+this.odeSolver_.toStringShort()+", energySystem_: "+this.energySystem_.toStringShort()+", secondDiff_: "+this.secondDiff_+", tolerance_: "+r.NFE(this.tolerance_)+"}"}toStringShort(){return"AdaptiveStepSolver{diffEq_: "+this.diffEq_.toStringShort()+"}"}getName(t){return t?h.i18n.NAME+"-"+this.odeSolver_.getName(!0):r.toName(h.en.NAME)+"_"+this.odeSolver_.getName(!1)}nameEquals(t){return this.getName()==r.toName(t)}getSecondDiff(){return this.secondDiff_}getTolerance(){return this.tolerance_}setSecondDiff(t){this.secondDiff_=t}setTolerance(t){this.tolerance_=t}step(t){this.diffEq_.saveState();let e=this.diffEq_.getTime(),i=t,s=0;this.diffEq_.modifyObjects();let n=this.energySystem_.getEnergyInfo().getTotalEnergy(),a=1/0,o=1/0,l=!0;if(t<1e-15)return null;do{let _=e;if(!l){this.diffEq_.restoreState(),this.diffEq_.modifyObjects(),r.assert(Math.abs(this.diffEq_.getTime()-e)<1e-12);let d=this.energySystem_.getEnergyInfo().getTotalEnergy();if(r.assert(Math.abs(d-n)<1e-10),i=i/5,i<1e-15)throw"time step too small "+i}for(s=0;_<e+t;){let d=i;_+d>e+t-1e-10&&(d=e+t-_),s++;let m=this.odeSolver_.step(d);if(this.diffEq_.modifyObjects(),m!=null)return m;_+=d}let c=this.energySystem_.getEnergyInfo().getTotalEnergy(),g=Math.abs(n-c);this.secondDiff_?l||(o=Math.abs(g-a)):o=g,a=g,l=!1}while(o>this.tolerance_);return this.totSteps_+=s,null}};Z.en={NAME:"Adaptive"};Z.de_strings={NAME:"Adaptiert"};Z.i18n=r.LOCALE==="de"?Z.de_strings:Z.en;r.defineGlobal("lab$model$AdaptiveStepSolver",Z);var Q=class h{constructor(t){this.inp_=[],this.k1_=[],this.ode_=t}toString(){return this.toStringShort()}toStringShort(){return"EulersMethod{ode_: "+this.ode_.toStringShort()+"}"}getName(t){return t?h.i18n.NAME:r.toName(h.en.NAME)}nameEquals(t){return this.getName()==r.toName(t)}step(t){let e=this.ode_.getVarsList(),i=e.getValues(),s=i.length;this.inp_.length!=s&&(this.inp_=new Array(s),this.k1_=new Array(s));let n=this.inp_,a=this.k1_;for(let l=0;l<s;l++)n[l]=i[l];r.zeroArray(a);let o=this.ode_.evaluate(n,a,0);if(o!=null)return o;for(let l=0;l<s;l++)i[l]+=a[l]*t;return e.setValues(i,!0),null}};Q.en={NAME:"Eulers Method"};Q.de_strings={NAME:"Eulers Methode"};Q.i18n=r.LOCALE==="de"?Q.de_strings:Q.en;r.defineGlobal("lab$model$EulersMethod",Q);var K=class h{constructor(t){this.inp_=[],this.k1_=[],this.k2_=[],this.ode_=t}toString(){return this.toStringShort()}toStringShort(){return"ModifiedEuler{ode_: "+this.ode_.toStringShort()+"}"}getName(t){return t?h.i18n.NAME:r.toName(h.en.NAME)}nameEquals(t){return this.getName()==r.toName(t)}step(t){let e=this.ode_.getVarsList(),i=e.getValues(),s=i.length;this.inp_.length!=s&&(this.inp_=new Array(s),this.k1_=new Array(s),this.k2_=new Array(s));let n=this.inp_,a=this.k1_,o=this.k2_;for(let _=0;_<s;_++)n[_]=i[_];r.zeroArray(a);let l=this.ode_.evaluate(n,a,0);if(l!=null)return l;for(let _=0;_<s;_++)n[_]=i[_]+a[_]*t;if(r.zeroArray(o),l=this.ode_.evaluate(n,o,t),l!=null)return l;for(let _=0;_<s;_++)i[_]+=(a[_]+o[_])*t/2;return e.setValues(i,!0),null}};K.en={NAME:"Modified Euler"};K.de_strings={NAME:"Modifiziert Euler"};K.i18n=r.LOCALE==="de"?K.de_strings:K.en;r.defineGlobal("lab$model$ModifiedEuler",K);var z=class h{constructor(t){this.inp_=[],this.k1_=[],this.k2_=[],this.k3_=[],this.k4_=[],this.ode_=t}toString(){return this.toStringShort()}toStringShort(){return"RungeKutta{ode_: "+this.ode_.toStringShort()+"}"}getName(t){return t?h.i18n.NAME:r.toName(h.en.NAME)}nameEquals(t){return this.getName()==r.toName(t)}step(t){let e=this.ode_.getVarsList(),i=e.getValues(),s=i.length;this.inp_.length<s&&(this.inp_=new Array(s),this.k1_=new Array(s),this.k2_=new Array(s),this.k3_=new Array(s),this.k4_=new Array(s));let n=this.inp_,a=this.k1_,o=this.k2_,l=this.k3_,_=this.k4_;for(let g=0;g<s;g++)n[g]=i[g];r.zeroArray(a);let c=this.ode_.evaluate(n,a,0);if(c!==null)return c;for(let g=0;g<s;g++)n[g]=i[g]+a[g]*t/2;if(r.zeroArray(o),c=this.ode_.evaluate(n,o,t/2),c!==null)return c;for(let g=0;g<s;g++)n[g]=i[g]+o[g]*t/2;if(r.zeroArray(l),c=this.ode_.evaluate(n,l,t/2),c!==null)return c;for(let g=0;g<s;g++)n[g]=i[g]+l[g]*t;if(r.zeroArray(_),c=this.ode_.evaluate(n,_,t),c!==null)return c;for(let g=0;g<s;g++)i[g]+=(a[g]+2*o[g]+2*l[g]+_[g])*t/6;return e.setValues(i,!0),null}};z.en={NAME:"Runge-Kutta"};z.de_strings={NAME:"Runge-Kutta"};z.i18n=r.LOCALE==="de"?z.de_strings:z.en;r.defineGlobal("lab$model$RungeKutta",z);var J=class h extends T{constructor(t,e,i,s){if(super(s||"DIFF_EQ_SUBJECT"),this.sim_=t,this.energySystem_=e,this.advanceStrategy_=i,this.solvers_=[],this.solvers_.push(new Q(this.sim_)),this.solvers_.push(new K(this.sim_)),this.solvers_.push(new z(this.sim_)),this.energySystem_!=null){let o=new Z(this.sim_,this.energySystem_,new K(this.sim_));this.solvers_.push(o),o=new Z(this.sim_,this.energySystem_,new z(this.sim_)),this.solvers_.push(o)}let n=this.solvers_.map(o=>o.getName(!0)),a=this.solvers_.map(o=>o.getName());this.addParameter(new I(this,h.en.DIFF_EQ_SOLVER,h.i18n.DIFF_EQ_SOLVER,()=>this.getDiffEqSolver(),o=>this.setDiffEqSolver(o),n,a))}toString(){return this.toStringShort().slice(0,-1)+", sim_: "+this.sim_.toStringShort()+", energySystem_: "+(this.energySystem_==null?"null":this.energySystem_.toStringShort())+", advanceStrategy_: "+this.advanceStrategy_+", solvers_: [ "+this.solvers_.map(t=>t.toStringShort())+"]"+super.toString()}getClassName(){return"DiffEqSolverSubject"}getDiffEqSolver(){return this.advanceStrategy_.getDiffEqSolver().getName()}setDiffEqSolver(t){if(!this.advanceStrategy_.getDiffEqSolver().nameEquals(t)){let e=this.solvers_.find(i=>i.nameEquals(t));if(e!==void 0)this.advanceStrategy_.setDiffEqSolver(e),this.broadcastParameter(h.en.DIFF_EQ_SOLVER);else throw"unknown solver: "+t}}};J.en={DIFF_EQ_SOLVER:"Diff Eq Solver"};J.de_strings={DIFF_EQ_SOLVER:"Diff Eq L\xF6ser"};J.i18n=r.LOCALE==="de"?J.de_strings:J.en;r.defineGlobal("lab$model$DiffEqSolverSubject",J);var he=class{constructor(t){this.text_=t,this.label_=document.createElement("label"),this.label_.appendChild(document.createTextNode(t))}toString(){return this.toStringShort().slice(0,-1)+"}"}toStringShort(){return'LabelControl{text_: "'+this.text_+'"}'}disconnect(){}getElement(){return this.label_}getParameter(){return null}setEnabled(t){throw"LabelControl cannot be disabled"}};r.defineGlobal("lab$controls$LabelControl",he);var Jt=class h{constructor(t,e,i,s){if(this.signifDigits_=3,this.decimalPlaces_=-1,this.columns_=Math.max(8,1+this.signifDigits_),this.lastValue_="",this.firstClick_=!1,this.label_=t,this.getter_=e,this.setter_=i,this.value_=e(),typeof this.value_!="number")throw"not a number "+this.value_;let n=null;if(s!==void 0){let a=s.parentElement;a!==null&&a.tagName=="LABEL"&&(n=a)}else s=document.createElement("input"),s.type="text",s.size=this.columns_,n=document.createElement("label"),n.appendChild(document.createTextNode(this.label_)),n.appendChild(s);this.textField_=s,this.topElement_=n!==null?n:this.textField_,this.textField_.style.textAlign="right",this.changeFn_=this.validate.bind(this),this.textField_.addEventListener("change",this.changeFn_,!0),this.focusFn_=this.gainFocus.bind(this),this.textField_.addEventListener("focus",this.focusFn_,!1),this.clickFn_=this.doClick.bind(this),this.textField_.addEventListener("click",this.clickFn_,!1),this.formatTextField()}toString(){return this.toStringShort().slice(0,-1)+", signifDigits_: "+this.signifDigits_+", decimalPlaces_: "+this.decimalPlaces_+", columns_: "+this.columns_+"}"}toStringShort(){return this.getClassName()+'{label_: "'+this.label_+'"}'}columnsNeeded(t,e){let i=h.magnitude(t);return 2+this.decimalPlacesNeeded(t,e)+(i>0?i:0)}decimalPlacesNeeded(t,e){if(this.decimalPlaces_>-1)return this.decimalPlaces_;{let i=e-1-h.magnitude(t);return i>16&&(i=16),i>0?i:0}}disconnect(){this.textField_.removeEventListener("change",this.changeFn_,!0),this.textField_.removeEventListener("focus",this.focusFn_,!1),this.textField_.removeEventListener("click",this.clickFn_,!1)}doClick(t){this.firstClick_&&(this.textField_.select(),this.firstClick_=!1)}formatTextField(){let t=this.decimalPlacesNeeded(this.value_,this.signifDigits_),e=this.columnsNeeded(this.value_,this.signifDigits_);this.lastValue_=this.value_.toFixed(t),this.textField_.value=this.lastValue_,e!=this.columns_&&(this.columns_=e,this.textField_.size=this.columns_)}gainFocus(t){this.firstClick_=!0}getClassName(){return"NumericControlBase"}getDecimalPlaces(){return this.decimalPlaces_}getElement(){return this.topElement_}getParameter(){return null}getSignifDigits(){return this.signifDigits_}getValue(){return this.value_}static magnitude(t){return Math.abs(t)<1e-15?0:Math.floor(Math.LOG10E*Math.log(Math.abs(t)))}observe(t){this.setValue(this.getter_())}setDecimalPlaces(t){return this.decimalPlaces_!=t&&(this.decimalPlaces_=t>-1?t:-1,this.formatTextField()),this}setEnabled(t){this.textField_.disabled=!t}setSignifDigits(t){return this.signifDigits_!=t&&(this.signifDigits_=t,this.formatTextField()),this}setValue(t){if(t!=this.value_){try{if(isNaN(t))throw"not a number "+t;this.value_=t,this.setter_(t)}catch(e){alert(e),this.value_=this.getter_()}this.formatTextField()}}validate(t){let e=this.textField_.value.replace(/^\s*|\s*$/g,"");if(e!=this.lastValue_){let i=parseFloat(e);isNaN(i)?(alert("not a number: "+e),this.formatTextField()):this.setValue(i)}}};r.defineGlobal("lab$controls$NumericControlBase",Jt);var tt=class extends Jt{constructor(t,e){super(t.getName(!0)+t.getUnits(),()=>t.getValue(),i=>t.setValue(i),e),this.parameter_=t,this.setSignifDigits(t.getSignifDigits()),this.setDecimalPlaces(t.getDecimalPlaces()),this.parameter_.getSubject().addObserver(this)}toString(){return super.toString().slice(0,-1)+", parameter_: "+this.parameter_.toStringShort()+"}"}disconnect(){super.disconnect(),this.parameter_.getSubject().removeObserver(this)}getClassName(){return"NumericControl"}getParameter(){return this.parameter_}observe(t){t===this.parameter_&&(super.observe(t),this.setSignifDigits(this.parameter_.getSignifDigits()),this.setDecimalPlaces(this.parameter_.getDecimalPlaces()))}};r.defineGlobal("lab$controls$NumericControl",tt);var Yt=class h{constructor(t,e,i,s,n){if(this.ehDrag_=!1,this.dragSimObj_=null,this.dragOffset_=u.ORIGIN,t==null&&n==null)throw"";if(this.dragDispObj_=t,this.view_=e,this.eventHandler_=n,t!=null){let a=t.getSimObjects();a.length>0&&(this.dragSimObj_=a[0])}this.loc_sim_=i,this.drag_body_=s,t!==null&&(this.dragOffset_=i.subtract(t.getPosition()),this.dragSimObj_===null&&(this.eventHandler_=null))}startDrag(t){this.eventHandler_!=null?this.ehDrag_=this.eventHandler_.startDrag(this.dragSimObj_,this.loc_sim_,this.dragOffset_,this.drag_body_,t):this.ehDrag_=!1}mouseDrag(t){let e=this.view_.getCoordMap();this.loc_sim_=e.screenToSim(t),this.dragDispObj_!=null&&(this.dragSimObj_==null||!this.ehDrag_)?this.dragDispObj_.setPosition(this.loc_sim_.subtract(this.dragOffset_)):this.eventHandler_!=null&&this.ehDrag_&&this.eventHandler_.mouseDrag(this.dragSimObj_,this.loc_sim_,this.dragOffset_)}finishDrag(){this.eventHandler_!=null&&this.eventHandler_.finishDrag(this.dragSimObj_,this.loc_sim_,this.dragOffset_)}static findNearestDragable(t,e,i){let s=null,n,a,o=null,l=1/0,_=t.getViews();t:for(let c=_.length-1;c>=0;c--){let g=_[c],d=g.getCoordMap(),m=d.screenToSim(e),f=g.getDisplayList().toArray();e:for(let b=f.length-1;b>=0;b--){let C=f[b];if(!C.isDragable())continue e;let v=C.getMassObjects();if(v.length>1)continue e;if(v.length==0)if(C.contains(m)){s=C,n=g,a=m,o=u.ORIGIN;break t}else continue e;else{let gt=v[0],it=gt.getDragPoints();for(let X=it.length-1;X>=0;X--){let pe=gt.bodyToWorld(it[X]),le=e.distanceTo(d.simToScreen(pe));le<=l&&(l=le,s=C,n=g,o=it[X],a=m)}}}}if(s==null){let c=t.getFocusView();if(c!=null)n=c,a=n.getCoordMap().screenToSim(e);else return null;if(i==null)return null}return n!==void 0&&a!==void 0?new h(s,n,a,o,i):null}};r.defineGlobal("lab$app$MouseTracker",Yt);var at=class h{constructor(t,e,i){this.enablePanning_=!1,this.panModifiers_={},this.mouseDrag_=!1,this.mouseTracker_=null,this.myViewPanner_=null,this.touchStartFn_=void 0,this.touchMoveFn_=void 0,this.touchEndFn_=void 0,this.debug_=!1,this.labCanvas_=t,this.eventHandler_=e||null,i===void 0&&(i={shift:!0}),i&&(this.enablePanning_=!0,this.panModifiers_=i),this.mouseDownFn_=this.mouseDown.bind(this),t.getCanvas().addEventListener("mousedown",this.mouseDownFn_),this.mouseMoveFn_=this.mouseMove.bind(this),document.addEventListener("mousemove",this.mouseMoveFn_),this.mouseUpFn_=this.mouseUp.bind(this),document.addEventListener("mouseup",this.mouseUpFn_),this.keyDownFn_=this.keyPressed.bind(this),document.addEventListener("keydown",this.keyDownFn_),this.keyUpFn_=this.keyReleased.bind(this),document.addEventListener("keyup",this.keyUpFn_),this.touchStartFn_=this.touchStart.bind(this),document.addEventListener("touchstart",this.touchStartFn_),this.touchMoveFn_=this.touchMove.bind(this),document.addEventListener("touchmove",this.touchMoveFn_),this.touchEndFn_=this.touchEnd.bind(this),document.addEventListener("touchend",this.touchEndFn_)}destroy(){this.mouseDownFn_&&this.labCanvas_.getCanvas().removeEventListener("mousedown",this.mouseDownFn_),this.mouseMoveFn_&&document.removeEventListener("mousemove",this.mouseMoveFn_),this.mouseUpFn_&&document.removeEventListener("mouseup",this.mouseUpFn_),this.keyDownFn_&&document.removeEventListener("keydown",this.keyDownFn_),this.keyUpFn_&&document.removeEventListener("keyup",this.keyUpFn_),this.touchStartFn_&&document.removeEventListener("touchstart",this.touchStartFn_),this.touchMoveFn_&&document.removeEventListener("touchmove",this.touchMoveFn_),this.touchEndFn_&&document.removeEventListener("touchend",this.touchEndFn_)}toString(){return this.toStringShort().slice(0,-1)+", labCanvas_: "+this.labCanvas_.toStringShort()+", enablePanning_: "+this.enablePanning_+", panModifiers_: "+h.modifiersToString(this.panModifiers_)+"}"}toStringShort(){return"SimController{eventHandler_: "+(this.eventHandler_!=null?this.eventHandler_.toStringShort():"null")+"}"}notifyError(t){this.mouseDrag_&&this.finishDrag()}mouseDown(t){let e={control:t.ctrlKey,meta:t.metaKey,shift:t.shiftKey,alt:t.altKey};this.doMouseDown(e,t.clientX,t.clientY)}doMouseDown(t,e,i){this.labCanvas_.focus(),this.mouseDrag_=!0;let s=this.eventToScreen(e,i);if(this.enablePanning_&&h.modifiersEqual(this.panModifiers_,t)){let n=this.labCanvas_.getFocusView();n!=null&&(this.myViewPanner_=new Qt(n,s),this.myViewPanner_.mouseDrag(s))}else this.mouseTracker_=Yt.findNearestDragable(this.labCanvas_,s,this.eventHandler_),this.mouseTracker_!=null&&this.mouseTracker_.startDrag(t)}eventToScreen(t,e){let i=this.labCanvas_.getCanvas(),s=i.getBoundingClientRect(),n=new u(t-s.left,e-s.top),a=i.offsetWidth/this.labCanvas_.getWidth();return n.divide(a)}mouseMove(t){this.doMouseMove(t.clientX,t.clientY)}doMouseMove(t,e){if(this.labCanvas_.getCanvas().offsetParent==null)return;let s=this.eventToScreen(t,e);this.myViewPanner_!=null?this.myViewPanner_.mouseDrag(s):this.mouseTracker_!=null&&this.mouseTracker_.mouseDrag(s)}mouseUp(t){this.labCanvas_.getCanvas().offsetParent!=null&&this.finishDrag()}finishDrag(){this.myViewPanner_!=null?this.myViewPanner_.finishDrag():this.mouseTracker_!=null&&this.mouseTracker_.finishDrag(),this.mouseTracker_=null,this.myViewPanner_=null,this.mouseDrag_=!1}getEventHandler(){return this.eventHandler_}getPanModifiers(){return this.enablePanning_?this.panModifiers_:null}keyPressed(t){let e=t;if((e.target==this.labCanvas_.getCanvas()||e.target==document.body)&&this.eventHandler_!=null){r.DEBUG&&this.debug_&&console.log("keyPressed "+r.propertiesOf(e,!0));let i={control:e.ctrlKey,meta:e.metaKey,shift:e.shiftKey,alt:e.altKey};this.eventHandler_.handleKeyEvent(e,!0,i)}}keyReleased(t){if((t.target==this.labCanvas_.getCanvas()||t.target==document.body)&&this.eventHandler_!=null){r.DEBUG&&this.debug_&&console.log("keyReleased "+r.propertiesOf(t,!0));let e={control:t.ctrlKey,meta:t.metaKey,shift:t.shiftKey,alt:t.altKey};this.eventHandler_.handleKeyEvent(t,!1,e)}}setEventHandler(t){this.eventHandler_=t}setPanModifiers(t){t==null?(this.enablePanning_=!1,this.panModifiers_={}):(this.enablePanning_=!0,this.panModifiers_=t)}touchStart(t){if(t.target==this.labCanvas_.getCanvas()){let e=t.touches;if(e&&e.length==1){let i={control:!1,meta:!1,shift:!1,alt:!1};this.doMouseDown(i,e[0].clientX,e[0].clientY)}else this.finishDrag()}}touchMove(t){let e=t!=null?t.touches:[];this.mouseDrag_&&e&&e.length==1?this.doMouseMove(e[0].clientX,e[0].clientY):this.finishDrag()}touchEnd(t){this.mouseDrag_&&this.finishDrag()}static modifiersToString(t){let e="";return t.control&&(e+="control"),t.alt&&(e+=(e.length>0?"+":"")+"alt"),t.meta&&(e+=(e.length>0?"+":"")+"meta"),t.shift&&(e+=(e.length>0?"+":"")+"shift"),e}static modifiersEqual(t,e){return!!t.control==!!e.control&&!!t.meta==!!e.meta&&!!t.shift==!!e.shift&&!!t.alt==!!e.alt}};r.defineGlobal("lab$app$SimController",at);var Qt=class{constructor(t,e){this.view_=t,this.panMap_=t.getCoordMap();let i=t.getSimRect();this.center_screen_=this.panMap_.simToScreen(i.getCenter()),this.start_screen_=e}mouseDrag(t){let e=this.start_screen_.subtract(t),i=this.panMap_.screenToSim(this.center_screen_.add(e)),s=this.view_.getSimRect(),n=S.makeCentered(i,s.getWidth(),s.getHeight());this.view_.setSimRect(n)}finishDrag(){}};r.defineGlobal("lab$app$ViewPanner",Qt);var ut=class h{constructor(t){this.capacity_=3e3,this.size_=0,this.cycles_=0,this.nextPtr_=0,this.lastPtr_=-1,this.values_=new Array(this.capacity_),this.lastValue_=null,t!==void 0&&t>1&&(this.capacity_=t,this.values_=new Array(t))}toString(){return"CircularList{capacity_: "+this.capacity_+", size_: "+this.size_+", cycles_: "+this.cycles_+", nextPtr_: "+this.nextPtr_+", lastPtr_: "+this.lastPtr_+"}"}causeMaxIntError(){this.size_=this.capacity_,this.cycles_=Math.floor(r.MAX_INTEGER/this.capacity_)-1}getEndIndex(){if(this.size_==0)return-1;let t;return this.nextPtr_==0?t=this.pointerToIndex(this.size_-1):t=this.pointerToIndex(this.nextPtr_-1),t}getEndValue(){let t=this.getEndIndex();return t==-1?null:this.values_[this.indexToPointer(t)]}getIterator(t){return new te(this,t)}getSize(){return this.size_}getStartIndex(){return this.size_<this.capacity_?0:this.pointerToIndex(this.nextPtr_)}getValue(t){let e=this.indexToPointer(t);return this.values_[e]}getValueAtPointer(t){return this.values_[t]}indexToPointer(t){if(this.size_<this.capacity_)return t;let e=t%this.capacity_;return t-(this.cycles_-(e<this.nextPtr_?0:1))*this.capacity_}pointerToIndex(t){if(this.size_<this.capacity_)return t;let e=t+(this.cycles_-(t<this.nextPtr_?0:1))*this.capacity_;if(e>=r.MAX_INTEGER)throw h.MAX_INDEX_ERROR;return e}reset(){this.nextPtr_=this.size_=0,this.cycles_=0,this.lastPtr_=-1}store(t){return this.lastPtr_=this.nextPtr_,this.values_[this.nextPtr_]=t,this.nextPtr_++,this.size_<this.capacity_&&this.size_++,this.nextPtr_>=this.capacity_&&(this.cycles_++,this.nextPtr_=0),this.pointerToIndex(this.lastPtr_)}};ut.MAX_INDEX_ERROR="exceeded max int";r.defineGlobal("lab$util$CircularList",ut);var te=class{constructor(t,e){if(this.first_=t.getSize()>0,this.cList_=t,(e===void 0||e<0)&&(e=t.getStartIndex()),t.getSize()>0&&(e<t.getStartIndex()||e>t.getEndIndex()))throw"out of range startIndex="+e;this.index_=e,this.pointer_=t.indexToPointer(e)}getIndex(){if(this.cList_.getSize()==0)throw"no data";return this.index_}getValue(){if(this.cList_.getSize()==0)throw"no data";return this.cList_.getValueAtPointer(this.pointer_)}hasNext(){return this.first_||this.index_<this.cList_.getEndIndex()}hasPrevious(){return this.first_||this.index_>this.cList_.getStartIndex()}nextValue(){if(this.cList_.getSize()===0)throw"no data";if(this.first_)this.first_=!1;else{if(this.index_+1>this.cList_.getEndIndex())throw"cannot iterate past end of list";this.index_++,this.pointer_=this.cList_.indexToPointer(this.index_)}return this.cList_.getValueAtPointer(this.pointer_)}previousValue(){if(this.cList_.getSize()===0)throw"no data";if(this.first_)this.first_=!1;else{if(this.index_-1<this.cList_.getStartIndex())throw"cannot iterate prior to start of list";this.index_--,this.pointer_=this.cList_.indexToPointer(this.index_)}return this.cList_.getValueAtPointer(this.pointer_)}};r.defineGlobal("lab$util$CircularListIterator",te);function de(){return[ge.DOTS,ge.LINES]}function me(){return["dots","lines"]}var Te={DOTS:"Dots",LINES:"Lines"},we={DOTS:"Punkte",LINES:"Linien"},ge=r.LOCALE==="de"?we:Te;var R=class h extends T{constructor(t,e,i){let s=i!==void 0?i:"VARIABLES";if(super(s),this.timeIdx_=-1,this.varList_=[],this.history_=r.DEBUG,this.histArray_=[],t.length!=e.length)throw"varNames and localNames are different lengths";for(let n=0,a=t.length;n<a;n++){let o=t[n];if(typeof o!="string")throw"variable name "+o+" is not a string i="+n;o=r.validName(r.toName(o)),t[n]=o,o==h.TIME&&(this.timeIdx_=n)}if(!r.uniqueElements(t))throw"duplicate variable names";for(let n=0,a=t.length;n<a;n++)this.varList_.push(new ot(this,t[n],e[n]))}toString(){return this.toStringShort().slice(0,-1)+", timeIdx_: "+this.timeIdx_+", history_: "+this.history_+", "+this.varList_.map((t,e)=>"("+e+") "+t.getName()+": "+r.NF5E(t.getValue()))+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", numVars: "+this.varList_.length+"}"}getClassName(){return"VarsList"}addParameter(t){throw"addParameter not allowed on VarsList"}addVariable(t){let e=t.getName();if(e==h.DELETED)throw'variable cannot be named "'+h.DELETED+'"';let i=this.findOpenSlot_(1);return this.varList_[i]=t,e==h.TIME&&(this.timeIdx_=i),this.broadcast(new p(this,h.VARS_MODIFIED)),i}addVariables(t,e){let i=t.length;if(i==0)throw"";if(t.length!=e.length)throw"names and localNames are different lengths";let s=this.findOpenSlot_(i);for(let n=0;n<i;n++){let a=r.validName(r.toName(t[n]));if(a==h.DELETED)throw"variable cannot be named ''+VarsList.DELETED+''";let o=s+n;this.varList_[o]=new ot(this,a,e[n]),a==h.TIME&&(this.timeIdx_=o)}return this.broadcast(new p(this,h.VARS_MODIFIED)),s}checkIndex_(t){if(t<0||t>=this.varList_.length)throw"bad variable index="+t+"; numVars="+this.varList_.length}deleteVariables(t,e){if(e!=0){if(e<0||t<0||t+e>this.varList_.length)throw"deleteVariables";for(let i=t;i<t+e;i++)this.varList_[i]=new ot(this,h.DELETED,h.DELETED);this.broadcast(new p(this,h.VARS_MODIFIED))}}findOpenSlot_(t){if(t<0)throw"";let e=0,i=-1;for(let n=0,a=this.varList_.length;n<a;n++)if(this.varList_[n].getName()==h.DELETED){if(i==-1&&(i=n),e++,e>=t)return i}else i=-1,e=0;let s;e>0?(s=t-e,r.assert(i>=0&&s>0)):(i=this.varList_.length,s=t);for(let n=0;n<s;n++)this.varList_.push(new ot(this,h.DELETED,h.DELETED));return i}getHistory(){return this.history_}getParameter(t){t=r.toName(t);let e=this.varList_.find(i=>i.getName()==t);if(e===void 0)throw"Parameter not found "+t;return e}getParameters(){return Array.from(this.varList_)}getTime(){if(this.timeIdx_<0)throw"no time variable";return this.getValue(this.timeIdx_)}getValue(t){return this.checkIndex_(t),this.varList_[t].getValue()}getValues(t){return this.varList_.map(e=>!t&&e.isComputed()?NaN:e.getValue())}getVariable(t){let e;if(typeof t=="number")e=t;else if(typeof t=="string"){if(t=r.toName(t),e=this.varList_.findIndex(i=>i.getName()==t),e<0)throw"unknown variable name "+t}else throw"";return this.checkIndex_(e),this.varList_[e]}incrSequence(...t){if(t.length==0)for(let e=0,i=this.varList_.length;e<i;e++)this.varList_[e].incrSequence();else for(let e=0,i=t.length;e<i;e++){let s=t[e];this.checkIndex_(s),this.varList_[s].incrSequence()}}indexOf(t){return typeof t=="string"?(t=r.toName(t),this.varList_.findIndex(e=>e.getName()==t)):this.varList_.findIndex(e=>e===t)}numVariables(){return this.varList_.length}printOneHistory(t){let e="";if(this.history_&&t<=this.histArray_.length){let i=this.histArray_[this.histArray_.length-t];e="//time = "+r.NF5(i[i.length-1]);for(let s=0,n=i.length-1;s<n;s++)e+=`
sim.getVarsList().setValue(`+s+", "+i[s]+");"}return e}printHistory(t){if(typeof t=="number")return this.printOneHistory(t);{let e=this.printOneHistory(10);return e+=`
`+this.printOneHistory(3),e+=`
`+this.printOneHistory(2),e+=`
`+this.printOneHistory(1),e}}saveHistory(){if(this.history_){let t=this.getValues();t.push(this.getTime()),this.histArray_.push(t),this.histArray_.length>20&&this.histArray_.shift()}}setComputed(...t){for(let e=0,i=t.length;e<i;e++){let s=t[e];this.checkIndex_(s),this.varList_[s].setComputed(!0)}}setHistory(t){this.history_=t}setTime(t){this.setValue(this.timeIdx_,t)}setValue(t,e,i){this.checkIndex_(t);let s=this.varList_[t];if(s.getName()!=h.DELETED){if(isNaN(e)&&!s.isComputed())throw"cannot set variable "+s.getName()+" to NaN";i?s.setValueSmooth(e):s.setValue(e)}}setValues(t,e){let i=this.varList_.length,s=t.length;if(s>i)throw"setValues bad length n="+s+" > N="+i;for(let n=0;n<i;n++)n<s&&this.setValue(n,t[n],e)}timeIndex(){return this.timeIdx_}toArray(){return Array.from(this.varList_)}};R.VARS_MODIFIED="VARS_MODIFIED";R.DELETED="DELETED";R.TIME="TIME";R.en={TIME:"time"};R.de_strings={TIME:"Zeit"};R.i18n=r.LOCALE==="de"?R.de_strings:R.en;r.defineGlobal("lab$model$VarsList",R);var ot=class{constructor(t,e,i){this.value_=0,this.isComputed_=!1,this.seq_=0,this.doesBroadcast_=!1,this.varsList_=t,this.name_=r.validName(r.toName(e)),this.localName_=i}toString(){return this.toStringShort().slice(0,-1)+", isComputed_: "+this.isComputed_+', localName_: "'+this.localName_+'", varsList_: '+this.varsList_.toStringShort()+"}"}toStringShort(){return this.getClassName()+'{name_: "'+this.name_+'", value_: '+r.NF(this.getValue())+"}"}getClassName(){return"ConcreteVariable"}getAsString(){return this.value_.toString()}getBroadcast(){return this.doesBroadcast_}getChoices(){return[]}getName(t){return t?this.localName_:this.name_}getSequence(){return this.seq_}getSubject(){return this.varsList_}getValue(){return this.value_}getValues(){return[]}incrSequence(){this.seq_++}indexOf(){return this.varsList_.indexOf(this)}isComputed(){return this.isComputed_}nameEquals(t){return this.name_==r.toName(t)}setBroadcast(t){this.doesBroadcast_=t}setComputed(t){this.isComputed_=t}setFromString(t){let e=Number(t);if(isNaN(e))throw"not a number: "+t+" (ConcreteVariable.setFromString)";this.setValue(e)}setValue(t){this.value_!=t&&(this.value_=t,this.seq_++,this.doesBroadcast_&&this.varsList_.broadcast(this))}setValueSmooth(t){this.value_=t}};r.defineGlobal("lab$model$ConcreteVariable",ot);var E=class h extends T{constructor(t,e,i){super(t),this.xVar_=-1,this.yVar_=-1,this.changed_=!0,this.drawColor_="lime",this.drawMode_="lines",this.lineWidth_=1,this.hotSpotColor_="red",this.styles_=[],this.xTransform=(s,n)=>s,this.yTransform=(s,n)=>n,this.varsList_=e,e.addObserver(this),this.yVarParam_=new y(this,h.en.Y_VARIABLE,h.i18n.Y_VARIABLE,()=>this.getYVariable(),s=>this.setYVariable(s)).setLowerLimit(-1),this.addParameter(this.yVarParam_),this.xVarParam_=new y(this,h.en.X_VARIABLE,h.i18n.X_VARIABLE,()=>this.getXVariable(),s=>this.setXVariable(s)).setLowerLimit(-1),this.addParameter(this.xVarParam_),this.buildMenu(),this.dataPoints_=new ut(i||1e5),this.addGraphStyle(),this.addParameter(new y(this,h.en.LINE_WIDTH,h.i18n.LINE_WIDTH,()=>this.getLineWidth(),s=>this.setLineWidth(s))),this.addParameter(new I(this,h.en.DRAWING_MODE,h.i18n.DRAWING_MODE,()=>this.getDrawingMode(),s=>this.setDrawingMode(s),de(),me())),this.addParameter(new I(this,h.en.GRAPH_COLOR,h.i18n.GRAPH_COLOR,()=>this.getColor(),s=>this.setColor(s)))}toString(){return this.toStringShort().slice(0,-1)+', drawColor_:"'+this.drawColor_+'", lineWidth_: '+r.NF(this.lineWidth_)+", drawMode_: "+this.drawMode_+', hotSpotColor_:"'+this.hotSpotColor_+'", styles_.length: '+r.NF(this.styles_.length)+", varsList: "+this.varsList_.toStringShort()+", dataPoints_: "+this.dataPoints_+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", xVar: "+r.NF(this.xVar_)+", yVar: "+r.NF(this.yVar_)+"}"}getClassName(){return"GraphLine"}addGraphStyle(){this.styles_.push(new ie(this.dataPoints_.getEndIndex()+1,this.drawMode_,this.drawColor_,this.lineWidth_)),this.changed_=!0}buildMenu(){let t=[h.i18n.NONE],e=[-1];for(let i=0,s=this.varsList_.numVariables();i<s;i++)t.push(this.varsList_.getVariable(i).getName(!0)),e.push(i);this.yVarParam_.setChoices(t,e),this.xVarParam_.setChoices(t,e)}getChanged(){return this.changed_?(this.changed_=!1,!0):!1}getColor(){return this.drawColor_}getDrawingMode(){return this.drawMode_}getGraphPoints(){return this.dataPoints_}getGraphStyle(t){let e=this.styles_;if(e.length==0)throw"graph styles list is empty";let i=e[0];for(let s=1,n=e.length;s<n;s++){let a=e[s];if(r.assert(i.index_<=a.index_),a.index_>t)break;i=a}return r.assert(r.isObject(i)),i}getHotSpotColor(){return this.hotSpotColor_}getLineWidth(){return this.lineWidth_}getVarsList(){return this.varsList_}getXVariable(){return this.xVar_}getXVarName(){return this.xVar_>-1?this.varsList_.getVariable(this.xVar_).getName(!0):""}getYVariable(){return this.yVar_}getYVarName(){return this.yVar_>-1?this.varsList_.getVariable(this.yVar_).getName(!0):""}memorize(){if(this.xVar_>-1&&this.yVar_>-1){let t=this.varsList_.getVariable(this.xVar_),e=this.varsList_.getVariable(this.yVar_),i=t.getValue(),s=e.getValue(),n=this.xTransform(i,s),a=this.yTransform(i,s),o=t.getSequence(),l=e.getSequence(),_=new ee(n,a,o,l),c=this.dataPoints_.getEndValue();(c==null||!c.equals(_))&&(this.dataPoints_.store(_),this.changed_=!0)}}observe(t){t.getSubject()==this.varsList_&&t.nameEquals(R.VARS_MODIFIED)&&this.buildMenu()}reset(){this.dataPoints_.reset(),this.resetStyle(),this.memorize(),this.broadcast(new p(this,h.RESET))}resetStyle(){this.styles_=[],this.addGraphStyle(),this.changed_=!0}setColor(t){this.drawColor_!=t&&(this.drawColor_=t,this.addGraphStyle(),this.changed_=!0,this.broadcastParameter(h.en.GRAPH_COLOR))}setDrawingMode(t){this.drawMode_!=t&&(this.drawMode_=t,this.addGraphStyle(),this.changed_=!0,this.broadcastParameter(h.en.DRAWING_MODE))}setHotSpotColor(t){this.hotSpotColor_=t,this.changed_=!0}setLineWidth(t){r.veryDifferent(t,this.lineWidth_)&&(this.lineWidth_=t,this.addGraphStyle(),this.changed_=!0,this.broadcastParameter(h.en.LINE_WIDTH))}setXVariable(t){if(typeof t=="string"){var e=this.varsList_.getVariable(t);t=this.varsList_.indexOf(e)}else if(t<-1||t>this.varsList_.numVariables()-1)throw"setXVariable bad index "+t;this.xVar_!=t&&(this.xVar_=t,this.reset(),this.broadcastParameter(h.en.X_VARIABLE))}setYVariable(t){if(typeof t=="string"){var e=this.varsList_.getVariable(t);t=this.varsList_.indexOf(e)}else if(t<-1||t>this.varsList_.numVariables()-1)throw"setYVariable bad index "+t;this.yVar_!=t&&(this.yVar_=t,this.reset(),this.broadcastParameter(h.en.Y_VARIABLE))}};E.RESET="RESET";E.en={DRAWING_MODE:"draw mode",GRAPH_COLOR:"graph color",GRAPH_DRAW_MODE:"graph draw mode",GRAPH_POINTS:"graph points",LINE_WIDTH:"draw width",X_VARIABLE:"X variable",Y_VARIABLE:"Y variable",CLEAR_GRAPH:"clear graph",NONE:"-none-"};E.de_strings={DRAWING_MODE:"Zeichnenart",GRAPH_COLOR:"Graph Farbe",GRAPH_DRAW_MODE:"Graph Zeichnenart",GRAPH_POINTS:"Punkteanzahl",LINE_WIDTH:"Zeichenbreite",X_VARIABLE:"X Variable",Y_VARIABLE:"Y Yariable",CLEAR_GRAPH:"Graph erneuern",NONE:"-keine-"};E.i18n=r.LOCALE==="de"?E.de_strings:E.en;r.defineGlobal("lab$graph$GraphLine",E);var ee=class{constructor(t,e,i,s){if(isNaN(t)||isNaN(e))throw"NaN in GraphPoint";this.x=t,this.y=e,this.seqX=i,this.seqY=s}toString(){return"GraphPoint{x: "+r.NF(this.x)+", y: "+r.NF(this.y)+", seqX: "+r.NF(this.seqX)+", seqY: "+r.NF(this.seqY)+"}"}equals(t){return this.x==t.x&&this.y==t.y&&this.seqX==t.seqX&&this.seqY==t.seqY}getX(){return this.x}getY(){return this.y}getZ(){return 0}};r.defineGlobal("lab$graph$GraphPoint",ee);var ie=class{constructor(t,e,i,s){this.index_=t,this.drawMode=e,this.color_=i,this.lineWidth=s}toString(){return"GraphStyle{index_: "+this.index_+", drawMode: "+this.drawMode+', color_:"'+this.color_+'", lineWidth: '+this.lineWidth+"}"}};r.defineGlobal("lab$graph$GraphStyle",ie);var k=class h extends T{constructor(t,e,i){if(super(t),this.enabled_=!0,this.isActive_=!0,this.ownEvent_=!1,this.axis_=h.BOTH_AXES,this.rangeSetX_=!1,this.rangeSetY_=!1,this.rangeXHi_=0,this.rangeXLo_=0,this.rangeYHi_=0,this.rangeYLo_=0,this.timeWindow_=10,this.extraMargin=.01,this.minSize=1e-14,!(e instanceof E))throw"not a GraphLine "+e;this.graphLines_=[],this.graphLines_.push(e),e.addObserver(this),this.simView_=i,i.addMemo(this),i.addObserver(this),this.lastIndex_=r.repeat(-1,this.graphLines_.length);let s=new y(this,h.en.TIME_WINDOW,h.i18n.TIME_WINDOW,()=>this.getTimeWindow(),a=>this.setTimeWindow(a));s.setSignifDigits(3),this.addParameter(s);let n=[h.VERTICAL,h.HORIZONTAL,h.BOTH_AXES];this.addParameter(new I(this,h.en.AXIS,h.i18n.AXIS,()=>this.getAxis(),a=>this.setAxis(a),n,n)),this.addParameter(new N(this,h.en.ACTIVE,h.i18n.ACTIVE,()=>this.getActive(),a=>this.setActive(a))),this.addParameter(new N(this,h.en.ENABLED,h.i18n.ENABLED,()=>this.getEnabled(),a=>this.setEnabled(a))),this.setComputed(this.isActive_)}toString(){return this.toStringShort().slice(0,-1)+", enabled_: "+this.enabled_+", isActive_: "+this.isActive_+", axis_: "+this.axis_+", extraMargin: "+r.NF(this.extraMargin)+", minSize: "+r.NF(this.minSize)+", timeWindow_: "+r.NF(this.timeWindow_)+", simView_: "+this.simView_.toStringShort()+", graphLines_: ["+this.graphLines_.map(t=>t.toStringShort())+"]"+super.toString()}getClassName(){return"AutoScale"}addGraphLine(t){if(!(t instanceof E))throw"not a GraphLine "+t;this.graphLines_.includes(t)||(this.graphLines_.push(t),this.lastIndex_.push(-1))}clearRange(){this.rangeXLo_=0,this.rangeXHi_=0,this.rangeSetX_=!1,this.rangeYLo_=0,this.rangeYHi_=0,this.rangeSetY_=!1}getActive(){return this.isActive_}getAxis(){return this.axis_}getEnabled(){return this.enabled_}getRangeRect(){return new S(this.rangeXLo_,this.rangeYLo_,this.rangeXHi_,this.rangeYHi_)}getTimeWindow(){return this.timeWindow_}memorize(){for(let t=0,e=this.graphLines_.length;t<e;t++){let i=this.graphLines_[t].getGraphPoints();this.lastIndex_[t]>i.getEndIndex()&&this.reset()}for(let t=0,e=this.graphLines_.length;t<e;t++){let s=this.graphLines_[t].getGraphPoints().getIterator(this.lastIndex_[t]);for(;s.hasNext();){let n=s.nextValue();this.updateRange_(this.graphLines_[t],n.x,n.y),this.lastIndex_[t]=s.getIndex()}}this.rangeCheck_()}observe(t){t.getSubject()==this.simView_?t.nameEquals(w.SIM_RECT_CHANGED)&&(this.ownEvent_||this.setActive(!1)):this.graphLines_.includes(t.getSubject())&&(t.nameEquals(E.en.X_VARIABLE)||t.nameEquals(E.en.Y_VARIABLE)?this.reset():t.nameEquals(E.RESET)&&this.setActive(!0))}rangeCheck_(){let t,e,i=this.minSize;this.rangeXHi_-this.rangeXLo_<i&&(t=(this.rangeXHi_+this.rangeXLo_)/2,e=Math.max(t*i,i),this.rangeXHi_=t+e,this.rangeXLo_=t-e),this.rangeYHi_-this.rangeYLo_<i&&(t=(this.rangeYHi_+this.rangeYLo_)/2,e=Math.max(t*i,i),this.rangeYHi_=t+e,this.rangeYLo_=t-e);let s=this.getRangeRect(),n=this.simView_.getSimRect();this.axis_==h.VERTICAL?s=new S(n.getLeft(),s.getBottom(),n.getRight(),s.getTop()):this.axis_==h.HORIZONTAL&&(s=new S(s.getLeft(),n.getBottom(),s.getRight(),n.getTop())),this.isActive_&&!s.nearEqual(n)&&(this.ownEvent_=!0,this.simView_.setSimRect(s),this.ownEvent_=!1,this.broadcast(new p(this,h.AUTO_SCALE,s)))}removeGraphLine(t){if(!(t instanceof E))throw"not a GraphLine "+t;let e=this.graphLines_.indexOf(t);if(e<0)throw"not found "+t;this.graphLines_.splice(e,1),this.lastIndex_.splice(e,1),r.assert(!this.graphLines_.includes(t)),this.reset()}reset(){this.clearRange();for(let t=0,e=this.lastIndex_.length;t<e;t++)this.lastIndex_[t]=-1}setActive(t){this.isActive_!=t&&(t?this.enabled_&&(this.reset(),this.simView_.addMemo(this),this.setComputed(!0),this.isActive_=!0,this.broadcastParameter(h.en.ACTIVE)):(this.simView_.removeMemo(this),this.setComputed(!1),this.isActive_=!1,this.broadcastParameter(h.en.ACTIVE))),r.assert(this.enabled_||!this.isActive_)}setAxis(t){if(t==h.VERTICAL||t==h.HORIZONTAL||t==h.BOTH_AXES)this.axis_=t,this.broadcastParameter(h.en.AXIS);else throw"unknown "+t}setComputed(t){[w.en.WIDTH,w.en.HEIGHT,w.en.CENTER_X,w.en.CENTER_Y].forEach(i=>this.simView_.getParameter(i).setComputed(t))}setEnabled(t){this.enabled_!=t&&(this.enabled_=t,this.setActive(t),this.broadcastParameter(h.en.ENABLED)),r.assert(this.enabled_||!this.isActive_)}setTimeWindow(t){r.veryDifferent(t,this.timeWindow_)&&(this.timeWindow_=t,this.reset(),this.memorize(),this.setActive(!0),this.broadcastParameter(h.en.TIME_WINDOW))}updateRange_(t,e,i){isFinite(e)||(e==Number.POSITIVE_INFINITY?e=1e308:e==Number.NEGATIVE_INFINITY&&(e=-1e308)),isFinite(i)||(i==Number.POSITIVE_INFINITY?i=1e308:i==Number.NEGATIVE_INFINITY&&(i=-1e308));let s=t.getVarsList().timeIndex(),n=t.getXVariable()==s,a=t.getYVariable()==s;this.rangeSetX_?(e<this.rangeXLo_&&(n?(this.rangeXLo_=e,this.rangeXHi_=e+this.timeWindow_):this.rangeXLo_=e-this.extraMargin*(this.rangeXHi_-this.rangeXLo_)),n?e>this.rangeXHi_-this.extraMargin*this.timeWindow_&&(this.rangeXHi_=e+this.extraMargin*this.timeWindow_,this.rangeXLo_=this.rangeXHi_-this.timeWindow_):e>this.rangeXHi_&&(this.rangeXHi_=e+this.extraMargin*(this.rangeXHi_-this.rangeXLo_))):(this.rangeXLo_=e,this.rangeXHi_=e+(n?this.timeWindow_:0),this.rangeSetX_=!0),this.rangeSetY_?(i<this.rangeYLo_&&(a?(this.rangeYLo_=i,this.rangeYHi_=i+this.timeWindow_):this.rangeYLo_=i-this.extraMargin*(this.rangeYHi_-this.rangeYLo_)),a?i>this.rangeYHi_-this.extraMargin*this.timeWindow_&&(this.rangeYHi_=i+this.extraMargin*this.timeWindow_,this.rangeYLo_=this.rangeYHi_-this.timeWindow_):i>this.rangeYHi_&&(this.rangeYHi_=i+this.extraMargin*(this.rangeYHi_-this.rangeYLo_))):(this.rangeYLo_=i,this.rangeYHi_=i+(a?this.timeWindow_:0),this.rangeSetY_=!0)}};k.AUTO_SCALE="AUTO_SCALE";k.BOTH_AXES="BOTH_AXES";k.HORIZONTAL="HORIZONTAL";k.VERTICAL="VERTICAL";k.en={AXIS:"axis",TIME_WINDOW:"time window",ACTIVE:"active",ENABLED:"enabled"};k.de_strings={AXIS:"Achse",TIME_WINDOW:"Zeitfenster",ACTIVE:"aktiviert",ENABLED:"erm\xF6glichte"};k.i18n=r.LOCALE==="de"?k.de_strings:k.en;r.defineGlobal("lab$graph$AutoScale",k);var Lt=class{constructor(t){if(this.offScreen_=null,this.lastMap_=null,this.screenRect_=F.EMPTY_RECT,this.needRedraw_=!1,this.useBuffer_=!0,this.zIndex=0,t!==void 0&&!(t instanceof E))throw"not a GraphLine "+t;this.graphLines_=t!==void 0?[t]:[],this.memDraw_=r.repeat(-1,this.graphLines_.length)}toString(){return this.toStringShort().slice(0,-1)+", screenRect_: "+this.screenRect_+", useBuffer_: "+this.useBuffer_+", zIndex: "+this.zIndex+", graphLines_: ["+this.graphLines_.map(t=>t.toStringShort())+"]}"}toStringShort(){return"DisplayGraph{graphLines_.length: "+this.graphLines_.length+"}"}addGraphLine(t){if(!(t instanceof E))throw"not a GraphLine "+t;this.graphLines_.includes(t)||(this.graphLines_.push(t),this.memDraw_.push(-1))}contains(t){return!1}draw(t,e){if(this.screenRect_.isEmpty()){r.DEBUG&&console.log("DisplayGraph: screenRect is empty");return}t.save(),(this.lastMap_==null||this.lastMap_!=e)&&(this.lastMap_=e,this.needRedraw_=!0);for(let i=0,s=this.graphLines_.length;i<s;i++)if(this.memDraw_[i]>this.graphLines_[i].getGraphPoints().getEndIndex()){this.reset();break}if(!this.useBuffer_)this.needRedraw_=!0,this.needRedraw_?(this.fullDraw(t,e),this.needRedraw_=!1):this.incrementalDraw(t,e);else{let i=this.screenRect_.getWidth(),s=this.screenRect_.getHeight();this.offScreen_==null&&(r.assert(i>0&&s>0),this.offScreen_=document.createElement("canvas"),this.offScreen_.width=i,this.offScreen_.height=s,this.needRedraw_=!0),r.assert(r.isObject(this.offScreen_));let n=this.offScreen_.getContext("2d");if(n===null)throw"DisplayGraph: getContext fail";this.needRedraw_?(n.clearRect(0,0,i,s),this.fullDraw(n,e),this.needRedraw_=!1):this.incrementalDraw(n,e),t.drawImage(this.offScreen_,0,0,i,s)}for(let i=0,s=this.graphLines_.length;i<s;i++)this.drawHotSpot(t,e,this.graphLines_[i]);t.restore()}drawHotSpot(t,e,i){let s=i.getGraphPoints().getEndValue();if(s!=null){let n=e.simToScreenX(s.getX()),a=e.simToScreenY(s.getY()),o=i.getHotSpotColor();o&&(t.fillStyle=o,t.fillRect(n-2,a-2,5,5))}}drawPoints(t,e,i,s){let n=e.screenToSimRect(this.screenRect_),a=s.getGraphPoints().getIterator(i);if(!a.hasNext())return i;let o=a.nextValue(),l=s.getGraphStyle(a.getIndex());if(l.drawMode=="dots"){let _=e.simToScreenX(o.x),c=e.simToScreenY(o.y),g=l.lineWidth;t.fillStyle=l.color_,t.fillRect(_,c,g,g)}for(;a.hasNext();){let _=o;if(o=a.nextValue(),o.x==_.x&&o.y==_.y)continue;l=s.getGraphStyle(a.getIndex());let c=o.seqX==_.seqX&&o.seqY==_.seqY;if(l.drawMode=="dots"||!c){if(!n.contains(o))continue;let g=e.simToScreenX(o.x),d=e.simToScreenY(o.y),m=l.lineWidth;t.fillStyle=l.color_,t.fillRect(g,d,m,m)}else{if(!n.maybeVisible(_,o))continue;let g=e.simToScreenX(_.x),d=e.simToScreenY(_.y),m=e.simToScreenX(o.x),f=e.simToScreenY(o.y);t.strokeStyle=l.color_,t.lineWidth=l.lineWidth,t.beginPath(),t.moveTo(g,d),t.lineTo(m,f),t.stroke()}}return a.getIndex()}fullDraw(t,e){this.memDraw_=r.repeat(-1,this.graphLines_.length),this.incrementalDraw(t,e)}getChanged(){let t=!1;for(let e=0,i=this.graphLines_.length;e<i;e++){let s=this.graphLines_[e].getChanged();t=t||s}return t||this.needRedraw_}getMassObjects(){return[]}getPosition(){return u.ORIGIN}getScreenRect(){return this.screenRect_}getSimObjects(){return[]}getUseBuffer(){return this.useBuffer_}getZIndex(){return this.zIndex}incrementalDraw(t,e){for(let i=0,s=this.graphLines_.length;i<s;i++)this.memDraw_[i]=this.drawPoints(t,e,this.memDraw_[i],this.graphLines_[i])}isDragable(){return!1}removeGraphLine(t){if(!(t instanceof E))throw"not a GraphLine "+t;let e=this.graphLines_.indexOf(t);if(e<0)throw"not found "+t;this.graphLines_.splice(e,1),this.memDraw_.splice(e,1),r.assert(!this.graphLines_.includes(t)),this.needRedraw_=!0}reset(){this.memDraw_=r.repeat(-1,this.graphLines_.length),this.needRedraw_=!0}setDragable(t){}setPosition(t){}setScreenRect(t){this.screenRect_=t,this.offScreen_=null,this.needRedraw_=!0}setUseBuffer(t){t!=this.useBuffer_&&(this.useBuffer_=t,this.useBuffer_||(this.offScreen_=null))}setZIndex(t){this.zIndex=t!==void 0?t:0,this.needRedraw_=!0}};r.defineGlobal("lab$graph$DisplayGraph",Lt);var lt=class{constructor(t,e){this.function_=t,this.purpose_=e||""}toString(){return this.toStringShort()}toStringShort(){return"GenericMemo{"+(this.purpose_.length>0?'purpose_:"'+this.purpose_+'"':"")+"}"}memorize(){this.function_()}};r.defineGlobal("lab$util$GenericMemo",lt);function ue(){return[G.AQUA,G.BLACK,G.BLUE,G.FUCHSIA,G.GRAY,G.GREEN,G.LIME,G.MAROON,G.NAVY,G.OLIVE,G.PURPLE,G.RED,G.SILVER,G.TEAL,G.WHITE,G.YELLOW]}function fe(){return["aqua","black","blue","fuchsia","gray","green","lime","maroon","navy","olive","purple","red","silver","teal","white","yellow"]}var Le={AQUA:"aqua",BLACK:"black",BLUE:"blue",FUCHSIA:"fuchsia",GRAY:"gray",GREEN:"green",LIME:"lime",MAROON:"maroon",NAVY:"navy",OLIVE:"olive",PURPLE:"purple",RED:"red",SILVER:"silver",TEAL:"teal",WHITE:"white",YELLOW:"yellow"},ve={AQUA:"Aquamarin",BLACK:"Schwarz",BLUE:"Blau",FUCHSIA:"Purpurrot",GRAY:"Grau",GREEN:"Gr\xFCn",LIME:"Hellgr\xFCn",MAROON:"Kastanienbraun",NAVY:"Marineblau",OLIVE:"Olivgr\xFCn",PURPLE:"Purpur",RED:"Rot",SILVER:"Silber",TEAL:"Blaugr\xFCn",WHITE:"Weiss",YELLOW:"Gelb"},G=r.LOCALE==="de"?ve:Le;var Ut=class extends T{constructor(t,e,i,s,n,a){super("GRAPH_LAYOUT"),this.displayStyle=a||"block",this.canvas=e,n.addCanvas(e),this.view=new w("X_Y_GRAPH_VIEW",new S(0,0,1,1)),this.view.setHorizAlign("FULL"),this.view.setVerticalAlign("FULL"),e.addView(this.view),this.displayList=this.view.getDisplayList(),this.line=new E("X_Y_GRAPH_LINE",t),this.line.setXVariable(0),this.line.setYVariable(1),this.line.setColor("lime"),this.view.addMemo(this.line),this.axes=L.makeAxes(this.view);let o=m=>{m.nameEquals(E.en.X_VARIABLE)&&this.axes.setHorizName(this.line.getXVarName()),m.nameEquals(E.en.Y_VARIABLE)&&this.axes.setVerticalName(this.line.getYVarName())};new Y(this.line,o,"update axes names"),o(new p(this.line,E.i18n.X_VARIABLE)),this.autoScale=new k("X_Y_AUTO_SCALE",this.line,this.view),this.autoScale.extraMargin=.05,this.displayGraph=new Lt(this.line),this.displayGraph.setScreenRect(this.view.getScreenRect()),this.displayGraph.setUseBuffer(!0),this.displayList.prepend(this.displayGraph),new Y(this.view,m=>{m.nameEquals(w.SCREEN_RECT_CHANGED)&&this.displayGraph.setScreenRect(this.view.getScreenRect())},"resize DisplayGraph"),this.controls_=[],this.div_controls=i;let l=this.line.getParameterNumber(E.en.Y_VARIABLE);this.addControl(new H(l,"Y:")),l=this.line.getParameterNumber(E.en.X_VARIABLE),this.addControl(new H(l,"X:")),this.addControl(new P(E.i18n.CLEAR_GRAPH,()=>this.line.reset()));let _=this.line.getParameterString(E.en.GRAPH_COLOR);this.addControl(new H(_,void 0,ue(),fe())),l=this.line.getParameterNumber(E.en.LINE_WIDTH),this.addControl(new tt(l)),_=this.line.getParameterString(E.en.DRAWING_MODE),this.addControl(new H(_)),this.graphCtrl=new at(e,null,{alt:!1,control:!1,meta:!1,shift:!1});let c=L.makePanZoomControls(this.view,!0,()=>{this.autoScale.setActive(!0)});s.appendChild(c);let g=L.makeShowPanZoomParam(c,this);this.addControl(new j(g));let d=this.line.getVarsList().timeIndex();n.addMemo(new lt(()=>{if(this.line.getXVariable()==d){let m=n.getClock().getTime(),f=this.autoScale.getTimeWindow();this.displayGraph.setUseBuffer(m<f)}else this.displayGraph.setUseBuffer(!0)},"graph: use off-screen buffer when not time-scrolling"))}toString(){return this.toStringShort().slice(0,-1)+", canvas: "+this.canvas.toStringShort()+", view: "+this.view.toStringShort()+", line: "+this.line.toStringShort()+", axes: "+this.axes.toStringShort()+", autoScale: "+this.autoScale.toStringShort()+", displayGraph: "+this.displayGraph.toStringShort()+", graphCtrl: "+this.graphCtrl.toStringShort()+super.toString()}getClassName(){return"StandardGraph1"}getSubjects(){return[this,this.line,this.view,this.autoScale]}addControl(t){let e=t.getElement();return e.style.display=this.displayStyle,this.div_controls.appendChild(e),this.controls_.push(t),t}};r.defineGlobal("sims$common$StandardGraph1",Ut);var V=class h extends T{constructor(t,e){super(e),this.simViews_=[],this.focusView_=null,this.alpha_=1,this.background_="",this.changed_=!0,this.counter_=0,this.debug_=!1,this.htmlCanvas_=t,this.memoList_=new rt,t.contentEditable="false",document.body.addEventListener("touchstart",function(i){i.target==t&&i.preventDefault()},{passive:!1}),document.body.addEventListener("touchend",function(i){i.target==t&&i.preventDefault()},{passive:!1}),document.body.addEventListener("touchmove",function(i){i.target==t&&i.preventDefault()},{passive:!1}),this.addParameter(new y(this,h.en.WIDTH,h.i18n.WIDTH,()=>this.getWidth(),i=>this.setWidth(i))),this.addParameter(new y(this,h.en.HEIGHT,h.i18n.HEIGHT,()=>this.getHeight(),i=>this.setHeight(i))),this.addParameter(new y(this,h.en.ALPHA,h.i18n.ALPHA,()=>this.getAlpha(),i=>this.setAlpha(i))),this.addParameter(new I(this,h.en.BACKGROUND,h.i18n.BACKGROUND,()=>this.getBackground(),i=>this.setBackground(i)))}toString(){return this.toStringShort().slice(0,-1)+", width: "+this.htmlCanvas_.width+", height: "+this.htmlCanvas_.height+', background_: "'+this.background_+'", alpha_: '+r.NF5(this.alpha_)+", focusView_: "+(this.focusView_==null?"null":this.focusView_.toStringShort())+", simViews_: ["+this.simViews_.map(t=>t.toStringShort())+"], memoList_: "+this.memoList_+super.toString()}getClassName(){return"LabCanvas"}addMemo(t){this.memoList_.addMemo(t)}addView(t){if(r.assert(r.isObject(t)),this.getWidth()>0&&this.getHeight()>0){let e=new F(0,0,this.getWidth(),this.getHeight());t.setScreenRect(e)}this.simViews_.push(t),this.addMemo(t),this.changed_=!0,this.broadcast(new p(this,h.VIEW_ADDED,t)),this.broadcast(new p(this,h.VIEW_LIST_MODIFIED)),this.focusView_==null&&this.setFocusView(t)}focus(){this.htmlCanvas_.focus()}getAlpha(){return this.alpha_}getBackground(){return this.background_}getCanvas(){return this.htmlCanvas_}getChanged(){let t=!1;for(let e=0,i=this.simViews_.length;e<i;e++){let s=this.simViews_[e].getChanged();t=t||s}return t||this.changed_?(this.changed_=!1,!0):!1}getContext(){let t=this.htmlCanvas_.getContext("2d");if(t===null)throw"unable to get CanvasRenderingContext2D";return t}getFocusView(){return this.focusView_}getHeight(){return this.htmlCanvas_.height}getMemos(){return this.memoList_.getMemos()}getScreenRect(){return new F(0,0,this.htmlCanvas_.width,this.htmlCanvas_.height)}getViews(){return Array.from(this.simViews_)}getWidth(){return this.htmlCanvas_.width}memorize(){this.memoList_.memorize()}notifySizeChanged(){let t=this.getScreenRect();this.simViews_.forEach(e=>e.setScreenRect(t)),this.changed_=!0,this.broadcast(new p(this,h.SIZE_CHANGED))}paint(){if(this.htmlCanvas_.offsetParent!=null){this.counter_>0&&this.counter_--;let t=this.getChanged();if(t||this.counter_>0){let e=this.htmlCanvas_.getContext("2d");if(e===null)throw"unable to get html context";e.save();try{this.background_!=""?(e.globalAlpha=this.alpha_,e.fillStyle=this.background_,e.fillRect(0,0,this.htmlCanvas_.width,this.htmlCanvas_.height),e.globalAlpha=1,this.alpha_==1?this.counter_=0:t&&(this.counter_=Math.floor(10/this.alpha_))):e.clearRect(0,0,this.htmlCanvas_.width,this.htmlCanvas_.height),this.simViews_.forEach(i=>i.paint(e))}finally{e.restore()}}}}removeMemo(t){this.memoList_.removeMemo(t)}removeView(t){if(!(t instanceof w))throw"not a SimView "+t;r.remove(this.simViews_,t),this.removeMemo(t),this.focusView_==t&&this.setFocusView(this.simViews_.length===0?null:this.simViews_[0]),this.changed_=!0,this.broadcast(new p(this,h.VIEW_REMOVED,t)),this.broadcast(new p(this,h.VIEW_LIST_MODIFIED))}setAlpha(t){if(r.veryDifferent(this.alpha_,t)){if(t<=0||t>1)throw"alpha must be between 0 and 1";this.alpha_=t,r.veryDifferent(t,1)&&this.background_==""&&this.setBackground("white"),this.changed_=!0,this.broadcastParameter(h.en.ALPHA)}}setBackground(t){this.background_!=t&&(this.background_=t,this.changed_=!0,this.broadcastParameter(h.en.BACKGROUND))}setFocusView(t){if(t!=null&&!this.simViews_.includes(t))throw"cannot set focus to unknown view "+t;this.focusView_!=t&&(this.focusView_!=null&&this.focusView_.loseFocus(),this.focusView_=t,t?.gainFocus(),this.changed_=!0,this.broadcast(new p(this,h.FOCUS_VIEW_CHANGED,t)))}setHeight(t){r.veryDifferent(t,this.htmlCanvas_.height)&&(this.htmlCanvas_.height=t),this.notifySizeChanged(),this.broadcastParameter(h.en.HEIGHT)}setScreenRect(t){if(!(t instanceof F))throw"not a ScreenRect: "+t;if(t.getTop()!=0||t.getLeft()!=0)throw"top left must be (0,0), was: "+t;this.changed_=!0,this.setSize(t.getWidth(),t.getHeight())}setSize(t,e){if(typeof t!="number"||t<=0||typeof e!="number"||e<=0)throw"bad size "+t+", "+e;this.htmlCanvas_.width=t,this.htmlCanvas_.height=e,this.notifySizeChanged(),this.broadcastParameter(h.en.WIDTH),this.broadcastParameter(h.en.HEIGHT)}setWidth(t){r.veryDifferent(t,this.htmlCanvas_.width)&&(this.htmlCanvas_.width=t),this.notifySizeChanged(),this.broadcastParameter(h.en.WIDTH)}};V.FOCUS_VIEW_CHANGED="FOCUS_VIEW_CHANGED";V.SIZE_CHANGED="SIZE_CHANGED";V.VIEW_LIST_MODIFIED="VIEW_LIST_MODIFIED";V.VIEW_ADDED="VIEW_ADDED";V.VIEW_REMOVED="VIEW_REMOVED";V.en={WIDTH:"width",HEIGHT:"height",ALPHA:"alpha",BACKGROUND:"background"};V.de_strings={WIDTH:"Breite",HEIGHT:"H\xF6he",ALPHA:"alpha",BACKGROUND:"Hintergrund"};V.i18n=r.LOCALE==="de"?V.de_strings:V.en;r.defineGlobal("lab$view$LabCanvas",V);var et=class h extends T{constructor(t,e=800,i=800,s=!0){super("TAB_LAYOUT"),this.limitSize_=!0,this.simWidth_=1,this.graphWidth_=1,this.timeGraphWidth_=1,this.debug_layout=!1,this.controls_=[],this.show_term_cb=null,r.setImagesDir(t.images_dir),this.tab_list=r.getElementById(t.tab_list),this.layout_=this.getSelectedTab(),this.terminalEnabled_=s,this.layout_==""&&(this.layout_="sim",this.setSelectedTab(this.layout_)),this.tab_list.addEventListener("click",d=>{let m=d.target;if(m===void 0)throw"event target is undefined";m==null||m.tagName!="LI"||m.className.indexOf("selected")>-1||this.setLayoutFromTab(m.className)}),window.addEventListener("resize",()=>this.redoLayout());let n=window.screen.orientation;n!==void 0?n.addEventListener("orientationchange",()=>this.redoLayout()):window.addEventListener("orientationchange",()=>this.redoLayout());let a=r.maybeElementById(t.term_output);this.term_input=r.maybeElementById(t.term_input),this.terminal=new st(this.term_input,a),st.stdRegex(this.terminal),this.div_contain=r.getElementById(t.container),this.debug_layout&&(this.div_contain.style.border="dashed 1px red"),this.div_sim=r.getElementById(t.sim_applet),this.div_sim.style.position="relative";let o=document.createElement("canvas");o.tabIndex=0,this.simCanvas=new V(o,"SIM_CANVAS"),this.simCanvas.setSize(e,i),this.div_sim.appendChild(this.simCanvas.getCanvas()),this.show_sim_cb=r.getElementById(t.show_sim);let l=this.show_sim_cb.parentElement;if(l==null||l.tagName!="LABEL")throw"";this.show_sim_label=l,this.show_sim_cb.addEventListener("click",d=>{this.showSim(this.show_sim_cb.checked)}),this.div_graph=r.getElementById(t.div_graph),this.div_graph.style.position="relative";let _=document.createElement("canvas");this.graphCanvas=new V(_,"GRAPH_CANVAS"),e=Math.max(e,i),this.graphCanvas.setSize(e,e),this.div_graph.appendChild(_),this.div_graph_controls=r.getElementById(t.graph_controls),this.debug_layout&&(this.div_graph_controls.style.border="dashed 1px green"),this.div_sim_controls=r.getElementById(t.sim_controls),this.div_sim_controls.style.marginLeft="10px",this.debug_layout&&(this.div_sim_controls.style.border="dashed 1px green"),this.div_term=r.getElementById(t.div_terminal),this.div_term.style.display="none",this.debug_layout&&(this.div_term.style.border="dashed 1px green");let c=r.getElementById(t.label_terminal);this.terminalEnabled_?(c.style.display="inline",this.show_term_cb=r.getElementById(t.show_terminal),this.show_term_cb.addEventListener("click",d=>{this.show_term_cb!==null&&this.showTerminal(this.show_term_cb.checked)})):c.style.display="none",this.div_time_graph=r.getElementById(t.div_time_graph),this.div_time_graph.style.position="relative";let g=document.createElement("canvas");this.timeGraphCanvas=new V(g,"TIME_GRAPH_CANVAS"),this.timeGraphCanvas.setSize(e,e),this.div_time_graph.appendChild(g),this.div_time_graph_controls=r.getElementById(t.time_graph_controls),this.debug_layout&&(this.div_time_graph_controls.style.border="dashed 1px green"),this.redoLayout(),this.addParameter(new y(this,h.en.SIM_WIDTH,h.i18n.SIM_WIDTH,()=>this.getSimWidth(),d=>this.setSimWidth(d))),this.addParameter(new y(this,h.en.GRAPH_WIDTH,h.i18n.GRAPH_WIDTH,()=>this.getGraphWidth(),d=>this.setGraphWidth(d))),this.addParameter(new y(this,h.en.TIME_GRAPH_WIDTH,h.i18n.TIME_GRAPH_WIDTH,()=>this.getTimeGraphWidth(),d=>this.setTimeGraphWidth(d))),this.addParameter(new I(this,h.en.LAYOUT,h.i18n.LAYOUT,()=>this.getLayout(),d=>this.setLayout(d),h.getLayoutValues(),h.getLayoutValues())),this.terminalEnabled_&&this.addParameter(new N(this,h.en.SHOW_TERMINAL,h.i18n.SHOW_TERMINAL,()=>this.show_term_cb!=null?this.show_term_cb.checked:!1,d=>this.showTerminal(d)))}toString(){return this.toStringShort().slice(0,-1)+', layout_: "'+this.layout_+'", simWidth_: '+r.NF(this.simWidth_)+", graphWidth_: "+r.NF(this.graphWidth_)+", timeGraphWidth_: "+r.NF(this.timeGraphWidth_)+", simCanvas: "+this.simCanvas.toStringShort()+", graphCanvas: "+this.graphCanvas.toStringShort()+", timeGraphCanvas: "+this.timeGraphCanvas.toStringShort()+", terminal: "+this.terminal+", controls_: ["+this.controls_.map(t=>t.toStringShort())+"]"+super.toString()}getClassName(){return"TabLayout"}static getLayoutValues(){return["sim","graph","sim+graph","time_graph","sim+time_graph","multi_graph","sim+multi_graph"]}addControl(t,e=!0){if(e){let i=t.getElement();i.style.display="block",this.div_sim_controls.appendChild(i)}return this.controls_.push(t),t}alignCanvasControls(t,e,i){t.style.display="block",e.style.display="inline-block",e.style.columnCount="1",e.style.width="auto";let s=e.getBoundingClientRect().width;s=s>150?s:300;let n=t.offsetWidth||t.getBoundingClientRect().width;i!=null&&(i.style.display="block",n+=i.offsetWidth||i.getBoundingClientRect().width);let a=this.div_contain.offsetWidth||this.div_contain.getBoundingClientRect().width;a-n-2<s&&a>2*s&&(e.style.width="100%",e.style.columnCount="2")}getGraphCanvas(){return this.graphCanvas}getGraphControls(){return this.div_graph_controls}getGraphDiv(){return this.div_graph}getGraphWidth(){return this.graphWidth_}getLayout(){return this.layout_}getSelectedTab(){let t;return this.tab_list.childNodes.forEach(i=>{if(i.nodeType==Node.ELEMENT_NODE){let s=i;s.tagName=="LI"&&s.className.match(/.*selected/)!=null&&(t=s)}}),t===void 0?"":t.className.replace(/[ ]*selected/,"")}getSimCanvas(){return this.simCanvas}getSimControls(){return this.div_sim_controls}getSimDiv(){return this.div_sim}getSimWidth(){return this.simWidth_}getSubjects(){return[this,this.simCanvas,this.graphCanvas,this.timeGraphCanvas]}getTerminal(){return this.terminal}getTimeGraphCanvas(){return this.timeGraphCanvas}getTimeGraphControls(){return this.div_time_graph_controls}getTimeGraphDiv(){return this.div_time_graph}getTimeGraphWidth(){return this.timeGraphWidth_}redoLayout(){let t=r.getViewportSize()[0];switch(this.div_sim.style.float="left",this.div_graph.style.float="left",this.div_time_graph.style.float="left",this.layout_){case"":case"sim":this.div_graph.style.display="none",this.div_graph_controls.style.display="none",this.div_time_graph.style.display="none",this.div_time_graph_controls.style.display="none",this.setDisplaySize(.95*this.simWidth_,this.div_graph),this.alignCanvasControls(this.div_sim,this.div_sim_controls),this.show_sim_label.style.display="none";break;case"graph":this.div_sim.style.display="none",this.div_sim_controls.style.display="none",this.div_time_graph.style.display="none",this.div_time_graph_controls.style.display="none",this.setDisplaySize(.95*this.graphWidth_,this.div_graph),this.alignCanvasControls(this.div_graph,this.div_graph_controls),this.show_sim_cb.checked=!1,this.show_sim_label.style.display="inline";break;case"sim+graph":this.div_time_graph.style.display="none",this.div_sim_controls.style.display="none",this.div_time_graph_controls.style.display="none",t>600?this.setDisplaySize(.49,this.div_graph):this.setDisplaySize(.95*this.graphWidth_,this.div_graph),this.alignCanvasControls(this.div_graph,this.div_graph_controls,this.div_sim),this.show_sim_cb.checked=!0,this.show_sim_label.style.display="inline";break;case"time_graph":this.div_graph.style.display="none",this.div_graph_controls.style.display="none",this.div_sim.style.display="none",this.div_sim_controls.style.display="none",this.setDisplaySize(.95*this.timeGraphWidth_,this.div_time_graph),this.alignCanvasControls(this.div_time_graph,this.div_time_graph_controls),this.show_sim_cb.checked=!1,this.show_sim_label.style.display="inline";break;case"sim+time_graph":this.div_graph.style.display="none",this.div_sim_controls.style.display="none",this.div_graph_controls.style.display="none",t>600?this.setDisplaySize(.49,this.div_time_graph):this.setDisplaySize(.95*this.timeGraphWidth_,this.div_time_graph),this.alignCanvasControls(this.div_time_graph,this.div_time_graph_controls,this.div_sim),this.show_sim_cb.checked=!0,this.show_sim_label.style.display="inline";break;case"multi_graph":this.div_graph.style.display="block",this.div_time_graph.style.display="block",this.div_sim.style.display="none",this.div_sim_controls.style.display="none",this.div_graph_controls.style.display="none",this.div_time_graph_controls.style.display="none",this.setDisplaySize(.49,this.div_graph),this.setDisplaySize(.49,this.div_time_graph),this.show_sim_cb.checked=!1,this.show_sim_label.style.display="inline";break;case"sim+multi_graph":this.div_graph.style.display="block",this.div_time_graph.style.display="block",this.div_sim.style.display="block",this.div_sim_controls.style.display="none",this.div_graph_controls.style.display="none",this.div_time_graph_controls.style.display="none",this.setDisplaySize(.49,this.div_graph),this.setDisplaySize(.49,this.div_time_graph),this.show_sim_cb.checked=!0,this.show_sim_label.style.display="inline";break;default:throw'redoLayout: no such layout "'+this.layout_+'"'}}setDisplaySize(t,e){if(this.limitSize_){let n=r.getViewportSize()[1]-80,a=this.div_contain.offsetWidth||this.div_contain.getBoundingClientRect().width,o=this.simCanvas.getScreenRect(),l=o.getWidth(),_=o.getHeight(),c=n/a*(l/_);t=Math.min(t,c)}let i=Math.floor(t*100)+"%";this.div_sim.style.width=i,this.div_sim.style.height="auto",e.style.width=i,e.style.height="auto"}setGraphWidth(t){r.veryDifferent(t,this.graphWidth_)&&(this.graphWidth_=t),this.redoLayout(),this.broadcastParameter(h.en.GRAPH_WIDTH)}setLayout(t){if(t=t.toLowerCase().trim(),this.layout_!=t){this.layout_=t;let e=this.layout_;switch(e){case"sim+graph":e="graph";break;case"sim+time_graph":e="time_graph";break;case"sim+multi_graph":e="multi_graph";break;default:}this.setSelectedTab(e),this.redoLayout()}}setLayoutFromTab(t){if(t=t.toLowerCase().trim(),this.show_sim_cb.checked)switch(t){case"graph":t="sim+graph";break;case"time_graph":t="sim+time_graph";break;case"multi_graph":t="sim+multi_graph";break;default:}this.setLayout(t)}setSelectedTab(t){this.getSelectedTab()!=t&&this.tab_list.childNodes.forEach(e=>{if(e.nodeType!=Node.ELEMENT_NODE)return;let i=e;i.tagName=="LI"&&(i.className.trim()==t?i.className+=" selected":i.className.indexOf("selected")>-1&&(i.className=i.className.replace(/[ ]*selected/,"")))})}setSimWidth(t){r.veryDifferent(t,this.simWidth_)&&(this.simWidth_=t),this.redoLayout(),this.broadcastParameter(h.en.SIM_WIDTH)}setTimeGraphWidth(t){r.veryDifferent(t,this.timeGraphWidth_)&&(this.timeGraphWidth_=t),this.redoLayout(),this.broadcastParameter(h.en.TIME_GRAPH_WIDTH)}showSim(t){switch(this.layout_){case"":case"sim":break;case"graph":t&&this.setLayout("sim+graph");break;case"sim+graph":t||this.setLayout("graph");break;case"time_graph":t&&this.setLayout("sim+time_graph");break;case"sim+time_graph":t||this.setLayout("time_graph");break;case"multi_graph":t&&this.setLayout("sim+multi_graph");break;case"sim+multi_graph":t||this.setLayout("multi_graph");break;default:throw'showSim: no such layout "'+this.layout_+'"'}}showTerminal(t){this.terminalEnabled_&&(this.div_term.style.display=t?"block":"none",this.show_term_cb!=null&&(this.show_term_cb.checked=t),t&&this.term_input&&this.term_input.focus())}};et.en={SIM_WIDTH:"sim-width",GRAPH_WIDTH:"graph-width",TIME_GRAPH_WIDTH:"time-graph-width",LAYOUT:"layout",SHOW_TERMINAL:"show terminal"};et.de_strings={SIM_WIDTH:"Sim Breite",GRAPH_WIDTH:"Graf Breite",TIME_GRAPH_WIDTH:"Zeit Graf Breite",LAYOUT:"layout",SHOW_TERMINAL:"zeige Terminal"};et.i18n=r.LOCALE==="de"?et.de_strings:et.en;r.defineGlobal("sims$common$TabLayout",et);var zt=class extends T{constructor(t,e,i,s,n,a,o,l){super("TIME_GRAPH_LAYOUT"),this.controls_=[],a=a??"lime",o=o??"red",l=l??"blue",this.canvas=e,n.addCanvas(e),this.view=new w("TIME_GRAPH_VIEW",new S(0,0,1,1)),this.view.setHorizAlign("FULL"),this.view.setVerticalAlign("FULL"),e.addView(this.view),this.axes=L.makeAxes(this.view),this.line1=new E("TIME_GRAPH_LINE_1",t),this.line1.setColor(a),this.view.addMemo(this.line1),this.autoScale=new k("TIME_GRAPH_AUTO_SCALE",this.line1,this.view),this.autoScale.extraMargin=.05,this.displayGraph=new Lt(this.line1),this.displayGraph.setScreenRect(this.view.getScreenRect()),this.view.getDisplayList().prepend(this.displayGraph),new Y(this.view,f=>{f.nameEquals(w.SCREEN_RECT_CHANGED)&&this.displayGraph.setScreenRect(this.view.getScreenRect())},"resize DisplayGraph");let _=this.line1.getVarsList().timeIndex();this.line1.setXVariable(_),this.line1.setYVariable(0),this.line2=new E("TIME_GRAPH_LINE_2",t),this.autoScale.addGraphLine(this.line2),this.view.addMemo(this.line2),this.line2.setXVariable(_),this.line2.setYVariable(1),this.line2.setColor(o),this.displayGraph.addGraphLine(this.line2),this.line3=new E("TIME_GRAPH_LINE_3",t),this.autoScale.addGraphLine(this.line3),this.view.addMemo(this.line3),this.line3.setXVariable(_),this.line3.setYVariable(-1),this.line3.setColor(l),this.displayGraph.addGraphLine(this.line3),this.div_controls=i;let c=this.line1.getParameterNumber(E.en.Y_VARIABLE);this.addControl(new H(c,a)),c=this.line2.getParameterNumber(E.en.Y_VARIABLE),this.addControl(new H(c,o)),c=this.line3.getParameterNumber(E.en.Y_VARIABLE),this.addControl(new H(c,l)),c=this.line1.getParameterNumber(E.en.X_VARIABLE),this.addControl(new H(c,"X:")),c=this.autoScale.getParameterNumber(k.en.TIME_WINDOW),this.addControl(new tt(c));let g=new P(E.i18n.CLEAR_GRAPH,()=>{this.line1.reset(),this.line2.reset(),this.line3.reset()});this.addControl(g),this.line1Obs=new Y(this.line1,f=>{this.line2.setXVariable(this.line1.getXVariable()),this.line3.setXVariable(this.line1.getXVariable())},"ensure line2, line3 have same X variable as line1"),this.graphCtrl=new at(e,null,{alt:!1,control:!1,meta:!1,shift:!1}),this.view.setScaleTogether(!1),new Y(n,f=>{if(f.nameEquals(M.RESET)){let b=this.view.getWidth();this.view.setCenterX(b/2),this.autoScale.setActive(!0)}},"TimeGraph1: go to time zero on reset"),n.addMemo(new lt(()=>{if(this.line1.getXVariable()==_){let f=n.getClock().getTime(),b=this.autoScale.getTimeWindow();this.displayGraph.setUseBuffer(f<b)}else this.displayGraph.setUseBuffer(!0)},"time graph: use off-screen buffer when not time-scrolling"));let d=L.makePanZoomControls(this.view,!0,()=>this.autoScale.setActive(!0));s.appendChild(d);let m=L.makeShowPanZoomParam(d,this);this.addControl(new j(m))}toString(){return this.toStringShort().slice(0,-1)+", canvas: "+this.canvas.toStringShort()+", view: "+this.view.toStringShort()+", line1: "+this.line1.toStringShort()+", line2: "+this.line2.toStringShort()+", line3: "+this.line3.toStringShort()+", axes: "+this.axes.toStringShort()+", autoScale: "+this.autoScale.toStringShort()+", displayGraph: "+this.displayGraph.toStringShort()+", graphCtrl: "+this.graphCtrl.toStringShort()+super.toString()}getClassName(){return"TimeGraph1"}addControl(t){let e=t.getElement();return e.style.display="block",this.div_controls.appendChild(e),this.controls_.push(t),t}getSubjects(){return[this,this.line1,this.line2,this.line3,this.view,this.autoScale]}};r.defineGlobal("sims$common$TimeGraph1",zt);var Xt=class{constructor(t,e){this.numberFormat=r.NF5E,this.separator="	",this.variablesList_=t,this.dataPoints_=new ut(e||1e5),this.varIndex_=r.range(this.variablesList_.numVariables())}toString(){return this.toStringShort().slice(0,-1)+", samples: "+this.dataPoints_.getSize()+", separator: "+this.separator+", varIndex_: ["+r.array2string(this.varIndex_,r.NF0)+"]}"}toStringShort(){return"VarsHistory{variablesList: "+this.variablesList_.toStringShort()+"}"}getDataPoints(){return this.dataPoints_}getVariables(){return Array.from(this.varIndex_)}memorize(){let t=this.variablesList_.getValues(!0),e=this.varIndex_.map(s=>t[s]),i=this.dataPoints_.getEndValue();(i==null||!r.equals(e,i))&&this.dataPoints_.store(e)}output(t){t===void 0&&(t=!0);let e="";this.varIndex_.forEach((s,n)=>{e+=n>0?this.separator:"",e+=this.variablesList_.getVariable(s).getName(t)}),e+=`
`;let i=this.dataPoints_.getIterator();for(;i.hasNext();){let s=i.nextValue();e+=r.array2string(s,this.numberFormat,this.separator)+`
`}return e}reset(){this.dataPoints_.reset()}setVariables(t){let e=this.variablesList_.numVariables();t.forEach(i=>{if(i<0||i>e-1)throw"variable index "+i+" not between 0 and "+(e-1)}),this.varIndex_=t,this.dataPoints_.reset()}setNumberFormat(t){this.numberFormat=t}setSeparator(t){this.separator=t}toArray(){let t=this.dataPoints_.getIterator(),e=[];for(;t.hasNext();)e.push(t.nextValue());return e}};r.defineGlobal("lab$graph$VarsHistory",Xt);var $t=class extends ot{constructor(t,e,i,s,n){super(t,e,i),this.getter_=s,this.setter_=n}toString(){return super.toString().slice(0,-1)+", getter_: "+this.getter_+", setter_: "+this.setter_+"}"}getBroadcast(){return!1}getClassName(){return"FunctionVariable"}getValue(){return this.getter_()}setValue(t){this.setter_!==void 0&&this.getValue()!=t&&(this.setter_(t),this.seq_++,this.doesBroadcast_&&this.varsList_.broadcast(this))}setValueSmooth(t){this.setter_!==void 0&&this.setter_(t)}};r.defineGlobal("lab$model$FunctionVariable",$t);var jt=class{constructor(t,e,i){this.zIndex_=0,this.dragable_=!1,this.changed_=!0,this.text_=t??"",this.location_=e??u.ORIGIN,this.proto_=i??null}toString(){return this.toStringShort().slice(0,-1)+", location: "+this.location_+", font: "+this.getFont()+', fillStyle: "'+this.getFillStyle()+'", textAlign: '+this.getTextAlign()+", textBaseline: "+this.getTextBaseline()+", zIndex: "+this.getZIndex()+"}"}toStringShort(){return"DisplayText{text_: "+this.text_+"}"}contains(t){return!1}draw(t,e){t.save(),t.fillStyle=this.getFillStyle(),t.font=this.getFont(),t.textAlign=this.getTextAlign(),t.textBaseline=this.getTextBaseline();let i=e.simToScreenX(this.location_.getX()),s=e.simToScreenY(this.location_.getY());t.fillText(this.text_,i,s),t.restore()}getChanged(){return this.changed_?(this.changed_=!1,!0):!1}getFillStyle(){return this.fillStyle_!==void 0?this.fillStyle_:this.proto_!=null?this.proto_.getFillStyle():"black"}getFont(){return this.font_!==void 0?this.font_:this.proto_!=null?this.proto_.getFont():"12pt sans-serif"}getMassObjects(){return[]}getPosition(){return this.location_}getSimObjects(){return[]}getTextAlign(){return this.textAlign_!==void 0?this.textAlign_:this.proto_!=null?this.proto_.getTextAlign():"left"}getTextBaseline(){return this.textBaseline_!==void 0?this.textBaseline_:this.proto_!=null?this.proto_.getTextBaseline():"alphabetic"}getText(){return this.text_}getZIndex(){return this.zIndex_!==void 0?this.zIndex_:this.proto_!=null?this.proto_.getZIndex():0}isDragable(){return this.dragable_}setDragable(t){this.dragable_=t}setFillStyle(t){return this.fillStyle_=t,this.changed_=!0,this}setFont(t){return this.font_=t,this.changed_=!0,this}setPosition(t){this.location_=u.clone(t),this.changed_=!0}setText(t){this.text_=t,this.changed_=!0}setTextAlign(t){return this.textAlign_=t,this.changed_=!0,this}setTextBaseline(t){return this.textBaseline_=t,this.changed_=!0,this}setZIndex(t){this.zIndex_=t,this.changed_=!0}};r.defineGlobal("lab$view$DisplayText",jt);var ae=class extends T{constructor(t,e,i,s,n,a,o){super(o||"APP"),this.energyGraph=null,this.showEnergyParam=null,this.simRect=e,this.layout=this.makeLayout(t),this.terminal=this.layout.getTerminal();let l=this.layout.getSimCanvas();this.sim=i,this.sim.setTerminal(this.terminal),this.advance=s,this.simList=i.getSimList(),this.varsList=i.getVarsList(),this.simCtrl=new at(l,n),this.simView=new w("SIM_VIEW",this.simRect),l.addView(this.simView),this.displayList=this.simView.getDisplayList(),this.statusView=new w("STATUS_VIEW",new S(-10,-10,10,10)),l.addView(this.statusView),this.axes=L.makeAxes(this.simView,!0),this.simRun=new M(this.advance),this.simRun.addCanvas(l),this.simRun.addErrorObserver(this.simCtrl),this.clock=this.simRun.getClock(),a!=null&&(this.energyGraph=new O(a),this.showEnergyParam=L.makeShowEnergyParam(this.energyGraph,this.statusView,this)),this.displayClock=new B(()=>i.getTime(),()=>this.clock.getRealTime(),2,2),this.displayClock.setPosition(new u(8,4)),this.showClockParam=L.makeShowClockParam(this.displayClock,this.statusView,this);let _=L.makePanZoomControls(this.simView,!0,()=>this.simView.setSimRect(this.simRect));this.layout.getSimDiv().appendChild(_),this.panZoomParam=L.makeShowPanZoomParam(_,this),this.panZoomParam.setValue(!1),this.diffEqSolver=new J(i,a,s),this.graph=new Ut(i.getVarsList(),this.layout.getGraphCanvas(),this.layout.getGraphControls(),this.layout.getGraphDiv(),this.simRun),this.graph.line.setDrawingMode("lines"),this.timeGraph=this.makeTimeGraph(),this.easyScript,this.terminal.setAfterEval(()=>this.sim.modifyObjects())}toString(){return", sim: "+this.sim.toStringShort()+", simList: "+this.simList.toStringShort()+", simCtrl: "+this.simCtrl.toStringShort()+", advance: "+this.advance+", simRect: "+this.simRect+", simView: "+this.simView.toStringShort()+", statusView: "+this.statusView.toStringShort()+", axes: "+this.axes.toStringShort()+", simRun: "+this.simRun.toStringShort()+", clock: "+this.clock.toStringShort()+", energyGraph: "+(this.energyGraph==null?"null":this.energyGraph.toStringShort())+", displayClock: "+this.displayClock.toStringShort()+", graph: "+this.graph.toStringShort()+", timeGraph: "+this.timeGraph.toStringShort()+", layout: "+this.layout.toStringShort()+", easyScript: "+this.easyScript.toStringShort()+", terminal: "+this.terminal+super.toString()}makeLayout(t){let i=Math.round(800*this.simRect.getHeight()/this.simRect.getWidth());return new et(t,800,i,!0)}addControl(t){return this.layout.addControl(t)}addPlaybackControls(){this.addControl(L.makePlaybackControls(this.simRun))}addStandardControls(){this.showEnergyParam!=null&&this.addControl(new j(this.showEnergyParam)),this.addControl(new j(this.showClockParam)),this.addControl(new j(this.panZoomParam));let t=this.simRun.getParameterNumber(M.en.TIME_STEP);this.addControl(new tt(t)),t=this.simRun.getClock().getParameterNumber(A.en.TIME_RATE),this.addControl(new tt(t));let e=this.diffEqSolver.getParameterString(J.en.DIFF_EQ_SOLVER);this.addControl(new H(e));let i=L.makeBackgroundMenu(this.layout.getSimCanvas());this.addControl(i)}defineNames(t){this.simRun.setAppName(t),this.terminal.addToVars(t),this.terminal.addRegex("advance|axes|clock|diffEqSolver|displayClock|energyGraph|graph|layout|sim|simCtrl|simList|simRect|simRun|simView|statusView|timeGraph|easyScript|terminal|varsList|displayList",t+"."),this.terminal.addRegex("simCanvas",t+".layout.")}makeEasyScript(t){let e=[this.varsList];t&&(e=e.concat(t)),this.easyScript=L.makeEasyScript(this.getSubjects(),e,this.simRun,this.terminal)}getSubjects(){return[this,this.sim,this.diffEqSolver,this.simRun,this.clock,this.simView,this.statusView,this.varsList].concat(this.layout.getSubjects(),this.graph.getSubjects(),this.timeGraph.getSubjects())}addURLScriptButton(){this.addControl(L.makeURLScriptButton(this.easyScript,this.simRun))}eval(t,e=!0){return this.terminal.eval(t,e)}static loadClass(){var t=$t.toString;t=Xt.toString,t=lt.toString,t=jt.toString,t=Tt.toString}setup(){this.clock.resume(),this.terminal.parseURL(),this.sim.saveInitialState(),this.sim.modifyObjects(),this.simRun.memorize()}start(){this.simRun.startFiring()}},qt=class extends ae{constructor(t,e,i,s,n,a,o){super(t,e,i,s,n,a,o)}makeTimeGraph(){return new zt(this.sim.getVarsList(),this.layout.getTimeGraphCanvas(),this.layout.getTimeGraphControls(),this.layout.getTimeGraphDiv(),this.simRun)}};r.defineGlobal("sims$common$AbstractApp",qt);var _t=class h extends U{constructor(t,e,i){super(t),this.startPt_=e||u.ORIGIN,this.endPt_=i||u.ORIGIN}toString(){return super.toString().slice(0,-1)+", startPoint: "+this.getStartPoint()+", endPoint: "+this.getEndPoint()+"}"}getClassName(){return"ConcreteLine"}getBoundsWorld(){return S.make(this.getStartPoint(),this.getEndPoint())}getEndPoint(){return this.endPt_}getStartPoint(){return this.startPt_}getVector(){return this.getEndPoint().subtract(this.getStartPoint())}setEndPoint(t){this.endPt_=t,this.setChanged()}setStartPoint(t){this.startPt_=t,this.setChanged()}similar(t,e){return!(t instanceof h)||!t.getStartPoint().nearEqual(this.getStartPoint(),e)?!1:t.getEndPoint().nearEqual(this.getEndPoint(),e)}};var Dt=class{constructor(t,e){this.changed_=!0,this.line_=t??new _t("proto"),this.scale_=1,this.proto_=e??null}toString(){return this.toStringShort().slice(0,-1)+", scale_: "+r.NF(this.scale_)+", thickness: "+r.NF(this.getThickness())+', color: "'+this.getColor()+'", lineDash: ['+this.getLineDash()+"], zIndex: "+this.getZIndex()+", proto: "+(this.proto_!=null?this.proto_.toStringShort():"null")+"}"}toStringShort(){return"DisplayLine{line_: "+this.line_.toStringShort()+"}"}contains(t){return!1}draw(t,e){if(this.getThickness()>0){let s=this.line_.getStartPoint(),n;if(this.scale_==1)n=this.line_.getEndPoint();else{let l=this.line_.getVector();n=s.add(l.multiply(this.scale_))}if(s=e.simToScreen(s),n=e.simToScreen(n),s.distanceTo(n)<1e-6)return;t.save();let o=this.getLineDash();o.length>0&&t.setLineDash&&t.setLineDash(o),t.lineWidth=this.getThickness(),t.strokeStyle=this.getColor(),t.beginPath(),t.moveTo(s.getX(),s.getY()),t.lineTo(n.getX(),n.getY()),t.stroke(),t.restore()}}getColor(){return this.color_!==void 0?this.color_:this.proto_!=null?this.proto_.getColor():"gray"}getChanged(){return this.line_.getChanged()||this.changed_?(this.changed_=!1,!0):!1}getLineDash(){return this.lineDash_!==void 0?this.lineDash_:this.proto_!=null?this.proto_.getLineDash():[]}getMassObjects(){return[]}getPosition(){return this.line_.getStartPoint().add(this.line_.getEndPoint()).multiply(.5)}getScale(){return this.scale_}getSimObjects(){return[this.line_]}getThickness(){return this.thickness_!==void 0?this.thickness_:this.proto_!=null?this.proto_.getThickness():4}getZIndex(){return this.zIndex_!==void 0?this.zIndex_:this.proto_!=null?this.proto_.getZIndex():0}isDragable(){return!1}setColor(t){return this.color_=t,this.changed_=!0,this}setDragable(t){}setLineDash(t){return this.lineDash_=t,this.changed_=!0,this}setPosition(t){}setScale(t){return this.scale_=t,this}setThickness(t){return this.thickness_=t,this.changed_=!0,this}setZIndex(t){this.zIndex_=t,this.changed_=!0}};r.defineGlobal("lab$view$DisplayLine",Dt);var se=class h extends U{constructor(t,e,i,s){super(t),this.angle_=0,this.startAngle_=e,this.radius_=i,this.center_=s}toString(){return super.toString().slice(0,-1)+", startAngle_: "+r.NF(this.startAngle_)+", angle_: "+r.NF(this.angle_)+", radius_: "+r.NF(this.radius_)+", center_: "+this.center_+"}"}getClassName(){return"Arc"}getAngle(){return this.angle_}getBoundsWorld(){return S.makeCentered(this.center_,this.radius_,this.radius_)}getCenter(){return this.center_}getRadius(){return this.radius_}getStartAngle(){return this.startAngle_}setAngle(t){this.angle_=t,this.setChanged()}setCenter(t){this.center_=t,this.setChanged()}setRadius(t){this.radius_=t,this.setChanged()}setStartAngle(t){this.startAngle_=t,this.setChanged()}similar(t,e){return!(t instanceof h)||r.veryDifferent(t.startAngle_,this.startAngle_,e)||r.veryDifferent(t.angle_,this.angle_,e)||r.veryDifferent(t.radius_,this.radius_,e)?!1:t.getCenter().nearEqual(this.center_,e)}};var Pt=class h extends U{constructor(t,e,i,s,n,a,o){super(t),this.contactDistance=0,this.contactTolerance=0,this.body_=e,this.location_=i,this.direction_=n,this.locationCoordType_=s,this.directionCoordType_=a,this.torque_=o===void 0?0:o}toString(){return super.toString().slice(0,-1)+', body: "'+this.body_.getName()+'", location: '+this.location_+", direction: "+this.direction_+", locationCoordType: "+this.locationCoordType_+", directionCoordType: "+this.directionCoordType_+", torque: "+r.NF5E(this.torque_)+"}"}getClassName(){return"Force"}getBody(){return this.body_}getBoundsWorld(){return S.make(this.getStartPoint(),this.getEndPoint())}getEndPoint(){return this.getStartPoint().add(this.getVector())}getStartPoint(){return this.locationCoordType_==0?this.body_.bodyToWorld(this.location_):this.location_}getTorque(){return this.torque_}getVector(){return this.directionCoordType_==0?this.body_.rotateBodyToWorld(this.direction_):this.direction_}similar(t,e){if(!(t instanceof h)||t.getName()!=this.getName())return!1;let i=t;return this.getStartPoint().nearEqual(i.getStartPoint(),e)?this.getVector().nearEqual(i.getVector(),e):!1}};r.defineGlobal("lab$model$Force",Pt);var Mt=class extends U{constructor(t,e,i,s,n,a,o,l){super(t),this.damping_=0,this.body1_=e,this.attach1_=u.clone(i),this.body2_=s,this.attach2_=u.clone(n),this.restLength_=a,this.stiffness_=o??0,this.compressOnly_=l??!1}toString(){return super.toString().slice(0,-1)+', body1_:"'+this.body1_.getName()+'", attach1_: '+this.attach1_+', body2_:"'+this.body2_.getName()+'", attach2_: '+this.attach2_+", restLength_: "+r.NF(this.restLength_)+", stiffness_: "+r.NF(this.stiffness_)+", damping_: "+r.NF(this.damping_)+", compressOnly_: "+this.compressOnly_+"}"}getClassName(){return"Spring"}calculateForces(){let t=this.getStartPoint(),e=this.getEndPoint(),i=e.subtract(t),s=i.length();if(s<u.TINY_POSITIVE)throw"zero spring length";let n=-this.stiffness_*(s-this.restLength_),a=-n*(i.getX()/s),o=-n*(i.getY()/s),l=new u(a,o,0);if(this.damping_!=0&&(!this.compressOnly_||s<this.restLength_-1e-10)){let _=this.body1_.getVelocity(this.attach1_),c=this.body2_.getVelocity(this.attach2_),g=_.subtract(c).multiply(-this.damping_);l=l.add(g)}return[new Pt("spring",this.body1_,t,1,l,1),new Pt("spring",this.body2_,e,1,l.multiply(-1),1)]}disconnect(){}getAttach1(){return this.attach1_}getAttach2(){return this.attach2_}getBodies(){return[this.body1_,this.body2_]}getBody1(){return this.body1_}getBody2(){return this.body2_}getBoundsWorld(){return S.make(this.getStartPoint(),this.getEndPoint())}getDamping(){return this.damping_}getEndPoint(){if(this.attach2_==null||this.body2_==null)throw"";let t=this.body2_.bodyToWorld(this.attach2_);if(this.compressOnly_){let e=this.getStartPoint(),i=e.distanceTo(t),s=this.restLength_;if(i<=s)return t;{let n=t.subtract(e).normalize();return e.add(n.multiply(s))}}else return t}getLength(){return this.getEndPoint().distanceTo(this.getStartPoint())}getPotentialEnergy(){let t=this.getStretch();return .5*this.stiffness_*t*t}getRestLength(){return this.restLength_}getStartPoint(){if(this.attach1_==null||this.body1_==null)throw"";return this.body1_.bodyToWorld(this.attach1_)}getStiffness(){return this.stiffness_}getStretch(){return this.getLength()-this.restLength_}getVector(){return this.getEndPoint().subtract(this.getStartPoint())}setDamping(t){return this.damping_=t,this.setChanged(),this}setRestLength(t){this.restLength_=t,this.setChanged()}setStiffness(t){this.stiffness_=t,this.setChanged()}};Mt.LOADME="loadme";r.defineGlobal("lab$model$Spring",Mt);var vt=class h extends T{constructor(){super("SIM_LIST"),this.elements_=[],this.tolerance_=.1}toString(){return this.toStringShort().slice(0,-1)+", tolerance_: "+r.NF(this.tolerance_)+", elements_: ["+this.elements_.map((t,e)=>e+": "+t.toStringShort())+"]"+super.toString()}toStringShort(){return super.toStringShort().slice(0,-1)+", length: "+this.elements_.length+"}"}getClassName(){return"SimList"}add(...t){for(let e=0;e<t.length;e++){let i=t[e];if(!i)throw"cannot add invalid SimObject";let s=i.getExpireTime();if(isFinite(s)){let n;for(;n=this.getSimilar(i);)this.remove(n)}this.elements_.includes(i)||(this.elements_.push(i),this.broadcast(new p(this,h.OBJECT_ADDED,i)))}}addAll(t){for(let e=0,i=t.length;e<i;e++)this.add(t[e])}clear(){this.removeAll(this.toArray())}contains(t){return this.elements_.includes(t)}get(t){if(typeof t=="number"){if(t>=0&&t<this.elements_.length)return this.elements_[t]}else if(typeof t=="string"){t=r.toName(t);let e=this.elements_.find(i=>i.getName()==t);if(e!==void 0)return e}throw"SimList did not find "+t}getArc(t){let e=this.get(t);if(e instanceof se)return e;throw"no Arc named "+t}getConcreteLine(t){let e=this.get(t);if(e instanceof _t)return e;throw"no ConcreteLine named "+t}getMassObject(t){let e=this.get(t);if(e instanceof x)return e;throw"no MassObject named "+t}getPointMass(t){let e=this.get(t);if(e instanceof x)return e;throw"no PointMass named "+t}getSimilar(t,e){let i=e===void 0?this.tolerance_:e,s=this.elements_.find(n=>n.similar(t,i));return s!==void 0?s:null}getSpring(t){let e=this.get(t);if(e instanceof Mt)return e;throw"no Spring named "+t}getTolerance(){return this.tolerance_}indexOf(t){return this.elements_.indexOf(t)}length(){return this.elements_.length}remove(t){r.remove(this.elements_,t)&&this.broadcast(new p(this,h.OBJECT_REMOVED,t))}removeAll(t){for(let e=0,i=t.length;e<i;e++)this.remove(t[e])}removeTemporary(t){for(let e=this.elements_.length-1;e>=0;e--){let i=this.elements_[e];i.getExpireTime()<t&&(this.elements_.splice(e,1),this.broadcast(new p(this,h.OBJECT_REMOVED,i)))}}setTolerance(t){this.tolerance_=t}toArray(){return Array.from(this.elements_)}};vt.OBJECT_ADDED="OBJECT_ADDED";vt.OBJECT_MODIFIED="OBJECT_MODIFIED";vt.OBJECT_REMOVED="OBJECT_REMOVED";var Ct=class h extends T{constructor(t,e,i){super(t||"SIM"),this.initialState_=null,this.recentState_=null,this.terminal_=null,this.simList_=e||new vt,this.varsList_=i||new R([],[],this.getName()+"_VARS")}toString(){return", varsList_: "+this.varsList_.toStringShort()+", simList_: "+this.simList_.toStringShort()+super.toString()}getTime(){return this.varsList_.getTime()}getVarsList(){return this.varsList_}reset(){this.initialState_!=null&&this.varsList_.setValues(this.initialState_),this.simList_.removeTemporary(1/0),this.modifyObjects(),this.broadcast(new p(this,h.RESET))}restoreState(){this.recentState_!=null&&this.varsList_.setValues(this.recentState_,!0)}saveInitialState(){this.initialState_=this.varsList_.getValues(),this.broadcast(new p(this,h.INITIAL_STATE_SAVED))}saveState(){this.recentState_=this.varsList_.getValues()}getSimList(){return this.simList_}setVarsList(t){this.varsList_=t}setTerminal(t){this.terminal_=t}};Ct.RESET="RESET";Ct.INITIAL_STATE_SAVED="INITIAL_STATE_SAVED";r.defineGlobal("lab$model$AbstractODESim",Ct);var D=class{constructor(t,e,i,s,n){this.potential_=t||0,this.translational_=e||0,this.rotational_=i===void 0?NaN:i,this.workDone_=s===void 0?NaN:s,this.initialEnergy_=n===void 0?NaN:n}toString(){return"EnergyInfo{potential_: "+r.NF(this.potential_)+", translational_: "+r.NF(this.translational_)+", rotational_: "+r.NF(this.rotational_)+", workDone_: "+r.NF(this.workDone_)+", initialEnergy_: "+r.NF(this.initialEnergy_)+"}"}getInitialEnergy(){return this.initialEnergy_}getPotential(){return this.potential_}getRotational(){return this.rotational_}getTotalEnergy(){let t=this.potential_+this.translational_;return isNaN(this.rotational_)||(t+=this.rotational_),t}getTranslational(){return this.translational_}getWorkDone(){return this.workDone_}setInitialEnergy(t){this.initialEnergy_=t}setPotential(t){this.potential_=t}setRotational(t){this.rotational_=t}setTranslational(t){this.translational_=t}setWorkDone(t){this.workDone_=t}};D.en={POTENTIAL_ENERGY:"potential energy",TRANSLATIONAL_ENERGY:"translational energy",KINETIC_ENERGY:"kinetic energy",ROTATIONAL_ENERGY:"rotational energy",TOTAL:"total",TOTAL_ENERGY:"total energy",PE_OFFSET:"potential energy offset"};D.de_strings={POTENTIAL_ENERGY:"potenzielle Energie",TRANSLATIONAL_ENERGY:"Translationsenergie",KINETIC_ENERGY:"kinetische Energie",ROTATIONAL_ENERGY:"Rotationsenergie",TOTAL:"gesamt",TOTAL_ENERGY:"gesamte Energie",PE_OFFSET:"Potenzielle Energie Ausgleich"};D.i18n=r.LOCALE==="de"?D.de_strings:D.en;r.defineGlobal("lab$model$EnergyInfo",D);var ft=0,pt=1,St=2,Et=3,Nt=4,It=5,xt=6,bt=7,yt=8,Ce=9,W=class h extends Ct{constructor(t){super(t),this.rod1Length_=1,this.rod2Length_=1,this.rod1_=new _t("rod1"),this.rod2_=new _t("rod2"),this.bob1_=x.makeCircle(.2,"bob1"),this.bob2_=x.makeCircle(.2,"bob2"),this.gravity_=9.8,this.potentialOffset_=0,this.isDragging_=!1;let e=[h.en.ANGLE_1,h.en.ANGLE_1_VELOCITY,h.en.ANGLE_2,h.en.ANGLE_2_VELOCITY,h.en.ACCELERATION_1,h.en.ACCELERATION_2,D.en.KINETIC_ENERGY,D.en.POTENTIAL_ENERGY,D.en.TOTAL_ENERGY,R.en.TIME],i=[h.i18n.ANGLE_1,h.i18n.ANGLE_1_VELOCITY,h.i18n.ANGLE_2,h.i18n.ANGLE_2_VELOCITY,h.i18n.ACCELERATION_1,h.i18n.ACCELERATION_2,D.i18n.KINETIC_ENERGY,D.i18n.POTENTIAL_ENERGY,D.i18n.TOTAL_ENERGY,R.i18n.TIME];this.setVarsList(new R(e,i,this.getName()+"_VARS")),this.getVarsList().setComputed(Nt,It,xt,bt,yt),this.bob1_.setMass(2),this.bob2_.setMass(2),this.getSimList().add(this.rod1_,this.rod2_,this.bob1_,this.bob2_),this.restState(),this.getVarsList().setValue(0,Math.PI/8),this.saveInitialState(),this.addParameter(new y(this,h.en.ROD_1_LENGTH,h.i18n.ROD_1_LENGTH,()=>this.getRod1Length(),n=>this.setRod1Length(n))),this.addParameter(new y(this,h.en.ROD_2_LENGTH,h.i18n.ROD_2_LENGTH,()=>this.getRod2Length(),n=>this.setRod2Length(n))),this.addParameter(new y(this,h.en.MASS_1,h.i18n.MASS_1,()=>this.getMass1(),n=>this.setMass1(n))),this.addParameter(new y(this,h.en.MASS_2,h.i18n.MASS_2,()=>this.getMass2(),n=>this.setMass2(n))),this.addParameter(new y(this,h.en.GRAVITY,h.i18n.GRAVITY,()=>this.getGravity(),n=>this.setGravity(n)));let s=new y(this,D.en.PE_OFFSET,D.i18n.PE_OFFSET,()=>this.getPEOffset(),n=>this.setPEOffset(n));s.setLowerLimit(Number.NEGATIVE_INFINITY),s.setSignifDigits(5),this.addParameter(s)}toString(){return this.toStringShort().slice(0,-1)+", rod1Length_: "+r.NF(this.rod1Length_)+", rod2Length_: "+r.NF(this.rod2Length_)+", rod1_: "+this.rod1_+", rod2_: "+this.rod2_+", bob1_: "+this.bob1_+", bob2_: "+this.bob2_+", gravity_: "+r.NF(this.gravity_)+", potentialOffset_: "+r.NF(this.potentialOffset_)+super.toString()}getClassName(){return"DoublePendulumSim"}restState(){let t=this.getVarsList(),e=t.getValues();e[ft]=0,e[pt]=0,e[St]=0,e[Et]=0,t.setValues(e),this.moveObjects(e)}getEnergyInfo(){let t=this.rod1Length_,e=this.rod2Length_,i=this.bob1_.getKineticEnergy()+this.bob2_.getKineticEnergy(),s=this.bob1_.getPosition().getY(),n=this.bob2_.getPosition().getY(),a=this.gravity_*this.bob1_.getMass()*(s- -t)+this.gravity_*this.bob2_.getMass()*(n-(-t-e));return new D(a+this.potentialOffset_,i)}getPEOffset(){return this.potentialOffset_}setPEOffset(t){this.potentialOffset_=t,this.getVarsList().incrSequence(bt,yt),this.broadcastParameter(D.en.PE_OFFSET)}modifyObjects(){let t=this.getVarsList(),e=t.getValues(),i=r.limitAngle(e[ft]);i!=e[ft]&&(this.getVarsList().setValue(0,i,!1),e[ft]=i);let s=r.limitAngle(e[St]);s!=e[St]&&(this.getVarsList().setValue(2,s,!1),e[St]=s),this.moveObjects(e);let n=new Array(e.length);this.evaluate(e,n,0),e[Nt]=n[pt],e[It]=n[Et];let a=this.getEnergyInfo();e[xt]=a.getTranslational(),e[bt]=a.getPotential(),e[yt]=a.getTotalEnergy(),t.setValues(e,!0)}moveObjects(t){let e=t[ft],i=Math.sin(e),s=Math.cos(e),n=t[St],a=Math.sin(n),o=Math.cos(n),l=this.rod1Length_,_=this.rod2Length_,c=l*i,g=-l*s,d=c+_*a,m=g-_*o;this.bob1_.setPosition(new u(c,g)),this.bob2_.setPosition(new u(d,m));let f=t[pt]*l*s,b=t[pt]*l*i,C=f+t[Et]*_*o,v=b+t[Et]*_*a;this.bob1_.setVelocity(new u(f,b)),this.bob2_.setVelocity(new u(C,v)),this.rod1_.setStartPoint(u.ORIGIN),this.rod1_.setEndPoint(this.bob1_.getPosition()),this.rod2_.setStartPoint(this.bob1_.getPosition()),this.rod2_.setEndPoint(this.bob2_.getPosition())}startDrag(t,e,i,s,n){return t==this.bob1_||t==this.bob2_?(this.isDragging_=!0,!0):!1}mouseDrag(t,e,i){let s=this.getVarsList(),n=s.getValues(),a=e.subtract(i);t==this.bob1_?(n[ft]=Math.atan2(a.getX(),-a.getY()),n[pt]=0,n[Et]=0):t==this.bob2_&&(n[St]=Math.atan2(a.getX()-this.bob1_.getPosition().getX(),-(a.getY()-this.bob1_.getPosition().getY())),n[pt]=0,n[Et]=0),s.setValues(n),this.moveObjects(n)}finishDrag(t,e,i){this.isDragging_=!1}handleKeyEvent(t,e,i){}evaluate(t,e,i){if(r.zeroArray(e),e[Ce]=1,!this.isDragging_){let s=t[ft],n=t[pt],a=t[St],o=t[Et],l=this.bob2_.getMass(),_=this.bob1_.getMass(),c=this.rod1Length_,g=this.rod2Length_,d=this.gravity_;e[ft]=n;let m=-d*(2*_+l)*Math.sin(s);m=m-d*l*Math.sin(s-2*a),m=m-2*l*o*o*g*Math.sin(s-a),m=m-l*n*n*c*Math.sin(2*(s-a)),m=m/(c*(2*_+l-l*Math.cos(2*(s-a)))),e[pt]=m,e[St]=o,m=(_+l)*n*n*c,m=m+d*(_+l)*Math.cos(s),m=m+l*o*o*g*Math.cos(s-a),m=m*2*Math.sin(s-a),m=m/(g*(2*_+l-l*Math.cos(2*(s-a)))),e[Et]=m}return null}getMass1(){return this.bob1_.getMass()}setMass1(t){this.bob1_.setMass(t),this.getVarsList().incrSequence(Nt,It,xt,bt,yt),this.broadcastParameter(h.en.MASS_1)}getMass2(){return this.bob2_.getMass()}setMass2(t){this.bob2_.setMass(t),this.getVarsList().incrSequence(Nt,It,xt,bt,yt),this.broadcastParameter(h.en.MASS_2)}getGravity(){return this.gravity_}setGravity(t){this.gravity_=t,this.getVarsList().incrSequence(Nt,It,bt,yt),this.broadcastParameter(h.en.GRAVITY)}getRod1Length(){return this.rod1Length_}setRod1Length(t){this.rod1Length_=t,this.getVarsList().incrSequence(Nt,It,xt,bt,yt),this.broadcastParameter(h.en.ROD_1_LENGTH)}getRod2Length(){return this.rod2Length_}setRod2Length(t){this.rod2Length_=t,this.getVarsList().incrSequence(Nt,It,xt,bt,yt),this.broadcastParameter(h.en.ROD_2_LENGTH)}};W.en={ACCELERATION_1:"acceleration-1",ACCELERATION_2:"acceleration-2",ANGLE_1:"angle-1",ANGLE_1_VELOCITY:"angle-1 velocity",ANGLE_2:"angle-2",ANGLE_2_VELOCITY:"angle-2 velocity",GRAVITY:"gravity",MASS_1:"mass-1",MASS_2:"mass-2",ROD_1_LENGTH:"rod-1 length",ROD_2_LENGTH:"rod-2 length"};W.de_strings={ACCELERATION_1:"Beschleunigung-1",ACCELERATION_2:"Beschleunigung-2",ANGLE_1:"Winkel-1",ANGLE_1_VELOCITY:"Winkel-1 Geschwindigkeit",ANGLE_2:"Winkel-2",ANGLE_2_VELOCITY:"Winkel-2 Geschwindigkeit",GRAVITY:"Gravitation",MASS_1:"Masse-1",MASS_2:"Masse-2",ROD_1_LENGTH:"Stange-1 L\xE4nge",ROD_2_LENGTH:"Stange-2 L\xE4nge"};W.i18n=r.LOCALE==="de"?W.de_strings:W.en;r.defineGlobal("sims$pendulum$DoublePendulumSim",W);var Zt=class{constructor(t,e){this.sim_=t,this.odeSolver_=e||new z(t),this.timeStep_=.025}toString(){return this.toStringShort().slice(0,-1)+", odeSolver_: "+this.odeSolver_.toStringShort()+"}"}toStringShort(){return"SimpleAdvance{sim_: "+this.sim_.toStringShort()+"}"}advance(t,e){this.sim_.getSimList().removeTemporary(this.sim_.getTime());let i=this.odeSolver_.step(t);if(i!=null)throw"error during advance "+i;this.sim_.modifyObjects(),e!==void 0&&e.memorize()}getDiffEqSolver(){return this.odeSolver_}getTime(){return this.sim_.getTime()}getTimeStep(){return this.timeStep_}reset(){this.sim_.reset()}save(){this.sim_.saveInitialState()}setDiffEqSolver(t){this.odeSolver_=t}setTimeStep(t){this.timeStep_=t}};r.defineGlobal("lab$model$SimpleAdvance",Zt);var ct=class h{constructor(t,e,i,s,n){this.textboxValue_="",this.firstClick_=!1,this.parameter_=t,this.min_=e;let a=t.getLowerLimit();if(a>e)throw"lower limit on slider ="+r.NF(e)+" is less than parameter lower limit ="+r.NF(a);if(this.max_=i,e>=i)throw"min >= max";let o=t.getUpperLimit();if(o<i)throw"upper limit on slider ="+r.NF(i)+" is greater than parameter upper limit ="+r.NF(o);if(this.increments_=n||100,this.increments_<2)throw"increments < 2";if(this.multiply_=s??!0,this.multiply_&&e<=0)throw"slider cannot have min <= 0 and also exponential scale";if(this.delta_=h.rangeToDelta(e,i,this.increments_,this.multiply_),this.signifDigits_=t.getSignifDigits(),this.decimalPlaces_=t.getDecimalPlaces(),this.columns_=Math.max(8,1+this.signifDigits_),this.paramValue_=t.getValue(),r.assert(typeof this.paramValue_=="number"),this.slider_=document.createElement("input"),this.slider_.type="range",this.slider_.type=="text")throw"cannot make slider";this.slider_.min="0",this.slider_.max=String(this.increments_),this.slider_.step="1",this.slider_.value=String(this.valueToIncrement(this.paramValue_)),this.sliderValue_=this.incrementToValue(Number(this.slider_.value)),this.textField_=document.createElement("input"),this.textField_.type="text",this.textField_.size=this.columns_,this.label_=document.createElement("div"),this.label_.className="slider",this.label_.appendChild(document.createTextNode(t.getName(!0)+t.getUnits())),this.label_.appendChild(this.slider_),this.label_.appendChild(this.textField_),this.textField_.style.textAlign="right",this.changeSliderFn_=this.changeSlider.bind(this),this.slider_.addEventListener("input",this.changeSliderFn_,!0),this.slider_.addEventListener("change",this.changeSliderFn_,!0),this.clickSliderFn_=this.clickSlider.bind(this),this.slider_.addEventListener("click",this.clickSliderFn_,!0),this.validateTextFn_=this.validateText.bind(this),this.textField_.addEventListener("change",this.validateTextFn_,!0),this.focusTextFn_=this.focusText.bind(this),this.textField_.addEventListener("focus",this.focusTextFn_,!1),this.clickTextFn_=this.clickText.bind(this),this.textField_.addEventListener("click",this.clickTextFn_,!0),this.formatTextField(),this.parameter_.getSubject().addObserver(this)}toString(){return this.toStringShort().slice(0,-1)+", paramValue_: "+r.NF(this.paramValue_)+", sliderValue_: "+r.NF(this.sliderValue_)+", slider_.value: "+this.slider_.value+", textboxValue_: "+this.textboxValue_+", min_: "+r.NF(this.min_)+", max_: "+r.NF(this.max_)+", increments_: "+this.increments_+", delta_: "+r.NF(this.delta_)+", multiply_: "+this.multiply_+", signifDigits_: "+this.signifDigits_+", decimalPlaces_: "+this.decimalPlaces_+", columns_: "+this.columns_+"}"}toStringShort(){return"SliderControl{parameter: "+this.parameter_.toStringShort()+"}"}columnsNeeded(t,e){let i=h.magnitude(t);return 2+this.decimalPlacesNeeded(t,e)+(i>0?i:0)}decimalPlacesNeeded(t,e){if(this.decimalPlaces_>-1)return this.decimalPlaces_;{let i=e-1-h.magnitude(t);return i>16&&(i=16),i>0?i:0}}disconnect(){this.parameter_.getSubject().removeObserver(this),this.slider_.removeEventListener("input",this.changeSliderFn_,!0),this.slider_.removeEventListener("change",this.changeSliderFn_,!0),this.slider_.removeEventListener("click",this.clickSliderFn_,!0),this.textField_.removeEventListener("change",this.validateTextFn_,!0),this.textField_.removeEventListener("focus",this.focusTextFn_,!1),this.textField_.removeEventListener("click",this.clickTextFn_,!0)}clickText(t){this.firstClick_&&(this.textField_.select(),this.firstClick_=!1)}clickSlider(t){this.slider_.focus()}formatTextField(){let t=this.decimalPlacesNeeded(this.paramValue_,this.signifDigits_),e=this.columnsNeeded(this.paramValue_,this.signifDigits_);this.textboxValue_=this.paramValue_.toFixed(t),this.textField_.value=this.textboxValue_,e!=this.columns_&&(this.columns_=e,this.textField_.size=this.columns_)}focusText(t){this.firstClick_=!0}getDecimalPlaces(){return this.decimalPlaces_}getElement(){return this.label_}getParameter(){return this.parameter_}getSignifDigits(){return this.signifDigits_}getValue(){return this.paramValue_}incrementToValue(t){return this.multiply_?this.min_*Math.pow(this.delta_,t):this.min_+t*this.delta_}static magnitude(t){return Math.abs(t)<1e-15?0:Math.floor(Math.LOG10E*Math.log(Math.abs(t)))}observe(t){t==this.parameter_&&this.setValue(this.parameter_.getValue())}static rangeToDelta(t,e,i,s){return s?Math.exp((Math.log(e)-Math.log(t))/i):(e-t)/i}setDecimalPlaces(t){return this.decimalPlaces_!=t&&(this.decimalPlaces_=t>-1?t:-1,this.formatTextField()),this}setEnabled(t){this.textField_.disabled=!t,this.slider_.disabled=!t}setSignifDigits(t){return this.signifDigits_!=t&&(this.signifDigits_=t,this.formatTextField()),this}setValue(t){if(t!=this.paramValue_){if(isNaN(t))throw"not a number: "+t;try{this.paramValue_=t,this.parameter_.setValue(t)}catch(i){alert(i),this.paramValue_=this.parameter_.getValue()}this.formatTextField();let e=this.valueToIncrement(this.paramValue_);this.sliderValue_=this.incrementToValue(e),this.slider_.value=String(e)}}changeSlider(t){let e=this.incrementToValue(Number(this.slider_.value));r.veryDifferent(e,this.sliderValue_)&&this.setValue(e)}validateText(t){let e=this.textField_.value.trim();if(e!=this.textboxValue_){let i=parseFloat(e);isNaN(i)?(alert("not a number: "+e),this.formatTextField()):this.setValue(i)}}valueToIncrement(t){return this.multiply_?Math.floor(.5+(Math.log(t)-Math.log(this.min_))/Math.log(this.delta_)):Math.floor(.5+(t-this.min_)/this.delta_)}};r.defineGlobal("lab$controls$SliderControl",ct);var oe=class extends qt{constructor(t){r.setErrorHandler();let e=new S(-2,-2.2,2,1.5),i=new W,s=new Zt(i);super(t,e,i,s,i,i),this.rod1=new Dt(this.simList.getConcreteLine("rod1")),this.displayList.add(this.rod1),this.rod2=new Dt(this.simList.getConcreteLine("rod2")),this.displayList.add(this.rod2),this.bob1=new nt(this.simList.getPointMass("bob1")),this.bob1.setFillStyle("blue"),this.displayList.add(this.bob1),this.bob2=new nt(this.simList.getPointMass("bob2")),this.bob2.setFillStyle("blue"),this.displayList.add(this.bob2),this.marker1=x.makeCircle(.2,"marker1"),this.marker1.setPosition(new u(-3,1)),this.marker1Shape=new nt(this.marker1),this.marker1Shape.setFillStyle(""),this.marker1Shape.setStrokeStyle("red"),this.marker1Shape.setDragable(!0),this.displayList.add(this.marker1Shape),this.graph.line.setXVariable(0),this.graph.line.setYVariable(2),this.addPlaybackControls();let n;n=i.getParameterNumber(W.en.ROD_1_LENGTH),this.addControl(new ct(n,.1,10.1,!0)),n=i.getParameterNumber(W.en.ROD_2_LENGTH),this.addControl(new ct(n,.1,10.1,!0)),n=i.getParameterNumber(W.en.MASS_1),this.addControl(new ct(n,.2,20.2,!0)),n=i.getParameterNumber(W.en.MASS_2),this.addControl(new ct(n,.2,20.2,!0)),n=i.getParameterNumber(W.en.GRAVITY),this.addControl(new ct(n,0,20,!1)),this.addStandardControls(),this.makeEasyScript(),this.addURLScriptButton()}toString(){return this.toStringShort().slice(0,-1)+", bob1: "+this.bob1.toStringShort()+", bob2: "+this.bob2.toStringShort()+", rod1: "+this.rod2.toStringShort()+", rod2: "+this.rod2.toStringShort()+super.toString()}getClassName(){return"DoublePendulumApp"}defineNames(t){super.defineNames(t),this.terminal.addRegex("rod1|rod2|bob1|bob2",t+"."),this.terminal.addRegex("DoublePendulumSim","sims$pendulum$",!1)}};r.defineGlobal("sims$pendulum$DoublePendulumApp",oe);})();
 




/* Stylesheet for myphysicslab
* Organization of this style sheet is roughly similar to our typical page:
* HTML & BODY
* HEADER-BAR (LOGO, TABS, LANGUAGE MENU, NAV-LINKS)
* CANVAS
* UI CONTROLS
* GENERAL TEXT & HEADINGS
* MATH-IN-HTML
* IMAGES
* FOOTER
*/
 
/* After orientation change (portrait to landscape), to keep the text from getting
* bigger we need webkit-text-size-adjust:none
*/
html {
    -webkit-text-size-adjust: none;
    text-size-adjust: none;
}
 
body {
    background-color: white;
    color: black;
    margin: 0 0.1in;
    /*font-family: Palatino, "Book Antiqua", Times, "Times New Roman", serif;  */
    font-family: Georgia, "Bitstream Charter", serif;
    line-height: 1.25em;
    /* gives leading of 0.25em between lines: 1.25em - 1.0em font size */
}
 
/****** HEADER BAR: LOGO, TABS, LANGUAGE MENU, NAV-LINKS **********/
 
a#logo {
    float: right;
    margin: -9px 5px 0 0;
}
 
ul#header_bar,
ul.horiz_tabs {
    padding: 3px 0 0 0;
    margin: 3px 0;
    max-width: none;
}
 
ul.horiz_tabs {
    border-bottom: 1px solid #778;
}
 
ul#header_bar li {
    list-style: none;
}
 
ul.horiz_tabs li {
    list-style: none;
    display: inline-block;
    padding: 3px 0.5em;
    margin: 0 0 -1px 3px;
    border: 1px solid #778;
    background: #DDE;
    text-decoration: none;
    font: bold 12px Verdana, sans-serif;
    white-space: nowrap;
}
 
ul.horiz_tabs li.selected {
    background: white;
    border-bottom: 1px solid white;
}
 
/* this div contains language_menu and next/prev nav_links */
div#header_nav {
    clear: right;
    /* because logo is above */
    float: right;
    display: inline-block;
    margin: 0 0.5em 0 0;
}
 
select#language_menu {
    margin: 0 0 0 0.5em;
}
 
a.nav_link {
    font: 100% sans-serif;
    margin: 0 0 0 0.5em;
}
 
 
/********  CANVAS  ********/
 
/*see also SimController.mouseDown;  it has a fix for 'cursor change while drag' */
/* Note Nov 22 2016: the 'outline: none' solves a performance problem that is visible
 * as a "stutter" when using "black with trails" background mode. */
canvas {
    cursor: crosshair;
    border: 1px solid silver;
    outline: none;
    /* turns off outline drawn when selecting with mouse */
    width: 100%;
    /*-webkit-tap-highlight-color: rgba(255, 255, 255, 0);*/
}
 
/* Removed Jan 10 2016 because it results in empty space below SimView when
window is resized to be wide.
landscape mode:  leave blank area on right for user to scroll on iPhone etc
@media screen and (orientation:landscape) {
  canvas {
    width: 92%;
  }
}
*/
canvas:active {
    cursor: default;
    border: 1px dashed red;
}
 
/*********** UI CONTROLS *************/
 
div.control_container {
    clear: both;
    /* otherwise floating nav-links above are covered up, can't click */
    width: 100%;
}
 
div.control_container p {
    margin-top: 0em;
    margin-bottom: 0em;
}
 
div.control_group {
    vertical-align: top;
}
 
textarea {
    font-family: monospace, monospace;
    border: 1px solid silver;
    max-width: 50em;
}
 
label {
    white-space: nowrap;
    /* keep checkbox and label text together */
}
 
div.slider {
    display: inline;
}
 
label,
div.slider {
    font-family: sans-serif;
    font-size: 90%;
    margin-left: 0.3em;
    margin-bottom: 0.3em;
}
 
div.control_container input,
div.control_container select {
    margin-left: 0.7em;
    margin-right: 0.3em;
}
 
/* align slider controls, fixes Firefox layout */
div.control_container input[type='range'] {
    vertical-align: bottom;
}
 
button.icon {
    margin: 0;
    padding: 0;
    border-style: none;
    background-color: transparent;
}
 
button.icon:active {
    background-color: gray;
}
 
/* kludge for Firefox to get buttons to be same size as icon images they contain.
* http://stackoverflow.com/questions/8859908/buttons-too-tall-on-firefox
*/
button::-moz-focus-inner {
    border: 0;
    padding: 0;
}
 
/****** GENERAL TEXT & HEADINGS **********/
 
h2,
h3,
h4,
h5 {
    font-size: 115%;
    font-family: sans-serif;
    border-top: 3px solid #328DAE;
    /*color: #f90;  /* #f90 is orange.  Opera doesn't recognize 'orange' */
    /* other colors I liked:  #36c is a dark blue */
    color: #328DAE;
    margin: 0.5in 0 0.4in 0;
    clear: both;
    max-width: 50em;
}
 
h1 {
    margin-top: 12px;
    margin-bottom: 4px;
    font: bold 130% sans-serif;
    color: #328DAE;
}
 
 
p {
    margin: 1em 0.5em;
    max-width: 50em;
}
 
p.introduction {
    clear: both;
}
 
p.instructions,
p.hint {
    margin: 0.8em 2cm 0.8em 1cm;
    max-width: 40em;
    font-style: italic;
    text-align: left;
}
 
p.hint {
    text-align: right;
    font-size: 80%;
}
 
p.list {
    margin-top: 0cm;
    margin-bottom: 0cm;
    margin-left: 1cm;
}
 
p.quote {
    margin: 0.5em 1.5cm;
    text-align: left;
    font-size: 90%;
}
 
ul,
ol {
    max-width: 45em;
}
 
li {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}
 
code {
    font-family: monospace, monospace;
    font-size: 100%;
}
 
/****** MATH-IN-HTML **********/
 
/* inline equations */
span.inline-math {
    white-space: nowrap;
}
 
*.html-math sup,
*.html-math sub {
    font-size: 90%;
}
 
*.fraction,
*.display-equation,
*.table-equation {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    text-align: center;
    vertical-align: middle;
    max-width: 50em;
}
 
div.big_fraction {
    margin: 0.5em 0;
    padding: 0.5em;
    text-align: center;
    max-width: 50em;
}
 
/* left aligned equations. created Dec 2007*/
span.aligned_eqn {
    display: block;
}
 
*.aligned_eqn {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    margin-left: 2em;
    text-align: left;
    vertical-align: middle;
}
 
table {
    max-width: 50em;
    margin-right: 0.5em;
    margin-left: 0.5em;
}
 
/* inline fraction table  NOT USED??? */
table.inline_frac {
    display: inline;
    margin-top: 0;
    margin-bottom: 0;
    text-align: center;
    vertical-align: middle;
}
 
/* (note: don't use display:block on tables, it screws up NN tables) */
/* bigger line-height helps make eqns without ^2 more equal to those with ^2 */
*.aligned_eqn,
*.display-equation,
table.numbered-equation {
    line-height: 2em;
}
 
*.fraction {
    line-height: normal;
    /* for when fraction is wrapped by numbered-equation */
}
 
table.fraction {
    margin-right: auto;
    margin-left: auto;
}
 
/* numbered equations done with a table */
/* width slightly less than 100% because of bugs in IE when alongside an image
   see dbl_pendulum page. */
table.numbered-equation {
    width: 99%;
    text-align: center;
    vertical-align: middle;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    max-width: 50em;
}
 
ul.vars {
    list-style-type: none;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}
 
span.bigg {
    font-size: 150%;
}
 
/* for big math symbols */
 
span.vector {
    text-decoration: overline;
    font-weight: bolder;
    font-size: 110%;
}
 
span.nobr {
    white-space: nowrap;
}
 
/* for setting where to break long equations */
 
/* td { white-space: nowrap; } don't do this, it causes extremely wide equations
    which then causes Google mobile robot to think everything is too small Feb 2021 */
 
td.upper_line {
    border-top: solid 1px black;
}
 
/* for horiz line in fractions */
 
/*td.eqn_blank { text-align:left; width:2em; } /* for left side of numbered equations */
td.equation-number {
    text-align: right;
    width: 2em;
}
 
/* for numbered equations */
 
*.emphasized {
    border: solid 2px #f90;
}
 
div.emphasized {
    margin: 0.5em 0;
    padding: 0.5em;
    text-align: center;
    border: solid 2px #f90;
    max-width: 50em;
}
 
span.text {
    font-size: 90%;
}
 
/* smaller text within math expressions */
 
 
/******** IMAGES ********/
 
img {
    border: none;
    margin: 0;
}
 
/* give images a smaller centered font for picture captions */
div.image {
    float: left;
    margin: 0;
    text-align: center;
    font-size: 90%;
    /* small */
    font-family: sans-serif;
}
 
/* for centered images */
div.centered_image {
    margin: 0.5em 0;
    text-align: center;
    font-size: 90%;
    /* small */
    font-family: sans-serif;
}
 
/****** FOOTER ********/
 
p#page_history {
    max-width: none;
    font: normal 80% Verdana, sans-serif;
    text-align: center;
}
 
div#footer2 {
    text-align: right;
    margin: 1.2em 0 0.3em 0;
}
 
div#copyright {
    display: inline-block;
    float: left;
    text-align: left;
    font: bold 90% Verdana, sans-serif;
}
 
span#revised_date {
    font-weight: normal;
    font-size: 80%;
}
 
div#footer2 a.nav_link {
    vertical-align: 50%;
}
 
a#valid_html {
    margin: 0 0.5em;
}
